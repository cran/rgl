<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Duncan Murdoch" />

<meta name="date" content="2017-12-12" />

<title>Legacy WebGL Methods</title>

<script src="data:application/x-javascript,%28function%28%29%20%7B%0A%20%20%2F%2F%20If%20window%2EHTMLWidgets%20is%20already%20defined%2C%20then%20use%20it%3B%20otherwise%20create%20a%0A%20%20%2F%2F%20new%20object%2E%20This%20allows%20preceding%20code%20to%20set%20options%20that%20affect%20the%0A%20%20%2F%2F%20initialization%20process%20%28though%20none%20currently%20exist%29%2E%0A%20%20window%2EHTMLWidgets%20%3D%20window%2EHTMLWidgets%20%7C%7C%20%7B%7D%3B%0A%0A%20%20%2F%2F%20See%20if%20we%27re%20running%20in%20a%20viewer%20pane%2E%20If%20not%2C%20we%27re%20in%20a%20web%20browser%2E%0A%20%20var%20viewerMode%20%3D%20window%2EHTMLWidgets%2EviewerMode%20%3D%0A%20%20%20%20%20%20%2F%5Cbviewer%5Fpane%3D1%5Cb%2F%2Etest%28window%2Elocation%29%3B%0A%0A%20%20%2F%2F%20See%20if%20we%27re%20running%20in%20Shiny%20mode%2E%20If%20not%2C%20it%27s%20a%20static%20document%2E%0A%20%20%2F%2F%20Note%20that%20static%20widgets%20can%20appear%20in%20both%20Shiny%20and%20static%20modes%2C%20but%0A%20%20%2F%2F%20obviously%2C%20Shiny%20widgets%20can%20only%20appear%20in%20Shiny%20apps%2Fdocuments%2E%0A%20%20var%20shinyMode%20%3D%20window%2EHTMLWidgets%2EshinyMode%20%3D%0A%20%20%20%20%20%20typeof%28window%2EShiny%29%20%21%3D%3D%20%22undefined%22%20%26%26%20%21%21window%2EShiny%2EoutputBindings%3B%0A%0A%20%20%2F%2F%20We%20can%27t%20count%20on%20jQuery%20being%20available%2C%20so%20we%20implement%20our%20own%0A%20%20%2F%2F%20version%20if%20necessary%2E%0A%20%20function%20querySelectorAll%28scope%2C%20selector%29%20%7B%0A%20%20%20%20if%20%28typeof%28jQuery%29%20%21%3D%3D%20%22undefined%22%20%26%26%20scope%20instanceof%20jQuery%29%20%7B%0A%20%20%20%20%20%20return%20scope%2Efind%28selector%29%3B%0A%20%20%20%20%7D%0A%20%20%20%20if%20%28scope%2EquerySelectorAll%29%20%7B%0A%20%20%20%20%20%20return%20scope%2EquerySelectorAll%28selector%29%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20function%20asArray%28value%29%20%7B%0A%20%20%20%20if%20%28value%20%3D%3D%3D%20null%29%0A%20%20%20%20%20%20return%20%5B%5D%3B%0A%20%20%20%20if%20%28%24%2EisArray%28value%29%29%0A%20%20%20%20%20%20return%20value%3B%0A%20%20%20%20return%20%5Bvalue%5D%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20Implement%20jQuery%27s%20extend%0A%20%20function%20extend%28target%20%2F%2A%2C%20%2E%2E%2E%20%2A%2F%29%20%7B%0A%20%20%20%20if%20%28arguments%2Elength%20%3D%3D%201%29%20%7B%0A%20%20%20%20%20%20return%20target%3B%0A%20%20%20%20%7D%0A%20%20%20%20for%20%28var%20i%20%3D%201%3B%20i%20%3C%20arguments%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20var%20source%20%3D%20arguments%5Bi%5D%3B%0A%20%20%20%20%20%20for%20%28var%20prop%20in%20source%29%20%7B%0A%20%20%20%20%20%20%20%20if%20%28source%2EhasOwnProperty%28prop%29%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20target%5Bprop%5D%20%3D%20source%5Bprop%5D%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20return%20target%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20IE8%20doesn%27t%20support%20Array%2EforEach%2E%0A%20%20function%20forEach%28values%2C%20callback%2C%20thisArg%29%20%7B%0A%20%20%20%20if%20%28values%2EforEach%29%20%7B%0A%20%20%20%20%20%20values%2EforEach%28callback%2C%20thisArg%29%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20for%20%28var%20i%20%3D%200%3B%20i%20%3C%20values%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20callback%2Ecall%28thisArg%2C%20values%5Bi%5D%2C%20i%2C%20values%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20%2F%2F%20Replaces%20the%20specified%20method%20with%20the%20return%20value%20of%20funcSource%2E%0A%20%20%2F%2F%0A%20%20%2F%2F%20Note%20that%20funcSource%20should%20not%20BE%20the%20new%20method%2C%20it%20should%20be%20a%20function%0A%20%20%2F%2F%20that%20RETURNS%20the%20new%20method%2E%20funcSource%20receives%20a%20single%20argument%20that%20is%0A%20%20%2F%2F%20the%20overridden%20method%2C%20it%20can%20be%20called%20from%20the%20new%20method%2E%20The%20overridden%0A%20%20%2F%2F%20method%20can%20be%20called%20like%20a%20regular%20function%2C%20it%20has%20the%20target%20permanently%0A%20%20%2F%2F%20bound%20to%20it%20so%20%22this%22%20will%20work%20correctly%2E%0A%20%20function%20overrideMethod%28target%2C%20methodName%2C%20funcSource%29%20%7B%0A%20%20%20%20var%20superFunc%20%3D%20target%5BmethodName%5D%20%7C%7C%20function%28%29%20%7B%7D%3B%0A%20%20%20%20var%20superFuncBound%20%3D%20function%28%29%20%7B%0A%20%20%20%20%20%20return%20superFunc%2Eapply%28target%2C%20arguments%29%3B%0A%20%20%20%20%7D%3B%0A%20%20%20%20target%5BmethodName%5D%20%3D%20funcSource%28superFuncBound%29%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20Add%20a%20method%20to%20delegator%20that%2C%20when%20invoked%2C%20calls%0A%20%20%2F%2F%20delegatee%2EmethodName%2E%20If%20there%20is%20no%20such%20method%20on%0A%20%20%2F%2F%20the%20delegatee%2C%20but%20there%20was%20one%20on%20delegator%20before%0A%20%20%2F%2F%20delegateMethod%20was%20called%2C%20then%20the%20original%20version%0A%20%20%2F%2F%20is%20invoked%20instead%2E%0A%20%20%2F%2F%20For%20example%3A%0A%20%20%2F%2F%0A%20%20%2F%2F%20var%20a%20%3D%20%7B%0A%20%20%2F%2F%20%20%20method1%3A%20function%28%29%20%7B%20console%2Elog%28%27a1%27%29%3B%20%7D%0A%20%20%2F%2F%20%20%20method2%3A%20function%28%29%20%7B%20console%2Elog%28%27a2%27%29%3B%20%7D%0A%20%20%2F%2F%20%7D%3B%0A%20%20%2F%2F%20var%20b%20%3D%20%7B%0A%20%20%2F%2F%20%20%20method1%3A%20function%28%29%20%7B%20console%2Elog%28%27b1%27%29%3B%20%7D%0A%20%20%2F%2F%20%7D%3B%0A%20%20%2F%2F%20delegateMethod%28a%2C%20b%2C%20%22method1%22%29%3B%0A%20%20%2F%2F%20delegateMethod%28a%2C%20b%2C%20%22method2%22%29%3B%0A%20%20%2F%2F%20a%2Emethod1%28%29%3B%0A%20%20%2F%2F%20a%2Emethod2%28%29%3B%0A%20%20%2F%2F%0A%20%20%2F%2F%20The%20output%20would%20be%20%22b1%22%2C%20%22a2%22%2E%0A%20%20function%20delegateMethod%28delegator%2C%20delegatee%2C%20methodName%29%20%7B%0A%20%20%20%20var%20inherited%20%3D%20delegator%5BmethodName%5D%3B%0A%20%20%20%20delegator%5BmethodName%5D%20%3D%20function%28%29%20%7B%0A%20%20%20%20%20%20var%20target%20%3D%20delegatee%3B%0A%20%20%20%20%20%20var%20method%20%3D%20delegatee%5BmethodName%5D%3B%0A%0A%20%20%20%20%20%20%2F%2F%20The%20method%20doesn%27t%20exist%20on%20the%20delegatee%2E%20Instead%2C%0A%20%20%20%20%20%20%2F%2F%20call%20the%20method%20on%20the%20delegator%2C%20if%20it%20exists%2E%0A%20%20%20%20%20%20if%20%28%21method%29%20%7B%0A%20%20%20%20%20%20%20%20target%20%3D%20delegator%3B%0A%20%20%20%20%20%20%20%20method%20%3D%20inherited%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20if%20%28method%29%20%7B%0A%20%20%20%20%20%20%20%20return%20method%2Eapply%28target%2C%20arguments%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20Implement%20a%20vague%20facsimilie%20of%20jQuery%27s%20data%20method%0A%20%20function%20elementData%28el%2C%20name%2C%20value%29%20%7B%0A%20%20%20%20if%20%28arguments%2Elength%20%3D%3D%202%29%20%7B%0A%20%20%20%20%20%20return%20el%5B%22htmlwidget%5Fdata%5F%22%20%2B%20name%5D%3B%0A%20%20%20%20%7D%20else%20if%20%28arguments%2Elength%20%3D%3D%203%29%20%7B%0A%20%20%20%20%20%20el%5B%22htmlwidget%5Fdata%5F%22%20%2B%20name%5D%20%3D%20value%3B%0A%20%20%20%20%20%20return%20el%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20throw%20new%20Error%28%22Wrong%20number%20of%20arguments%20for%20elementData%3A%20%22%20%2B%0A%20%20%20%20%20%20%20%20arguments%2Elength%29%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20%2F%2F%20http%3A%2F%2Fstackoverflow%2Ecom%2Fquestions%2F3446170%2Fescape%2Dstring%2Dfor%2Duse%2Din%2Djavascript%2Dregex%0A%20%20function%20escapeRegExp%28str%29%20%7B%0A%20%20%20%20return%20str%2Ereplace%28%2F%5B%5C%2D%5C%5B%5C%5D%5C%2F%5C%7B%5C%7D%5C%28%5C%29%5C%2A%5C%2B%5C%3F%5C%2E%5C%5C%5C%5E%5C%24%5C%7C%5D%2Fg%2C%20%22%5C%5C%24%26%22%29%3B%0A%20%20%7D%0A%0A%20%20function%20hasClass%28el%2C%20className%29%20%7B%0A%20%20%20%20var%20re%20%3D%20new%20RegExp%28%22%5C%5Cb%22%20%2B%20escapeRegExp%28className%29%20%2B%20%22%5C%5Cb%22%29%3B%0A%20%20%20%20return%20re%2Etest%28el%2EclassName%29%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20elements%20%2D%20array%20%28or%20array%2Dlike%20object%29%20of%20HTML%20elements%0A%20%20%2F%2F%20className%20%2D%20class%20name%20to%20test%20for%0A%20%20%2F%2F%20include%20%2D%20if%20true%2C%20only%20return%20elements%20with%20given%20className%3B%0A%20%20%2F%2F%20%20%20if%20false%2C%20only%20return%20elements%20%2Awithout%2A%20given%20className%0A%20%20function%20filterByClass%28elements%2C%20className%2C%20include%29%20%7B%0A%20%20%20%20var%20results%20%3D%20%5B%5D%3B%0A%20%20%20%20for%20%28var%20i%20%3D%200%3B%20i%20%3C%20elements%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20if%20%28hasClass%28elements%5Bi%5D%2C%20className%29%20%3D%3D%20include%29%0A%20%20%20%20%20%20%20%20results%2Epush%28elements%5Bi%5D%29%3B%0A%20%20%20%20%7D%0A%20%20%20%20return%20results%3B%0A%20%20%7D%0A%0A%20%20function%20on%28obj%2C%20eventName%2C%20func%29%20%7B%0A%20%20%20%20if%20%28obj%2EaddEventListener%29%20%7B%0A%20%20%20%20%20%20obj%2EaddEventListener%28eventName%2C%20func%2C%20false%29%3B%0A%20%20%20%20%7D%20else%20if%20%28obj%2EattachEvent%29%20%7B%0A%20%20%20%20%20%20obj%2EattachEvent%28eventName%2C%20func%29%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20function%20off%28obj%2C%20eventName%2C%20func%29%20%7B%0A%20%20%20%20if%20%28obj%2EremoveEventListener%29%0A%20%20%20%20%20%20obj%2EremoveEventListener%28eventName%2C%20func%2C%20false%29%3B%0A%20%20%20%20else%20if%20%28obj%2EdetachEvent%29%20%7B%0A%20%20%20%20%20%20obj%2EdetachEvent%28eventName%2C%20func%29%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20%2F%2F%20Translate%20array%20of%20values%20to%20top%2Fright%2Fbottom%2Fleft%2C%20as%20usual%20with%0A%20%20%2F%2F%20the%20%22padding%22%20CSS%20property%0A%20%20%2F%2F%20https%3A%2F%2Fdeveloper%2Emozilla%2Eorg%2Fen%2DUS%2Fdocs%2FWeb%2FCSS%2Fpadding%0A%20%20function%20unpackPadding%28value%29%20%7B%0A%20%20%20%20if%20%28typeof%28value%29%20%3D%3D%3D%20%22number%22%29%0A%20%20%20%20%20%20value%20%3D%20%5Bvalue%5D%3B%0A%20%20%20%20if%20%28value%2Elength%20%3D%3D%3D%201%29%20%7B%0A%20%20%20%20%20%20return%20%7Btop%3A%20value%5B0%5D%2C%20right%3A%20value%5B0%5D%2C%20bottom%3A%20value%5B0%5D%2C%20left%3A%20value%5B0%5D%7D%3B%0A%20%20%20%20%7D%0A%20%20%20%20if%20%28value%2Elength%20%3D%3D%3D%202%29%20%7B%0A%20%20%20%20%20%20return%20%7Btop%3A%20value%5B0%5D%2C%20right%3A%20value%5B1%5D%2C%20bottom%3A%20value%5B0%5D%2C%20left%3A%20value%5B1%5D%7D%3B%0A%20%20%20%20%7D%0A%20%20%20%20if%20%28value%2Elength%20%3D%3D%3D%203%29%20%7B%0A%20%20%20%20%20%20return%20%7Btop%3A%20value%5B0%5D%2C%20right%3A%20value%5B1%5D%2C%20bottom%3A%20value%5B2%5D%2C%20left%3A%20value%5B1%5D%7D%3B%0A%20%20%20%20%7D%0A%20%20%20%20if%20%28value%2Elength%20%3D%3D%3D%204%29%20%7B%0A%20%20%20%20%20%20return%20%7Btop%3A%20value%5B0%5D%2C%20right%3A%20value%5B1%5D%2C%20bottom%3A%20value%5B2%5D%2C%20left%3A%20value%5B3%5D%7D%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20%2F%2F%20Convert%20an%20unpacked%20padding%20object%20to%20a%20CSS%20value%0A%20%20function%20paddingToCss%28paddingObj%29%20%7B%0A%20%20%20%20return%20paddingObj%2Etop%20%2B%20%22px%20%22%20%2B%20paddingObj%2Eright%20%2B%20%22px%20%22%20%2B%20paddingObj%2Ebottom%20%2B%20%22px%20%22%20%2B%20paddingObj%2Eleft%20%2B%20%22px%22%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20Makes%20a%20number%20suitable%20for%20CSS%0A%20%20function%20px%28x%29%20%7B%0A%20%20%20%20if%20%28typeof%28x%29%20%3D%3D%3D%20%22number%22%29%0A%20%20%20%20%20%20return%20x%20%2B%20%22px%22%3B%0A%20%20%20%20else%0A%20%20%20%20%20%20return%20x%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20Retrieves%20runtime%20widget%20sizing%20information%20for%20an%20element%2E%0A%20%20%2F%2F%20The%20return%20value%20is%20either%20null%2C%20or%20an%20object%20with%20fill%2C%20padding%2C%0A%20%20%2F%2F%20defaultWidth%2C%20defaultHeight%20fields%2E%0A%20%20function%20sizingPolicy%28el%29%20%7B%0A%20%20%20%20var%20sizingEl%20%3D%20document%2EquerySelector%28%22script%5Bdata%2Dfor%3D%27%22%20%2B%20el%2Eid%20%2B%20%22%27%5D%5Btype%3D%27application%2Fhtmlwidget%2Dsizing%27%5D%22%29%3B%0A%20%20%20%20if%20%28%21sizingEl%29%0A%20%20%20%20%20%20return%20null%3B%0A%20%20%20%20var%20sp%20%3D%20JSON%2Eparse%28sizingEl%2EtextContent%20%7C%7C%20sizingEl%2Etext%20%7C%7C%20%22%7B%7D%22%29%3B%0A%20%20%20%20if%20%28viewerMode%29%20%7B%0A%20%20%20%20%20%20return%20sp%2Eviewer%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20return%20sp%2Ebrowser%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20%2F%2F%20%40param%20tasks%20Array%20of%20strings%20%28or%20falsy%20value%2C%20in%20which%20case%20no%2Dop%29%2E%0A%20%20%2F%2F%20%20%20Each%20element%20must%20be%20a%20valid%20JavaScript%20expression%20that%20yields%20a%0A%20%20%2F%2F%20%20%20function%2E%20Or%2C%20can%20be%20an%20array%20of%20objects%20with%20%22code%22%20and%20%22data%22%0A%20%20%2F%2F%20%20%20properties%3B%20in%20this%20case%2C%20the%20%22code%22%20property%20should%20be%20a%20string%0A%20%20%2F%2F%20%20%20of%20JS%20that%27s%20an%20expr%20that%20yields%20a%20function%2C%20and%20%22data%22%20should%20be%0A%20%20%2F%2F%20%20%20an%20object%20that%20will%20be%20added%20as%20an%20additional%20argument%20when%20that%0A%20%20%2F%2F%20%20%20function%20is%20called%2E%0A%20%20%2F%2F%20%40param%20target%20The%20object%20that%20will%20be%20%22this%22%20for%20each%20function%0A%20%20%2F%2F%20%20%20execution%2E%0A%20%20%2F%2F%20%40param%20args%20Array%20of%20arguments%20to%20be%20passed%20to%20the%20functions%2E%20%28The%0A%20%20%2F%2F%20%20%20same%20arguments%20will%20be%20passed%20to%20all%20functions%2E%29%0A%20%20function%20evalAndRun%28tasks%2C%20target%2C%20args%29%20%7B%0A%20%20%20%20if%20%28tasks%29%20%7B%0A%20%20%20%20%20%20forEach%28tasks%2C%20function%28task%29%20%7B%0A%20%20%20%20%20%20%20%20var%20theseArgs%20%3D%20args%3B%0A%20%20%20%20%20%20%20%20if%20%28typeof%28task%29%20%3D%3D%3D%20%22object%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20theseArgs%20%3D%20theseArgs%2Econcat%28%5Btask%2Edata%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20task%20%3D%20task%2Ecode%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20var%20taskFunc%20%3D%20eval%28%22%28%22%20%2B%20task%20%2B%20%22%29%22%29%3B%0A%20%20%20%20%20%20%20%20if%20%28typeof%28taskFunc%29%20%21%3D%3D%20%22function%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20throw%20new%20Error%28%22Task%20must%20be%20a%20function%21%20Source%3A%5Cn%22%20%2B%20task%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20taskFunc%2Eapply%28target%2C%20theseArgs%29%3B%0A%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20function%20initSizing%28el%29%20%7B%0A%20%20%20%20var%20sizing%20%3D%20sizingPolicy%28el%29%3B%0A%20%20%20%20if%20%28%21sizing%29%0A%20%20%20%20%20%20return%3B%0A%0A%20%20%20%20var%20cel%20%3D%20document%2EgetElementById%28%22htmlwidget%5Fcontainer%22%29%3B%0A%20%20%20%20if%20%28%21cel%29%0A%20%20%20%20%20%20return%3B%0A%0A%20%20%20%20if%20%28typeof%28sizing%2Epadding%29%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20document%2Ebody%2Estyle%2Emargin%20%3D%20%220%22%3B%0A%20%20%20%20%20%20document%2Ebody%2Estyle%2Epadding%20%3D%20paddingToCss%28unpackPadding%28sizing%2Epadding%29%29%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20%28sizing%2Efill%29%20%7B%0A%20%20%20%20%20%20document%2Ebody%2Estyle%2Eoverflow%20%3D%20%22hidden%22%3B%0A%20%20%20%20%20%20document%2Ebody%2Estyle%2Ewidth%20%3D%20%22100%25%22%3B%0A%20%20%20%20%20%20document%2Ebody%2Estyle%2Eheight%20%3D%20%22100%25%22%3B%0A%20%20%20%20%20%20document%2EdocumentElement%2Estyle%2Ewidth%20%3D%20%22100%25%22%3B%0A%20%20%20%20%20%20document%2EdocumentElement%2Estyle%2Eheight%20%3D%20%22100%25%22%3B%0A%20%20%20%20%20%20if%20%28cel%29%20%7B%0A%20%20%20%20%20%20%20%20cel%2Estyle%2Eposition%20%3D%20%22absolute%22%3B%0A%20%20%20%20%20%20%20%20var%20pad%20%3D%20unpackPadding%28sizing%2Epadding%29%3B%0A%20%20%20%20%20%20%20%20cel%2Estyle%2Etop%20%3D%20pad%2Etop%20%2B%20%22px%22%3B%0A%20%20%20%20%20%20%20%20cel%2Estyle%2Eright%20%3D%20pad%2Eright%20%2B%20%22px%22%3B%0A%20%20%20%20%20%20%20%20cel%2Estyle%2Ebottom%20%3D%20pad%2Ebottom%20%2B%20%22px%22%3B%0A%20%20%20%20%20%20%20%20cel%2Estyle%2Eleft%20%3D%20pad%2Eleft%20%2B%20%22px%22%3B%0A%20%20%20%20%20%20%20%20el%2Estyle%2Ewidth%20%3D%20%22100%25%22%3B%0A%20%20%20%20%20%20%20%20el%2Estyle%2Eheight%20%3D%20%22100%25%22%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20return%20%7B%0A%20%20%20%20%20%20%20%20getWidth%3A%20function%28%29%20%7B%20return%20cel%2EoffsetWidth%3B%20%7D%2C%0A%20%20%20%20%20%20%20%20getHeight%3A%20function%28%29%20%7B%20return%20cel%2EoffsetHeight%3B%20%7D%0A%20%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20el%2Estyle%2Ewidth%20%3D%20px%28sizing%2Ewidth%29%3B%0A%20%20%20%20%20%20el%2Estyle%2Eheight%20%3D%20px%28sizing%2Eheight%29%3B%0A%0A%20%20%20%20%20%20return%20%7B%0A%20%20%20%20%20%20%20%20getWidth%3A%20function%28%29%20%7B%20return%20el%2EoffsetWidth%3B%20%7D%2C%0A%20%20%20%20%20%20%20%20getHeight%3A%20function%28%29%20%7B%20return%20el%2EoffsetHeight%3B%20%7D%0A%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20%2F%2F%20Default%20implementations%20for%20methods%0A%20%20var%20defaults%20%3D%20%7B%0A%20%20%20%20find%3A%20function%28scope%29%20%7B%0A%20%20%20%20%20%20return%20querySelectorAll%28scope%2C%20%22%2E%22%20%2B%20this%2Ename%29%3B%0A%20%20%20%20%7D%2C%0A%20%20%20%20renderError%3A%20function%28el%2C%20err%29%20%7B%0A%20%20%20%20%20%20var%20%24el%20%3D%20%24%28el%29%3B%0A%0A%20%20%20%20%20%20this%2EclearError%28el%29%3B%0A%0A%20%20%20%20%20%20%2F%2F%20Add%20all%20these%20error%20classes%2C%20as%20Shiny%20does%0A%20%20%20%20%20%20var%20errClass%20%3D%20%22shiny%2Doutput%2Derror%22%3B%0A%20%20%20%20%20%20if%20%28err%2Etype%20%21%3D%3D%20null%29%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F%20use%20the%20classes%20of%20the%20error%20condition%20as%20CSS%20class%20names%0A%20%20%20%20%20%20%20%20errClass%20%3D%20errClass%20%2B%20%22%20%22%20%2B%20%24%2Emap%28asArray%28err%2Etype%29%2C%20function%28type%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20return%20errClass%20%2B%20%22%2D%22%20%2B%20type%3B%0A%20%20%20%20%20%20%20%20%7D%29%2Ejoin%28%22%20%22%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20errClass%20%3D%20errClass%20%2B%20%22%20htmlwidgets%2Derror%22%3B%0A%0A%20%20%20%20%20%20%2F%2F%20Is%20el%20inline%20or%20block%3F%20If%20inline%20or%20inline%2Dblock%2C%20just%20display%3Anone%20it%0A%20%20%20%20%20%20%2F%2F%20and%20add%20an%20inline%20error%2E%0A%20%20%20%20%20%20var%20display%20%3D%20%24el%2Ecss%28%22display%22%29%3B%0A%20%20%20%20%20%20%24el%2Edata%28%22restore%2Ddisplay%2Dmode%22%2C%20display%29%3B%0A%0A%20%20%20%20%20%20if%20%28display%20%3D%3D%3D%20%22inline%22%20%7C%7C%20display%20%3D%3D%3D%20%22inline%2Dblock%22%29%20%7B%0A%20%20%20%20%20%20%20%20%24el%2Ehide%28%29%3B%0A%20%20%20%20%20%20%20%20if%20%28err%2Emessage%20%21%3D%3D%20%22%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20var%20errorSpan%20%3D%20%24%28%22%3Cspan%3E%22%29%2EaddClass%28errClass%29%3B%0A%20%20%20%20%20%20%20%20%20%20errorSpan%2Etext%28err%2Emessage%29%3B%0A%20%20%20%20%20%20%20%20%20%20%24el%2Eafter%28errorSpan%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%20else%20if%20%28display%20%3D%3D%3D%20%22block%22%29%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F%20If%20block%2C%20add%20an%20error%20just%20after%20the%20el%2C%20set%20visibility%3Anone%20on%20the%0A%20%20%20%20%20%20%20%20%2F%2F%20el%2C%20and%20position%20the%20error%20to%20be%20on%20top%20of%20the%20el%2E%0A%20%20%20%20%20%20%20%20%2F%2F%20Mark%20it%20with%20a%20unique%20ID%20and%20CSS%20class%20so%20we%20can%20remove%20it%20later%2E%0A%20%20%20%20%20%20%20%20%24el%2Ecss%28%22visibility%22%2C%20%22hidden%22%29%3B%0A%20%20%20%20%20%20%20%20if%20%28err%2Emessage%20%21%3D%3D%20%22%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20var%20errorDiv%20%3D%20%24%28%22%3Cdiv%3E%22%29%2EaddClass%28errClass%29%2Ecss%28%22position%22%2C%20%22absolute%22%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%2Ecss%28%22top%22%2C%20el%2EoffsetTop%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%2Ecss%28%22left%22%2C%20el%2EoffsetLeft%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20setting%20width%20can%20push%20out%20the%20page%20size%2C%20forcing%20otherwise%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20unnecessary%20scrollbars%20to%20appear%20and%20making%20it%20impossible%20for%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20the%20element%20to%20shrink%3B%20so%20use%20max%2Dwidth%20instead%0A%20%20%20%20%20%20%20%20%20%20%20%20%2Ecss%28%22maxWidth%22%2C%20el%2EoffsetWidth%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%2Ecss%28%22height%22%2C%20el%2EoffsetHeight%29%3B%0A%20%20%20%20%20%20%20%20%20%20errorDiv%2Etext%28err%2Emessage%29%3B%0A%20%20%20%20%20%20%20%20%20%20%24el%2Eafter%28errorDiv%29%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20Really%20dumb%20way%20to%20keep%20the%20size%2Fposition%20of%20the%20error%20in%20sync%20with%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20the%20parent%20element%20as%20the%20window%20is%20resized%20or%20whatever%2E%0A%20%20%20%20%20%20%20%20%20%20var%20intId%20%3D%20setInterval%28function%28%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28%21errorDiv%5B0%5D%2EparentElement%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20clearInterval%28intId%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20errorDiv%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2Ecss%28%22top%22%2C%20el%2EoffsetTop%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2Ecss%28%22left%22%2C%20el%2EoffsetLeft%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2Ecss%28%22maxWidth%22%2C%20el%2EoffsetWidth%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2Ecss%28%22height%22%2C%20el%2EoffsetHeight%29%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%2C%20500%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%2C%0A%20%20%20%20clearError%3A%20function%28el%29%20%7B%0A%20%20%20%20%20%20var%20%24el%20%3D%20%24%28el%29%3B%0A%20%20%20%20%20%20var%20display%20%3D%20%24el%2Edata%28%22restore%2Ddisplay%2Dmode%22%29%3B%0A%20%20%20%20%20%20%24el%2Edata%28%22restore%2Ddisplay%2Dmode%22%2C%20null%29%3B%0A%0A%20%20%20%20%20%20if%20%28display%20%3D%3D%3D%20%22inline%22%20%7C%7C%20display%20%3D%3D%3D%20%22inline%2Dblock%22%29%20%7B%0A%20%20%20%20%20%20%20%20if%20%28display%29%0A%20%20%20%20%20%20%20%20%20%20%24el%2Ecss%28%22display%22%2C%20display%29%3B%0A%20%20%20%20%20%20%20%20%24%28el%2EnextSibling%29%2Efilter%28%22%2Ehtmlwidgets%2Derror%22%29%2Eremove%28%29%3B%0A%20%20%20%20%20%20%7D%20else%20if%20%28display%20%3D%3D%3D%20%22block%22%29%7B%0A%20%20%20%20%20%20%20%20%24el%2Ecss%28%22visibility%22%2C%20%22inherit%22%29%3B%0A%20%20%20%20%20%20%20%20%24%28el%2EnextSibling%29%2Efilter%28%22%2Ehtmlwidgets%2Derror%22%29%2Eremove%28%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%2C%0A%20%20%20%20sizing%3A%20%7B%7D%0A%20%20%7D%3B%0A%0A%20%20%2F%2F%20Called%20by%20widget%20bindings%20to%20register%20a%20new%20type%20of%20widget%2E%20The%20definition%0A%20%20%2F%2F%20object%20can%20contain%20the%20following%20properties%3A%0A%20%20%2F%2F%20%2D%20name%20%28required%29%20%2D%20A%20string%20indicating%20the%20binding%20name%2C%20which%20will%20be%0A%20%20%2F%2F%20%20%20used%20by%20default%20as%20the%20CSS%20classname%20to%20look%20for%2E%0A%20%20%2F%2F%20%2D%20initialize%20%28optional%29%20%2D%20A%20function%28el%29%20that%20will%20be%20called%20once%20per%0A%20%20%2F%2F%20%20%20widget%20element%3B%20if%20a%20value%20is%20returned%2C%20it%20will%20be%20passed%20as%20the%20third%0A%20%20%2F%2F%20%20%20value%20to%20renderValue%2E%0A%20%20%2F%2F%20%2D%20renderValue%20%28required%29%20%2D%20A%20function%28el%2C%20data%2C%20initValue%29%20that%20will%20be%0A%20%20%2F%2F%20%20%20called%20with%20data%2E%20Static%20contexts%20will%20cause%20this%20to%20be%20called%20once%20per%0A%20%20%2F%2F%20%20%20element%3B%20Shiny%20apps%20will%20cause%20this%20to%20be%20called%20multiple%20times%20per%0A%20%20%2F%2F%20%20%20element%2C%20as%20the%20data%20changes%2E%0A%20%20window%2EHTMLWidgets%2Ewidget%20%3D%20function%28definition%29%20%7B%0A%20%20%20%20if%20%28%21definition%2Ename%29%20%7B%0A%20%20%20%20%20%20throw%20new%20Error%28%22Widget%20must%20have%20a%20name%22%29%3B%0A%20%20%20%20%7D%0A%20%20%20%20if%20%28%21definition%2Etype%29%20%7B%0A%20%20%20%20%20%20throw%20new%20Error%28%22Widget%20must%20have%20a%20type%22%29%3B%0A%20%20%20%20%7D%0A%20%20%20%20%2F%2F%20Currently%20we%20only%20support%20output%20widgets%0A%20%20%20%20if%20%28definition%2Etype%20%21%3D%3D%20%22output%22%29%20%7B%0A%20%20%20%20%20%20throw%20new%20Error%28%22Unrecognized%20widget%20type%20%27%22%20%2B%20definition%2Etype%20%2B%20%22%27%22%29%3B%0A%20%20%20%20%7D%0A%20%20%20%20%2F%2F%20TODO%3A%20Verify%20that%20%2Ename%20is%20a%20valid%20CSS%20classname%0A%0A%20%20%20%20%2F%2F%20Support%20new%2Dstyle%20instance%2Dbound%20definitions%2E%20Old%2Dstyle%20class%2Dbound%0A%20%20%20%20%2F%2F%20definitions%20have%20one%20widget%20%22object%22%20per%20widget%20per%20type%2Fclass%20of%0A%20%20%20%20%2F%2F%20widget%3B%20the%20renderValue%20and%20resize%20methods%20on%20such%20widget%20objects%0A%20%20%20%20%2F%2F%20take%20el%20and%20instance%20arguments%2C%20because%20the%20widget%20object%20can%27t%0A%20%20%20%20%2F%2F%20store%20them%2E%20New%2Dstyle%20instance%2Dbound%20definitions%20have%20one%20widget%0A%20%20%20%20%2F%2F%20object%20per%20widget%20instance%3B%20the%20definition%20that%27s%20passed%20in%20doesn%27t%0A%20%20%20%20%2F%2F%20provide%20renderValue%20or%20resize%20methods%20at%20all%2C%20just%20the%20single%20method%0A%20%20%20%20%2F%2F%20%20%20factory%28el%2C%20width%2C%20height%29%0A%20%20%20%20%2F%2F%20which%20returns%20an%20object%20that%20has%20renderValue%28x%29%20and%20resize%28w%2C%20h%29%2E%0A%20%20%20%20%2F%2F%20This%20enables%20a%20far%20more%20natural%20programming%20style%20for%20the%20widget%0A%20%20%20%20%2F%2F%20author%2C%20who%20can%20store%20per%2Dinstance%20state%20using%20either%20OO%2Dstyle%0A%20%20%20%20%2F%2F%20instance%20fields%20or%20functional%2Dstyle%20closure%20variables%20%28I%20guess%20this%0A%20%20%20%20%2F%2F%20is%20in%20contrast%20to%20what%20can%20only%20be%20called%20C%2Dstyle%20pseudo%2DOO%20which%20is%0A%20%20%20%20%2F%2F%20what%20we%20required%20before%29%2E%0A%20%20%20%20if%20%28definition%2Efactory%29%20%7B%0A%20%20%20%20%20%20definition%20%3D%20createLegacyDefinitionAdapter%28definition%29%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20%28%21definition%2ErenderValue%29%20%7B%0A%20%20%20%20%20%20throw%20new%20Error%28%22Widget%20must%20have%20a%20renderValue%20function%22%29%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F%2F%20For%20static%20rendering%20%28non%2DShiny%29%2C%20use%20a%20simple%20widget%20registration%0A%20%20%20%20%2F%2F%20scheme%2E%20We%20also%20use%20this%20scheme%20for%20Shiny%20apps%2Fdocuments%20that%20also%0A%20%20%20%20%2F%2F%20contain%20static%20widgets%2E%0A%20%20%20%20window%2EHTMLWidgets%2Ewidgets%20%3D%20window%2EHTMLWidgets%2Ewidgets%20%7C%7C%20%5B%5D%3B%0A%20%20%20%20%2F%2F%20Merge%20defaults%20into%20the%20definition%3B%20don%27t%20mutate%20the%20original%20definition%2E%0A%20%20%20%20var%20staticBinding%20%3D%20extend%28%7B%7D%2C%20defaults%2C%20definition%29%3B%0A%20%20%20%20overrideMethod%28staticBinding%2C%20%22find%22%2C%20function%28superfunc%29%20%7B%0A%20%20%20%20%20%20return%20function%28scope%29%20%7B%0A%20%20%20%20%20%20%20%20var%20results%20%3D%20superfunc%28scope%29%3B%0A%20%20%20%20%20%20%20%20%2F%2F%20Filter%20out%20Shiny%20outputs%2C%20we%20only%20want%20the%20static%20kind%0A%20%20%20%20%20%20%20%20return%20filterByClass%28results%2C%20%22html%2Dwidget%2Doutput%22%2C%20false%29%3B%0A%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20window%2EHTMLWidgets%2Ewidgets%2Epush%28staticBinding%29%3B%0A%0A%20%20%20%20if%20%28shinyMode%29%20%7B%0A%20%20%20%20%20%20%2F%2F%20Shiny%20is%20running%2E%20Register%20the%20definition%20with%20an%20output%20binding%2E%0A%20%20%20%20%20%20%2F%2F%20The%20definition%20itself%20will%20not%20be%20the%20output%20binding%2C%20instead%0A%20%20%20%20%20%20%2F%2F%20we%20will%20make%20an%20output%20binding%20object%20that%20delegates%20to%20the%0A%20%20%20%20%20%20%2F%2F%20definition%2E%20This%20is%20because%20we%20foolishly%20used%20the%20same%20method%0A%20%20%20%20%20%20%2F%2F%20name%20%28renderValue%29%20for%20htmlwidgets%20definition%20and%20Shiny%20bindings%0A%20%20%20%20%20%20%2F%2F%20but%20they%20actually%20have%20quite%20different%20semantics%20%28the%20Shiny%0A%20%20%20%20%20%20%2F%2F%20bindings%20receive%20data%20that%20includes%20lots%20of%20metadata%20that%20it%0A%20%20%20%20%20%20%2F%2F%20strips%20off%20before%20calling%20htmlwidgets%20renderValue%29%2E%20We%20can%27t%0A%20%20%20%20%20%20%2F%2F%20just%20ignore%20the%20difference%20because%20in%20some%20widgets%20it%27s%20helpful%0A%20%20%20%20%20%20%2F%2F%20to%20call%20this%2ErenderValue%28%29%20from%20inside%20of%20resize%28%29%2C%20and%20if%0A%20%20%20%20%20%20%2F%2F%20we%27re%20not%20delegating%2C%20then%20that%20call%20will%20go%20to%20the%20Shiny%0A%20%20%20%20%20%20%2F%2F%20version%20instead%20of%20the%20htmlwidgets%20version%2E%0A%0A%20%20%20%20%20%20%2F%2F%20Merge%20defaults%20with%20definition%2C%20without%20mutating%20either%2E%0A%20%20%20%20%20%20var%20bindingDef%20%3D%20extend%28%7B%7D%2C%20defaults%2C%20definition%29%3B%0A%0A%20%20%20%20%20%20%2F%2F%20This%20object%20will%20be%20our%20actual%20Shiny%20binding%2E%0A%20%20%20%20%20%20var%20shinyBinding%20%3D%20new%20Shiny%2EOutputBinding%28%29%3B%0A%0A%20%20%20%20%20%20%2F%2F%20With%20a%20few%20exceptions%2C%20we%27ll%20want%20to%20simply%20use%20the%20bindingDef%27s%0A%20%20%20%20%20%20%2F%2F%20version%20of%20methods%20if%20they%20are%20available%2C%20otherwise%20fall%20back%20to%0A%20%20%20%20%20%20%2F%2F%20Shiny%27s%20defaults%2E%20NOTE%3A%20If%20Shiny%27s%20output%20bindings%20gain%20additional%0A%20%20%20%20%20%20%2F%2F%20methods%20in%20the%20future%2C%20and%20we%20want%20them%20to%20be%20overrideable%20by%0A%20%20%20%20%20%20%2F%2F%20HTMLWidget%20binding%20definitions%2C%20then%20we%27ll%20need%20to%20add%20them%20to%20this%0A%20%20%20%20%20%20%2F%2F%20list%2E%0A%20%20%20%20%20%20delegateMethod%28shinyBinding%2C%20bindingDef%2C%20%22getId%22%29%3B%0A%20%20%20%20%20%20delegateMethod%28shinyBinding%2C%20bindingDef%2C%20%22onValueChange%22%29%3B%0A%20%20%20%20%20%20delegateMethod%28shinyBinding%2C%20bindingDef%2C%20%22onValueError%22%29%3B%0A%20%20%20%20%20%20delegateMethod%28shinyBinding%2C%20bindingDef%2C%20%22renderError%22%29%3B%0A%20%20%20%20%20%20delegateMethod%28shinyBinding%2C%20bindingDef%2C%20%22clearError%22%29%3B%0A%20%20%20%20%20%20delegateMethod%28shinyBinding%2C%20bindingDef%2C%20%22showProgress%22%29%3B%0A%0A%20%20%20%20%20%20%2F%2F%20The%20find%2C%20renderValue%2C%20and%20resize%20are%20handled%20differently%2C%20because%20we%0A%20%20%20%20%20%20%2F%2F%20want%20to%20actually%20decorate%20the%20behavior%20of%20the%20bindingDef%20methods%2E%0A%0A%20%20%20%20%20%20shinyBinding%2Efind%20%3D%20function%28scope%29%20%7B%0A%20%20%20%20%20%20%20%20var%20results%20%3D%20bindingDef%2Efind%28scope%29%3B%0A%0A%20%20%20%20%20%20%20%20%2F%2F%20Only%20return%20elements%20that%20are%20Shiny%20outputs%2C%20not%20static%20ones%0A%20%20%20%20%20%20%20%20var%20dynamicResults%20%3D%20results%2Efilter%28%22%2Ehtml%2Dwidget%2Doutput%22%29%3B%0A%0A%20%20%20%20%20%20%20%20%2F%2F%20It%27s%20possible%20that%20whatever%20caused%20Shiny%20to%20think%20there%20might%20be%0A%20%20%20%20%20%20%20%20%2F%2F%20new%20dynamic%20outputs%2C%20also%20caused%20there%20to%20be%20new%20static%20outputs%2E%0A%20%20%20%20%20%20%20%20%2F%2F%20Since%20there%20might%20be%20lots%20of%20different%20htmlwidgets%20bindings%2C%20we%0A%20%20%20%20%20%20%20%20%2F%2F%20schedule%20execution%20for%20later%2D%2Dno%20need%20to%20staticRender%20multiple%0A%20%20%20%20%20%20%20%20%2F%2F%20times%2E%0A%20%20%20%20%20%20%20%20if%20%28results%2Elength%20%21%3D%3D%20dynamicResults%2Elength%29%0A%20%20%20%20%20%20%20%20%20%20scheduleStaticRender%28%29%3B%0A%0A%20%20%20%20%20%20%20%20return%20dynamicResults%3B%0A%20%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%20%20%2F%2F%20Wrap%20renderValue%20to%20handle%20initialization%2C%20which%20unfortunately%20isn%27t%0A%20%20%20%20%20%20%2F%2F%20supported%20natively%20by%20Shiny%20at%20the%20time%20of%20this%20writing%2E%0A%0A%20%20%20%20%20%20shinyBinding%2ErenderValue%20%3D%20function%28el%2C%20data%29%20%7B%0A%20%20%20%20%20%20%20%20Shiny%2ErenderDependencies%28data%2Edeps%29%3B%0A%20%20%20%20%20%20%20%20%2F%2F%20Resolve%20strings%20marked%20as%20javascript%20literals%20to%20objects%0A%20%20%20%20%20%20%20%20if%20%28%21%28data%2Eevals%20instanceof%20Array%29%29%20data%2Eevals%20%3D%20%5Bdata%2Eevals%5D%3B%0A%20%20%20%20%20%20%20%20for%20%28var%20i%20%3D%200%3B%20data%2Eevals%20%26%26%20i%20%3C%20data%2Eevals%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20window%2EHTMLWidgets%2EevaluateStringMember%28data%2Ex%2C%20data%2Eevals%5Bi%5D%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20if%20%28%21bindingDef%2ErenderOnNullValue%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20if%20%28data%2Ex%20%3D%3D%3D%20null%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20el%2Estyle%2Evisibility%20%3D%20%22hidden%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20el%2Estyle%2Evisibility%20%3D%20%22inherit%22%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20if%20%28%21elementData%28el%2C%20%22initialized%22%29%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20initSizing%28el%29%3B%0A%0A%20%20%20%20%20%20%20%20%20%20elementData%28el%2C%20%22initialized%22%2C%20true%29%3B%0A%20%20%20%20%20%20%20%20%20%20if%20%28bindingDef%2Einitialize%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20result%20%3D%20bindingDef%2Einitialize%28el%2C%20el%2EoffsetWidth%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20el%2EoffsetHeight%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20elementData%28el%2C%20%22init%5Fresult%22%2C%20result%29%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20bindingDef%2ErenderValue%28el%2C%20data%2Ex%2C%20elementData%28el%2C%20%22init%5Fresult%22%29%29%3B%0A%20%20%20%20%20%20%20%20evalAndRun%28data%2EjsHooks%2Erender%2C%20elementData%28el%2C%20%22init%5Fresult%22%29%2C%20%5Bel%2C%20data%2Ex%5D%29%3B%0A%20%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%20%20%2F%2F%20Only%20override%20resize%20if%20bindingDef%20implements%20it%0A%20%20%20%20%20%20if%20%28bindingDef%2Eresize%29%20%7B%0A%20%20%20%20%20%20%20%20shinyBinding%2Eresize%20%3D%20function%28el%2C%20width%2C%20height%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20Shiny%20can%20call%20resize%20before%20initialize%2FrenderValue%20have%20been%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20called%2C%20which%20doesn%27t%20make%20sense%20for%20widgets%2E%0A%20%20%20%20%20%20%20%20%20%20if%20%28elementData%28el%2C%20%22initialized%22%29%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20bindingDef%2Eresize%28el%2C%20width%2C%20height%2C%20elementData%28el%2C%20%22init%5Fresult%22%29%29%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20Shiny%2EoutputBindings%2Eregister%28shinyBinding%2C%20bindingDef%2Ename%29%3B%0A%20%20%20%20%7D%0A%20%20%7D%3B%0A%0A%20%20var%20scheduleStaticRenderTimerId%20%3D%20null%3B%0A%20%20function%20scheduleStaticRender%28%29%20%7B%0A%20%20%20%20if%20%28%21scheduleStaticRenderTimerId%29%20%7B%0A%20%20%20%20%20%20scheduleStaticRenderTimerId%20%3D%20setTimeout%28function%28%29%20%7B%0A%20%20%20%20%20%20%20%20scheduleStaticRenderTimerId%20%3D%20null%3B%0A%20%20%20%20%20%20%20%20window%2EHTMLWidgets%2EstaticRender%28%29%3B%0A%20%20%20%20%20%20%7D%2C%201%29%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20%2F%2F%20Render%20static%20widgets%20after%20the%20document%20finishes%20loading%0A%20%20%2F%2F%20Statically%20render%20all%20elements%20that%20are%20of%20this%20widget%27s%20class%0A%20%20window%2EHTMLWidgets%2EstaticRender%20%3D%20function%28%29%20%7B%0A%20%20%20%20var%20bindings%20%3D%20window%2EHTMLWidgets%2Ewidgets%20%7C%7C%20%5B%5D%3B%0A%20%20%20%20forEach%28bindings%2C%20function%28binding%29%20%7B%0A%20%20%20%20%20%20var%20matches%20%3D%20binding%2Efind%28document%2EdocumentElement%29%3B%0A%20%20%20%20%20%20forEach%28matches%2C%20function%28el%29%20%7B%0A%20%20%20%20%20%20%20%20var%20sizeObj%20%3D%20initSizing%28el%2C%20binding%29%3B%0A%0A%20%20%20%20%20%20%20%20if%20%28hasClass%28el%2C%20%22html%2Dwidget%2Dstatic%2Dbound%22%29%29%0A%20%20%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%20%20el%2EclassName%20%3D%20el%2EclassName%20%2B%20%22%20html%2Dwidget%2Dstatic%2Dbound%22%3B%0A%0A%20%20%20%20%20%20%20%20var%20initResult%3B%0A%20%20%20%20%20%20%20%20if%20%28binding%2Einitialize%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20initResult%20%3D%20binding%2Einitialize%28el%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20sizeObj%20%3F%20sizeObj%2EgetWidth%28%29%20%3A%20el%2EoffsetWidth%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20sizeObj%20%3F%20sizeObj%2EgetHeight%28%29%20%3A%20el%2EoffsetHeight%0A%20%20%20%20%20%20%20%20%20%20%29%3B%0A%20%20%20%20%20%20%20%20%20%20elementData%28el%2C%20%22init%5Fresult%22%2C%20initResult%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20if%20%28binding%2Eresize%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20var%20lastSize%20%3D%20%7B%7D%3B%0A%20%20%20%20%20%20%20%20%20%20var%20resizeHandler%20%3D%20function%28e%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20size%20%3D%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20w%3A%20sizeObj%20%3F%20sizeObj%2EgetWidth%28%29%20%3A%20el%2EoffsetWidth%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20h%3A%20sizeObj%20%3F%20sizeObj%2EgetHeight%28%29%20%3A%20el%2EoffsetHeight%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28size%2Ew%20%3D%3D%3D%200%20%26%26%20size%2Eh%20%3D%3D%3D%200%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28size%2Ew%20%3D%3D%3D%20lastSize%2Ew%20%26%26%20size%2Eh%20%3D%3D%3D%20lastSize%2Eh%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20lastSize%20%3D%20size%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20binding%2Eresize%28el%2C%20size%2Ew%2C%20size%2Eh%2C%20initResult%29%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%20%20%20%20%20%20on%28window%2C%20%22resize%22%2C%20resizeHandler%29%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20This%20is%20needed%20for%20cases%20where%20we%27re%20running%20in%20a%20Shiny%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20app%2C%20but%20the%20widget%20itself%20is%20not%20a%20Shiny%20output%2C%20but%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20rather%20a%20simple%20static%20widget%2E%20One%20example%20of%20this%20is%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20an%20rmarkdown%20document%20that%20has%20runtime%3Ashiny%20and%20widget%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20that%20isn%27t%20in%20a%20render%20function%2E%20Shiny%20only%20knows%20to%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20call%20resize%20handlers%20for%20Shiny%20outputs%2C%20not%20for%20static%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20widgets%2C%20so%20we%20do%20it%20ourselves%2E%0A%20%20%20%20%20%20%20%20%20%20if%20%28window%2EjQuery%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20window%2EjQuery%28document%29%2Eon%28%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22shown%2Ehtmlwidgets%20shown%2Ebs%2Etab%2Ehtmlwidgets%20shown%2Ebs%2Ecollapse%2Ehtmlwidgets%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20resizeHandler%0A%20%20%20%20%20%20%20%20%20%20%20%20%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20window%2EjQuery%28document%29%2Eon%28%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22hidden%2Ehtmlwidgets%20hidden%2Ebs%2Etab%2Ehtmlwidgets%20hidden%2Ebs%2Ecollapse%2Ehtmlwidgets%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20resizeHandler%0A%20%20%20%20%20%20%20%20%20%20%20%20%29%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20This%20is%20needed%20for%20the%20specific%20case%20of%20ioslides%2C%20which%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20flips%20slides%20between%20display%3Anone%20and%20display%3Ablock%2E%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20Ideally%20we%20would%20not%20have%20to%20have%20ioslide%2Dspecific%20code%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20here%2C%20but%20rather%20have%20ioslides%20raise%20a%20generic%20event%2C%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20but%20the%20rmarkdown%20package%20just%20went%20to%20CRAN%20so%20the%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20window%20to%20getting%20that%20fixed%20may%20be%20long%2E%0A%20%20%20%20%20%20%20%20%20%20if%20%28window%2EaddEventListener%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20It%27s%20OK%20to%20limit%20this%20to%20window%2EaddEventListener%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20browsers%20because%20ioslides%20itself%20only%20supports%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20such%20browsers%2E%0A%20%20%20%20%20%20%20%20%20%20%20%20on%28document%2C%20%22slideenter%22%2C%20resizeHandler%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20on%28document%2C%20%22slideleave%22%2C%20resizeHandler%29%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20var%20scriptData%20%3D%20document%2EquerySelector%28%22script%5Bdata%2Dfor%3D%27%22%20%2B%20el%2Eid%20%2B%20%22%27%5D%5Btype%3D%27application%2Fjson%27%5D%22%29%3B%0A%20%20%20%20%20%20%20%20if%20%28scriptData%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20var%20data%20%3D%20JSON%2Eparse%28scriptData%2EtextContent%20%7C%7C%20scriptData%2Etext%29%3B%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20Resolve%20strings%20marked%20as%20javascript%20literals%20to%20objects%0A%20%20%20%20%20%20%20%20%20%20if%20%28%21%28data%2Eevals%20instanceof%20Array%29%29%20data%2Eevals%20%3D%20%5Bdata%2Eevals%5D%3B%0A%20%20%20%20%20%20%20%20%20%20for%20%28var%20k%20%3D%200%3B%20data%2Eevals%20%26%26%20k%20%3C%20data%2Eevals%2Elength%3B%20k%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20window%2EHTMLWidgets%2EevaluateStringMember%28data%2Ex%2C%20data%2Eevals%5Bk%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20binding%2ErenderValue%28el%2C%20data%2Ex%2C%20initResult%29%3B%0A%20%20%20%20%20%20%20%20%20%20evalAndRun%28data%2EjsHooks%2Erender%2C%20initResult%2C%20%5Bel%2C%20data%2Ex%5D%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%7D%29%3B%0A%0A%20%20%20%20invokePostRenderHandlers%28%29%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20Wait%20until%20after%20the%20document%20has%20loaded%20to%20render%20the%20widgets%2E%0A%20%20if%20%28document%2EaddEventListener%29%20%7B%0A%20%20%20%20document%2EaddEventListener%28%22DOMContentLoaded%22%2C%20function%28%29%20%7B%0A%20%20%20%20%20%20document%2EremoveEventListener%28%22DOMContentLoaded%22%2C%20arguments%2Ecallee%2C%20false%29%3B%0A%20%20%20%20%20%20window%2EHTMLWidgets%2EstaticRender%28%29%3B%0A%20%20%20%20%7D%2C%20false%29%3B%0A%20%20%7D%20else%20if%20%28document%2EattachEvent%29%20%7B%0A%20%20%20%20document%2EattachEvent%28%22onreadystatechange%22%2C%20function%28%29%20%7B%0A%20%20%20%20%20%20if%20%28document%2EreadyState%20%3D%3D%3D%20%22complete%22%29%20%7B%0A%20%20%20%20%20%20%20%20document%2EdetachEvent%28%22onreadystatechange%22%2C%20arguments%2Ecallee%29%3B%0A%20%20%20%20%20%20%20%20window%2EHTMLWidgets%2EstaticRender%28%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%29%3B%0A%20%20%7D%0A%0A%0A%20%20window%2EHTMLWidgets%2EgetAttachmentUrl%20%3D%20function%28depname%2C%20key%29%20%7B%0A%20%20%20%20%2F%2F%20If%20no%20key%2C%20default%20to%20the%20first%20item%0A%20%20%20%20if%20%28typeof%28key%29%20%3D%3D%3D%20%22undefined%22%29%0A%20%20%20%20%20%20key%20%3D%201%3B%0A%0A%20%20%20%20var%20link%20%3D%20document%2EgetElementById%28depname%20%2B%20%22%2D%22%20%2B%20key%20%2B%20%22%2Dattachment%22%29%3B%0A%20%20%20%20if%20%28%21link%29%20%7B%0A%20%20%20%20%20%20throw%20new%20Error%28%22Attachment%20%22%20%2B%20depname%20%2B%20%22%2F%22%20%2B%20key%20%2B%20%22%20not%20found%20in%20document%22%29%3B%0A%20%20%20%20%7D%0A%20%20%20%20return%20link%2EgetAttribute%28%22href%22%29%3B%0A%20%20%7D%3B%0A%0A%20%20window%2EHTMLWidgets%2EdataframeToD3%20%3D%20function%28df%29%20%7B%0A%20%20%20%20var%20names%20%3D%20%5B%5D%3B%0A%20%20%20%20var%20length%3B%0A%20%20%20%20for%20%28var%20name%20in%20df%29%20%7B%0A%20%20%20%20%20%20%20%20if%20%28df%2EhasOwnProperty%28name%29%29%0A%20%20%20%20%20%20%20%20%20%20%20%20names%2Epush%28name%29%3B%0A%20%20%20%20%20%20%20%20if%20%28typeof%28df%5Bname%5D%29%20%21%3D%3D%20%22object%22%20%7C%7C%20typeof%28df%5Bname%5D%2Elength%29%20%3D%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error%28%22All%20fields%20must%20be%20arrays%22%29%3B%0A%20%20%20%20%20%20%20%20%7D%20else%20if%20%28typeof%28length%29%20%21%3D%3D%20%22undefined%22%20%26%26%20length%20%21%3D%3D%20df%5Bname%5D%2Elength%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error%28%22All%20fields%20must%20be%20arrays%20of%20the%20same%20length%22%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20length%20%3D%20df%5Bname%5D%2Elength%3B%0A%20%20%20%20%7D%0A%20%20%20%20var%20results%20%3D%20%5B%5D%3B%0A%20%20%20%20var%20item%3B%0A%20%20%20%20for%20%28var%20row%20%3D%200%3B%20row%20%3C%20length%3B%20row%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20item%20%3D%20%7B%7D%3B%0A%20%20%20%20%20%20%20%20for%20%28var%20col%20%3D%200%3B%20col%20%3C%20names%2Elength%3B%20col%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20item%5Bnames%5Bcol%5D%5D%20%3D%20df%5Bnames%5Bcol%5D%5D%5Brow%5D%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20results%2Epush%28item%29%3B%0A%20%20%20%20%7D%0A%20%20%20%20return%20results%3B%0A%20%20%7D%3B%0A%0A%20%20window%2EHTMLWidgets%2EtransposeArray2D%20%3D%20function%28array%29%20%7B%0A%20%20%20%20%20%20if%20%28array%2Elength%20%3D%3D%3D%200%29%20return%20array%3B%0A%20%20%20%20%20%20var%20newArray%20%3D%20array%5B0%5D%2Emap%28function%28col%2C%20i%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20return%20array%2Emap%28function%28row%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20row%5Bi%5D%0A%20%20%20%20%20%20%20%20%20%20%7D%29%0A%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%20%20return%20newArray%3B%0A%20%20%7D%3B%0A%20%20%2F%2F%20Split%20value%20at%20splitChar%2C%20but%20allow%20splitChar%20to%20be%20escaped%0A%20%20%2F%2F%20using%20escapeChar%2E%20Any%20other%20characters%20escaped%20by%20escapeChar%0A%20%20%2F%2F%20will%20be%20included%20as%20usual%20%28including%20escapeChar%20itself%29%2E%0A%20%20function%20splitWithEscape%28value%2C%20splitChar%2C%20escapeChar%29%20%7B%0A%20%20%20%20var%20results%20%3D%20%5B%5D%3B%0A%20%20%20%20var%20escapeMode%20%3D%20false%3B%0A%20%20%20%20var%20currentResult%20%3D%20%22%22%3B%0A%20%20%20%20for%20%28var%20pos%20%3D%200%3B%20pos%20%3C%20value%2Elength%3B%20pos%2B%2B%29%20%7B%0A%20%20%20%20%20%20if%20%28%21escapeMode%29%20%7B%0A%20%20%20%20%20%20%20%20if%20%28value%5Bpos%5D%20%3D%3D%3D%20splitChar%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20results%2Epush%28currentResult%29%3B%0A%20%20%20%20%20%20%20%20%20%20currentResult%20%3D%20%22%22%3B%0A%20%20%20%20%20%20%20%20%7D%20else%20if%20%28value%5Bpos%5D%20%3D%3D%3D%20escapeChar%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20escapeMode%20%3D%20true%3B%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20currentResult%20%2B%3D%20value%5Bpos%5D%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20currentResult%20%2B%3D%20value%5Bpos%5D%3B%0A%20%20%20%20%20%20%20%20escapeMode%20%3D%20false%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20if%20%28currentResult%20%21%3D%3D%20%22%22%29%20%7B%0A%20%20%20%20%20%20results%2Epush%28currentResult%29%3B%0A%20%20%20%20%7D%0A%20%20%20%20return%20results%3B%0A%20%20%7D%0A%20%20%2F%2F%20Function%20authored%20by%20Yihui%2FJJ%20Allaire%0A%20%20window%2EHTMLWidgets%2EevaluateStringMember%20%3D%20function%28o%2C%20member%29%20%7B%0A%20%20%20%20var%20parts%20%3D%20splitWithEscape%28member%2C%20%27%2E%27%2C%20%27%5C%5C%27%29%3B%0A%20%20%20%20for%20%28var%20i%20%3D%200%2C%20l%20%3D%20parts%2Elength%3B%20i%20%3C%20l%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20var%20part%20%3D%20parts%5Bi%5D%3B%0A%20%20%20%20%20%20%2F%2F%20part%20may%20be%20a%20character%20or%20%27numeric%27%20member%20name%0A%20%20%20%20%20%20if%20%28o%20%21%3D%3D%20null%20%26%26%20typeof%20o%20%3D%3D%3D%20%22object%22%20%26%26%20part%20in%20o%29%20%7B%0A%20%20%20%20%20%20%20%20if%20%28i%20%3D%3D%20%28l%20%2D%201%29%29%20%7B%20%2F%2F%20if%20we%20are%20at%20the%20end%20of%20the%20line%20then%20evalulate%0A%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20o%5Bpart%5D%20%3D%3D%3D%20%22string%22%29%0A%20%20%20%20%20%20%20%20%20%20%20%20o%5Bpart%5D%20%3D%20eval%28%22%28%22%20%2B%20o%5Bpart%5D%20%2B%20%22%29%22%29%3B%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%20%2F%2F%20otherwise%20continue%20to%20next%20embedded%20object%0A%20%20%20%20%20%20%20%20%20%20o%20%3D%20o%5Bpart%5D%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%7D%3B%0A%0A%20%20%2F%2F%20Retrieve%20the%20HTMLWidget%20instance%20%28i%2Ee%2E%20the%20return%20value%20of%20an%0A%20%20%2F%2F%20HTMLWidget%20binding%27s%20initialize%28%29%20or%20factory%28%29%20function%29%0A%20%20%2F%2F%20associated%20with%20an%20element%2C%20or%20null%20if%20none%2E%0A%20%20window%2EHTMLWidgets%2EgetInstance%20%3D%20function%28el%29%20%7B%0A%20%20%20%20return%20elementData%28el%2C%20%22init%5Fresult%22%29%3B%0A%20%20%7D%3B%0A%0A%20%20%2F%2F%20Finds%20the%20first%20element%20in%20the%20scope%20that%20matches%20the%20selector%2C%0A%20%20%2F%2F%20and%20returns%20the%20HTMLWidget%20instance%20%28i%2Ee%2E%20the%20return%20value%20of%0A%20%20%2F%2F%20an%20HTMLWidget%20binding%27s%20initialize%28%29%20or%20factory%28%29%20function%29%0A%20%20%2F%2F%20associated%20with%20that%20element%2C%20if%20any%2E%20If%20no%20element%20matches%20the%0A%20%20%2F%2F%20selector%2C%20or%20the%20first%20matching%20element%20has%20no%20HTMLWidget%0A%20%20%2F%2F%20instance%20associated%20with%20it%2C%20then%20null%20is%20returned%2E%0A%20%20%2F%2F%0A%20%20%2F%2F%20The%20scope%20argument%20is%20optional%2C%20and%20defaults%20to%20window%2Edocument%2E%0A%20%20window%2EHTMLWidgets%2Efind%20%3D%20function%28scope%2C%20selector%29%20%7B%0A%20%20%20%20if%20%28arguments%2Elength%20%3D%3D%201%29%20%7B%0A%20%20%20%20%20%20selector%20%3D%20scope%3B%0A%20%20%20%20%20%20scope%20%3D%20document%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20var%20el%20%3D%20scope%2EquerySelector%28selector%29%3B%0A%20%20%20%20if%20%28el%20%3D%3D%3D%20null%29%20%7B%0A%20%20%20%20%20%20return%20null%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20return%20window%2EHTMLWidgets%2EgetInstance%28el%29%3B%0A%20%20%20%20%7D%0A%20%20%7D%3B%0A%0A%20%20%2F%2F%20Finds%20all%20elements%20in%20the%20scope%20that%20match%20the%20selector%2C%20and%0A%20%20%2F%2F%20returns%20the%20HTMLWidget%20instances%20%28i%2Ee%2E%20the%20return%20values%20of%0A%20%20%2F%2F%20an%20HTMLWidget%20binding%27s%20initialize%28%29%20or%20factory%28%29%20function%29%0A%20%20%2F%2F%20associated%20with%20the%20elements%2C%20in%20an%20array%2E%20If%20elements%20that%0A%20%20%2F%2F%20match%20the%20selector%20don%27t%20have%20an%20associated%20HTMLWidget%0A%20%20%2F%2F%20instance%2C%20the%20returned%20array%20will%20contain%20nulls%2E%0A%20%20%2F%2F%0A%20%20%2F%2F%20The%20scope%20argument%20is%20optional%2C%20and%20defaults%20to%20window%2Edocument%2E%0A%20%20window%2EHTMLWidgets%2EfindAll%20%3D%20function%28scope%2C%20selector%29%20%7B%0A%20%20%20%20if%20%28arguments%2Elength%20%3D%3D%201%29%20%7B%0A%20%20%20%20%20%20selector%20%3D%20scope%3B%0A%20%20%20%20%20%20scope%20%3D%20document%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20var%20nodes%20%3D%20scope%2EquerySelectorAll%28selector%29%3B%0A%20%20%20%20var%20results%20%3D%20%5B%5D%3B%0A%20%20%20%20for%20%28var%20i%20%3D%200%3B%20i%20%3C%20nodes%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20results%2Epush%28window%2EHTMLWidgets%2EgetInstance%28nodes%5Bi%5D%29%29%3B%0A%20%20%20%20%7D%0A%20%20%20%20return%20results%3B%0A%20%20%7D%3B%0A%0A%20%20var%20postRenderHandlers%20%3D%20%5B%5D%3B%0A%20%20function%20invokePostRenderHandlers%28%29%20%7B%0A%20%20%20%20while%20%28postRenderHandlers%2Elength%29%20%7B%0A%20%20%20%20%20%20var%20handler%20%3D%20postRenderHandlers%2Eshift%28%29%3B%0A%20%20%20%20%20%20if%20%28handler%29%20%7B%0A%20%20%20%20%20%20%20%20handler%28%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20%2F%2F%20Register%20the%20given%20callback%20function%20to%20be%20invoked%20after%20the%0A%20%20%2F%2F%20next%20time%20static%20widgets%20are%20rendered%2E%0A%20%20window%2EHTMLWidgets%2EaddPostRenderHandler%20%3D%20function%28callback%29%20%7B%0A%20%20%20%20postRenderHandlers%2Epush%28callback%29%3B%0A%20%20%7D%3B%0A%0A%20%20%2F%2F%20Takes%20a%20new%2Dstyle%20instance%2Dbound%20definition%2C%20and%20returns%20an%0A%20%20%2F%2F%20old%2Dstyle%20class%2Dbound%20definition%2E%20This%20saves%20us%20from%20having%0A%20%20%2F%2F%20to%20rewrite%20all%20the%20logic%20in%20this%20file%20to%20accomodate%20both%0A%20%20%2F%2F%20types%20of%20definitions%2E%0A%20%20function%20createLegacyDefinitionAdapter%28defn%29%20%7B%0A%20%20%20%20var%20result%20%3D%20%7B%0A%20%20%20%20%20%20name%3A%20defn%2Ename%2C%0A%20%20%20%20%20%20type%3A%20defn%2Etype%2C%0A%20%20%20%20%20%20initialize%3A%20function%28el%2C%20width%2C%20height%29%20%7B%0A%20%20%20%20%20%20%20%20return%20defn%2Efactory%28el%2C%20width%2C%20height%29%3B%0A%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20renderValue%3A%20function%28el%2C%20x%2C%20instance%29%20%7B%0A%20%20%20%20%20%20%20%20return%20instance%2ErenderValue%28x%29%3B%0A%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20resize%3A%20function%28el%2C%20width%2C%20height%2C%20instance%29%20%7B%0A%20%20%20%20%20%20%20%20return%20instance%2Eresize%28width%2C%20height%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20if%20%28defn%2Efind%29%0A%20%20%20%20%20%20result%2Efind%20%3D%20defn%2Efind%3B%0A%20%20%20%20if%20%28defn%2ErenderError%29%0A%20%20%20%20%20%20result%2ErenderError%20%3D%20defn%2ErenderError%3B%0A%20%20%20%20if%20%28defn%2EclearError%29%0A%20%20%20%20%20%20result%2EclearError%20%3D%20defn%2EclearError%3B%0A%0A%20%20%20%20return%20result%3B%0A%20%20%7D%0A%7D%29%28%29%3B%0A%0A"></script>
<link href="data:text/css,%2ErglPlayer%20%7B%0A%20%20width%3A%20auto%3B%0A%20%20height%3A%20auto%3B%0A%7D%0A%0A%2ErglPlayer%20%2Ergl%2Dbutton%20%7B%0A%20%20width%3A%20auto%3B%0A%20%20display%3A%20inline%2Dblock%3B%0A%20%20font%2Dsize%3A%2075%25%3B%0A%7D%0A%0A%2ErglPlayer%20%2Ergl%2Dslider%20%7B%0A%20%20display%3A%20inline%2Dblock%3B%0A%20%20width%3A%2030%25%3B%0A%7D%0A%0A%2ErglPlayer%20%2Ergl%2Dlabel%20%7B%0A%20%20display%3A%20inline%3B%0A%20%20padding%2Dleft%3A%206px%3B%0A%20%20padding%2Dright%3A%206px%3B%0A%7D%0A" rel="stylesheet" />
<script src="data:application/x-javascript,%2F%2F%20To%20generate%20the%20help%20pages%20for%20this%20library%2C%20use%0A%0A%2F%2F%20jsdoc%20%2D%2Ddestination%20%2E%2E%2F%2E%2E%2F%2E%2E%2Fdoc%2FrglwidgetClass%20%2D%2Dtemplate%20%7E%2Fnode%5Fmodules%2Fjsdoc%2Dbaseline%20rglClass%2Esrc%2Ejs%0A%0A%2F%2A%2A%0A%20%2A%20The%20class%20of%20an%20rgl%20widget%0A%20%2A%20%40class%0A%2A%2F%0ArglwidgetClass%20%3D%20function%28%29%20%7B%0A%20%20%20%20this%2Ecanvas%20%3D%20null%3B%0A%20%20%20%20this%2EuserMatrix%20%3D%20new%20CanvasMatrix4%28%29%3B%0A%20%20%20%20this%2Etypes%20%3D%20%5B%5D%3B%0A%20%20%20%20this%2EprMatrix%20%3D%20new%20CanvasMatrix4%28%29%3B%0A%20%20%20%20this%2EmvMatrix%20%3D%20new%20CanvasMatrix4%28%29%3B%0A%20%20%20%20this%2Evp%20%3D%20null%3B%0A%20%20%20%20this%2EprmvMatrix%20%3D%20null%3B%0A%20%20%20%20this%2Eorigs%20%3D%20null%3B%0A%20%20%20%20this%2Egl%20%3D%20null%3B%0A%20%20%20%20this%2Escene%20%3D%20null%3B%0A%7D%3B%0A%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Multiply%20matrix%20by%20vector%0A%20%20%20%20%20%2A%20%40returns%20%7Bnumber%5B%5D%7D%0A%20%20%20%20%20%2A%20%40param%20M%20%7Bnumber%5B%5D%5B%5D%7D%20Left%20operand%0A%20%20%20%20%20%2A%20%40param%20v%20%7Bnumber%5B%5D%7D%20Right%20operand%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EmultMV%20%3D%20function%28M%2C%20v%29%20%7B%0A%20%20%20%20%20%20%20%20return%20%5B%20M%2Em11%20%2A%20v%5B0%5D%20%2B%20M%2Em12%20%2A%20v%5B1%5D%20%2B%20M%2Em13%20%2A%20v%5B2%5D%20%2B%20M%2Em14%20%2A%20v%5B3%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20M%2Em21%20%2A%20v%5B0%5D%20%2B%20M%2Em22%20%2A%20v%5B1%5D%20%2B%20M%2Em23%20%2A%20v%5B2%5D%20%2B%20M%2Em24%20%2A%20v%5B3%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20M%2Em31%20%2A%20v%5B0%5D%20%2B%20M%2Em32%20%2A%20v%5B1%5D%20%2B%20M%2Em33%20%2A%20v%5B2%5D%20%2B%20M%2Em34%20%2A%20v%5B3%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20M%2Em41%20%2A%20v%5B0%5D%20%2B%20M%2Em42%20%2A%20v%5B1%5D%20%2B%20M%2Em43%20%2A%20v%5B2%5D%20%2B%20M%2Em44%20%2A%20v%5B3%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5D%3B%0A%20%20%20%20%7D%3B%0A%2F%2F%20%28function%28%29%20%7B%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Euclidean%20length%20of%20a%20vector%0A%20%20%20%20%20%2A%20%40returns%20%7Bnumber%7D%0A%20%20%20%20%20%2A%20%40param%20v%20%7Bnumber%5B%5D%7D%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2Evlen%20%3D%20function%28v%29%20%7B%0A%20%20%20%20%20%20return%20Math%2Esqrt%28this%2Edotprod%28v%2C%20v%29%29%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Dot%20product%20of%20two%20vectors%0A%20%20%20%20%20%2A%20%40instance%20rglwidgetClass%0A%20%20%20%20%20%2A%20%40returns%20%7Bnumber%7D%0A%20%20%20%20%20%2A%20%40param%20a%20%7Bnumber%5B%5D%7D%0A%20%20%20%20%20%2A%20%40param%20b%20%7Bnumber%5B%5D%7D%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2Edotprod%20%3D%20function%28a%2C%20b%29%20%7B%0A%20%20%20%20%20%20return%20a%5B0%5D%2Ab%5B0%5D%20%2B%20a%5B1%5D%2Ab%5B1%5D%20%2B%20a%5B2%5D%2Ab%5B2%5D%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Cross%20product%20of%20two%20vectors%0A%20%20%20%20%20%2A%20%40returns%20%7Bnumber%5B%5D%7D%0A%20%20%20%20%20%2A%20%40param%20a%20%7Bnumber%5B%5D%7D%0A%20%20%20%20%20%2A%20%40param%20b%20%7Bnumber%5B%5D%7D%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2Exprod%20%3D%20function%28a%2C%20b%29%20%7B%0A%20%20%20%20%20%20return%20%5Ba%5B1%5D%2Ab%5B2%5D%20%2D%20a%5B2%5D%2Ab%5B1%5D%2C%0A%20%20%20%20%20%20%20%20%20%20a%5B2%5D%2Ab%5B0%5D%20%2D%20a%5B0%5D%2Ab%5B2%5D%2C%0A%20%20%20%20%20%20%20%20%20%20a%5B0%5D%2Ab%5B1%5D%20%2D%20a%5B1%5D%2Ab%5B0%5D%5D%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Bind%20vectors%20or%20matrices%20by%20columns%0A%20%20%20%20%20%2A%20%40returns%20%7Bnumber%5B%5D%5B%5D%7D%0A%20%20%20%20%20%2A%20%40param%20a%20%7Bnumber%5B%5D%7Cnumber%5B%5D%5B%5D%7D%0A%20%20%20%20%20%2A%20%40param%20b%20%7Bnumber%5B%5D%7Cnumber%5B%5D%5B%5D%7D%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2Ecbind%20%3D%20function%28a%2C%20b%29%20%7B%0A%20%20%20%20%20%20if%20%28b%2Elength%20%3C%20a%2Elength%29%0A%20%20%20%20%20%20%20%20b%20%3D%20this%2ErepeatToLen%28b%2C%20a%2Elength%29%3B%0A%20%20%20%20%20%20else%20if%20%28a%2Elength%20%3C%20b%2Elength%29%0A%20%20%20%20%20%20%20%20a%20%3D%20this%2ErepeatToLen%28a%2C%20b%2Elength%29%3B%0A%20%20%20%20%20%20return%20a%2Emap%28function%28currentValue%2C%20index%2C%20array%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20currentValue%2Econcat%28b%5Bindex%5D%29%3B%0A%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Swap%20elements%0A%20%20%20%20%20%2A%20%40returns%20%7Bany%5B%5D%7D%0A%20%20%20%20%20%2A%20%40param%20a%20%7Bany%5B%5D%7D%0A%20%20%20%20%20%2A%20%40param%20i%20%7Bnumber%7D%20Element%20to%20swap%0A%20%20%20%20%20%2A%20%40param%20j%20%7Bnumber%7D%20Other%20element%20to%20swap%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2Eswap%20%3D%20function%28a%2C%20i%2C%20j%29%20%7B%0A%20%20%20%20%20%20var%20temp%20%3D%20a%5Bi%5D%3B%0A%20%20%20%20%20%20a%5Bi%5D%20%3D%20a%5Bj%5D%3B%0A%20%20%20%20%20%20a%5Bj%5D%20%3D%20temp%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Flatten%20a%20matrix%20into%20a%20vector%0A%20%20%20%20%20%2A%20%40returns%20%7Bany%5B%5D%7D%0A%20%20%20%20%20%2A%20%40param%20a%20%7Bany%5B%5D%5B%5D%7D%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2Eflatten%20%3D%20function%28arr%2C%20result%29%20%7B%0A%20%20%20%20%20%20var%20value%3B%0A%20%20%20%20%20%20if%20%28typeof%20result%20%3D%3D%3D%20%22undefined%22%29%20result%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20for%20%28var%20i%20%3D%200%2C%20length%20%3D%20arr%2Elength%3B%20i%20%3C%20length%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20value%20%3D%20arr%5Bi%5D%3B%0A%20%20%20%20%20%20%20%20if%20%28Array%2EisArray%28value%29%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20this%2Eflatten%28value%2C%20result%29%3B%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20result%2Epush%28value%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20return%20result%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20set%20element%20of%201d%20or%202d%20array%20as%20if%20it%20was%20flattened%2E%0A%20%20%20%20%20%2A%20Column%20major%2C%20zero%20based%21%0A%20%20%20%20%20%2A%20%40returns%20%7Bany%5B%5D%7Cany%5B%5D%5B%5D%7D%0A%20%20%20%20%20%2A%20%40param%20%7Bany%5B%5D%7Cany%5B%5D%5B%5D%7D%20a%20%2D%20array%0A%20%20%20%20%20%2A%20%40param%20%7Bnumber%7D%20i%20%2D%20element%0A%20%20%20%20%20%2A%20%40param%20%7Bany%7D%20value%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EsetElement%20%3D%20function%28a%2C%20i%2C%20value%29%20%7B%0A%20%20%20%20%20%20if%20%28Array%2EisArray%28a%5B0%5D%29%29%20%7B%0A%20%20%20%20%20%20%20%20var%20dim%20%3D%20a%2Elength%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20col%20%3D%20Math%2Efloor%28i%2Fdim%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20row%20%3D%20i%20%25%20dim%3B%0A%20%20%20%20%20%20%20%20a%5Brow%5D%5Bcol%5D%20%3D%20value%3B%0A%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20a%5Bi%5D%20%3D%20value%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Transpose%20an%20array%0A%20%20%20%20%20%2A%20%40returns%20%7Bany%5B%5D%5B%5D%7D%0A%20%20%20%20%20%2A%20%40param%20%7Bany%5B%5D%5B%5D%7D%20a%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2Etranspose%20%3D%20function%28a%29%20%7B%0A%20%20%20%20%20%20var%20newArray%20%3D%20%5B%5D%2C%0A%20%20%20%20%20%20%20%20%20%20n%20%3D%20a%2Elength%2C%0A%20%20%20%20%20%20%20%20%20%20m%20%3D%20a%5B0%5D%2Elength%2C%0A%20%20%20%20%20%20%20%20%20%20i%3B%0A%20%20%20%20%20%20for%28i%20%3D%200%3B%20i%20%3C%20m%3B%20i%2B%2B%29%7B%0A%20%20%20%20%20%20%20%20newArray%2Epush%28%5B%5D%29%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20for%28i%20%3D%200%3B%20i%20%3C%20n%3B%20i%2B%2B%29%7B%0A%20%20%20%20%20%20%20%20for%28var%20j%20%3D%200%3B%20j%20%3C%20m%3B%20j%2B%2B%29%7B%0A%20%20%20%20%20%20%20%20%20%20newArray%5Bj%5D%2Epush%28a%5Bi%5D%5Bj%5D%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20return%20newArray%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Calculate%20sum%20of%20squares%20of%20a%20numeric%20vector%0A%20%20%20%20%20%2A%20%40returns%20%7Bnumber%7D%0A%20%20%20%20%20%2A%20%40param%20%7Bnumber%5B%5D%7D%20x%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2Esumsq%20%3D%20function%28x%29%20%7B%0A%20%20%20%20%20%20var%20result%20%3D%200%2C%20i%3B%0A%20%20%20%20%20%20for%20%28i%3D0%3B%20i%20%3C%20x%2Elength%3B%20i%2B%2B%29%0A%20%20%20%20%20%20%20%20result%20%2B%3D%20x%5Bi%5D%2Ax%5Bi%5D%3B%0A%20%20%20%20%20%20return%20result%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Convert%20a%20matrix%20to%20a%20CanvasMatrix4%0A%20%20%20%20%20%2A%20%40returns%20%7BCanvasMatrix4%7D%0A%20%20%20%20%20%2A%20%40param%20%7Bnumber%5B%5D%5B%5D%7Cnumber%5B%5D%7D%20mat%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EtoCanvasMatrix4%20%3D%20function%28mat%29%20%7B%0A%20%20%20%20%20%20if%20%28mat%20instanceof%20CanvasMatrix4%29%0A%20%20%20%20%20%20%20%20return%20mat%3B%0A%20%20%20%20%20%20var%20result%20%3D%20new%20CanvasMatrix4%28%29%3B%0A%20%20%20%20%20%20mat%20%3D%20this%2Eflatten%28this%2Etranspose%28mat%29%29%3B%0A%20%20%20%20%20%20result%2Eload%28mat%29%3B%0A%20%20%20%20%20%20return%20result%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Convert%20an%20R%2Dstyle%20numeric%20colour%20string%20to%20an%20rgb%20vector%0A%20%20%20%20%20%2A%20%40returns%20%7Bnumber%5B%5D%7D%0A%20%20%20%20%20%2A%20%40param%20%7Bstring%7D%20s%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EstringToRgb%20%3D%20function%28s%29%20%7B%0A%20%20%20%20%20%20s%20%3D%20s%2Ereplace%28%22%23%22%2C%20%22%22%29%3B%0A%20%20%20%20%20%20var%20bigint%20%3D%20parseInt%28s%2C%2016%29%3B%0A%20%20%20%20%20%20return%20%5B%28%28bigint%20%3E%3E%2016%29%20%26%20255%29%2F255%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%28%28bigint%20%3E%3E%208%29%20%26%20255%29%2F255%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%28bigint%20%26%20255%29%2F255%5D%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Take%20a%20component%2Dby%2Dcomponent%20product%20of%20two%203%20vectors%0A%20%20%20%20%20%2A%20%40returns%20%7Bnumber%5B%5D%7D%0A%20%20%20%20%20%2A%20%40param%20%7Bnumber%5B%5D%7D%20x%0A%20%20%20%20%20%2A%20%40param%20%7Bnumber%5B%5D%7D%20y%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EcomponentProduct%20%3D%20function%28x%2C%20y%29%20%7B%0A%20%20%20%20%20%20if%20%28typeof%20y%20%3D%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%20%20this%2EalertOnce%28%22Bad%20arg%20to%20componentProduct%22%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20var%20result%20%3D%20new%20Float32Array%283%29%2C%20i%3B%0A%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%3C3%3B%20i%2B%2B%29%0A%20%20%20%20%20%20%20%20result%5Bi%5D%20%3D%20x%5Bi%5D%2Ay%5Bi%5D%3B%0A%20%20%20%20%20%20return%20result%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Get%20next%20higher%20power%20of%20two%0A%20%20%20%20%20%2A%20%40returns%20%7B%20number%20%7D%0A%20%20%20%20%20%2A%20%40param%20%7B%20number%20%7D%20value%20%2D%20input%20value%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EgetPowerOfTwo%20%3D%20function%28value%29%20%7B%0A%20%20%20%20%20%20var%20pow%20%3D%201%3B%0A%20%20%20%20%20%20while%28pow%3Cvalue%29%20%7B%0A%20%20%20%20%20%20%20%20pow%20%2A%3D%202%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20return%20pow%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Unique%20entries%0A%20%20%20%20%20%2A%20%40returns%20%7B%20any%5B%5D%20%7D%0A%20%20%20%20%20%2A%20%40param%20%7B%20any%5B%5D%20%7D%20arr%20%2D%20An%20array%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2Eunique%20%3D%20function%28arr%29%20%7B%0A%20%20%20%20%20%20arr%20%3D%20%5B%5D%2Econcat%28arr%29%3B%0A%20%20%20%20%20%20return%20arr%2Efilter%28function%28value%2C%20index%2C%20self%29%20%7B%0A%20%20%20%20%20%20%20%20return%20self%2EindexOf%28value%29%20%3D%3D%3D%20index%3B%0A%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Repeat%20an%20array%20to%20a%20desired%20length%0A%20%20%20%20%20%2A%20%40returns%20%7Bany%5B%5D%7D%0A%20%20%20%20%20%2A%20%40param%20%7Bany%20%7C%20any%5B%5D%7D%20arr%20The%20input%20array%0A%20%20%20%20%20%2A%20%40param%20%7Bnumber%7D%20len%20The%20desired%20output%20length%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2ErepeatToLen%20%3D%20function%28arr%2C%20len%29%20%7B%0A%20%20%20%20%20%20arr%20%3D%20%5B%5D%2Econcat%28arr%29%3B%0A%20%20%20%20%20%20while%20%28arr%2Elength%20%3C%20len%2F2%29%0A%20%20%20%20%20%20%20%20arr%20%3D%20arr%2Econcat%28arr%29%3B%0A%20%20%20%20%20%20return%20arr%2Econcat%28arr%2Eslice%280%2C%20len%20%2D%20arr%2Elength%29%29%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Give%20a%20single%20alert%20message%2C%20not%20to%20be%20repeated%2E%0A%20%20%20%20%20%2A%20%40param%20%7Bstring%7D%20msg%20%20The%20message%20to%20give%2E%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EalertOnce%20%3D%20function%28msg%29%20%7B%0A%20%20%20%20%20%20if%20%28typeof%20this%2Ealerted%20%21%3D%3D%20%22undefined%22%29%0A%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20this%2Ealerted%20%3D%20true%3B%0A%20%20%20%20%20%20alert%28msg%29%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20rglwidgetClass%2Eprototype%2Ef%5Fis%5Flit%20%3D%201%3B%0A%20%20%20%20rglwidgetClass%2Eprototype%2Ef%5Fis%5Fsmooth%20%3D%202%3B%0A%20%20%20%20rglwidgetClass%2Eprototype%2Ef%5Fhas%5Ftexture%20%3D%204%3B%0A%20%20%20%20rglwidgetClass%2Eprototype%2Ef%5Fdepth%5Fsort%20%3D%208%3B%0A%20%20%20%20rglwidgetClass%2Eprototype%2Ef%5Ffixed%5Fquads%20%3D%2016%3B%0A%20%20%20%20rglwidgetClass%2Eprototype%2Ef%5Fis%5Ftransparent%20%3D%2032%3B%0A%20%20%20%20rglwidgetClass%2Eprototype%2Ef%5Fis%5Flines%20%3D%2064%3B%0A%20%20%20%20rglwidgetClass%2Eprototype%2Ef%5Fsprites%5F3d%20%3D%20128%3B%0A%20%20%20%20rglwidgetClass%2Eprototype%2Ef%5Fsprite%5F3d%20%3D%20256%3B%0A%20%20%20%20rglwidgetClass%2Eprototype%2Ef%5Fis%5Fsubscene%20%3D%20512%3B%0A%20%20%20%20rglwidgetClass%2Eprototype%2Ef%5Fis%5Fclipplanes%20%3D%201024%3B%0A%20%20%20%20rglwidgetClass%2Eprototype%2Ef%5Ffixed%5Fsize%20%3D%202048%3B%0A%20%20%20%20rglwidgetClass%2Eprototype%2Ef%5Fis%5Fpoints%20%3D%204096%3B%0A%20%20%20%20rglwidgetClass%2Eprototype%2Ef%5Fis%5Ftwosided%20%3D%208192%3B%0A%20%20%20%20rglwidgetClass%2Eprototype%2Ef%5Ffat%5Flines%20%3D%2016384%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Which%20list%20does%20a%20particular%20id%20come%20from%3F%0A%20%20%20%20%20%2A%20%40returns%20%7B%20string%20%7D%0A%20%20%20%20%20%2A%20%40param%20%7Bnumber%7D%20id%20The%20id%20to%20look%20up%2E%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EwhichList%20%3D%20function%28id%29%20%7B%0A%20%20%20%20%20%20var%20obj%20%3D%20this%2EgetObj%28id%29%2C%0A%20%20%20%20%20%20%20%20%20%20flags%20%3D%20obj%2Eflags%3B%0A%20%20%20%20%20%20%20%20if%20%28obj%2Etype%20%3D%3D%3D%20%22light%22%29%0A%20%20%20%20%20%20%20%20%20%20return%20%22lights%22%3B%0A%20%20%20%20%20%20%20%20if%20%28flags%20%26%20this%2Ef%5Fis%5Fsubscene%29%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20%22subscenes%22%3B%0A%20%20%20%20%20%20%20%20if%20%28flags%20%26%20this%2Ef%5Fis%5Fclipplanes%29%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20%22clipplanes%22%3B%0A%20%20%20%20%20%20%20%20if%20%28flags%20%26%20this%2Ef%5Fis%5Ftransparent%29%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20%22transparent%22%3B%0A%20%20%20%20%20%20%20%20return%20%22opaque%22%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Get%20an%20object%20by%20id%20number%2E%0A%20%20%20%20%20%2A%20%40returns%20%7B%20Object%20%7D%0A%20%20%20%20%20%2A%20%40param%20%7Bnumber%7D%20id%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EgetObj%20%3D%20function%28id%29%20%7B%0A%20%20%20%20%20%20if%20%28typeof%20id%20%21%3D%3D%20%22number%22%29%20%7B%0A%20%20%20%20%20%20%20%20this%2EalertOnce%28%22getObj%20id%20is%20%22%2Btypeof%20id%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20return%20this%2Escene%2Eobjects%5Bid%5D%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Get%20ids%20of%20a%20particular%20type%20from%20a%20subscene%20or%20the%20whole%20scene%0A%20%20%20%20%20%2A%20%40returns%20%7B%20number%5B%5D%20%7D%0A%20%20%20%20%20%2A%20%40param%20%7Bstring%7D%20type%20What%20type%20of%20object%3F%0A%20%20%20%20%20%2A%20%40param%20%7Bnumber%7D%20subscene%20%20Which%20subscene%3F%20%20If%20not%20given%2C%20find%20in%20the%20whole%20scene%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EgetIdsByType%20%3D%20function%28type%2C%20subscene%29%20%7B%0A%20%20%20%20%20%20var%0A%20%20%20%20%20%20%20%20result%20%3D%20%5B%5D%2C%20i%2C%20self%20%3D%20this%3B%0A%20%20%20%20%20%20if%20%28typeof%20subscene%20%3D%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%20%20Object%2Ekeys%28this%2Escene%2Eobjects%29%2EforEach%28%0A%20%20%20%20%20%20%20%20%20%20function%28key%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20key%20%3D%20parseInt%28key%2C%2010%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28self%2EgetObj%28key%29%2Etype%20%3D%3D%3D%20type%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20result%2Epush%28key%29%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20ids%20%3D%20this%2EgetObj%28subscene%29%2Eobjects%3B%0A%20%20%20%20%20%20%20%20for%20%28i%3D0%3B%20i%20%3C%20ids%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20if%20%28this%2EgetObj%28ids%5Bi%5D%29%2Etype%20%3D%3D%3D%20type%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20result%2Epush%28ids%5Bi%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20return%20result%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Get%20a%20particular%20material%20property%20for%20an%20id%0A%20%20%20%20%20%2A%20%40returns%20%7B%20any%20%7D%0A%20%20%20%20%20%2A%20%40param%20%7Bnumber%7D%20id%20%20Which%20object%3F%0A%20%20%20%20%20%2A%20%40param%20%7Bstring%7D%20property%20Which%20material%20property%3F%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EgetMaterial%20%3D%20function%28id%2C%20property%29%20%7B%0A%20%20%20%20%20%20var%20obj%20%3D%20this%2EgetObj%28id%29%2C%0A%20%20%20%20%20%20%20%20%20%20mat%20%3D%20obj%2Ematerial%5Bproperty%5D%3B%0A%20%20%20%20%20%20if%20%28typeof%20mat%20%3D%3D%3D%20%22undefined%22%29%0A%20%20%20%20%20%20%20%20%20%20mat%20%3D%20this%2Escene%2Ematerial%5Bproperty%5D%3B%0A%20%20%20%20%20%20return%20mat%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Is%20a%20particular%20id%20in%20a%20subscene%3F%0A%20%20%20%20%20%2A%20%40returns%20%7B%20boolean%20%7D%0A%20%20%20%20%20%2A%20%40param%20%7Bnumber%7D%20id%20Which%20id%3F%0A%20%20%20%20%20%2A%20%40param%20%7Bnumber%7D%20subscene%20Which%20subscene%20id%3F%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EinSubscene%20%3D%20function%28id%2C%20subscene%29%20%7B%0A%20%20%20%20%20%20return%20this%2EgetObj%28subscene%29%2Eobjects%2EindexOf%28id%29%20%3E%20%2D1%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Add%20an%20id%20to%20a%20subscene%2E%0A%20%20%20%20%20%2A%20%40param%20%7Bnumber%7D%20id%20Which%20id%3F%0A%20%20%20%20%20%2A%20%40param%20%7Bnumber%7D%20subscene%20Which%20subscene%20id%3F%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EaddToSubscene%20%3D%20function%28id%2C%20subscene%29%20%7B%0A%20%20%20%20%20%20var%20thelist%2C%0A%20%20%20%20%20%20%20%20%20%20thesub%20%3D%20this%2EgetObj%28subscene%29%2C%0A%20%20%20%20%20%20%20%20%20%20ids%20%3D%20%5Bid%5D%2C%0A%20%20%20%20%20%20%20%20%20%20obj%20%3D%20this%2EgetObj%28id%29%2C%20i%3B%0A%20%20%20%20%20%20if%20%28typeof%20obj%20%21%3D%20%22undefined%22%20%26%26%20typeof%20%28obj%2EnewIds%29%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%20%20ids%20%3D%20ids%2Econcat%28obj%2EnewIds%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20ids%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20id%20%3D%20ids%5Bi%5D%3B%0A%20%20%20%20%20%20%20%20if%20%28thesub%2Eobjects%2EindexOf%28id%29%20%3D%3D%20%2D1%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20thelist%20%3D%20this%2EwhichList%28id%29%3B%0A%20%20%20%20%20%20%20%20%20%20thesub%2Eobjects%2Epush%28id%29%3B%0A%20%20%20%20%20%20%20%20%20%20thesub%5Bthelist%5D%2Epush%28id%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Delete%20an%20id%20from%20a%20subscene%0A%20%20%20%20%20%2A%20%40param%20%7B%20number%20%7D%20id%20%2D%20the%20id%20to%20add%0A%20%20%20%20%20%2A%20%40param%20%7B%20number%20%7D%20subscene%20%2D%20the%20id%20of%20the%20subscene%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EdelFromSubscene%20%3D%20function%28id%2C%20subscene%29%20%7B%0A%20%20%20%20%20%20var%20thelist%2C%0A%20%20%20%20%20%20%20%20%20%20thesub%20%3D%20this%2EgetObj%28subscene%29%2C%0A%20%20%20%20%20%20%20%20%20%20obj%20%3D%20this%2EgetObj%28id%29%2C%0A%20%20%20%20%20%20%20%20%20%20ids%20%3D%20%5Bid%5D%2C%20i%3B%0A%20%20%20%20%20%20if%20%28typeof%20obj%20%21%3D%3D%20%22undefined%22%20%26%26%20typeof%20%28obj%2EnewIds%29%20%21%3D%3D%20%22undefined%22%29%0A%20%20%20%20%20%20%20%20ids%20%3D%20ids%2Econcat%28obj%2EnewIds%29%3B%0A%20%20%20%20%20%20for%20%28j%3D0%3B%20j%3Cids%2Elength%3Bj%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20id%20%3D%20ids%5Bj%5D%3B%0A%20%20%20%20%20%20%20%20i%20%3D%20thesub%2Eobjects%2EindexOf%28id%29%3B%0A%20%20%20%20%20%20%20%20if%20%28i%20%3E%20%2D1%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20thesub%2Eobjects%2Esplice%28i%2C%201%29%3B%0A%20%20%20%20%20%20%20%20%20%20thelist%20%3D%20this%2EwhichList%28id%29%3B%0A%20%20%20%20%20%20%20%20%20%20i%20%3D%20thesub%5Bthelist%5D%2EindexOf%28id%29%3B%0A%20%20%20%20%20%20%20%20%20%20thesub%5Bthelist%5D%2Esplice%28i%2C%201%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Set%20the%20ids%20in%20a%20subscene%0A%20%20%20%20%20%2A%20%40param%20%7B%20number%5B%5D%20%7D%20ids%20%2D%20the%20ids%20to%20set%0A%20%20%20%20%20%2A%20%40param%20%7B%20number%20%7D%20subsceneid%20%2D%20the%20id%20of%20the%20subscene%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EsetSubsceneEntries%20%3D%20function%28ids%2C%20subsceneid%29%20%7B%0A%20%20%20%20%20%20var%20sub%20%3D%20this%2EgetObj%28subsceneid%29%3B%0A%20%20%20%20%20%20sub%2Eobjects%20%3D%20ids%3B%0A%20%20%20%20%20%20this%2EinitSubscene%28subsceneid%29%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Get%20the%20ids%20in%20a%20subscene%0A%20%20%20%20%20%2A%20%40returns%20%7Bnumber%5B%5D%7D%0A%20%20%20%20%20%2A%20%40param%20%7B%20number%20%7D%20subscene%20%2D%20the%20id%20of%20the%20subscene%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EgetSubsceneEntries%20%3D%20function%28subscene%29%20%7B%0A%20%20%20%20%20%20return%20this%2EgetObj%28subscene%29%2Eobjects%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Get%20the%20ids%20of%20the%20subscenes%20within%20a%20subscene%0A%20%20%20%20%20%2A%20%40returns%20%7B%20number%5B%5D%20%7D%0A%20%20%20%20%20%2A%20%40param%20%7B%20number%20%7D%20subscene%20%2D%20the%20id%20of%20the%20subscene%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EgetChildSubscenes%20%3D%20function%28subscene%29%20%7B%0A%20%20%20%20%20%20return%20this%2EgetObj%28subscene%29%2Esubscenes%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Start%20drawing%0A%20%20%20%20%20%2A%20%40returns%20%7B%20boolean%20%7D%20Previous%20state%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EstartDrawing%20%3D%20function%28%29%20%7B%0A%20%20%20%20%09var%20value%20%3D%20this%2Edrawing%3B%0A%20%20%20%20%09this%2Edrawing%20%3D%20true%3B%0A%20%20%20%20%09return%20value%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Stop%20drawing%20and%20check%20for%20context%20loss%0A%20%20%20%20%20%2A%20%40param%20%7B%20boolean%20%7D%20saved%20%2D%20Previous%20state%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EstopDrawing%20%3D%20function%28saved%29%20%7B%0A%20%20%20%20%20%20this%2Edrawing%20%3D%20saved%3B%0A%20%20%20%20%20%20if%20%28%21saved%20%26%26%20this%2Egl%20%26%26%20this%2Egl%2EisContextLost%28%29%29%0A%20%20%20%20%20%20%20%20this%2ErestartCanvas%28%29%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Generate%20the%20vertex%20shader%20for%20an%20object%0A%20%20%20%20%20%2A%20%40returns%20%7Bstring%7D%0A%20%20%20%20%20%2A%20%40param%20%7B%20number%20%7D%20id%20%2D%20Id%20of%20object%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EgetVertexShader%20%3D%20function%28id%29%20%7B%0A%20%20%20%20%20%20var%20obj%20%3D%20this%2EgetObj%28id%29%2C%0A%20%20%20%20%20%20%20%20%20%20userShader%20%3D%20obj%2EuserVertexShader%2C%0A%20%20%20%20%20%20%20%20%20%20flags%20%3D%20obj%2Eflags%2C%0A%20%20%20%20%20%20%20%20%20%20type%20%3D%20obj%2Etype%2C%0A%20%20%20%20%20%20%20%20%20%20is%5Flit%20%3D%20flags%20%26%20this%2Ef%5Fis%5Flit%2C%0A%20%20%20%20%20%20%20%20%20%20has%5Ftexture%20%3D%20flags%20%26%20this%2Ef%5Fhas%5Ftexture%2C%0A%20%20%20%20%20%20%20%20%20%20fixed%5Fquads%20%3D%20flags%20%26%20this%2Ef%5Ffixed%5Fquads%2C%0A%20%20%20%20%20%20%20%20%20%20sprites%5F3d%20%3D%20flags%20%26%20this%2Ef%5Fsprites%5F3d%2C%0A%20%20%20%20%20%20%20%20%20%20sprite%5F3d%20%3D%20flags%20%26%20this%2Ef%5Fsprite%5F3d%2C%0A%20%20%20%20%20%20%20%20%20%20nclipplanes%20%3D%20this%2EcountClipplanes%28%29%2C%0A%20%20%20%20%20%20%20%20%20%20fixed%5Fsize%20%3D%20flags%20%26%20this%2Ef%5Ffixed%5Fsize%2C%0A%20%20%20%20%20%20%20%20%20%20is%5Fpoints%20%3D%20flags%20%26%20this%2Ef%5Fis%5Fpoints%2C%0A%20%20%20%20%20%20%20%20%20%20is%5Ftwosided%20%3D%20flags%20%26%20this%2Ef%5Fis%5Ftwosided%2C%0A%20%20%20%20%20%20%20%20%20%20fat%5Flines%20%3D%20flags%20%26%20this%2Ef%5Ffat%5Flines%2C%0A%20%20%20%20%20%20%20%20%20%20result%3B%0A%0A%20%20%20%20%20%20if%20%28type%20%3D%3D%3D%20%22clipplanes%22%20%7C%7C%20sprites%5F3d%29%20return%3B%0A%0A%20%20%20%20%20%20if%20%28typeof%20userShader%20%21%3D%3D%20%22undefined%22%29%20return%20userShader%3B%0A%0A%20%20%20%20%20%20result%20%3D%20%22%20%20%2F%2A%20%2A%2A%2A%2A%2A%2A%20%22%2Btype%2B%22%20object%20%22%2Bid%2B%22%20vertex%20shader%20%2A%2A%2A%2A%2A%2A%20%2A%2F%5Cn%22%2B%0A%20%20%20%20%20%20%22%20%20attribute%20vec3%20aPos%3B%5Cn%22%2B%0A%20%20%20%20%20%20%22%20%20attribute%20vec4%20aCol%3B%5Cn%22%2B%0A%20%20%20%20%20%20%22%20uniform%20mat4%20mvMatrix%3B%5Cn%22%2B%0A%20%20%20%20%20%20%22%20uniform%20mat4%20prMatrix%3B%5Cn%22%2B%0A%20%20%20%20%20%20%22%20varying%20vec4%20vCol%3B%5Cn%22%2B%0A%20%20%20%20%20%20%22%20varying%20vec4%20vPosition%3B%5Cn%22%3B%0A%0A%20%20%20%20%20%20if%20%28%28is%5Flit%20%26%26%20%21fixed%5Fquads%29%20%7C%7C%20sprite%5F3d%29%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20attribute%20vec3%20aNorm%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20uniform%20mat4%20normMatrix%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20varying%20vec3%20vNormal%3B%5Cn%22%3B%0A%0A%20%20%20%20%20%20if%20%28has%5Ftexture%20%7C%7C%20type%20%3D%3D%3D%20%22text%22%29%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20attribute%20vec2%20aTexcoord%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20varying%20vec2%20vTexcoord%3B%5Cn%22%3B%0A%0A%20%20%20%20%20%20if%20%28fixed%5Fsize%29%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20uniform%20vec2%20textScale%3B%5Cn%22%3B%0A%0A%20%20%20%20%20%20if%20%28fixed%5Fquads%29%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20attribute%20vec2%20aOfs%3B%5Cn%22%3B%0A%20%20%20%20%20%20else%20if%20%28sprite%5F3d%29%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20uniform%20vec3%20uOrig%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20uniform%20float%20uSize%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20uniform%20mat4%20usermat%3B%5Cn%22%3B%0A%0A%20%20%20%20%20%20if%20%28is%5Ftwosided%29%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20attribute%20vec3%20aPos1%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20attribute%20vec3%20aPos2%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20varying%20float%20normz%3B%5Cn%22%3B%0A%0A%20%20%20%20%20%20if%20%28fat%5Flines%29%20%7B%0A%20%20%20%20%20%20%09result%20%3D%20result%20%2B%20%20%20%22%20%20attribute%20vec3%20aNext%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20attribute%20vec2%20aPoint%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20varying%20vec2%20vPoint%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20varying%20float%20vLength%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20uniform%20float%20uAspect%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20uniform%20float%20uLwd%3B%5Cn%22%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20void%20main%28void%29%20%7B%5Cn%22%3B%0A%0A%20%20%20%20%20%20if%20%28nclipplanes%20%7C%7C%20%28%21fixed%5Fquads%20%26%26%20%21sprite%5F3d%29%29%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20%20%20vPosition%20%3D%20mvMatrix%20%2A%20vec4%28aPos%2C%201%2E%29%3B%5Cn%22%3B%0A%0A%20%20%20%20%20%20if%20%28%21fixed%5Fquads%20%26%26%20%21sprite%5F3d%29%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20%20%20gl%5FPosition%20%3D%20prMatrix%20%2A%20vPosition%3B%5Cn%22%3B%0A%0A%20%20%20%20%20%20if%20%28is%5Fpoints%29%20%7B%0A%20%20%20%20%20%20%20%20var%20size%20%3D%20this%2EgetMaterial%28id%2C%20%22size%22%29%3B%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20%20%20gl%5FPointSize%20%3D%20%22%2Bsize%2EtoFixed%281%29%2B%22%3B%5Cn%22%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20%20%20vCol%20%3D%20aCol%3B%5Cn%22%3B%0A%0A%20%20%20%20%20%20if%20%28is%5Flit%20%26%26%20%21fixed%5Fquads%20%26%26%20%21sprite%5F3d%29%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20%20%20vNormal%20%3D%20normalize%28%28normMatrix%20%2A%20vec4%28aNorm%2C%201%2E%29%29%2Exyz%29%3B%5Cn%22%3B%0A%0A%20%20%20%20%20%20if%20%28has%5Ftexture%20%7C%7C%20type%20%3D%3D%20%22text%22%29%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20%20%20vTexcoord%20%3D%20aTexcoord%3B%5Cn%22%3B%0A%0A%20%20%20%20%20%20if%20%28fixed%5Fsize%29%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20%20%20vec4%20pos%20%3D%20prMatrix%20%2A%20mvMatrix%20%2A%20vec4%28aPos%2C%201%2E%29%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20pos%20%3D%20pos%2Fpos%2Ew%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20gl%5FPosition%20%3D%20pos%20%2B%20vec4%28aOfs%2AtextScale%2C%200%2E%2C0%2E%29%3B%5Cn%22%3B%0A%0A%20%20%20%20%20%20if%20%28type%20%3D%3D%20%22sprites%22%20%26%26%20%21fixed%5Fsize%29%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20%20%20vec4%20pos%20%3D%20mvMatrix%20%2A%20vec4%28aPos%2C%201%2E%29%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20pos%20%3D%20pos%2Fpos%2Ew%20%2B%20vec4%28aOfs%2C%200%2E%2C%200%2E%29%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20gl%5FPosition%20%3D%20prMatrix%2Apos%3B%5Cn%22%3B%0A%0A%20%20%20%20%20%20if%20%28sprite%5F3d%29%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20%20vNormal%20%3D%20normalize%28%28normMatrix%20%2A%20vec4%28aNorm%2C%201%2E%29%29%2Exyz%29%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20vec4%20pos%20%3D%20mvMatrix%20%2A%20vec4%28uOrig%2C%201%2E%29%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20vPosition%20%3D%20pos%2Fpos%2Ew%20%2B%20vec4%28uSize%2A%28vec4%28aPos%2C%201%2E%29%2Ausermat%29%2Exyz%2C0%2E%29%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20gl%5FPosition%20%3D%20prMatrix%20%2A%20vPosition%3B%5Cn%22%3B%0A%0A%20%20%20%20%20%20if%20%28is%5Ftwosided%29%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20%20vec4%20pos1%20%3D%20prMatrix%2A%28mvMatrix%2Avec4%28aPos1%2C%201%2E%29%29%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20pos1%20%3D%20pos1%2Fpos1%2Ew%20%2D%20gl%5FPosition%2Fgl%5FPosition%2Ew%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20vec4%20pos2%20%3D%20prMatrix%2A%28mvMatrix%2Avec4%28aPos2%2C%201%2E%29%29%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20pos2%20%3D%20pos2%2Fpos2%2Ew%20%2D%20gl%5FPosition%2Fgl%5FPosition%2Ew%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20normz%20%3D%20pos1%2Ex%2Apos2%2Ey%20%2D%20pos1%2Ey%2Apos2%2Ex%3B%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20if%20%28fat%5Flines%29%20%0A%20%20%20%20%20%20%20%20%2F%2A%20This%20code%20was%20inspired%20by%20Matt%20Deslauriers%27%20code%20in%20https%3A%2F%2Fmattdesl%2Esvbtle%2Ecom%2Fdrawing%2Dlines%2Dis%2Dhard%20%2A%2F%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20%20vec2%20aspectVec%20%3D%20vec2%28uAspect%2C%201%2E0%29%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20mat4%20projViewModel%20%3D%20prMatrix%20%2A%20mvMatrix%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20vec4%20currentProjected%20%3D%20projViewModel%20%2A%20vec4%28aPos%2C%201%2E0%29%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20currentProjected%20%3D%20currentProjected%2FcurrentProjected%2Ew%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20vec4%20nextProjected%20%3D%20projViewModel%20%2A%20vec4%28aNext%2C%201%2E0%29%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20vec2%20currentScreen%20%3D%20currentProjected%2Exy%20%2A%20aspectVec%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20vec2%20nextScreen%20%3D%20%28nextProjected%2Exy%20%2F%20nextProjected%2Ew%29%20%2A%20aspectVec%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20float%20len%20%3D%20uLwd%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20vec2%20dir%20%3D%20vec2%281%2E0%2C%200%2E0%29%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20vPoint%20%3D%20aPoint%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20vLength%20%3D%20length%28nextScreen%20%2D%20currentScreen%29%2F2%2E0%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20vLength%20%3D%20vLength%2F%28vLength%20%2B%20len%29%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20if%20%28vLength%20%3E%200%2E0%29%20%7B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20%20%20dir%20%3D%20normalize%28nextScreen%20%2D%20currentScreen%29%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20%7D%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20vec2%20normal%20%3D%20vec2%28%2Ddir%2Ey%2C%20dir%2Ex%29%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20dir%2Ex%20%2F%3D%20uAspect%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20normal%2Ex%20%2F%3D%20uAspect%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20vec4%20offset%20%3D%20vec4%28len%2A%28normal%2AaPoint%2Ex%2AaPoint%2Ey%20%2D%20dir%29%2C%200%2E0%2C%200%2E0%29%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20gl%5FPosition%20%3D%20currentProjected%20%2B%20offset%3B%5Cn%22%3B%0A%0A%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20%7D%5Cn%22%3B%0A%20%20%20%20%20%20%2F%2F%20console%2Elog%28result%29%3B%0A%20%20%20%20%20%20return%20result%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Generate%20the%20fragment%20shader%20for%20an%20object%0A%20%20%20%20%20%2A%20%40returns%20%7Bstring%7D%0A%20%20%20%20%20%2A%20%40param%20%7B%20number%20%7D%20id%20%2D%20Id%20of%20object%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EgetFragmentShader%20%3D%20function%28id%29%20%7B%0A%20%20%20%20%20%20var%20obj%20%3D%20this%2EgetObj%28id%29%2C%0A%20%20%20%20%20%20%20%20%20%20userShader%20%3D%20obj%2EuserFragmentShader%2C%0A%20%20%20%20%20%20%20%20%20%20flags%20%3D%20obj%2Eflags%2C%0A%20%20%20%20%20%20%20%20%20%20type%20%3D%20obj%2Etype%2C%0A%20%20%20%20%20%20%20%20%20%20is%5Flit%20%3D%20flags%20%26%20this%2Ef%5Fis%5Flit%2C%0A%20%20%20%20%20%20%20%20%20%20has%5Ftexture%20%3D%20flags%20%26%20this%2Ef%5Fhas%5Ftexture%2C%0A%20%20%20%20%20%20%20%20%20%20fixed%5Fquads%20%3D%20flags%20%26%20this%2Ef%5Ffixed%5Fquads%2C%0A%20%20%20%20%20%20%20%20%20%20sprites%5F3d%20%3D%20flags%20%26%20this%2Ef%5Fsprites%5F3d%2C%0A%20%20%20%20%20%20%20%20%20%20is%5Ftwosided%20%3D%20%28flags%20%26%20this%2Ef%5Fis%5Ftwosided%29%20%3E%200%2C%0A%20%20%20%20%20%20%20%20%20%20fat%5Flines%20%3D%20flags%20%26%20this%2Ef%5Ffat%5Flines%2C%0A%20%20%20%20%20%20%20%20%20%20is%5Ftransparent%20%3D%20flags%20%26%20this%2Ef%5Fis%5Ftransparent%2C%0A%20%20%20%20%20%20%20%20%20%20nclipplanes%20%3D%20this%2EcountClipplanes%28%29%2C%20i%2C%0A%20%20%20%20%20%20%20%20%20%20texture%5Fformat%2C%20nlights%2C%0A%20%20%20%20%20%20%20%20%20%20result%3B%0A%0A%20%20%20%20%20%20if%20%28type%20%3D%3D%3D%20%22clipplanes%22%20%7C%7C%20sprites%5F3d%29%20return%3B%0A%0A%20%20%20%20%20%20if%20%28typeof%20userShader%20%21%3D%3D%20%22undefined%22%29%20return%20userShader%3B%0A%0A%20%20%20%20%20%20if%20%28has%5Ftexture%29%0A%20%20%20%20%20%20%20%20texture%5Fformat%20%3D%20this%2EgetMaterial%28id%2C%20%22textype%22%29%3B%0A%0A%20%20%20%20%20%20result%20%3D%20%22%2F%2A%20%2A%2A%2A%2A%2A%2A%20%22%2Btype%2B%22%20object%20%22%2Bid%2B%22%20fragment%20shader%20%2A%2A%2A%2A%2A%2A%20%2A%2F%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%23ifdef%20GL%5FES%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20precision%20highp%20float%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%23endif%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20varying%20vec4%20vCol%3B%20%2F%2F%20carries%20alpha%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20varying%20vec4%20vPosition%3B%5Cn%22%3B%0A%0A%20%20%20%20%20%20if%20%28has%5Ftexture%20%7C%7C%20type%20%3D%3D%3D%20%22text%22%29%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20varying%20vec2%20vTexcoord%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20uniform%20sampler2D%20uSampler%3B%5Cn%22%3B%0A%0A%20%20%20%20%20%20if%20%28is%5Flit%20%26%26%20%21fixed%5Fquads%29%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20varying%20vec3%20vNormal%3B%5Cn%22%3B%0A%0A%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20nclipplanes%3B%20i%2B%2B%29%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20uniform%20vec4%20vClipplane%22%2Bi%2B%22%3B%5Cn%22%3B%0A%0A%20%20%20%20%20%20if%20%28is%5Flit%29%20%7B%0A%20%20%20%20%20%20%20%20nlights%20%3D%20this%2EcountLights%28%29%3B%0A%20%20%20%20%20%20%20%20if%20%28nlights%29%0A%20%20%20%20%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20uniform%20mat4%20mvMatrix%3B%5Cn%22%3B%0A%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20is%5Flit%20%3D%20false%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20if%20%28is%5Flit%29%20%7B%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20%20uniform%20vec3%20emission%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20uniform%20float%20shininess%3B%5Cn%22%3B%0A%0A%20%20%20%20%20%20%20%20for%20%28i%3D0%3B%20i%20%3C%20nlights%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20%20uniform%20vec3%20ambient%22%20%2B%20i%20%2B%20%22%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20uniform%20vec3%20specular%22%20%2B%20i%20%2B%22%3B%20%2F%2F%20light%2Amaterial%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20uniform%20vec3%20diffuse%22%20%2B%20i%20%2B%20%22%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20uniform%20vec3%20lightDir%22%20%2B%20i%20%2B%20%22%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20uniform%20bool%20viewpoint%22%20%2B%20i%20%2B%20%22%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20uniform%20bool%20finite%22%20%2B%20i%20%2B%20%22%3B%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20if%20%28is%5Ftwosided%29%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20%20uniform%20bool%20front%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20varying%20float%20normz%3B%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20if%20%28fat%5Flines%29%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20%20varying%20vec2%20vPoint%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20varying%20float%20vLength%3B%5Cn%22%3B%0A%0A%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20void%20main%28void%29%20%7B%5Cn%22%3B%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20if%20%28fat%5Flines%29%20%7B%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20%20%20vec2%20point%20%3D%20vPoint%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20%20bool%20neg%20%3D%20point%2Ey%20%3C%200%2E0%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20%20point%2Ey%20%3D%20neg%20%3F%20%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20%20%20%20%28point%2Ey%20%2B%20vLength%29%2F%281%2E0%20%2D%20vLength%29%20%3A%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20%20%20%2D%28point%2Ey%20%2D%20vLength%29%2F%281%2E0%20%2D%20vLength%29%3B%5Cn%22%3B%0A%20%20%20%20%20%20%20%20if%20%28is%5Ftransparent%20%26%26%20type%20%3D%3D%20%22linestrip%22%29%0A%20%20%20%20%20%20%20%20%20%20result%20%3D%20result%2B%22%20%20%20%20if%20%28neg%20%26%26%20length%28point%29%20%3C%3D%201%2E0%29%20discard%3B%5Cn%22%3B%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20%20%20point%2Ey%20%3D%20min%28point%2Ey%2C%200%2E0%29%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20%20if%20%28length%28point%29%20%3E%201%2E0%29%20discard%3B%5Cn%22%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20for%20%28i%3D0%3B%20i%20%3C%20nclipplanes%3Bi%2B%2B%29%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20%20%20if%20%28dot%28vPosition%2C%20vClipplane%22%2Bi%2B%22%29%20%3C%200%2E0%29%20discard%3B%5Cn%22%3B%0A%0A%20%20%20%20%20%20if%20%28fixed%5Fquads%29%20%7B%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%20%20%22%20%20%20%20vec3%20n%20%3D%20vec3%280%2E%2C%200%2E%2C%201%2E%29%3B%5Cn%22%3B%0A%20%20%20%20%20%20%7D%20else%20if%20%28is%5Flit%29%20%7B%0A%20%20%20%20%20%20%09result%20%3D%20result%20%2B%20%20%20%22%20%20%20%20vec3%20n%20%3D%20normalize%28vNormal%29%3B%5Cn%22%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20if%20%28is%5Ftwosided%29%20%7B%0A%20%20%20%20%20%20%09result%20%3D%20result%20%2B%20%20%20%22%20%20%20%20if%20%28%28normz%20%3C%3D%200%2E%29%20%21%3D%20front%29%20discard%3B%5Cn%22%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20if%20%28is%5Flit%29%20%7B%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20%20%20vec3%20eye%20%3D%20normalize%28%2DvPosition%2Exyz%29%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20vec3%20lightdir%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20vec4%20colDiff%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20vec3%20halfVec%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20vec4%20lighteffect%20%3D%20vec4%28emission%2C%200%2E%29%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20vec3%20col%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20float%20nDotL%3B%5Cn%22%3B%0A%20%20%20%20%20%20%20%20if%20%28%21fixed%5Fquads%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%20%20%22%20%20%20n%20%3D%20%2Dfaceforward%28n%2C%20n%2C%20eye%29%3B%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20for%20%28i%3D0%3B%20i%20%3C%20nlights%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20%20colDiff%20%3D%20vec4%28vCol%2Ergb%20%2A%20diffuse%22%20%2B%20i%20%2B%20%22%2C%20vCol%2Ea%29%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20lightdir%20%3D%20lightDir%22%20%2B%20i%20%2B%20%22%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20if%20%28%21viewpoint%22%20%2B%20i%20%2B%22%29%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20%20%20lightdir%20%3D%20%28mvMatrix%20%2A%20vec4%28lightdir%2C%201%2E%29%29%2Exyz%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20if%20%28%21finite%22%20%2B%20i%20%2B%20%22%29%20%7B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20%20%20halfVec%20%3D%20normalize%28lightdir%20%2B%20eye%29%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20%7D%20else%20%7B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20%20%20lightdir%20%3D%20normalize%28lightdir%20%2D%20vPosition%2Exyz%29%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20%20%20halfVec%20%3D%20normalize%28lightdir%20%2B%20eye%29%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20%7D%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20%20col%20%3D%20ambient%22%20%2B%20i%20%2B%20%22%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20nDotL%20%3D%20dot%28n%2C%20lightdir%29%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20col%20%3D%20col%20%2B%20max%28nDotL%2C%200%2E%29%20%2A%20colDiff%2Ergb%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20col%20%3D%20col%20%2B%20pow%28max%28dot%28halfVec%2C%20n%29%2C%200%2E%29%2C%20shininess%29%20%2A%20specular%22%20%2B%20i%20%2B%20%22%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20lighteffect%20%3D%20lighteffect%20%2B%20vec4%28col%2C%20colDiff%2Ea%29%3B%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%20%20%22%20%20%20vec4%20colDiff%20%3D%20vCol%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20%20vec4%20lighteffect%20%3D%20colDiff%3B%5Cn%22%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20if%20%28type%20%3D%3D%3D%20%22text%22%29%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%20%20%22%20%20%20%20vec4%20textureColor%20%3D%20lighteffect%2Atexture2D%28uSampler%2C%20vTexcoord%29%3B%5Cn%22%3B%0A%0A%20%20%20%20%20%20if%20%28has%5Ftexture%29%20%7B%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20rgb%3A%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20vec4%20textureColor%20%3D%20lighteffect%2Avec4%28texture2D%28uSampler%2C%20vTexcoord%29%2Ergb%2C%201%2E%29%3B%5Cn%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20rgba%3A%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20vec4%20textureColor%20%3D%20lighteffect%2Atexture2D%28uSampler%2C%20vTexcoord%29%3B%5Cn%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20alpha%3A%20%20%20%20%20%20%20%20%20%20%22%20%20%20vec4%20textureColor%20%3D%20texture2D%28uSampler%2C%20vTexcoord%29%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20float%20luminance%20%3D%20dot%28vec3%281%2E%2C1%2E%2C1%2E%29%2C%20textureColor%2Ergb%29%2F3%2E%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20textureColor%20%3D%20%20vec4%28lighteffect%2Ergb%2C%20lighteffect%2Ea%2Aluminance%29%3B%5Cn%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20luminance%3A%20%20%20%20%20%20%22%20%20%20vec4%20textureColor%20%3D%20vec4%28lighteffect%2Ergb%2Adot%28texture2D%28uSampler%2C%20vTexcoord%29%2Ergb%2C%20vec3%281%2E%2C1%2E%2C1%2E%29%29%2F3%2E%2C%20lighteffect%2Ea%29%3B%5Cn%22%2C%0A%20%20%20%20%20%20%20%20%20%20%22luminance%2Ealpha%22%3A%22%20%20%20%20vec4%20textureColor%20%3D%20texture2D%28uSampler%2C%20vTexcoord%29%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20float%20luminance%20%3D%20dot%28vec3%281%2E%2C1%2E%2C1%2E%29%2CtextureColor%2Ergb%29%2F3%2E%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20textureColor%20%3D%20vec4%28lighteffect%2Ergb%2Aluminance%2C%20lighteffect%2Ea%2AtextureColor%2Ea%29%3B%5Cn%22%0A%20%20%20%20%20%20%20%20%20%20%7D%5Btexture%5Fformat%5D%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20gl%5FFragColor%20%3D%20textureColor%3B%5Cn%22%3B%0A%20%20%20%20%20%20%7D%20else%20if%20%28type%20%3D%3D%3D%20%22text%22%29%20%7B%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%20%20%22%20%20%20%20if%20%28textureColor%2Ea%20%3C%200%2E1%29%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20%20%20discard%3B%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20else%5Cn%22%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20%20%20%20%20gl%5FFragColor%20%3D%20textureColor%3B%5Cn%22%3B%0A%20%20%20%20%20%20%7D%20else%0A%20%20%20%20%20%20%20%20result%20%3D%20result%20%2B%20%20%20%22%20%20%20gl%5FFragColor%20%3D%20lighteffect%3B%5Cn%22%3B%0A%0A%20%20%20%20%20%20%2F%2Fif%20%28fat%5Flines%29%0A%20%20%20%20%20%20%2F%2F%20%20result%20%3D%20result%20%2B%20%20%20%22%20%20%20gl%5FFragColor%20%3D%20vec4%280%2E0%2C%20abs%28point%2Ex%29%2C%20abs%28point%2Ey%29%2C%201%2E0%29%3B%22%0A%20%20%20%20%20%20result%20%3D%20result%20%2B%20%22%20%20%7D%5Cn%22%3B%0A%20%20%20%20%20%20%2F%2F%20console%2Elog%28result%29%3B%0A%20%20%20%20%20%20return%20result%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Call%20gl%20functions%20to%20create%20and%20compile%20shader%0A%20%20%20%20%20%2A%20%40returns%20%7BObject%7D%0A%20%20%20%20%20%2A%20%40param%20%7B%20number%20%7D%20shaderType%20%2D%20gl%20code%20for%20shader%20type%0A%20%20%20%20%20%2A%20%40param%20%7B%20string%20%7D%20code%20%2D%20code%20for%20the%20shader%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EgetShader%20%3D%20function%28shaderType%2C%20code%29%20%7B%0A%20%20%20%20%20%20%20%20var%20gl%20%3D%20this%2Egl%2C%20shader%3B%0A%20%20%20%20%20%20%20%20shader%20%3D%20gl%2EcreateShader%28shaderType%29%3B%0A%20%20%20%20%20%20%20%20gl%2EshaderSource%28shader%2C%20code%29%3B%0A%20%20%20%20%20%20%20%20gl%2EcompileShader%28shader%29%3B%0A%20%20%20%20%20%20%20%20if%20%28%21gl%2EgetShaderParameter%28shader%2C%20gl%2ECOMPILE%5FSTATUS%29%20%26%26%20%21gl%2EisContextLost%28%29%29%0A%20%20%20%20%20%20%20%20%20%20%20%20alert%28gl%2EgetShaderInfoLog%28shader%29%29%3B%0A%20%20%20%20%20%20%20%20return%20shader%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Handle%20a%20texture%20after%20its%20image%20has%20been%20loaded%0A%20%20%20%20%20%2A%20%40param%20%7B%20Object%20%7D%20texture%20%2D%20the%20gl%20texture%20object%0A%20%20%20%20%20%2A%20%40param%20%7B%20Object%20%7D%20textureCanvas%20%2D%20the%20canvas%20holding%20the%20image%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EhandleLoadedTexture%20%3D%20function%28texture%2C%20textureCanvas%29%20%7B%0A%20%20%20%20%20%20var%20gl%20%3D%20this%2Egl%20%7C%7C%20this%2EinitGL%28%29%3B%0A%20%20%20%20%20%20gl%2EpixelStorei%28gl%2EUNPACK%5FFLIP%5FY%5FWEBGL%2C%20true%29%3B%0A%0A%20%20%20%20%20%20gl%2EbindTexture%28gl%2ETEXTURE%5F2D%2C%20texture%29%3B%0A%20%20%20%20%20%20gl%2EtexImage2D%28gl%2ETEXTURE%5F2D%2C%200%2C%20gl%2ERGBA%2C%20gl%2ERGBA%2C%20gl%2EUNSIGNED%5FBYTE%2C%20textureCanvas%29%3B%0A%20%20%20%20%20%20gl%2EtexParameteri%28gl%2ETEXTURE%5F2D%2C%20gl%2ETEXTURE%5FMAG%5FFILTER%2C%20gl%2ELINEAR%29%3B%0A%20%20%20%20%20%20gl%2EtexParameteri%28gl%2ETEXTURE%5F2D%2C%20gl%2ETEXTURE%5FMIN%5FFILTER%2C%20gl%2ELINEAR%5FMIPMAP%5FNEAREST%29%3B%0A%20%20%20%20%20%20gl%2EgenerateMipmap%28gl%2ETEXTURE%5F2D%29%3B%0A%0A%20%20%20%20%20%20gl%2EbindTexture%28gl%2ETEXTURE%5F2D%2C%20null%29%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Load%20an%20image%20to%20a%20texture%0A%20%20%20%20%20%2A%20%40param%20%7B%20string%20%7D%20uri%20%2D%20The%20image%20location%0A%20%20%20%20%20%2A%20%40param%20%7B%20Object%20%7D%20texture%20%2D%20the%20gl%20texture%20object%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EloadImageToTexture%20%3D%20function%28uri%2C%20texture%29%20%7B%0A%20%20%20%20%20%20var%20canvas%20%3D%20this%2EtextureCanvas%2C%0A%20%20%20%20%20%20%20%20%20%20ctx%20%3D%20canvas%2EgetContext%28%222d%22%29%2C%0A%20%20%20%20%20%20%20%20%20%20image%20%3D%20new%20Image%28%29%2C%0A%20%20%20%20%20%20%20%20%20%20self%20%3D%20this%3B%0A%0A%20%20%20%20%20%20%20image%2Eonload%20%3D%20function%28%29%20%7B%0A%20%20%20%20%20%20%20%20%20var%20w%20%3D%20image%2Ewidth%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20h%20%3D%20image%2Eheight%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20canvasX%20%3D%20self%2EgetPowerOfTwo%28w%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20canvasY%20%3D%20self%2EgetPowerOfTwo%28h%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20gl%20%3D%20self%2Egl%20%7C%7C%20self%2EinitGL%28%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20maxTexSize%20%3D%20gl%2EgetParameter%28gl%2EMAX%5FTEXTURE%5FSIZE%29%3B%0A%20%20%20%20%20%20%20%20%20if%20%28maxTexSize%20%3E%204096%29%20maxTexSize%20%3D%204096%3B%0A%20%20%20%20%20%20%20%20%20while%20%28canvasX%20%3E%201%20%26%26%20canvasY%20%3E%201%20%26%26%20%28canvasX%20%3E%20maxTexSize%20%7C%7C%20canvasY%20%3E%20maxTexSize%29%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20canvasX%20%2F%3D%202%3B%0A%20%20%20%20%20%20%20%20%20%20%20canvasY%20%2F%3D%202%3B%0A%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20canvas%2Ewidth%20%3D%20canvasX%3B%0A%20%20%20%20%20%20%20%20%20canvas%2Eheight%20%3D%20canvasY%3B%0A%20%20%20%20%20%20%20%20%20ctx%2EimageSmoothingEnabled%20%3D%20true%3B%0A%20%20%20%20%20%20%20%20%20ctx%2EdrawImage%28image%2C%200%2C%200%2C%20canvasX%2C%20canvasY%29%3B%0A%20%20%20%20%20%20%20%20%20self%2EhandleLoadedTexture%28texture%2C%20canvas%29%3B%0A%20%20%20%20%20%20%20%20%20self%2EdrawScene%28%29%3B%0A%20%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%20%20%20image%2Esrc%20%3D%20uri%3B%0A%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Draw%20text%20to%20the%20texture%20canvas%0A%20%20%20%20%20%2A%20%40returns%20%7B%20Object%20%7D%20object%20with%20text%20measurements%0A%20%20%20%20%20%2A%20%40param%20%7B%20string%20%7D%20text%20%2D%20the%20text%0A%20%20%20%20%20%2A%20%40param%20%7B%20number%20%7D%20cex%20%2D%20expansion%0A%20%20%20%20%20%2A%20%40param%20%7B%20string%20%7D%20family%20%2D%20font%20family%0A%20%20%20%20%20%2A%20%40param%20%7B%20number%20%7D%20font%20%2D%20font%20number%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EdrawTextToCanvas%20%3D%20function%28text%2C%20cex%2C%20family%2C%20font%29%20%7B%0A%20%20%20%20%20%20%20var%20canvasX%2C%20canvasY%2C%0A%20%20%20%20%20%20%20%20%20%20%20textY%2C%0A%20%20%20%20%20%20%20%20%20%20%20scaling%20%3D%2020%2C%0A%20%20%20%20%20%20%20%20%20%20%20textColour%20%3D%20%22white%22%2C%0A%0A%20%20%20%20%20%20%20%20%20%20%20backgroundColour%20%3D%20%22rgba%280%2C0%2C0%2C0%29%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20canvas%20%3D%20this%2EtextureCanvas%2C%0A%20%20%20%20%20%20%20%20%20%20%20ctx%20%3D%20canvas%2EgetContext%28%222d%22%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20i%2C%20textHeights%20%3D%20%5B%5D%2C%20widths%20%3D%20%5B%5D%2C%20offset%20%3D%200%2C%20offsets%20%3D%20%5B%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20fontStrings%20%3D%20%5B%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20getFontString%20%3D%20function%28i%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20textHeights%5Bi%5D%20%3D%20scaling%2Acex%5Bi%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20var%20fontString%20%3D%20textHeights%5Bi%5D%20%2B%20%22px%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20family0%20%3D%20family%5Bi%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20font0%20%3D%20font%5Bi%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28family0%20%3D%3D%3D%20%22sans%22%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20family0%20%3D%20%22sans%2Dserif%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20%28family0%20%3D%3D%3D%20%22mono%22%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20family0%20%3D%20%22monospace%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20fontString%20%3D%20fontString%20%2B%20%22%20%22%20%2B%20family0%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28font0%20%3D%3D%3D%202%20%7C%7C%20font0%20%3D%3D%3D%204%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fontString%20%3D%20%22bold%20%22%20%2B%20fontString%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28font0%20%3D%3D%3D%203%20%7C%7C%20font0%20%3D%3D%3D%204%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fontString%20%3D%20%22italic%20%22%20%2B%20fontString%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20return%20fontString%3B%0A%20%20%20%20%20%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%20%20%20cex%20%3D%20this%2ErepeatToLen%28cex%2C%20text%2Elength%29%3B%0A%20%20%20%20%20%20%20family%20%3D%20this%2ErepeatToLen%28family%2C%20text%2Elength%29%3B%0A%20%20%20%20%20%20%20font%20%3D%20this%2ErepeatToLen%28font%2C%20text%2Elength%29%3B%0A%0A%20%20%20%20%20%20%20canvasX%20%3D%201%3B%0A%20%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20text%2Elength%3B%20i%2B%2B%29%20%20%7B%0A%20%20%20%20%20%20%20%20%20ctx%2Efont%20%3D%20fontStrings%5Bi%5D%20%3D%20getFontString%28i%29%3B%0A%20%20%20%20%20%20%20%20%20widths%5Bi%5D%20%3D%20ctx%2EmeasureText%28text%5Bi%5D%29%2Ewidth%3B%0A%20%20%20%20%20%20%20%20%20offset%20%3D%20offsets%5Bi%5D%20%3D%20offset%20%2B%202%2AtextHeights%5Bi%5D%3B%0A%20%20%20%20%20%20%20%20%20canvasX%20%3D%20%28widths%5Bi%5D%20%3E%20canvasX%29%20%3F%20widths%5Bi%5D%20%3A%20canvasX%3B%0A%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20canvasX%20%3D%20this%2EgetPowerOfTwo%28canvasX%29%3B%0A%20%20%20%20%20%20%20canvasY%20%3D%20this%2EgetPowerOfTwo%28offset%29%3B%0A%0A%20%20%20%20%20%20%20canvas%2Ewidth%20%3D%20canvasX%3B%0A%20%20%20%20%20%20%20canvas%2Eheight%20%3D%20canvasY%3B%0A%0A%20%20%20%20%20%20%20ctx%2EfillStyle%20%3D%20backgroundColour%3B%0A%20%20%20%20%20%20%20ctx%2EfillRect%280%2C%200%2C%20ctx%2Ecanvas%2Ewidth%2C%20ctx%2Ecanvas%2Eheight%29%3B%0A%0A%20%20%20%20%20%20%20ctx%2EtextBaseline%20%3D%20%22alphabetic%22%3B%0A%20%20%20%20%20%20%20for%28i%20%3D%200%3B%20i%20%3C%20text%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20textY%20%3D%20offsets%5Bi%5D%3B%0A%20%20%20%20%20%20%20%20%20ctx%2Efont%20%3D%20fontStrings%5Bi%5D%3B%0A%20%20%20%20%20%20%20%20%20ctx%2EfillStyle%20%3D%20textColour%3B%0A%20%20%20%20%20%20%20%20%20ctx%2EtextAlign%20%3D%20%22left%22%3B%0A%20%20%20%20%20%20%20%20%20ctx%2EfillText%28text%5Bi%5D%2C%200%2C%20%20textY%29%3B%0A%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20return%20%7BcanvasX%3AcanvasX%2C%20canvasY%3AcanvasY%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20widths%3Awidths%2C%20textHeights%3AtextHeights%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20offsets%3Aoffsets%7D%3B%0A%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Set%20the%20gl%20viewport%20and%20scissor%20test%0A%20%20%20%20%20%2A%20%40param%20%7B%20number%20%7D%20id%20%2D%20id%20of%20subscene%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EsetViewport%20%3D%20function%28id%29%20%7B%0A%20%20%20%20%20%20%20var%20gl%20%3D%20this%2Egl%20%7C%7C%20this%2EinitGL%28%29%2C%0A%20%20%20%20%20%20%20%20%20vp%20%3D%20this%2EgetObj%28id%29%2Epar3d%2Eviewport%2C%0A%20%20%20%20%20%20%20%20%20x%20%3D%20vp%2Ex%2Athis%2Ecanvas%2Ewidth%2C%0A%20%20%20%20%20%20%20%20%20y%20%3D%20vp%2Ey%2Athis%2Ecanvas%2Eheight%2C%0A%20%20%20%20%20%20%20%20%20width%20%3D%20vp%2Ewidth%2Athis%2Ecanvas%2Ewidth%2C%0A%20%20%20%20%20%20%20%20%20height%20%3D%20vp%2Eheight%2Athis%2Ecanvas%2Eheight%3B%0A%20%20%20%20%20%20%20this%2Evp%20%3D%20%7Bx%3Ax%2C%20y%3Ay%2C%20width%3Awidth%2C%20height%3Aheight%7D%3B%0A%20%20%20%20%20%20%20gl%2Eviewport%28x%2C%20y%2C%20width%2C%20height%29%3B%0A%20%20%20%20%20%20%20gl%2Escissor%28x%2C%20y%2C%20width%2C%20height%29%3B%0A%20%20%20%20%20%20%20gl%2Eenable%28gl%2ESCISSOR%5FTEST%29%3B%0A%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Set%20the%20projection%20matrix%20for%20a%20subscene%0A%20%20%20%20%20%2A%20%40param%20%7B%20number%20%7D%20id%20%2D%20id%20of%20subscene%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EsetprMatrix%20%3D%20function%28id%29%20%7B%0A%20%20%20%20%20%20%20var%20subscene%20%3D%20this%2EgetObj%28id%29%2C%0A%20%20%20%20%20%20%20%20%20%20embedding%20%3D%20subscene%2Eembeddings%2Eprojection%3B%0A%20%20%20%20%20%20%20if%20%28embedding%20%3D%3D%3D%20%22replace%22%29%0A%20%20%20%20%20%20%20%20%20this%2EprMatrix%2EmakeIdentity%28%29%3B%0A%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20this%2EsetprMatrix%28subscene%2Eparent%29%3B%0A%20%20%20%20%20%20%20if%20%28embedding%20%3D%3D%3D%20%22inherit%22%29%0A%20%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%20%2F%2F%20This%20is%20based%20on%20the%20Frustum%3A%3Aenclose%20code%20from%20geom%2Ecpp%0A%20%20%20%20%20%20%20var%20bbox%20%3D%20subscene%2Epar3d%2Ebbox%2C%0A%20%20%20%20%20%20%20%20%20%20%20scale%20%3D%20subscene%2Epar3d%2Escale%2C%0A%20%20%20%20%20%20%20%20%20%20%20ranges%20%3D%20%5B%28bbox%5B1%5D%2Dbbox%5B0%5D%29%2Ascale%5B0%5D%2F2%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%28bbox%5B3%5D%2Dbbox%5B2%5D%29%2Ascale%5B1%5D%2F2%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%28bbox%5B5%5D%2Dbbox%5B4%5D%29%2Ascale%5B2%5D%2F2%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20radius%20%3D%20Math%2Esqrt%28this%2Esumsq%28ranges%29%29%2A1%2E1%3B%20%2F%2F%20A%20bit%20bigger%20to%20handle%20labels%0A%20%20%20%20%20%20%20if%20%28radius%20%3C%3D%200%29%20radius%20%3D%201%3B%0A%20%20%20%20%20%20%20var%20observer%20%3D%20subscene%2Epar3d%2Eobserver%2C%0A%20%20%20%20%20%20%20%20%20%20%20distance%20%3D%20observer%5B2%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20FOV%20%3D%20subscene%2Epar3d%2EFOV%2C%20ortho%20%3D%20FOV%20%3D%3D%3D%200%2C%0A%20%20%20%20%20%20%20%20%20%20%20t%20%3D%20ortho%20%3F%201%20%3A%20Math%2Etan%28FOV%2AMath%2EPI%2F360%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20near%20%3D%20distance%20%2D%20radius%2C%0A%20%20%20%20%20%20%20%20%20%20%20far%20%3D%20distance%20%2B%20radius%2C%0A%20%20%20%20%20%20%20%20%20%20%20hlen%2C%0A%20%20%20%20%20%20%20%20%20%20%20aspect%20%3D%20this%2Evp%2Ewidth%2Fthis%2Evp%2Eheight%2C%0A%20%20%20%20%20%20%20%20%20%20%20z%20%3D%20subscene%2Epar3d%2Ezoom%3B%0A%20%20%20%20%20%20%20if%20%28far%20%3C%200%2E0%29%0A%20%20%20%20%20%20%20%20%20far%20%3D%201%2E0%3B%0A%20%20%20%20%20%20%20if%20%28near%20%3C%20far%2F100%2E0%29%0A%20%20%20%20%20%20%20%20%20near%20%3D%20far%2F100%2E0%3B%0A%20%20%20%20%20%20%20hlen%20%3D%20t%2Anear%3B%0A%20%20%20%20%20%20%20if%20%28ortho%29%20%7B%0A%20%20%20%20%20%20%20%20%20if%20%28aspect%20%3E%201%29%0A%20%20%20%20%20%20%20%20%20%20%20this%2EprMatrix%2Eortho%28%2Dhlen%2Aaspect%2Az%2C%20hlen%2Aaspect%2Az%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2Dhlen%2Az%2C%20hlen%2Az%2C%20near%2C%20far%29%3B%0A%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20this%2EprMatrix%2Eortho%28%2Dhlen%2Az%2C%20hlen%2Az%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2Dhlen%2Az%2Faspect%2C%20hlen%2Az%2Faspect%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20near%2C%20far%29%3B%0A%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20if%20%28aspect%20%3E%201%29%0A%20%20%20%20%20%20%20%20%20%20%20this%2EprMatrix%2Efrustum%28%2Dhlen%2Aaspect%2Az%2C%20hlen%2Aaspect%2Az%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2Dhlen%2Az%2C%20hlen%2Az%2C%20near%2C%20far%29%3B%0A%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20this%2EprMatrix%2Efrustum%28%2Dhlen%2Az%2C%20hlen%2Az%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2Dhlen%2Az%2Faspect%2C%20hlen%2Az%2Faspect%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20near%2C%20far%29%3B%0A%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Set%20the%20model%2Dview%20matrix%20for%20a%20subscene%0A%20%20%20%20%20%2A%20%40param%20%7B%20number%20%7D%20id%20%2D%20id%20of%20the%20subscene%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EsetmvMatrix%20%3D%20function%28id%29%20%7B%0A%20%20%20%20%20%20%20var%20observer%20%3D%20this%2EgetObj%28id%29%2Epar3d%2Eobserver%3B%0A%20%20%20%20%20%20%20this%2EmvMatrix%2EmakeIdentity%28%29%3B%0A%20%20%20%20%20%20%20this%2EsetmodelMatrix%28id%29%3B%0A%20%20%20%20%20%20%20this%2EmvMatrix%2Etranslate%28%2Dobserver%5B0%5D%2C%20%2Dobserver%5B1%5D%2C%20%2Dobserver%5B2%5D%29%3B%0A%0A%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Set%20the%20model%20matrix%20for%20a%20subscene%0A%20%20%20%20%20%2A%20%40param%20%7B%20number%20%7D%20id%20%2D%20id%20of%20the%20subscene%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EsetmodelMatrix%20%3D%20function%28id%29%20%7B%0A%20%20%20%20%20%20var%20subscene%20%3D%20this%2EgetObj%28id%29%2C%0A%20%20%20%20%20%20%20%20%20%20embedding%20%3D%20subscene%2Eembeddings%2Emodel%3B%0A%20%20%20%20%20%20if%20%28embedding%20%21%3D%3D%20%22inherit%22%29%20%7B%0A%20%20%20%20%20%20%20%20var%20scale%20%3D%20subscene%2Epar3d%2Escale%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20bbox%20%3D%20subscene%2Epar3d%2Ebbox%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20center%20%3D%20%5B%28bbox%5B0%5D%2Bbbox%5B1%5D%29%2F2%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%28bbox%5B2%5D%2Bbbox%5B3%5D%29%2F2%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%28bbox%5B4%5D%2Bbbox%5B5%5D%29%2F2%5D%3B%0A%20%20%20%20%20%20%20%20%20this%2EmvMatrix%2Etranslate%28%2Dcenter%5B0%5D%2C%20%2Dcenter%5B1%5D%2C%20%2Dcenter%5B2%5D%29%3B%0A%20%20%20%20%20%20%20%20%20this%2EmvMatrix%2Escale%28scale%5B0%5D%2C%20scale%5B1%5D%2C%20scale%5B2%5D%29%3B%0A%20%20%20%20%20%20%20%20%20this%2EmvMatrix%2EmultRight%28%20subscene%2Epar3d%2EuserMatrix%20%29%3B%0A%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20if%20%28embedding%20%21%3D%3D%20%22replace%22%29%0A%20%20%20%20%20%20%20%20%20this%2EsetmodelMatrix%28subscene%2Eparent%29%3B%0A%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Set%20the%20normals%20matrix%20for%20a%20subscene%0A%20%20%20%20%20%2A%20%40param%20%7B%20number%20%7D%20subsceneid%20%2D%20id%20of%20the%20subscene%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EsetnormMatrix%20%3D%20function%28subsceneid%29%20%7B%0A%20%20%20%20%20%20%20var%20self%20%3D%20this%2C%0A%20%20%20%20%20%20%20recurse%20%3D%20function%28id%29%20%7B%0A%20%20%20%20%20%20%20%20%20var%20sub%20%3D%20self%2EgetObj%28id%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20embedding%20%3D%20sub%2Eembeddings%2Emodel%3B%0A%20%20%20%20%20%20%20%20%20if%20%28embedding%20%21%3D%3D%20%22inherit%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20var%20scale%20%3D%20sub%2Epar3d%2Escale%3B%0A%20%20%20%20%20%20%20%20%20%20%20self%2EnormMatrix%2Escale%281%2Fscale%5B0%5D%2C%201%2Fscale%5B1%5D%2C%201%2Fscale%5B2%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20self%2EnormMatrix%2EmultRight%28sub%2Epar3d%2EuserMatrix%29%3B%0A%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20if%20%28embedding%20%21%3D%3D%20%22replace%22%29%0A%20%20%20%20%20%20%20%20%20%20%20recurse%28sub%2Eparent%29%3B%0A%20%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%20%20%20self%2EnormMatrix%2EmakeIdentity%28%29%3B%0A%20%20%20%20%20%20%20recurse%28subsceneid%29%3B%0A%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Set%20the%20combined%20projection%2Dmodel%2Dview%20matrix%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EsetprmvMatrix%20%3D%20function%28%29%20%7B%0A%20%20%20%20%20%20%20this%2EprmvMatrix%20%3D%20new%20CanvasMatrix4%28%20this%2EmvMatrix%20%29%3B%0A%20%20%20%20%20%20%20this%2EprmvMatrix%2EmultRight%28%20this%2EprMatrix%20%29%3B%0A%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Count%20clipping%20planes%20in%20a%20scene%0A%20%20%20%20%20%2A%20%40returns%20%7Bnumber%7D%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EcountClipplanes%20%3D%20function%28%29%20%7B%0A%20%20%20%20%20%20return%20this%2EcountObjs%28%22clipplanes%22%29%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Count%20lights%20in%20a%20scene%0A%20%20%20%20%20%2A%20%40returns%20%7B%20number%20%7D%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EcountLights%20%3D%20function%28%29%20%7B%0A%20%20%20%20%20%20return%20this%2EcountObjs%28%22light%22%29%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Count%20objects%20of%20specific%20type%20in%20a%20scene%0A%20%20%20%20%20%2A%20%40returns%20%7B%20number%20%7D%0A%20%20%20%20%20%2A%20%40param%20%7B%20string%20%7D%20type%20%2D%20Type%20of%20object%20to%20count%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EcountObjs%20%3D%20function%28type%29%20%7B%0A%20%20%20%20%20%20var%20self%20%3D%20this%2C%0A%20%20%20%20%20%20%20%20%20%20bound%20%3D%200%3B%0A%0A%20%20%20%20%20%20Object%2Ekeys%28this%2Escene%2Eobjects%29%2EforEach%28%0A%20%20%20%20%20%20%20%20function%28key%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20if%20%28self%2EgetObj%28parseInt%28key%2C%2010%29%29%2Etype%20%3D%3D%3D%20type%29%0A%20%20%20%20%20%20%20%20%20%20%20%20bound%20%3D%20bound%20%2B%201%3B%0A%20%20%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%20%20return%20bound%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Initialize%20a%20subscene%0A%20%20%20%20%20%2A%20%40param%20%7B%20number%20%7D%20id%20%2D%20id%20of%20subscene%2E%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EinitSubscene%20%3D%20function%28id%29%20%7B%0A%20%20%20%20%20%20var%20sub%20%3D%20this%2EgetObj%28id%29%2C%0A%20%20%20%20%20%20%20%20%20%20i%2C%20obj%3B%0A%0A%20%20%20%20%20%20if%20%28sub%2Etype%20%21%3D%3D%20%22subscene%22%29%0A%20%20%20%20%20%20%20%20return%3B%0A%0A%20%20%20%20%20%20sub%2Epar3d%2EuserMatrix%20%3D%20this%2EtoCanvasMatrix4%28sub%2Epar3d%2EuserMatrix%29%3B%0A%20%20%20%20%20%20sub%2Epar3d%2Elisteners%20%3D%20%5B%5D%2Econcat%28sub%2Epar3d%2Elisteners%29%3B%0A%20%20%20%20%20%20sub%2EbackgroundId%20%3D%20undefined%3B%0A%20%20%20%20%20%20sub%2Esubscenes%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20sub%2Eclipplanes%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20sub%2Etransparent%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20sub%2Eopaque%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20sub%2Elights%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20for%20%28i%3D0%3B%20i%20%3C%20sub%2Eobjects%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20obj%20%3D%20this%2EgetObj%28sub%2Eobjects%5Bi%5D%29%3B%0A%20%20%20%20%20%20%20%20if%20%28typeof%20obj%20%3D%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20sub%2Eobjects%2Esplice%28i%2C%201%29%3B%0A%20%20%20%20%20%20%20%20%20%20i%2D%2D%3B%0A%20%20%20%20%20%20%20%20%7D%20else%20if%20%28obj%2Etype%20%3D%3D%3D%20%22background%22%29%0A%20%20%20%20%20%20%20%20%20%20sub%2EbackgroundId%20%3D%20obj%2Eid%3B%0A%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20sub%5Bthis%2EwhichList%28obj%2Eid%29%5D%2Epush%28obj%2Eid%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Copy%20object%0A%20%20%20%20%20%2A%20%40param%20%7B%20number%20%7D%20id%20%2D%20id%20of%20object%20to%20copy%0A%20%20%20%20%20%2A%20%40param%20%7B%20string%20%7D%20reuse%20%2D%20Document%20id%20of%20scene%20to%20reuse%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EcopyObj%20%3D%20function%28id%2C%20reuse%29%20%7B%0A%20%20%20%20%20%20var%20obj%20%3D%20this%2EgetObj%28id%29%2C%0A%20%20%20%20%20%20%20%20%20%20prev%20%3D%20document%2EgetElementById%28reuse%29%3B%0A%20%20%20%20%20%20if%20%28prev%20%21%3D%3D%20null%29%20%7B%0A%20%20%20%20%20%20%20%20prev%20%3D%20prev%2Erglinstance%3B%0A%20%20%20%20%20%20%20%20var%0A%20%20%20%20%20%20%20%20%20%20prevobj%20%3D%20prev%2EgetObj%28id%29%2C%0A%20%20%20%20%20%20%20%20%20%20fields%20%3D%20%5B%22flags%22%2C%20%22type%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22colors%22%2C%20%22vertices%22%2C%20%22centers%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22normals%22%2C%20%22offsets%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22texts%22%2C%20%22cex%22%2C%20%22family%22%2C%20%22font%22%2C%20%22adj%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22material%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22radii%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22texcoords%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22userMatrix%22%2C%20%22ids%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22dim%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22par3d%22%2C%20%22userMatrix%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22viewpoint%22%2C%20%22finite%22%5D%2C%0A%20%20%20%20%20%20%20%20%20%20i%3B%0A%20%20%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20fields%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20prevobj%5Bfields%5Bi%5D%5D%20%21%3D%3D%20%22undefined%22%29%0A%20%20%20%20%20%20%20%20%20%20%20%20obj%5Bfields%5Bi%5D%5D%20%3D%20prevobj%5Bfields%5Bi%5D%5D%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%20else%0A%20%20%20%20%20%20%20%20console%2Ewarn%28%22copyObj%20failed%22%29%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Update%20the%20triangles%20used%20to%20display%20a%20plane%0A%20%20%20%20%20%2A%20%40param%20%7B%20number%20%7D%20id%20%2D%20id%20of%20the%20plane%0A%20%20%20%20%20%2A%20%40param%20%7B%20Object%20%7D%20bbox%20%2D%20bounding%20box%20in%20which%20to%20display%20the%20plane%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EplaneUpdateTriangles%20%3D%20function%28id%2C%20bbox%29%20%7B%0A%20%20%20%20%20%20var%20perms%20%3D%20%5B%5B0%2C0%2C1%5D%2C%20%5B1%2C2%2C2%5D%2C%20%5B2%2C1%2C0%5D%5D%2C%0A%20%20%20%20%20%20%20%20%20%20x%2C%20xrow%2C%20elem%2C%20A%2C%20d%2C%20nhits%2C%20i%2C%20j%2C%20k%2C%20u%2C%20v%2C%20w%2C%20intersect%2C%20which%2C%20v0%2C%20v2%2C%20vx%2C%20reverse%2C%0A%20%20%20%20%20%20%20%20%20%20face1%20%3D%20%5B%5D%2C%20face2%20%3D%20%5B%5D%2C%20normals%20%3D%20%5B%5D%2C%0A%20%20%20%20%20%20%20%20%20%20obj%20%3D%20this%2EgetObj%28id%29%2C%0A%20%20%20%20%20%20%20%20%20%20nPlanes%20%3D%20obj%2Enormals%2Elength%3B%0A%20%20%20%20%20%20obj%2Ebbox%20%3D%20bbox%3B%0A%20%20%20%20%20%20obj%2Evertices%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20obj%2Einitialized%20%3D%20false%3B%0A%20%20%20%20%20%20for%20%28elem%20%3D%200%3B%20elem%20%3C%20nPlanes%3B%20elem%2B%2B%29%20%7B%0A%2F%2F%20%20%20%20Vertex%20Av%20%3D%20normal%2EgetRecycled%28elem%29%3B%0A%20%20%20%20%20%20%20%20x%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20%20%20A%20%3D%20obj%2Enormals%5Belem%5D%3B%0A%20%20%20%20%20%20%20%20d%20%3D%20obj%2Eoffsets%5Belem%5D%5B0%5D%3B%0A%20%20%20%20%20%20%20%20nhits%20%3D%200%3B%0A%20%20%20%20%20%20%20%20for%20%28i%3D0%3B%20i%3C3%3B%20i%2B%2B%29%0A%20%20%20%20%20%20%20%20%20%20for%20%28j%3D0%3B%20j%3C2%3B%20j%2B%2B%29%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20%28k%3D0%3B%20k%3C2%3B%20k%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20u%20%3D%20perms%5B0%5D%5Bi%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20v%20%3D%20perms%5B1%5D%5Bi%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20w%20%3D%20perms%5B2%5D%5Bi%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28A%5Bw%5D%20%21%3D%3D%200%2E0%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20intersect%20%3D%20%2D%28d%20%2B%20A%5Bu%5D%2Abbox%5Bj%2B2%2Au%5D%20%2B%20A%5Bv%5D%2Abbox%5Bk%2B2%2Av%5D%29%2FA%5Bw%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28bbox%5B2%2Aw%5D%20%3C%20intersect%20%26%26%20intersect%20%3C%20bbox%5B1%2B2%2Aw%5D%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20xrow%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20xrow%5Bu%5D%20%3D%20bbox%5Bj%2B2%2Au%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20xrow%5Bv%5D%20%3D%20bbox%5Bk%2B2%2Av%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20xrow%5Bw%5D%20%3D%20intersect%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20x%2Epush%28xrow%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20face1%5Bnhits%5D%20%3D%20j%20%2B%202%2Au%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20face2%5Bnhits%5D%20%3D%20k%20%2B%202%2Av%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20nhits%2B%2B%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28nhits%20%3E%203%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2A%20Re%2Dorder%20the%20intersections%20so%20the%20triangles%20work%20%2A%2F%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20%28i%3D0%3B%20i%3Cnhits%2D2%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20which%20%3D%200%3B%20%2F%2A%20initialize%20to%20suppress%20warning%20%2A%2F%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20%28j%3Di%2B1%3B%20j%3Cnhits%3B%20j%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28face1%5Bi%5D%20%3D%3D%20face1%5Bj%5D%20%7C%7C%20face1%5Bi%5D%20%3D%3D%20face2%5Bj%5D%20%7C%7C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20face2%5Bi%5D%20%3D%3D%20face1%5Bj%5D%20%7C%7C%20face2%5Bi%5D%20%3D%3D%20face2%5Bj%5D%20%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20which%20%3D%20j%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28which%20%3E%20i%2B1%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this%2Eswap%28x%2C%20i%2B1%2C%20which%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this%2Eswap%28face1%2C%20i%2B1%2C%20which%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this%2Eswap%28face2%2C%20i%2B1%2C%20which%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28nhits%20%3E%3D%203%29%20%7B%0A%20%20%20%20%20%20%2F%2A%20Put%20in%20order%20so%20that%20the%20normal%20points%20out%20the%20FRONT%20of%20the%20faces%20%2A%2F%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20v0%20%3D%20%5Bx%5B0%5D%5B0%5D%20%2D%20x%5B1%5D%5B0%5D%20%2C%20x%5B0%5D%5B1%5D%20%2D%20x%5B1%5D%5B1%5D%2C%20x%5B0%5D%5B2%5D%20%2D%20x%5B1%5D%5B2%5D%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20v2%20%3D%20%5Bx%5B2%5D%5B0%5D%20%2D%20x%5B1%5D%5B0%5D%20%2C%20x%5B2%5D%5B1%5D%20%2D%20x%5B1%5D%5B1%5D%2C%20x%5B2%5D%5B2%5D%20%2D%20x%5B1%5D%5B2%5D%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2A%20cross%2Dproduct%20%2A%2F%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20vx%20%3D%20this%2Exprod%28v0%2C%20v2%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20reverse%20%3D%20this%2Edotprod%28vx%2C%20A%29%20%3E%200%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20%28i%3D0%3B%20i%3Cnhits%2D2%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20obj%2Evertices%2Epush%28x%5B0%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20normals%2Epush%28A%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20%28j%3D1%3B%20j%3C3%3B%20j%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20obj%2Evertices%2Epush%28x%5Bi%20%2B%20%28reverse%20%3F%203%2Dj%20%3A%20j%29%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20normals%2Epush%28A%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20obj%2Epnormals%20%3D%20normals%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Initialize%20object%20for%20display%0A%20%20%20%20%20%2A%20%40param%20%7B%20number%20%7D%20id%20%2D%20id%20of%20object%20to%20initialize%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EinitObj%20%3D%20function%28id%29%20%7B%0A%20%20%20%20%20%20var%20obj%20%3D%20this%2EgetObj%28id%29%2C%0A%20%20%20%20%20%20%20%20%20%20flags%20%3D%20obj%2Eflags%2C%0A%20%20%20%20%20%20%20%20%20%20type%20%3D%20obj%2Etype%2C%0A%20%20%20%20%20%20%20%20%20%20is%5Flit%20%3D%20flags%20%26%20this%2Ef%5Fis%5Flit%2C%0A%20%20%20%20%20%20%20%20%20%20is%5Flines%20%3D%20flags%20%26%20this%2Ef%5Fis%5Flines%2C%0A%20%20%20%20%20%20%20%20%20%20fat%5Flines%20%3D%20flags%20%26%20this%2Ef%5Ffat%5Flines%2C%0A%20%20%20%20%20%20%20%20%20%20has%5Ftexture%20%3D%20flags%20%26%20this%2Ef%5Fhas%5Ftexture%2C%0A%20%20%20%20%20%20%20%20%20%20fixed%5Fquads%20%3D%20flags%20%26%20this%2Ef%5Ffixed%5Fquads%2C%0A%20%20%20%20%20%20%20%20%20%20depth%5Fsort%20%3D%20flags%20%26%20this%2Ef%5Fdepth%5Fsort%2C%0A%20%20%20%20%20%20%20%20%20%20sprites%5F3d%20%3D%20flags%20%26%20this%2Ef%5Fsprites%5F3d%2C%0A%20%20%20%20%20%20%20%20%20%20sprite%5F3d%20%3D%20flags%20%26%20this%2Ef%5Fsprite%5F3d%2C%0A%20%20%20%20%20%20%20%20%20%20fixed%5Fsize%20%3D%20flags%20%26%20this%2Ef%5Ffixed%5Fsize%2C%0A%20%20%20%20%20%20%20%20%20%20is%5Ftwosided%20%3D%20%28flags%20%26%20this%2Ef%5Fis%5Ftwosided%29%20%3E%200%2C%0A%20%20%20%20%20%20%20%20%20%20gl%20%3D%20this%2Egl%20%7C%7C%20this%2EinitGL%28%29%2C%0A%20%20%20%20%20%20%20%20%20%20texinfo%2C%20drawtype%2C%20nclipplanes%2C%20f%2C%20nrows%2C%20oldrows%2C%0A%20%20%20%20%20%20%20%20%20%20i%2Cj%2Cv%2Cv1%2Cv2%2C%20mat%2C%20uri%2C%20matobj%2C%20pass%2C%20passes%2C%20pmode%2C%0A%20%20%20%20%20%20%20%20%20%20dim%2C%20nx%2C%20nz%2C%20attr%3B%0A%0A%20%20%20%20if%20%28typeof%20id%20%21%3D%3D%20%22number%22%29%20%7B%0A%20%20%20%20%20%20this%2EalertOnce%28%22initObj%20id%20is%20%22%2Btypeof%20id%29%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20obj%2Einitialized%20%3D%20true%3B%0A%0A%20%20%20%20if%20%28type%20%3D%3D%3D%20%22bboxdeco%22%20%7C%7C%20type%20%3D%3D%3D%20%22subscene%22%29%0A%20%20%20%20%20%20return%3B%0A%0A%20%20%20%20if%20%28type%20%3D%3D%3D%20%22light%22%29%20%7B%0A%20%20%20%20%20%20obj%2Eambient%20%3D%20new%20Float32Array%28obj%2Ecolors%5B0%5D%2Eslice%280%2C3%29%29%3B%0A%20%20%20%20%20%20obj%2Ediffuse%20%3D%20new%20Float32Array%28obj%2Ecolors%5B1%5D%2Eslice%280%2C3%29%29%3B%0A%20%20%20%20%20%20obj%2Especular%20%3D%20new%20Float32Array%28obj%2Ecolors%5B2%5D%2Eslice%280%2C3%29%29%3B%0A%20%20%20%20%20%20obj%2ElightDir%20%3D%20new%20Float32Array%28obj%2Evertices%5B0%5D%29%3B%0A%20%20%20%20%20%20return%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20%28type%20%3D%3D%3D%20%22clipplanes%22%29%20%7B%0A%20%20%20%20%20%20obj%2EvClipplane%20%3D%20this%2Eflatten%28this%2Ecbind%28obj%2Enormals%2C%20obj%2Eoffsets%29%29%3B%0A%20%20%20%20%20%20return%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20%28type%20%3D%3D%20%22background%22%20%26%26%20typeof%20obj%2Eids%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20obj%2Equad%20%3D%20this%2Eflatten%28%5B%5D%2Econcat%28obj%2Eids%29%29%3B%0A%20%20%20%20%20%20return%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20%28typeof%20obj%2Evertices%20%3D%3D%3D%20%22undefined%22%29%0A%20%20%20%20%20%20obj%2Evertices%20%3D%20%5B%5D%3B%0A%0A%20%20%20%20v%20%3D%20obj%2Evertices%3B%0A%20%20%20%20obj%2EvertexCount%20%3D%20v%2Elength%3B%0A%20%20%20%20if%20%28%21obj%2EvertexCount%29%20return%3B%0A%0A%20%20%20%20if%20%28is%5Ftwosided%29%20%7B%0A%20%20%20%20%20%20if%20%28typeof%20obj%2EuserAttributes%20%3D%3D%3D%20%22undefined%22%29%0A%20%20%20%20%20%20%20%20obj%2EuserAttributes%20%3D%20%7B%7D%3B%0A%20%20%20%20%20%20v1%20%3D%20Array%28v%2Elength%29%3B%0A%20%20%20%20%20%20v2%20%3D%20Array%28v%2Elength%29%3B%0A%20%20%20%20%20%20if%20%28obj%2Etype%20%3D%3D%20%22triangles%22%20%7C%7C%20obj%2Etype%20%3D%3D%20%22quads%22%29%20%7B%0A%20%20%20%20%20%20%09if%20%28obj%2Etype%20%3D%3D%20%22triangles%22%29%0A%20%20%20%20%20%20%09%20%20nrow%20%3D%203%3B%0A%20%20%20%20%20%20%09else%0A%20%20%20%20%20%20%09%20%20nrow%20%3D%204%3B%0A%20%20%20%20%20%20%20%20for%20%28i%3D0%3B%20i%3CMath%2Efloor%28v%2Elength%2Fnrow%29%3B%20i%2B%2B%29%0A%20%20%20%20%20%20%20%20%20%20for%20%28j%3D0%3B%20j%3Cnrow%3B%20j%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20v1%5Bnrow%2Ai%20%2B%20j%5D%20%3D%20v%5Bnrow%2Ai%20%2B%20%28%28j%2B1%29%20%25%20nrow%29%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20v2%5Bnrow%2Ai%20%2B%20j%5D%20%3D%20v%5Bnrow%2Ai%20%2B%20%28%28j%2B2%29%20%25%20nrow%29%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%20else%20if%20%28obj%2Etype%20%3D%3D%20%22surface%22%29%20%7B%0A%20%20%20%20%20%20%20%20dim%20%3D%20obj%2Edim%5B0%5D%3B%0A%20%20%20%20%20%20%20%20nx%20%3D%20dim%5B0%5D%3B%0A%20%20%20%20%20%20%20%20nz%20%3D%20dim%5B1%5D%3B%0A%20%20%20%20%20%20%20%20for%20%28j%3D0%3B%20j%3Cnx%3B%20j%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20for%20%28i%3D0%3B%20i%3Cnz%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28i%2B1%20%3C%20nz%20%26%26%20j%2B1%20%3C%20nx%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20v2%5Bj%20%2B%20nx%2Ai%5D%20%3D%20v%5Bj%20%2B%20nx%2A%28i%2B1%29%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20v1%5Bj%20%2B%20nx%2Ai%5D%20%3D%20v%5Bj%2B1%20%2B%20nx%2A%28i%2B1%29%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20if%20%28i%2B1%20%3C%20nz%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20v2%5Bj%20%2B%20nx%2Ai%5D%20%3D%20v%5Bj%2D1%20%2B%20nx%2Ai%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20v1%5Bj%20%2B%20nx%2Ai%5D%20%3D%20v%5Bj%20%2B%20nx%2A%28i%2B1%29%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20v2%5Bj%20%2B%20nx%2Ai%5D%20%3D%20v%5Bj%20%2B%20nx%2A%28i%2D1%29%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20v1%5Bj%20%2B%20nx%2Ai%5D%20%3D%20v%5Bj%2D1%20%2B%20nx%2A%28i%2D1%29%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20obj%2EuserAttributes%2EaPos1%20%3D%20v1%3B%0A%20%20%20%20%20%20obj%2EuserAttributes%2EaPos2%20%3D%20v2%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20%28%21sprites%5F3d%29%20%7B%0A%20%20%20%20%20%20if%20%28gl%2EisContextLost%28%29%29%20return%3B%0A%20%20%20%20%20%20obj%2Eprog%20%3D%20gl%2EcreateProgram%28%29%3B%0A%20%20%20%20%20%20gl%2EattachShader%28obj%2Eprog%2C%20this%2EgetShader%28%20gl%2EVERTEX%5FSHADER%2C%0A%20%20%20%20%20%20%20%20this%2EgetVertexShader%28id%29%20%29%29%3B%0A%20%20%20%20%20%20gl%2EattachShader%28obj%2Eprog%2C%20this%2EgetShader%28%20gl%2EFRAGMENT%5FSHADER%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this%2EgetFragmentShader%28id%29%20%29%29%3B%0A%20%20%20%20%20%20%2F%2F%20%20Force%20aPos%20to%20location%200%2C%20aCol%20to%20location%201%0A%20%20%20%20%20%20gl%2EbindAttribLocation%28obj%2Eprog%2C%200%2C%20%22aPos%22%29%3B%0A%20%20%20%20%20%20gl%2EbindAttribLocation%28obj%2Eprog%2C%201%2C%20%22aCol%22%29%3B%0A%20%20%20%20%20%20gl%2ElinkProgram%28obj%2Eprog%29%3B%0A%20%20%20%20%20%20var%20linked%20%3D%20gl%2EgetProgramParameter%28obj%2Eprog%2C%20gl%2ELINK%5FSTATUS%29%3B%0A%20%20%20%20%20%20if%20%28%21linked%29%20%7B%0A%0A%20%20%20%20%20%20%20%20%2F%2F%20An%20error%20occurred%20while%20linking%0A%20%20%20%20%20%20%20%20var%20lastError%20%3D%20gl%2EgetProgramInfoLog%28obj%2Eprog%29%3B%0A%20%20%20%20%20%20%20%20console%2Ewarn%28%22Error%20in%20program%20linking%3A%22%20%2B%20lastError%29%3B%0A%0A%20%20%20%20%20%20%20%20gl%2EdeleteProgram%28obj%2Eprog%29%3B%0A%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20%28type%20%3D%3D%3D%20%22text%22%29%20%7B%0A%20%20%20%20%20%20texinfo%20%3D%20this%2EdrawTextToCanvas%28obj%2Etexts%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this%2Eflatten%28obj%2Ecex%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this%2Eflatten%28obj%2Efamily%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this%2Eflatten%28obj%2Efamily%29%29%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20%28fixed%5Fquads%20%26%26%20%21sprites%5F3d%29%20%7B%0A%20%20%20%20%20%20obj%2EofsLoc%20%3D%20gl%2EgetAttribLocation%28obj%2Eprog%2C%20%22aOfs%22%29%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20%28sprite%5F3d%29%20%7B%0A%20%20%20%20%20%20obj%2EorigLoc%20%3D%20gl%2EgetUniformLocation%28obj%2Eprog%2C%20%22uOrig%22%29%3B%0A%20%20%20%20%20%20obj%2EsizeLoc%20%3D%20gl%2EgetUniformLocation%28obj%2Eprog%2C%20%22uSize%22%29%3B%0A%20%20%20%20%20%20obj%2EusermatLoc%20%3D%20gl%2EgetUniformLocation%28obj%2Eprog%2C%20%22usermat%22%29%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20%28has%5Ftexture%20%7C%7C%20type%20%3D%3D%20%22text%22%29%20%7B%0A%20%20%20%20%20%20obj%2Etexture%20%3D%20gl%2EcreateTexture%28%29%3B%0A%20%20%20%20%20%20obj%2EtexLoc%20%3D%20gl%2EgetAttribLocation%28obj%2Eprog%2C%20%22aTexcoord%22%29%3B%0A%20%20%20%20%20%20obj%2Esampler%20%3D%20gl%2EgetUniformLocation%28obj%2Eprog%2C%20%22uSampler%22%29%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20%28has%5Ftexture%29%20%7B%0A%20%20%20%20%20%20mat%20%3D%20obj%2Ematerial%3B%0A%20%20%20%20%20%20if%20%28typeof%20mat%2Euri%20%21%3D%3D%20%22undefined%22%29%0A%20%20%20%20%20%20%20%20uri%20%3D%20mat%2Euri%3B%0A%20%20%20%20%20%20else%20if%20%28typeof%20mat%2EuriElementId%20%3D%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%20%20matobj%20%3D%20this%2EgetObj%28mat%2EuriId%29%3B%0A%20%20%20%20%20%20%20%20if%20%28typeof%20matobj%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20uri%20%3D%20matobj%2Ematerial%2Euri%3B%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20uri%20%3D%20%22%22%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%20else%0A%20%20%20%20%20%20%20%20uri%20%3D%20document%2EgetElementById%28mat%2EuriElementId%29%2Erglinstance%2EgetObj%28mat%2EuriId%29%2Ematerial%2Euri%3B%0A%0A%20%20%20%20%20%20this%2EloadImageToTexture%28uri%2C%20obj%2Etexture%29%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20%28type%20%3D%3D%3D%20%22text%22%29%20%7B%0A%20%20%20%20%20%20this%2EhandleLoadedTexture%28obj%2Etexture%2C%20this%2EtextureCanvas%29%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20var%20stride%20%3D%203%2C%20nc%2C%20cofs%2C%20nofs%2C%20radofs%2C%20oofs%2C%20tofs%2C%20vnew%2C%20fnew%2C%0A%20%20%20%20%20%20%20%20nextofs%20%3D%20%2D1%2C%20pointofs%20%3D%20%2D1%2C%20alias%3B%0A%0A%20%20%20%20obj%2Ealias%20%3D%20undefined%3B%0A%20%20%20%20%0A%20%20%20%20nc%20%3D%20obj%2EcolorCount%20%3D%20obj%2Ecolors%2Elength%3B%0A%20%20%20%20if%20%28nc%20%3E%201%29%20%7B%0A%20%20%20%20%20%20cofs%20%3D%20stride%3B%0A%20%20%20%20%20%20stride%20%3D%20stride%20%2B%204%3B%0A%20%20%20%20%20%20v%20%3D%20this%2Ecbind%28v%2C%20obj%2Ecolors%29%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20cofs%20%3D%20%2D1%3B%0A%20%20%20%20%20%20obj%2Eonecolor%20%3D%20this%2Eflatten%28obj%2Ecolors%29%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20%28typeof%20obj%2Enormals%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20nofs%20%3D%20stride%3B%0A%20%20%20%20%20%20stride%20%3D%20stride%20%2B%203%3B%0A%20%20%20%20%20%20v%20%3D%20this%2Ecbind%28v%2C%20typeof%20obj%2Epnormals%20%21%3D%3D%20%22undefined%22%20%3F%20obj%2Epnormals%20%3A%20obj%2Enormals%29%3B%0A%20%20%20%20%7D%20else%0A%20%20%20%20%20%20nofs%20%3D%20%2D1%3B%0A%0A%20%20%20%20if%20%28typeof%20obj%2Eradii%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20radofs%20%3D%20stride%3B%0A%20%20%20%20%20%20stride%20%3D%20stride%20%2B%201%3B%0A%20%20%20%20%20%20%2F%2F%20FIXME%3A%20%20always%20concat%20the%20radii%3F%0A%20%20%20%20%20%20if%20%28obj%2Eradii%2Elength%20%3D%3D%3D%20v%2Elength%29%20%7B%0A%20%20%20%20%20%20%20%20v%20%3D%20this%2Ecbind%28v%2C%20obj%2Eradii%29%3B%0A%20%20%20%20%20%20%7D%20else%20if%20%28obj%2Eradii%2Elength%20%3D%3D%3D%201%29%20%7B%0A%20%20%20%20%20%20%20%20v%20%3D%20v%2Emap%28function%28row%2C%20i%2C%20arr%29%20%7B%20return%20row%2Econcat%28obj%2Eradii%5B0%5D%29%3B%7D%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%20else%0A%20%20%20%20%20%20radofs%20%3D%20%2D1%3B%0A%20%20%20%20%20%20%0A%20%20%20%20%2F%2F%20Add%20default%20indices%0A%20%20%20%20f%20%3D%20Array%28v%2Elength%29%3B%0A%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20v%2Elength%3B%20i%2B%2B%29%0A%20%20%20%20%20%20f%5Bi%5D%20%3D%20i%3B%0A%20%20%20%20obj%2Ef%20%3D%20%5Bf%2Cf%5D%3B%0A%0A%20%20%20%20if%20%28type%20%3D%3D%20%22sprites%22%20%26%26%20%21sprites%5F3d%29%20%7B%0A%20%20%20%20%20%20tofs%20%3D%20stride%3B%0A%20%20%20%20%20%20stride%20%2B%3D%202%3B%0A%20%20%20%20%20%20oofs%20%3D%20stride%3B%0A%20%20%20%20%20%20stride%20%2B%3D%202%3B%0A%20%20%20%20%20%20vnew%20%3D%20new%20Array%284%2Av%2Elength%29%3B%0A%20%20%20%20%20%20fnew%20%3D%20new%20Array%284%2Av%2Elength%29%3B%0A%20%20%20%20%20%20alias%20%3D%20new%20Array%28v%2Elength%29%3B%0A%20%20%20%20%20%20var%20rescale%20%3D%20fixed%5Fsize%20%3F%2072%20%3A%201%2C%0A%20%20%20%20%20%20%20%20%20%20size%20%3D%20obj%2Eradii%2C%20s%20%3D%20rescale%2Asize%5B0%5D%2F2%3B%0A%20%20%20%20%20%20last%20%3D%20v%2Elength%3B%0A%20%20%20%20%20%20f%20%3D%20obj%2Ef%5B0%5D%3B%0A%20%20%20%20%20%20for%20%28i%3D0%3B%20i%20%3C%20v%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20if%20%28size%2Elength%20%3E%201%29%0A%20%20%20%20%20%20%20%20%20%20s%20%3D%20rescale%2Asize%5Bi%5D%2F2%3B%0A%20%20%20%20%20%20%20%20vnew%5Bi%5D%20%20%3D%20v%5Bi%5D%2Econcat%28%5B0%2C0%2C%2Ds%2C%2Ds%5D%29%3B%0A%20%20%20%20%20%20%20%20fnew%5B4%2Ai%5D%20%3D%20f%5Bi%5D%3B%0A%20%20%20%20%20%20%20%20vnew%5Blast%5D%3D%20v%5Bi%5D%2Econcat%28%5B1%2C0%2C%20s%2C%2Ds%5D%29%3B%0A%20%20%20%20%20%20%20%20fnew%5B4%2Ai%2B1%5D%20%3D%20last%2B%2B%3B%0A%20%20%20%20%20%20%20%20vnew%5Blast%5D%3D%20v%5Bi%5D%2Econcat%28%5B1%2C1%2C%20s%2C%20s%5D%29%3B%0A%20%20%20%20%20%20%20%20fnew%5B4%2Ai%2B2%5D%20%3D%20last%2B%2B%3B%0A%20%20%20%20%20%20%20%20vnew%5Blast%5D%3D%20v%5Bi%5D%2Econcat%28%5B0%2C1%2C%2Ds%2C%20s%5D%29%3B%0A%20%20%20%20%20%20%20%20fnew%5B4%2Ai%2B3%5D%20%3D%20last%2B%2B%3B%0A%20%20%20%20%20%20%20%20alias%5Bi%5D%20%3D%20%5Blast%2D3%2C%20last%2D2%2C%20last%2D1%5D%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20v%20%3D%20vnew%3B%0A%20%20%20%20%20%20obj%2EvertexCount%20%3D%20v%2Elength%3B%0A%20%20%20%20%20%20obj%2Ef%20%3D%20%5Bfnew%2C%20fnew%5D%3B%0A%20%20%20%20%7D%20else%20if%20%28type%20%3D%3D%3D%20%22text%22%29%20%7B%0A%20%20%20%20%20%20tofs%20%3D%20stride%3B%0A%20%20%20%20%20%20stride%20%2B%3D%202%3B%0A%20%20%20%20%20%20oofs%20%3D%20stride%3B%0A%20%20%20%20%20%20stride%20%2B%3D%202%3B%0A%20%20%20%20%20%20vnew%20%3D%20new%20Array%284%2Av%2Elength%29%3B%0A%20%20%20%20%20%20f%20%3D%20obj%2Ef%5B0%5D%3B%0A%20%20%20%20%20%20fnew%20%3D%20new%20Array%284%2Af%2Elength%29%3B%0A%20%20%20%20%20%20alias%20%3D%20new%20Array%28v%2Elength%29%3B%0A%20%20%20%20%20%20last%20%3D%20v%2Elength%3B%0A%20%20%20%20%20%20for%20%28i%3D0%3B%20i%20%3C%20v%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20vnew%5Bi%5D%20%20%3D%20v%5Bi%5D%2Econcat%28%5B0%2C%2D0%2E5%5D%29%2Econcat%28obj%2Eadj%5B0%5D%29%3B%0A%20%20%20%20%20%20%20%20fnew%5B4%2Ai%5D%20%3D%20f%5Bi%5D%3B%0A%20%20%20%20%20%20%20%20vnew%5Blast%5D%20%3D%20v%5Bi%5D%2Econcat%28%5B1%2C%2D0%2E5%5D%29%2Econcat%28obj%2Eadj%5B0%5D%29%3B%0A%20%20%20%20%20%20%20%20fnew%5B4%2Ai%2B1%5D%20%3D%20last%2B%2B%3B%0A%20%20%20%20%20%20%20%20vnew%5Blast%5D%20%3D%20v%5Bi%5D%2Econcat%28%5B1%2C%201%2E5%5D%29%2Econcat%28obj%2Eadj%5B0%5D%29%3B%0A%20%20%20%20%20%20%20%20fnew%5B4%2Ai%2B2%5D%20%3D%20last%2B%2B%3B%0A%20%20%20%20%20%20%20%20vnew%5Blast%5D%20%3D%20v%5Bi%5D%2Econcat%28%5B0%2C%201%2E5%5D%29%2Econcat%28obj%2Eadj%5B0%5D%29%3B%0A%20%20%20%20%20%20%20%20fnew%5B4%2Ai%2B3%5D%20%3D%20last%2B%2B%3B%0A%20%20%20%20%20%20%20%20alias%5Bi%5D%20%3D%20%5Blast%2D3%2C%20last%2D2%2C%20last%2D1%5D%3B%0A%20%20%20%20%20%20%20%20for%20%28j%3D0%3B%20j%20%3C%204%3B%20j%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20v1%20%3D%20vnew%5Bfnew%5B4%2Ai%2Bj%5D%5D%3B%0A%20%20%20%20%20%20%20%20%20%20v1%5Btofs%2B2%5D%20%3D%202%2A%28v1%5Btofs%5D%2Dv1%5Btofs%2B2%5D%29%2Atexinfo%2Ewidths%5Bi%5D%3B%0A%20%20%20%20%20%20%20%20%20%20v1%5Btofs%2B3%5D%20%3D%202%2A%28v1%5Btofs%2B1%5D%2Dv1%5Btofs%2B3%5D%29%2Atexinfo%2EtextHeights%5Bi%5D%3B%0A%20%20%20%20%20%20%20%20%20%20v1%5Btofs%5D%20%2A%3D%20texinfo%2Ewidths%5Bi%5D%2Ftexinfo%2EcanvasX%3B%0A%20%20%20%20%20%20%20%20%20%20v1%5Btofs%2B1%5D%20%3D%201%2E0%2D%28texinfo%2Eoffsets%5Bi%5D%20%2D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20v1%5Btofs%2B1%5D%2Atexinfo%2EtextHeights%5Bi%5D%29%2Ftexinfo%2EcanvasY%3B%0A%20%20%20%20%20%20%20%20%20%20vnew%5Bfnew%5B4%2Ai%2Bj%5D%5D%20%3D%20v1%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20v%20%3D%20vnew%3B%0A%20%20%20%20%20%20obj%2EvertexCount%20%3D%20v%2Elength%3B%0A%20%20%20%20%20%20obj%2Ef%20%3D%20%5Bfnew%2C%20fnew%5D%3B%0A%20%20%20%20%7D%20else%20if%20%28typeof%20obj%2Etexcoords%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20tofs%20%3D%20stride%3B%0A%20%20%20%20%20%20stride%20%2B%3D%202%3B%0A%20%20%20%20%20%20oofs%20%3D%20%2D1%3B%0A%20%20%20%20%20%20v%20%3D%20this%2Ecbind%28v%2C%20obj%2Etexcoords%29%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20tofs%20%3D%20%2D1%3B%0A%20%20%20%20%20%20oofs%20%3D%20%2D1%3B%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20obj%2Ealias%20%3D%20alias%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20if%20%28typeof%20obj%2EuserAttributes%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20obj%2EuserAttribOffsets%20%3D%20%7B%7D%3B%0A%20%20%20%20%20%20obj%2EuserAttribLocations%20%3D%20%7B%7D%3B%0A%20%20%20%20%20%20obj%2EuserAttribSizes%20%3D%20%7B%7D%3B%0A%20%20%20%20%20%20for%20%28attr%20in%20obj%2EuserAttributes%29%20%7B%0A%20%20%20%20%20%20%09obj%2EuserAttribLocations%5Battr%5D%20%3D%20gl%2EgetAttribLocation%28obj%2Eprog%2C%20attr%29%3B%0A%20%20%20%20%20%20%09if%20%28obj%2EuserAttribLocations%5Battr%5D%20%3E%3D%200%29%20%7B%20%2F%2F%20Attribute%20may%20not%20have%20been%20used%0A%20%20%20%20%20%20%09%20%20obj%2EuserAttribOffsets%5Battr%5D%20%3D%20stride%3B%0A%20%20%20%20%20%20%09%20%20v%20%3D%20this%2Ecbind%28v%2C%20obj%2EuserAttributes%5Battr%5D%29%3B%0A%20%20%20%20%20%20%09%20%20stride%20%3D%20v%5B0%5D%2Elength%3B%0A%20%20%20%20%20%20%09%20%20obj%2EuserAttribSizes%5Battr%5D%20%3D%20stride%20%2D%20obj%2EuserAttribOffsets%5Battr%5D%3B%0A%20%20%20%20%20%20%09%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20%28typeof%20obj%2EuserUniforms%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20obj%2EuserUniformLocations%20%3D%20%7B%7D%3B%0A%20%20%20%20%20%20for%20%28attr%20in%20obj%2EuserUniforms%29%0A%20%20%20%20%20%20%20%20obj%2EuserUniformLocations%5Battr%5D%20%3D%20gl%2EgetUniformLocation%28obj%2Eprog%2C%20attr%29%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20%28sprites%5F3d%29%20%7B%0A%20%20%20%20%20%20obj%2EuserMatrix%20%3D%20new%20CanvasMatrix4%28obj%2EuserMatrix%29%3B%0A%20%20%20%20%20%20obj%2Eobjects%20%3D%20this%2Eflatten%28%5B%5D%2Econcat%28obj%2Eids%29%29%3B%0A%20%20%20%20%20%20is%5Flit%20%3D%20false%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20%28is%5Flit%20%26%26%20%21fixed%5Fquads%29%20%7B%0A%20%20%20%20%20%20%20obj%2EnormLoc%20%3D%20gl%2EgetAttribLocation%28obj%2Eprog%2C%20%22aNorm%22%29%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20nclipplanes%20%3D%20this%2EcountClipplanes%28%29%3B%0A%20%20%20%20if%20%28nclipplanes%20%26%26%20%21sprites%5F3d%29%20%7B%0A%20%20%20%20%20%20obj%2EclipLoc%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20for%20%28i%3D0%3B%20i%20%3C%20nclipplanes%3B%20i%2B%2B%29%0A%20%20%20%20%20%20%20%20obj%2EclipLoc%5Bi%5D%20%3D%20gl%2EgetUniformLocation%28obj%2Eprog%2C%22vClipplane%22%20%2B%20i%29%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20%28is%5Flit%29%20%7B%0A%20%20%20%20%20%20obj%2EemissionLoc%20%3D%20gl%2EgetUniformLocation%28obj%2Eprog%2C%20%22emission%22%29%3B%0A%20%20%20%20%20%20obj%2Eemission%20%3D%20new%20Float32Array%28this%2EstringToRgb%28this%2EgetMaterial%28id%2C%20%22emission%22%29%29%29%3B%0A%20%20%20%20%20%20obj%2EshininessLoc%20%3D%20gl%2EgetUniformLocation%28obj%2Eprog%2C%20%22shininess%22%29%3B%0A%20%20%20%20%20%20obj%2Eshininess%20%3D%20this%2EgetMaterial%28id%2C%20%22shininess%22%29%3B%0A%20%20%20%20%20%20obj%2Enlights%20%3D%20this%2EcountLights%28%29%3B%0A%20%20%20%20%20%20obj%2EambientLoc%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20obj%2Eambient%20%3D%20new%20Float32Array%28this%2EstringToRgb%28this%2EgetMaterial%28id%2C%20%22ambient%22%29%29%29%3B%0A%20%20%20%20%20%20obj%2EspecularLoc%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20obj%2Especular%20%3D%20new%20Float32Array%28this%2EstringToRgb%28this%2EgetMaterial%28id%2C%20%22specular%22%29%29%29%3B%0A%20%20%20%20%20%20obj%2EdiffuseLoc%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20obj%2ElightDirLoc%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20obj%2EviewpointLoc%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20obj%2EfiniteLoc%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20for%20%28i%3D0%3B%20i%20%3C%20obj%2Enlights%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20obj%2EambientLoc%5Bi%5D%20%3D%20gl%2EgetUniformLocation%28obj%2Eprog%2C%20%22ambient%22%20%2B%20i%29%3B%0A%20%20%20%20%20%20%20%20obj%2EspecularLoc%5Bi%5D%20%3D%20gl%2EgetUniformLocation%28obj%2Eprog%2C%20%22specular%22%20%2B%20i%29%3B%0A%20%20%20%20%20%20%20%20obj%2EdiffuseLoc%5Bi%5D%20%3D%20gl%2EgetUniformLocation%28obj%2Eprog%2C%20%22diffuse%22%20%2B%20i%29%3B%0A%20%20%20%20%20%20%20%20obj%2ElightDirLoc%5Bi%5D%20%3D%20gl%2EgetUniformLocation%28obj%2Eprog%2C%20%22lightDir%22%20%2B%20i%29%3B%0A%20%20%20%20%20%20%20%20obj%2EviewpointLoc%5Bi%5D%20%3D%20gl%2EgetUniformLocation%28obj%2Eprog%2C%20%22viewpoint%22%20%2B%20i%29%3B%0A%20%20%20%20%20%20%20%20obj%2EfiniteLoc%5Bi%5D%20%3D%20gl%2EgetUniformLocation%28obj%2Eprog%2C%20%22finite%22%20%2B%20i%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20obj%2Epasses%20%3D%20is%5Ftwosided%20%2B%201%3B%0A%20%20%20%20obj%2Epmode%20%3D%20new%20Array%28obj%2Epasses%29%3B%0A%20%20%20%20for%20%28pass%20%3D%200%3B%20pass%20%3C%20obj%2Epasses%3B%20pass%2B%2B%29%20%7B%0A%20%20%20%20%20%20if%20%28type%20%3D%3D%3D%20%22triangles%22%20%7C%7C%20type%20%3D%3D%3D%20%22quads%22%20%7C%7C%20type%20%3D%3D%3D%20%22surface%22%29%0A%20%20%20%20%20%20%09pmode%20%3D%20this%2EgetMaterial%28id%2C%20%28pass%20%3D%3D%3D%200%29%20%3F%20%22front%22%20%3A%20%22back%22%29%3B%0A%20%20%20%20%20%20else%20pmode%20%3D%20%22filled%22%3B%0A%20%20%20%20%20%20obj%2Epmode%5Bpass%5D%20%3D%20pmode%3B%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%0A%20%20%20%20%20%20obj%2Ef%2Elength%20%3D%20obj%2Epasses%3B%0A%20%20%20%20%20%20for%20%28pass%20%3D%200%3B%20pass%20%3C%20obj%2Epasses%3B%20pass%2B%2B%29%20%7B%0A%20%20%20%20%20%20%09f%20%3D%20fnew%20%3D%20obj%2Ef%5Bpass%5D%3B%0A%20%20%20%20%20%20%20%20pmode%20%3D%20obj%2Epmode%5Bpass%5D%3B%0A%20%20%20%20%20%20%09if%20%28pmode%20%3D%3D%3D%20%22culled%22%29%0A%20%20%20%20%20%20%09%20%20f%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20%20%20else%20if%20%28pmode%20%3D%3D%3D%20%22points%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20stay%20with%20default%0A%20%20%20%20%20%20%20%20%7D%20else%20if%20%28%28type%20%3D%3D%3D%20%22quads%22%20%7C%7C%20type%20%3D%3D%3D%20%22text%22%20%7C%7C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20type%20%3D%3D%3D%20%22sprites%22%29%20%26%26%20%21sprites%5F3d%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20nrows%20%3D%20Math%2Efloor%28obj%2EvertexCount%2F4%29%3B%0A%20%20%20%20%20%20%20%20%20%20if%20%28pmode%20%3D%3D%3D%20%22filled%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20fnew%20%3D%20Array%286%2Anrows%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20%28i%3D0%3B%20i%20%3C%20nrows%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20fnew%5B6%2Ai%5D%20%3D%20f%5B4%2Ai%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20fnew%5B6%2Ai%2B1%5D%20%3D%20f%5B4%2Ai%20%2B%201%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20fnew%5B6%2Ai%2B2%5D%20%3D%20f%5B4%2Ai%20%2B%202%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20fnew%5B6%2Ai%2B3%5D%20%3D%20f%5B4%2Ai%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20fnew%5B6%2Ai%2B4%5D%20%3D%20f%5B4%2Ai%20%2B%202%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20fnew%5B6%2Ai%2B5%5D%20%3D%20f%5B4%2Ai%20%2B%203%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20fnew%20%3D%20Array%288%2Anrows%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20%28i%3D0%3B%20i%20%3C%20nrows%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20fnew%5B8%2Ai%5D%20%3D%20f%5B4%2Ai%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20fnew%5B8%2Ai%2B1%5D%20%3D%20f%5B4%2Ai%20%2B%201%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20fnew%5B8%2Ai%2B2%5D%20%3D%20f%5B4%2Ai%20%2B%201%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20fnew%5B8%2Ai%2B3%5D%20%3D%20f%5B4%2Ai%20%2B%202%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20fnew%5B8%2Ai%2B4%5D%20%3D%20f%5B4%2Ai%20%2B%202%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20fnew%5B8%2Ai%2B5%5D%20%3D%20f%5B4%2Ai%20%2B%203%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20fnew%5B8%2Ai%2B6%5D%20%3D%20f%5B4%2Ai%20%2B%203%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20fnew%5B8%2Ai%2B7%5D%20%3D%20f%5B4%2Ai%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%20else%20if%20%28type%20%3D%3D%3D%20%22triangles%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20nrows%20%3D%20Math%2Efloor%28obj%2EvertexCount%2F3%29%3B%0A%20%20%20%20%20%20%20%20%20%20if%20%28pmode%20%3D%3D%3D%20%22filled%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20fnew%20%3D%20Array%283%2Anrows%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20%28i%3D0%3B%20i%20%3C%20fnew%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20fnew%5Bi%5D%20%3D%20f%5Bi%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%20else%20if%20%28pmode%20%3D%3D%3D%20%22lines%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20fnew%20%3D%20Array%286%2Anrows%29%3B%0A%20%20%20%20%20%20%09%20%20%20%20for%20%28i%3D0%3B%20i%20%3C%20nrows%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%09%20%20%20%20%20%20fnew%5B6%2Ai%5D%20%3D%20f%5B3%2Ai%5D%3B%0A%20%20%20%20%20%20%09%20%20%20%20%20%20fnew%5B6%2Ai%20%2B%201%5D%20%3D%20f%5B3%2Ai%20%2B%201%5D%3B%0A%20%20%20%20%20%20%09%20%20%20%20%20%20fnew%5B6%2Ai%20%2B%202%5D%20%3D%20f%5B3%2Ai%20%2B%201%5D%3B%0A%20%20%20%20%20%20%09%20%20%20%20%20%20fnew%5B6%2Ai%20%2B%203%5D%20%3D%20f%5B3%2Ai%20%2B%202%5D%3B%0A%20%20%20%20%20%20%09%20%20%20%20%20%20fnew%5B6%2Ai%20%2B%204%5D%20%3D%20f%5B3%2Ai%20%2B%202%5D%3B%0A%20%20%20%20%20%20%09%20%20%20%20%20%20fnew%5B6%2Ai%20%2B%205%5D%20%3D%20f%5B3%2Ai%5D%3B%0A%20%20%20%20%20%20%09%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%20else%20if%20%28type%20%3D%3D%3D%20%22spheres%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20default%0A%20%20%20%20%20%20%20%20%7D%20else%20if%20%28type%20%3D%3D%3D%20%22surface%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20dim%20%3D%20obj%2Edim%5B0%5D%3B%0A%20%20%20%20%20%20%20%20%20%20nx%20%3D%20dim%5B0%5D%3B%0A%20%20%20%20%20%20%20%20%20%20nz%20%3D%20dim%5B1%5D%3B%0A%20%20%20%20%20%20%20%20%20%20if%20%28pmode%20%3D%3D%3D%20%22filled%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20fnew%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20%28j%3D0%3B%20j%3Cnx%2D1%3B%20j%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20%28i%3D0%3B%20i%3Cnz%2D1%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fnew%2Epush%28f%5Bj%20%2B%20nx%2Ai%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f%5Bj%20%2B%20nx%2A%28i%2B1%29%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f%5Bj%20%2B%201%20%2B%20nx%2A%28i%2B1%29%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f%5Bj%20%2B%20nx%2Ai%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f%5Bj%20%2B%201%20%2B%20nx%2A%28i%2B1%29%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f%5Bj%20%2B%201%20%2B%20nx%2Ai%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%20else%20if%20%28pmode%20%3D%3D%3D%20%22lines%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20fnew%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20%28j%3D0%3B%20j%3Cnx%3B%20j%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20%28i%3D0%3B%20i%3Cnz%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28i%2B1%20%3C%20nz%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fnew%2Epush%28f%5Bj%20%2B%20nx%2Ai%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f%5Bj%20%2B%20nx%2A%28i%2B1%29%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28j%2B1%20%3C%20nx%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fnew%2Epush%28f%5Bj%20%2B%20nx%2Ai%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f%5Bj%2B1%20%2B%20nx%2Ai%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20obj%2Ef%5Bpass%5D%20%3D%20fnew%3B%0A%20%20%20%20%20%20%20%20if%20%28depth%5Fsort%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20drawtype%20%3D%20%22DYNAMIC%5FDRAW%22%3B%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20drawtype%20%3D%20%22STATIC%5FDRAW%22%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20%0A%20%20%20%20if%20%28fat%5Flines%29%20%7B%0A%20%20%20%20%20%20alias%20%3D%20undefined%3B%0A%20%20%20%20%20%20obj%2EnextLoc%20%3D%20gl%2EgetAttribLocation%28obj%2Eprog%2C%20%22aNext%22%29%3B%0A%20%20%20%20%20%20obj%2EpointLoc%20%3D%20gl%2EgetAttribLocation%28obj%2Eprog%2C%20%22aPoint%22%29%3B%0A%20%20%20%20%20%20obj%2EaspectLoc%20%3D%20gl%2EgetUniformLocation%28obj%2Eprog%2C%20%22uAspect%22%29%3B%0A%20%20%20%20%20%20obj%2ElwdLoc%20%3D%20gl%2EgetUniformLocation%28obj%2Eprog%2C%20%22uLwd%22%29%3B%0A%20%20%20%20%20%20%2F%2F%20Expand%20vertices%20to%20turn%20each%20segment%20into%20a%20pair%20of%20triangles%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%09for%20%28pass%20%3D%200%3B%20pass%20%3C%20obj%2Epasses%3B%20pass%2B%2B%29%20%7B%0A%20%20%20%20%20%20%09%20%20f%20%3D%20obj%2Ef%5Bpass%5D%3B%09%0A%20%20%20%20%20%20%20%20%20%20oldrows%20%3D%20f%2Elength%3B%0A%20%20%20%20%20%20%09%20%20if%20%28obj%2Epmode%5Bpass%5D%20%3D%3D%3D%20%22lines%22%29%20%0A%20%20%20%20%20%20%09%20%20%20%20break%3B%0A%20%20%20%20%20%20%09%7D%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20if%20%28type%20%3D%3D%3D%20%22linestrip%22%29%20%0A%20%20%20%20%20%20%20%20nrows%20%3D%204%2A%28oldrows%20%2D%201%29%3B%20%0A%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20nrows%20%3D%202%2Aoldrows%3B%0A%20%20%20%20%20%20vnew%20%3D%20new%20Array%28nrows%29%3B%0A%20%20%20%20%20%20fnew%20%3D%20new%20Array%281%2E5%2Anrows%29%3B%0A%20%20%20%20%20%20var%20fnext%20%3D%20new%20Array%28nrows%29%2C%0A%20%20%20%20%20%20%20%20%20%20fpt%20%3D%20new%20Array%28nrows%29%2C%20%0A%20%20%20%20%20%20%20%20%20%20pt%2C%20start%2C%20gap%20%3D%20type%20%3D%3D%3D%20%22linestrip%22%20%3F%203%20%3A%201%3B%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20%2F%2F%20We%27re%20going%20to%20turn%20each%20pair%20of%20vertices%20into%204%20new%20ones%2C%20with%20the%20%22next%22%20and%20%22pt%22%20attributes%0A%20%20%20%20%20%20%2F%2F%20added%2E%0A%20%20%20%20%20%20%2F%2F%20We%20do%20this%20by%20copying%20the%20originals%20in%20the%20first%20pass%2C%20adding%20the%20new%20attributes%2C%20then%20in%20a%20%0A%20%20%20%20%20%20%2F%2F%20second%20pass%20add%20new%20vertices%20at%20the%20end%2E%0A%0A%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20v%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20vnew%5Bi%5D%20%3D%20v%5Bi%5D%2Econcat%28%5B0%2C0%2C0%2C0%2C0%5D%29%3B%20%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20nextofs%20%3D%20stride%3B%0A%20%20%20%20%20%20pointofs%20%3D%20stride%20%2B%203%3B%0A%20%20%20%20%20%20stride%20%3D%20stride%20%2B%205%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%2F%2F%20Now%20add%20the%20extras%0A%20%20%20%20%20%20last%20%3D%20v%2Elength%20%2D%201%3B%0A%20%20%20%20%20%20ind%20%3D%200%3B%0A%20%20%20%20%20%20alias%20%3D%20new%20Array%28f%2Elength%29%3B%0A%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20f%2Elength%3B%20i%2B%2B%29%0A%20%20%20%20%20%20%20%20alias%5Bi%5D%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20f%2Elength%20%2D%201%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%09if%20%28type%20%21%3D%3D%20%22linestrip%22%20%26%26%20i%20%25%202%20%3D%3D%201%29%0A%20%20%20%20%20%20%09%20%20continue%3B%0A%20%20%20%20%20%20%09k%20%3D%20%2B%2Blast%3B%0A%20%20%20%20%20%20%09vnew%5Bk%5D%20%3D%20vnew%5Bf%5Bi%5D%5D%2Eslice%28%29%3B%0A%20%20%20%20%20%20%09for%20%28j%3D0%3B%20j%3C3%3B%20j%2B%2B%29%0A%20%20%20%20%20%20%09%20%20vnew%5Bk%5D%5Bnextofs%20%2B%20j%5D%20%3D%20vnew%5Bf%5Bi%2B1%5D%5D%5Bj%5D%3B%0A%20%20%20%20%20%20%09vnew%5Bk%5D%5Bpointofs%5D%20%3D%20%2D1%3B%0A%20%20%20%20%20%20%09vnew%5Bk%5D%5Bpointofs%2B1%5D%20%3D%20%2D1%3B%0A%20%20%20%20%20%20%09fnew%5Bind%5D%20%3D%20k%3B%0A%20%20%20%20%20%20%09last%2B%2B%3B%0A%20%20%20%20%20%20%09vnew%5Blast%5D%20%3D%20vnew%5Bk%5D%2Eslice%28%29%3B%0A%20%20%20%20%20%20%09vnew%5Blast%5D%5Bpointofs%5D%20%3D%201%3B%0A%20%20%20%20%20%20%09fnew%5Bind%2B1%5D%20%3D%20last%3B%0A%20%20%20%20%20%20%09alias%5Bf%5Bi%5D%5D%2Epush%28last%2D1%2C%20last%29%3B%0A%20%20%20%20%20%20%09last%2B%2B%3B%0A%20%20%20%20%20%20%09k%20%3D%20last%3B%0A%20%20%20%20%20%20%09vnew%5Bk%5D%20%3D%20vnew%5Bf%5Bi%2B1%5D%5D%2Eslice%28%29%3B%0A%20%20%20%20%20%20%09for%20%28j%3D0%3B%20j%3C3%3B%20j%2B%2B%29%0A%20%20%20%20%20%20%09%20%20vnew%5Bk%5D%5Bnextofs%20%2B%20j%5D%20%3D%20vnew%5Bf%5Bi%5D%5D%5Bj%5D%3B%0A%20%20%20%20%20%20%09vnew%5Bk%5D%5Bpointofs%5D%20%3D%20%2D1%3B%0A%20%20%20%20%20%20%09vnew%5Bk%5D%5Bpointofs%2B1%5D%20%3D%201%3B%0A%20%20%20%20%20%20%09fnew%5Bind%2B2%5D%20%3D%20k%3B%0A%20%20%20%20%20%20%09fnew%5Bind%2B3%5D%20%3D%20fnew%5Bind%2B1%5D%3B%0A%20%20%20%20%20%20%09last%2B%2B%3B%0A%20%20%20%20%20%20%09vnew%5Blast%5D%20%3D%20vnew%5Bk%5D%2Eslice%28%29%3B%0A%20%20%20%20%20%20%09vnew%5Blast%5D%5Bpointofs%5D%20%3D%201%3B%0A%20%20%20%20%20%20%09fnew%5Bind%2B4%5D%20%3D%20last%3B%0A%20%20%20%20%20%20%09fnew%5Bind%2B5%5D%20%3D%20fnew%5Bind%2B2%5D%3B%0A%20%20%20%20%20%20%09ind%20%2B%3D%206%3B%0A%20%20%20%20%20%20%09alias%5Bf%5Bi%2B1%5D%5D%2Epush%28last%2D1%2C%20last%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20vnew%2Elength%20%3D%20last%2B1%3B%0A%20%20%20%20%20%20v%20%3D%20vnew%3B%0A%20%20%20%20%20%20obj%2EvertexCount%20%3D%20v%2Elength%3B%0A%20%20%20%20%20%20if%20%28typeof%20alias%20%21%3D%3D%20%22undefined%22%20%26%26%20typeof%20obj%2Ealias%20%21%3D%3D%20%22undefined%22%29%20%7B%20%20%2F%2F%20Already%20have%20aliases%20from%20previous%20section%3F%0A%20%20%20%20%20%20%20%20var%20oldalias%20%3D%20obj%2Ealias%2C%20newalias%20%3D%20Array%28obj%2Ealias%2Elength%29%3B%0A%20%20%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20newalias%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20newalias%5Bi%5D%20%3D%20oldalias%5Bi%5D%2Eslice%28%29%3B%0A%20%20%20%20%20%20%20%20%20%20for%20%28j%20%3D%200%3B%20j%20%3C%20oldalias%5Bi%5D%2Elength%3B%20j%2B%2B%29%0A%20%20%20%20%20%20%20%20%20%20%20%20Array%2Eprototype%2Epush%2Eapply%28newalias%5Bi%5D%2C%20alias%5Boldalias%5Bj%5D%5D%29%3B%20%2F%2F%20pushes%20each%20element%20%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20obj%2Ealias%20%3D%20newalias%3B%0A%20%20%20%20%20%20%7D%20else%0A%20%20%20%20%20%20%20%20obj%2Ealias%20%3D%20alias%3B%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20for%20%28pass%20%3D%200%3B%20pass%20%3C%20obj%2Epasses%3B%20pass%2B%2B%29%0A%20%20%20%20%20%20%09if%20%28type%20%3D%3D%3D%20%22lines%22%20%7C%7C%20type%20%3D%3D%3D%20%22linestrip%22%20%7C%7C%20obj%2Epmode%5Bpass%5D%20%3D%3D%20%22lines%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20obj%2Ef%5Bpass%5D%20%3D%20fnew%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20if%20%28depth%5Fsort%29%20%0A%20%20%20%20%20%20%20%20drawtype%20%3D%20%22DYNAMIC%5FDRAW%22%3B%0A%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20drawtype%20%3D%20%22STATIC%5FDRAW%22%3B%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20%20%20for%20%28pass%20%3D%200%3B%20pass%20%3C%20obj%2Epasses%3B%20pass%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20if%20%28obj%2EvertexCount%20%3E%2065535%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20if%20%28this%2Eindex%5Fuint%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20obj%2Ef%5Bpass%5D%20%3D%20new%20Uint32Array%28obj%2Ef%5Bpass%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20obj%2Eindex%5Fuint%20%3D%20true%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2EalertOnce%28%22Object%20has%20%22%2Bobj%2EvertexCount%2B%22%20vertices%2C%20not%20supported%20in%20this%20browser%2E%22%29%3B%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20obj%2Ef%5Bpass%5D%20%3D%20new%20Uint16Array%28obj%2Ef%5Bpass%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20obj%2Eindex%5Fuint%20%3D%20false%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20if%20%28stride%20%21%3D%3D%20v%5B0%5D%2Elength%29%20%7B%0A%20%20%20%20%20%20this%2EalertOnce%28%22problem%20in%20stride%20calculation%22%29%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20obj%2EvOffsets%20%3D%20%7Bvofs%3A0%2C%20cofs%3Acofs%2C%20nofs%3Anofs%2C%20radofs%3Aradofs%2C%20oofs%3Aoofs%2C%20tofs%3Atofs%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20nextofs%3Anextofs%2C%20pointofs%3Apointofs%2C%20stride%3Astride%7D%3B%0A%0A%20%20%20%20obj%2Evalues%20%3D%20new%20Float32Array%28this%2Eflatten%28v%29%29%3B%0A%0A%20%20%20%20if%20%28type%20%21%3D%3D%20%22spheres%22%20%26%26%20%21sprites%5F3d%29%20%7B%0A%20%20%20%20%20%20obj%2Ebuf%20%3D%20gl%2EcreateBuffer%28%29%3B%0A%20%20%20%20%20%20gl%2EbindBuffer%28gl%2EARRAY%5FBUFFER%2C%20obj%2Ebuf%29%3B%0A%20%20%20%20%20%20gl%2EbufferData%28gl%2EARRAY%5FBUFFER%2C%20obj%2Evalues%2C%20gl%2ESTATIC%5FDRAW%29%3B%20%2F%2F%0A%20%20%20%20%20%20obj%2Eibuf%20%3D%20Array%28obj%2Epasses%29%3B%0A%20%20%20%20%20%20obj%2Eibuf%5B0%5D%20%3D%20gl%2EcreateBuffer%28%29%3B%0A%20%20%20%20%20%20gl%2EbindBuffer%28gl%2EELEMENT%5FARRAY%5FBUFFER%2C%20obj%2Eibuf%5B0%5D%29%3B%0A%20%20%20%20%20%20gl%2EbufferData%28gl%2EELEMENT%5FARRAY%5FBUFFER%2C%20obj%2Ef%5B0%5D%2C%20gl%5Bdrawtype%5D%29%3B%0A%20%20%20%20%20%20if%20%28is%5Ftwosided%29%20%7B%0A%20%20%20%20%20%20%09obj%2Eibuf%5B1%5D%20%3D%20gl%2EcreateBuffer%28%29%3B%0A%20%20%20%20%20%20%09gl%2EbindBuffer%28gl%2EELEMENT%5FARRAY%5FBUFFER%2C%20obj%2Eibuf%5B1%5D%29%3B%0A%20%20%20%20%20%20%09gl%2EbufferData%28gl%2EELEMENT%5FARRAY%5FBUFFER%2C%20obj%2Ef%5B1%5D%2C%20gl%5Bdrawtype%5D%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20%28%21sprites%5F3d%29%20%7B%0A%20%20%20%20%20%20obj%2EmvMatLoc%20%3D%20gl%2EgetUniformLocation%28obj%2Eprog%2C%20%22mvMatrix%22%29%3B%0A%20%20%20%20%20%20obj%2EprMatLoc%20%3D%20gl%2EgetUniformLocation%28obj%2Eprog%2C%20%22prMatrix%22%29%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20%28fixed%5Fsize%29%20%7B%0A%20%20%20%20%20%20obj%2EtextScaleLoc%20%3D%20gl%2EgetUniformLocation%28obj%2Eprog%2C%20%22textScale%22%29%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20%28is%5Flit%20%26%26%20%21sprites%5F3d%29%20%7B%0A%20%20%20%20%20%20obj%2EnormMatLoc%20%3D%20gl%2EgetUniformLocation%28obj%2Eprog%2C%20%22normMatrix%22%29%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20%28is%5Ftwosided%29%20%7B%0A%20%20%20%20%20%20obj%2EfrontLoc%20%3D%20gl%2EgetUniformLocation%28obj%2Eprog%2C%20%22front%22%29%3B%0A%20%20%20%20%7D%0A%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Set%20gl%20depth%20test%20based%20on%20object%27s%20material%0A%20%20%20%20%20%2A%20%40param%20%7B%20number%20%7D%20id%20%2D%20object%20to%20use%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EsetDepthTest%20%3D%20function%28id%29%20%7B%0A%20%20%20%20%20%20var%20gl%20%3D%20this%2Egl%20%7C%7C%20this%2EinitGL%28%29%2C%0A%20%20%20%20%20%20%20%20%20%20tests%20%3D%20%7Bnever%3A%20gl%2ENEVER%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20less%3A%20%20gl%2ELESS%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20equal%3A%20gl%2EEQUAL%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20lequal%3Agl%2ELEQUAL%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20greater%3A%20gl%2EGREATER%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20notequal%3A%20gl%2ENOTEQUAL%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20gequal%3A%20gl%2EGEQUAL%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20always%3A%20gl%2EALWAYS%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20test%20%3D%20tests%5Bthis%2EgetMaterial%28id%2C%20%22depth%5Ftest%22%29%5D%3B%0A%20%20%20%20%20%20gl%2EdepthFunc%28test%29%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20rglwidgetClass%2Eprototype%2Emode4type%20%3D%20%7Bpoints%20%3A%20%22POINTS%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20linestrip%20%3A%20%22LINE%5FSTRIP%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20abclines%20%3A%20%22LINES%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20lines%20%3A%20%22LINES%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20sprites%20%3A%20%22TRIANGLES%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20planes%20%3A%20%22TRIANGLES%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text%20%3A%20%22TRIANGLES%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20quads%20%3A%20%22TRIANGLES%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20surface%20%3A%20%22TRIANGLES%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20triangles%20%3A%20%22TRIANGLES%22%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Sort%20objects%20from%20back%20to%20front%0A%20%20%20%20%20%2A%20%40returns%20%7B%20number%5B%5D%20%7D%0A%20%20%20%20%20%2A%20%40param%20%7B%20Object%20%7D%20obj%20%2D%20object%20to%20sort%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EdepthSort%20%3D%20function%28obj%29%20%7B%0A%20%20%20%20%20%20var%20n%20%3D%20obj%2Ecenters%2Elength%2C%0A%20%20%20%20%20%20%20%20%20%20depths%20%3D%20new%20Float32Array%28n%29%2C%0A%20%20%20%20%20%20%20%20%20%20result%20%3D%20new%20Array%28n%29%2C%0A%20%20%20%20%20%20%20%20%20%20compare%20%3D%20function%28i%2Cj%29%20%7B%20return%20depths%5Bj%5D%20%2D%20depths%5Bi%5D%3B%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20z%2C%20w%3B%0A%20%20%20%20%20%20for%28i%3D0%3B%20i%3Cn%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20z%20%3D%20this%2EprmvMatrix%2Em13%2Aobj%2Ecenters%5Bi%5D%5B0%5D%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2EprmvMatrix%2Em23%2Aobj%2Ecenters%5Bi%5D%5B1%5D%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2EprmvMatrix%2Em33%2Aobj%2Ecenters%5Bi%5D%5B2%5D%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2EprmvMatrix%2Em43%3B%0A%20%20%20%20%20%20%20%20w%20%3D%20this%2EprmvMatrix%2Em14%2Aobj%2Ecenters%5Bi%5D%5B0%5D%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2EprmvMatrix%2Em24%2Aobj%2Ecenters%5Bi%5D%5B1%5D%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2EprmvMatrix%2Em34%2Aobj%2Ecenters%5Bi%5D%5B2%5D%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2EprmvMatrix%2Em44%3B%0A%20%20%20%20%20%20%20%20depths%5Bi%5D%20%3D%20z%2Fw%3B%0A%20%20%20%20%20%20%20%20result%5Bi%5D%20%3D%20i%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20result%2Esort%28compare%29%3B%0A%20%20%20%20%20%20return%20result%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Draw%20an%20object%20in%20a%20subscene%0A%20%20%20%20%20%2A%20%40param%20%7B%20number%20%7D%20id%20%2D%20object%20to%20draw%0A%20%20%20%20%20%2A%20%40param%20%7B%20number%20%7D%20subsceneid%20%2D%20id%20of%20subscene%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EdrawObj%20%3D%20function%28id%2C%20subsceneid%29%20%7B%0A%20%20%20%20%20%20var%20obj%20%3D%20this%2EgetObj%28id%29%2C%0A%20%20%20%20%20%20%20%20%20%20subscene%20%3D%20this%2EgetObj%28subsceneid%29%2C%0A%20%20%20%20%20%20%20%20%20%20flags%20%3D%20obj%2Eflags%2C%0A%20%20%20%20%20%20%20%20%20%20type%20%3D%20obj%2Etype%2C%0A%20%20%20%20%20%20%20%20%20%20is%5Flit%20%3D%20flags%20%26%20this%2Ef%5Fis%5Flit%2C%0A%20%20%20%20%20%20%20%20%20%20has%5Ftexture%20%3D%20flags%20%26%20this%2Ef%5Fhas%5Ftexture%2C%0A%20%20%20%20%20%20%20%20%20%20fixed%5Fquads%20%3D%20flags%20%26%20this%2Ef%5Ffixed%5Fquads%2C%0A%20%20%20%20%20%20%20%20%20%20depth%5Fsort%20%3D%20flags%20%26%20this%2Ef%5Fdepth%5Fsort%2C%0A%20%20%20%20%20%20%20%20%20%20sprites%5F3d%20%3D%20flags%20%26%20this%2Ef%5Fsprites%5F3d%2C%0A%20%20%20%20%20%20%20%20%20%20sprite%5F3d%20%3D%20flags%20%26%20this%2Ef%5Fsprite%5F3d%2C%0A%20%20%20%20%20%20%20%20%20%20is%5Flines%20%3D%20flags%20%26%20this%2Ef%5Fis%5Flines%2C%0A%20%20%20%20%20%20%20%20%20%20fat%5Flines%20%3D%20flags%20%26%20this%2Ef%5Ffat%5Flines%2C%0A%20%20%20%20%20%20%20%20%20%20is%5Fpoints%20%3D%20flags%20%26%20this%2Ef%5Fis%5Fpoints%2C%0A%20%20%20%20%20%20%20%20%20%20fixed%5Fsize%20%3D%20flags%20%26%20this%2Ef%5Ffixed%5Fsize%2C%0A%20%20%20%20%20%20%20%20%20%20is%5Ftwosided%20%3D%20%28flags%20%26%20this%2Ef%5Fis%5Ftwosided%29%20%3E%200%2C%0A%20%20%20%20%20%20%20%20%20%20gl%20%3D%20this%2Egl%20%7C%7C%20this%2EinitGL%28%29%2C%0A%20%20%20%20%20%20%20%20%20%20mat%2C%0A%20%20%20%20%20%20%20%20%20%20sphereMV%2C%20baseofs%2C%20ofs%2C%20sscale%2C%20i%2C%20count%2C%20light%2C%0A%20%20%20%20%20%20%20%20%20%20pass%2C%20mode%2C%20pmode%2C%20attr%3B%0A%0A%20%20%20%20%20%20if%20%28typeof%20id%20%21%3D%3D%20%22number%22%29%20%7B%0A%20%20%20%20%20%20%20%20this%2EalertOnce%28%22drawObj%20id%20is%20%22%2Btypeof%20id%29%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20if%20%28type%20%3D%3D%3D%20%22planes%22%29%20%7B%0A%20%20%20%20%20%20%20%20if%20%28obj%2Ebbox%20%21%3D%3D%20subscene%2Epar3d%2Ebbox%20%7C%7C%20%21obj%2Einitialized%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20this%2EplaneUpdateTriangles%28id%2C%20subscene%2Epar3d%2Ebbox%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20if%20%28%21obj%2Einitialized%29%0A%20%20%20%20%20%20%20%20this%2EinitObj%28id%29%3B%0A%0A%20%20%20%20%20%20if%20%28type%20%3D%3D%3D%20%22clipplanes%22%29%20%7B%0A%20%20%20%20%20%20%20%20count%20%3D%20obj%2Eoffsets%2Elength%3B%0A%20%20%20%20%20%20%20%20var%20IMVClip%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20%20%20for%20%28i%3D0%3B%20i%20%3C%20count%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20IMVClip%5Bi%5D%20%3D%20this%2EmultMV%28this%2EinvMatrix%2C%20obj%2EvClipplane%2Eslice%284%2Ai%2C%204%2A%28i%2B1%29%29%29%3B%0A%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20obj%2EIMVClip%20%3D%20IMVClip%3B%0A%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20if%20%28type%20%3D%3D%3D%20%22light%22%20%7C%7C%20type%20%3D%3D%3D%20%22bboxdeco%22%20%7C%7C%20%21obj%2EvertexCount%29%0A%20%20%20%20%20%20%20%20return%3B%0A%0A%20%20%20%20%20%20this%2EsetDepthTest%28id%29%3B%0A%0A%20%20%20%20%20%20if%20%28sprites%5F3d%29%20%7B%0A%20%20%20%20%20%20%20%20var%20norigs%20%3D%20obj%2Evertices%2Elength%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20savenorm%20%3D%20new%20CanvasMatrix4%28this%2EnormMatrix%29%3B%0A%20%20%20%20%20%20%20%20this%2Eorigs%20%3D%20obj%2Evertices%3B%0A%20%20%20%20%20%20%20%20this%2Eusermat%20%3D%20new%20Float32Array%28obj%2EuserMatrix%2EgetAsArray%28%29%29%3B%0A%20%20%20%20%20%20%20%20this%2Eradii%20%3D%20obj%2Eradii%3B%0A%20%20%20%20%20%20%20%20this%2EnormMatrix%20%3D%20subscene%2EspriteNormmat%3B%0A%20%20%20%20%20%20%20%20for%20%28this%2EiOrig%3D0%3B%20this%2EiOrig%20%3C%20norigs%3B%20this%2EiOrig%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20for%20%28i%3D0%3B%20i%20%3C%20obj%2Eobjects%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2EdrawObj%28obj%2Eobjects%5Bi%5D%2C%20subsceneid%29%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20this%2EnormMatrix%20%3D%20savenorm%3B%0A%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20gl%2EuseProgram%28obj%2Eprog%29%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20if%20%28sprite%5F3d%29%20%7B%0A%20%20%20%20%20%20%20%20gl%2Euniform3fv%28obj%2EorigLoc%2C%20new%20Float32Array%28this%2Eorigs%5Bthis%2EiOrig%5D%29%29%3B%0A%20%20%20%20%20%20%20%20if%20%28this%2Eradii%2Elength%20%3E%201%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20gl%2Euniform1f%28obj%2EsizeLoc%2C%20this%2Eradii%5Bthis%2EiOrig%5D%5B0%5D%29%3B%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20gl%2Euniform1f%28obj%2EsizeLoc%2C%20this%2Eradii%5B0%5D%5B0%5D%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20gl%2EuniformMatrix4fv%28obj%2EusermatLoc%2C%20false%2C%20this%2Eusermat%29%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20if%20%28type%20%3D%3D%3D%20%22spheres%22%29%20%7B%0A%20%20%20%20%20%20%20%20gl%2EbindBuffer%28gl%2EARRAY%5FBUFFER%2C%20this%2Esphere%2Ebuf%29%3B%0A%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20gl%2EbindBuffer%28gl%2EARRAY%5FBUFFER%2C%20obj%2Ebuf%29%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20gl%2EuniformMatrix4fv%28%20obj%2EprMatLoc%2C%20false%2C%20new%20Float32Array%28this%2EprMatrix%2EgetAsArray%28%29%29%20%29%3B%0A%20%20%20%20%20%20gl%2EuniformMatrix4fv%28%20obj%2EmvMatLoc%2C%20false%2C%20new%20Float32Array%28this%2EmvMatrix%2EgetAsArray%28%29%29%20%29%3B%0A%20%20%20%20%20%20var%20clipcheck%20%3D%200%2C%0A%20%20%20%20%20%20%20%20%20%20clipplaneids%20%3D%20subscene%2Eclipplanes%2C%0A%20%20%20%20%20%20%20%20%20%20clip%2C%20j%3B%0A%20%20%20%20%20%20for%20%28i%3D0%3B%20i%20%3C%20clipplaneids%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20clip%20%3D%20this%2EgetObj%28clipplaneids%5Bi%5D%29%3B%0A%20%20%20%20%20%20%20%20for%20%28j%3D0%3B%20j%20%3C%20clip%2Eoffsets%2Elength%3B%20j%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20gl%2Euniform4fv%28obj%2EclipLoc%5Bclipcheck%20%2B%20j%5D%2C%20clip%2EIMVClip%5Bj%5D%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20clipcheck%20%2B%3D%20clip%2Eoffsets%2Elength%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20if%20%28typeof%20obj%2EclipLoc%20%21%3D%3D%20%22undefined%22%29%0A%20%20%20%20%20%20%20%20for%20%28i%3Dclipcheck%3B%20i%20%3C%20obj%2EclipLoc%2Elength%3B%20i%2B%2B%29%0A%20%20%20%20%20%20%20%20%20%20gl%2Euniform4f%28obj%2EclipLoc%5Bi%5D%2C%200%2C0%2C0%2C0%29%3B%0A%0A%20%20%20%20%20%20if%20%28is%5Flit%29%20%7B%0A%20%20%20%20%20%20%20%20gl%2EuniformMatrix4fv%28%20obj%2EnormMatLoc%2C%20false%2C%20new%20Float32Array%28this%2EnormMatrix%2EgetAsArray%28%29%29%20%29%3B%0A%20%20%20%20%20%20%20%20gl%2Euniform3fv%28%20obj%2EemissionLoc%2C%20obj%2Eemission%29%3B%0A%20%20%20%20%20%20%20%20gl%2Euniform1f%28%20obj%2EshininessLoc%2C%20obj%2Eshininess%29%3B%0A%20%20%20%20%20%20%20%20for%20%28i%3D0%3B%20i%20%3C%20subscene%2Elights%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20light%20%3D%20this%2EgetObj%28subscene%2Elights%5Bi%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20gl%2Euniform3fv%28%20obj%2EambientLoc%5Bi%5D%2C%20this%2EcomponentProduct%28light%2Eambient%2C%20obj%2Eambient%29%29%3B%0A%20%20%20%20%20%20%20%20%20%20gl%2Euniform3fv%28%20obj%2EspecularLoc%5Bi%5D%2C%20this%2EcomponentProduct%28light%2Especular%2C%20obj%2Especular%29%29%3B%0A%20%20%20%20%20%20%20%20%20%20gl%2Euniform3fv%28%20obj%2EdiffuseLoc%5Bi%5D%2C%20light%2Ediffuse%29%3B%0A%20%20%20%20%20%20%20%20%20%20gl%2Euniform3fv%28%20obj%2ElightDirLoc%5Bi%5D%2C%20light%2ElightDir%29%3B%0A%20%20%20%20%20%20%20%20%20%20gl%2Euniform1i%28%20obj%2EviewpointLoc%5Bi%5D%2C%20light%2Eviewpoint%29%3B%0A%20%20%20%20%20%20%20%20%20%20gl%2Euniform1i%28%20obj%2EfiniteLoc%5Bi%5D%2C%20light%2Efinite%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20for%20%28i%3Dsubscene%2Elights%2Elength%3B%20i%20%3C%20obj%2Enlights%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20gl%2Euniform3f%28%20obj%2EambientLoc%5Bi%5D%2C%200%2C0%2C0%29%3B%0A%20%20%20%20%20%20%20%20%20%20gl%2Euniform3f%28%20obj%2EspecularLoc%5Bi%5D%2C%200%2C0%2C0%29%3B%0A%20%20%20%20%20%20%20%20%20%20gl%2Euniform3f%28%20obj%2EdiffuseLoc%5Bi%5D%2C%200%2C0%2C0%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20if%20%28fixed%5Fsize%29%20%7B%0A%20%20%20%20%20%20%20%20gl%2Euniform2f%28%20obj%2EtextScaleLoc%2C%200%2E75%2Fthis%2Evp%2Ewidth%2C%200%2E75%2Fthis%2Evp%2Eheight%29%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20gl%2EenableVertexAttribArray%28%20this%2EposLoc%20%29%3B%0A%0A%20%20%20%20%20%20var%20nc%20%3D%20obj%2EcolorCount%3B%0A%20%20%20%20%20%20count%20%3D%20obj%2EvertexCount%3B%0A%0A%20%20%20%20%20%20if%20%28type%20%3D%3D%3D%20%22spheres%22%29%20%7B%0A%20%20%20%20%20%20%20%20subscene%20%3D%20this%2EgetObj%28subsceneid%29%3B%0A%20%20%20%20%20%20%20%20var%20scale%20%3D%20subscene%2Epar3d%2Escale%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20scount%20%3D%20count%2C%20indices%3B%0A%20%20%20%20%20%20%20%20gl%2EvertexAttribPointer%28this%2EposLoc%2C%20%203%2C%20gl%2EFLOAT%2C%20false%2C%204%2Athis%2Esphere%2EvOffsets%2Estride%2C%20%200%29%3B%0A%20%20%20%20%20%20%20%20gl%2EenableVertexAttribArray%28obj%2EnormLoc%20%29%3B%0A%20%20%20%20%20%20%20%20gl%2EvertexAttribPointer%28obj%2EnormLoc%2C%20%203%2C%20gl%2EFLOAT%2C%20false%2C%204%2Athis%2Esphere%2EvOffsets%2Estride%2C%20%200%29%3B%0A%20%20%20%20%20%20%20%20gl%2EdisableVertexAttribArray%28%20this%2EcolLoc%20%29%3B%0A%20%20%20%20%20%20%20%20var%20sphereNorm%20%3D%20new%20CanvasMatrix4%28%29%3B%0A%20%20%20%20%20%20%20%20sphereNorm%2Escale%28scale%5B0%5D%2C%20scale%5B1%5D%2C%20scale%5B2%5D%29%3B%0A%20%20%20%20%20%20%20%20sphereNorm%2EmultRight%28this%2EnormMatrix%29%3B%0A%20%20%20%20%20%20%20%20gl%2EuniformMatrix4fv%28%20obj%2EnormMatLoc%2C%20false%2C%20new%20Float32Array%28sphereNorm%2EgetAsArray%28%29%29%20%29%3B%0A%0A%20%20%20%20%20%20%20%20if%20%28nc%20%3D%3D%201%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20gl%2EvertexAttrib4fv%28%20this%2EcolLoc%2C%20new%20Float32Array%28obj%2Eonecolor%29%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20if%20%28has%5Ftexture%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20gl%2EenableVertexAttribArray%28%20obj%2EtexLoc%20%29%3B%0A%20%20%20%20%20%20%20%20%20%20gl%2EvertexAttribPointer%28obj%2EtexLoc%2C%202%2C%20gl%2EFLOAT%2C%20false%2C%204%2Athis%2Esphere%2EvOffsets%2Estride%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%204%2Athis%2Esphere%2EvOffsets%2Etofs%29%3B%0A%20%20%20%20%20%20%20%20%20%20gl%2EactiveTexture%28gl%2ETEXTURE0%29%3B%0A%20%20%20%20%20%20%20%20%20%20gl%2EbindTexture%28gl%2ETEXTURE%5F2D%2C%20obj%2Etexture%29%3B%0A%20%20%20%20%20%20%20%20%20%20gl%2Euniform1i%28%20obj%2Esampler%2C%200%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20if%20%28depth%5Fsort%29%0A%20%20%20%20%20%20%20%20%20%20indices%20%3D%20this%2EdepthSort%28obj%29%3B%0A%0A%20%20%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20scount%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20sphereMV%20%3D%20new%20CanvasMatrix4%28%29%3B%0A%0A%20%20%20%20%20%20%20%20%20%20if%20%28depth%5Fsort%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20baseofs%20%3D%20indices%5Bi%5D%2Aobj%2EvOffsets%2Estride%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20baseofs%20%3D%20i%2Aobj%2EvOffsets%2Estride%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20ofs%20%3D%20baseofs%20%2B%20obj%2EvOffsets%2Eradofs%3B%0A%20%20%20%20%20%20%20%20%20%20sscale%20%3D%20obj%2Evalues%5Bofs%5D%3B%0A%0A%20%20%20%20%20%20%20%20%20%20sphereMV%2Escale%28sscale%2Fscale%5B0%5D%2C%20sscale%2Fscale%5B1%5D%2C%20sscale%2Fscale%5B2%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20sphereMV%2Etranslate%28obj%2Evalues%5Bbaseofs%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20obj%2Evalues%5Bbaseofs%2B1%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20obj%2Evalues%5Bbaseofs%2B2%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20sphereMV%2EmultRight%28this%2EmvMatrix%29%3B%0A%20%20%20%20%20%20%20%20%20%20gl%2EuniformMatrix4fv%28%20obj%2EmvMatLoc%2C%20false%2C%20new%20Float32Array%28sphereMV%2EgetAsArray%28%29%29%20%29%3B%0A%0A%20%20%20%20%20%20%20%20%20%20if%20%28nc%20%3E%201%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20ofs%20%3D%20baseofs%20%2B%20obj%2EvOffsets%2Ecofs%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20gl%2EvertexAttrib4f%28%20this%2EcolLoc%2C%20obj%2Evalues%5Bofs%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20obj%2Evalues%5Bofs%2B1%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20obj%2Evalues%5Bofs%2B2%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20obj%2Evalues%5Bofs%2B3%5D%20%29%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20gl%2EbindBuffer%28gl%2EELEMENT%5FARRAY%5FBUFFER%2C%20this%2Esphere%2Eibuf%29%3B%0A%20%20%20%20%20%20%20%20%20%20gl%2EdrawElements%28gl%2ETRIANGLES%2C%20this%2Esphere%2EsphereCount%2C%20gl%2EUNSIGNED%5FSHORT%2C%200%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20if%20%28obj%2EcolorCount%20%3D%3D%3D%201%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20gl%2EdisableVertexAttribArray%28%20this%2EcolLoc%20%29%3B%0A%20%20%20%20%20%20%20%20%20%20gl%2EvertexAttrib4fv%28%20this%2EcolLoc%2C%20new%20Float32Array%28obj%2Eonecolor%29%29%3B%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20gl%2EenableVertexAttribArray%28%20this%2EcolLoc%20%29%3B%0A%20%20%20%20%20%20%20%20%20%20gl%2EvertexAttribPointer%28this%2EcolLoc%2C%204%2C%20gl%2EFLOAT%2C%20false%2C%204%2Aobj%2EvOffsets%2Estride%2C%204%2Aobj%2EvOffsets%2Ecofs%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20if%20%28is%5Flit%20%26%26%20obj%2EvOffsets%2Enofs%20%3E%200%29%20%7B%0A%20%20%20%20%20%20%20%20gl%2EenableVertexAttribArray%28%20obj%2EnormLoc%20%29%3B%0A%20%20%20%20%20%20%20%20gl%2EvertexAttribPointer%28obj%2EnormLoc%2C%203%2C%20gl%2EFLOAT%2C%20false%2C%204%2Aobj%2EvOffsets%2Estride%2C%204%2Aobj%2EvOffsets%2Enofs%29%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20if%20%28has%5Ftexture%20%7C%7C%20type%20%3D%3D%3D%20%22text%22%29%20%7B%0A%20%20%20%20%20%20%20%20gl%2EenableVertexAttribArray%28%20obj%2EtexLoc%20%29%3B%0A%20%20%20%20%20%20%20%20gl%2EvertexAttribPointer%28obj%2EtexLoc%2C%202%2C%20gl%2EFLOAT%2C%20false%2C%204%2Aobj%2EvOffsets%2Estride%2C%204%2Aobj%2EvOffsets%2Etofs%29%3B%0A%20%20%20%20%20%20%20%20gl%2EactiveTexture%28gl%2ETEXTURE0%29%3B%0A%20%20%20%20%20%20%20%20gl%2EbindTexture%28gl%2ETEXTURE%5F2D%2C%20obj%2Etexture%29%3B%0A%20%20%20%20%20%20%20%20gl%2Euniform1i%28%20obj%2Esampler%2C%200%29%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20if%20%28fixed%5Fquads%29%20%7B%0A%20%20%20%20%20%20%20%20gl%2EenableVertexAttribArray%28%20obj%2EofsLoc%20%29%3B%0A%20%20%20%20%20%20%20%20gl%2EvertexAttribPointer%28obj%2EofsLoc%2C%202%2C%20gl%2EFLOAT%2C%20false%2C%204%2Aobj%2EvOffsets%2Estride%2C%204%2Aobj%2EvOffsets%2Eoofs%29%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20if%20%28typeof%20obj%2EuserAttributes%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%09for%20%28attr%20in%20obj%2EuserAttribSizes%29%20%7B%20%20%2F%2F%20Not%20all%20attributes%20may%20have%20been%20used%0A%20%20%20%20%20%20%09%20%20gl%2EenableVertexAttribArray%28%20obj%2EuserAttribLocations%5Battr%5D%20%29%3B%0A%20%20%20%20%20%20%09%20%20gl%2EvertexAttribPointer%28%20obj%2EuserAttribLocations%5Battr%5D%2C%20obj%2EuserAttribSizes%5Battr%5D%2C%0A%20%20%20%20%20%20%09%20%20%09%09%09%20%20gl%2EFLOAT%2C%20false%2C%204%2Aobj%2EvOffsets%2Estride%2C%204%2Aobj%2EuserAttribOffsets%5Battr%5D%29%3B%0A%20%20%20%20%20%20%09%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20if%20%28typeof%20obj%2EuserUniforms%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%09for%20%28attr%20in%20obj%2EuserUniformLocations%29%20%7B%0A%20%20%20%20%20%20%09%20%20var%20loc%20%3D%20obj%2EuserUniformLocations%5Battr%5D%3B%0A%20%20%20%20%20%20%09%20%20if%20%28loc%20%21%3D%3D%20null%29%20%7B%0A%20%20%20%20%20%20%09%20%20%20%20var%20uniform%20%3D%20obj%2EuserUniforms%5Battr%5D%3B%0A%20%20%20%20%20%20%09%20%20%20%20if%20%28typeof%20uniform%2Elength%20%3D%3D%3D%20%22undefined%22%29%0A%20%20%20%20%20%20%09%20%20%20%20%20%20gl%2Euniform1f%28loc%2C%20uniform%29%3B%0A%20%20%20%20%20%20%09%20%20%20%20else%20if%20%28typeof%20uniform%5B0%5D%2Elength%20%3D%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%09%20%20%20%20%20%20uniform%20%3D%20new%20Float32Array%28uniform%29%3B%0A%20%20%20%20%20%20%09%20%20%20%20%20%20switch%28uniform%2Elength%29%20%7B%0A%20%20%20%20%20%20%09%20%20%20%20%20%20%09case%202%3A%20gl%2Euniform2fv%28loc%2C%20uniform%29%3B%20break%3B%0A%20%20%20%20%20%20%09%20%20%20%20%20%20%09case%203%3A%20gl%2Euniform3fv%28loc%2C%20uniform%29%3B%20break%3B%0A%20%20%20%20%20%20%09%20%20%20%20%20%20%09case%204%3A%20gl%2Euniform4fv%28loc%2C%20uniform%29%3B%20break%3B%0A%20%20%20%20%20%20%09%20%20%20%20%20%20%09default%3A%20console%2Ewarn%28%22bad%20uniform%20length%22%29%3B%0A%20%20%20%20%20%20%09%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%09%20%20%20%20%7D%20else%20if%20%28uniform%2Elength%20%3D%3D%204%20%26%26%20uniform%5B0%5D%2Elength%20%3D%3D%204%29%0A%20%20%20%20%20%20%09%20%20%20%20%20%20gl%2EuniformMatrix4fv%28loc%2C%20false%2C%20new%20Float32Array%28uniform%2EgetAsArray%28%29%29%29%3B%0A%20%20%20%20%20%20%09%20%20%20%20else%0A%20%20%20%20%20%20%09%20%20%20%20%20%20console%2Ewarn%28%22unsupported%20uniform%20matrix%22%29%3B%0A%20%20%20%20%20%20%09%20%20%7D%0A%20%20%20%20%20%20%09%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20for%20%28pass%20%3D%200%3B%20pass%20%3C%20obj%2Epasses%3B%20pass%2B%2B%29%20%7B%0A%20%20%20%20%20%20%09pmode%20%3D%20obj%2Epmode%5Bpass%5D%3B%0A%20%20%20%20%20%20%20%20if%20%28pmode%20%3D%3D%3D%20%22culled%22%29%0A%20%20%20%20%20%20%20%20%20%20continue%3B%0A%0A%20%20%20%20%20%20%09mode%20%3D%20fat%5Flines%20%26%26%20%28is%5Flines%20%7C%7C%20pmode%20%3D%3D%20%22lines%22%29%20%3F%20%22TRIANGLES%22%20%3A%20this%2Emode4type%5Btype%5D%3B%0A%20%20%20%20%20%20%20%20if%20%28depth%5Fsort%20%26%26%20pmode%20%3D%3D%20%22filled%22%29%20%7B%2F%2F%20Don%27t%20try%20depthsorting%20on%20wireframe%20or%20points%0A%20%20%20%20%20%20%20%20%20%20var%20faces%20%3D%20this%2EdepthSort%28obj%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20nfaces%20%3D%20faces%2Elength%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20frowsize%20%3D%20Math%2Efloor%28obj%2Ef%5Bpass%5D%2Elength%2Fnfaces%29%3B%0A%0A%20%20%20%20%20%20%20%20%20%20if%20%28type%20%21%3D%3D%20%22spheres%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20f%20%3D%20obj%2Eindex%5Fuint%20%3F%20new%20Uint32Array%28obj%2Ef%5Bpass%5D%2Elength%29%20%3A%20new%20Uint16Array%28obj%2Ef%5Bpass%5D%2Elength%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20%28i%3D0%3B%20i%3Cnfaces%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20%28j%3D0%3B%20j%3Cfrowsize%3B%20j%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f%5Bfrowsize%2Ai%20%2B%20j%5D%20%3D%20obj%2Ef%5Bpass%5D%5Bfrowsize%2Afaces%5Bi%5D%20%2B%20j%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20gl%2EbindBuffer%28gl%2EELEMENT%5FARRAY%5FBUFFER%2C%20obj%2Eibuf%5Bpass%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20gl%2EbufferData%28gl%2EELEMENT%5FARRAY%5FBUFFER%2C%20f%2C%20gl%2EDYNAMIC%5FDRAW%29%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%09if%20%28is%5Ftwosided%29%0A%20%20%20%20%20%20%09%20%20gl%2Euniform1i%28obj%2EfrontLoc%2C%20pass%20%21%3D%3D%200%29%3B%0A%0A%20%20%20%20%20%20%20%20if%20%28type%20%21%3D%3D%20%22spheres%22%29%20%0A%20%20%20%20%20%20%20%20%20%20gl%2EbindBuffer%28gl%2EELEMENT%5FARRAY%5FBUFFER%2C%20obj%2Eibuf%5Bpass%5D%29%3B%0A%0A%20%20%20%20%20%20%20%20if%20%28type%20%3D%3D%3D%20%22sprites%22%20%7C%7C%20type%20%3D%3D%3D%20%22text%22%20%7C%7C%20type%20%3D%3D%3D%20%22quads%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20count%20%3D%20count%20%2A%206%2F4%3B%0A%20%20%20%20%20%20%20%20%7D%20else%20if%20%28type%20%3D%3D%3D%20%22surface%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20count%20%3D%20obj%2Ef%5Bpass%5D%2Elength%3B%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20count%20%3D%20obj%2Ef%5Bpass%5D%2Elength%3B%0A%20%20%20%20%20%20%09%20%20if%20%28%28is%5Flines%20%7C%7C%20pmode%20%3D%3D%3D%20%22lines%22%29%20%26%26%20%21fat%5Flines%29%20%7B%0A%20%20%20%20%20%20%09%20%20%20%20mode%20%3D%20%22LINES%22%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%20else%20if%20%28pmode%20%3D%3D%3D%20%22points%22%29%20%7B%0A%20%20%20%20%20%20%09%20%20%20%20mode%20%3D%20%22POINTS%22%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20if%20%28%28is%5Flines%20%7C%7C%20pmode%20%3D%3D%3D%20%22lines%22%29%20%26%26%20fat%5Flines%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20gl%2EenableVertexAttribArray%28obj%2EpointLoc%29%3B%0A%20%20%20%20%20%20%20%20%20%20gl%2EvertexAttribPointer%28obj%2EpointLoc%2C%202%2C%20gl%2EFLOAT%2C%20false%2C%204%2Aobj%2EvOffsets%2Estride%2C%204%2Aobj%2EvOffsets%2Epointofs%29%3B%0A%20%20%20%20%20%20%20%20%20%20gl%2EenableVertexAttribArray%28obj%2EnextLoc%20%29%3B%0A%20%20%20%20%20%20%20%20%20%20gl%2EvertexAttribPointer%28obj%2EnextLoc%2C%203%2C%20gl%2EFLOAT%2C%20false%2C%204%2Aobj%2EvOffsets%2Estride%2C%204%2Aobj%2EvOffsets%2Enextofs%29%3B%0A%20%20%20%20%20%20%20%20%20%20gl%2Euniform1f%28obj%2EaspectLoc%2C%20this%2Evp%2Ewidth%2Fthis%2Evp%2Eheight%29%3B%0A%20%20%20%20%20%20%20%20%20%20gl%2Euniform1f%28obj%2ElwdLoc%2C%20this%2EgetMaterial%28id%2C%20%22lwd%22%29%2Fthis%2Evp%2Eheight%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20gl%2EvertexAttribPointer%28this%2EposLoc%2C%20%203%2C%20gl%2EFLOAT%2C%20false%2C%204%2Aobj%2EvOffsets%2Estride%2C%20%204%2Aobj%2EvOffsets%2Evofs%29%3B%0A%0A%20%20%20%20%20%20%20%20gl%2EdrawElements%28gl%5Bmode%5D%2C%20count%2C%20obj%2Eindex%5Fuint%20%3F%20gl%2EUNSIGNED%5FINT%20%3A%20gl%2EUNSIGNED%5FSHORT%2C%200%29%3B%0A%20%20%20%20%20%7D%0A%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Draw%20the%20background%20for%20a%20subscene%0A%20%20%20%20%20%2A%20%40param%20%7B%20number%20%7D%20id%20%2D%20id%20of%20background%20object%0A%20%20%20%20%20%2A%20%40param%20%7B%20number%20%7D%20subsceneid%20%2D%20id%20of%20subscene%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EdrawBackground%20%3D%20function%28id%2C%20subsceneid%29%20%7B%0A%20%20%20%20%20%20var%20gl%20%3D%20this%2Egl%20%7C%7C%20this%2EinitGL%28%29%2C%0A%20%20%20%20%20%20%20%20%20%20obj%20%3D%20this%2EgetObj%28id%29%2C%0A%20%20%20%20%20%20%20%20%20%20bg%2C%20i%3B%0A%0A%20%20%20%20%20%20if%20%28%21obj%2Einitialized%29%0A%20%20%20%20%20%20%20%20this%2EinitObj%28id%29%3B%0A%0A%20%20%20%20%20%20if%20%28obj%2Ecolors%2Elength%29%20%7B%0A%20%20%20%20%20%20%20%20bg%20%3D%20obj%2Ecolors%5B0%5D%3B%0A%20%20%20%20%20%20%20%20gl%2EclearColor%28bg%5B0%5D%2C%20bg%5B1%5D%2C%20bg%5B2%5D%2C%20bg%5B3%5D%29%3B%0A%20%20%20%20%20%20%20%20gl%2EdepthMask%28true%29%3B%0A%20%20%20%20%20%20%20%20gl%2Eclear%28gl%2ECOLOR%5FBUFFER%5FBIT%20%7C%20gl%2EDEPTH%5FBUFFER%5FBIT%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20if%20%28typeof%20obj%2Equad%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%20%20this%2EprMatrix%2EmakeIdentity%28%29%3B%0A%20%20%20%20%20%20%20%20this%2EmvMatrix%2EmakeIdentity%28%29%3B%0A%20%20%20%20%20%20%20%20gl%2Edisable%28gl%2EBLEND%29%3B%0A%20%20%20%20%20%20%20%20gl%2Edisable%28gl%2EDEPTH%5FTEST%29%3B%0A%20%20%20%20%20%20%20%20gl%2EdepthMask%28false%29%3B%0A%20%20%20%20%20%20%20%20for%20%28i%3D0%3B%20i%20%3C%20obj%2Equad%2Elength%3B%20i%2B%2B%29%0A%20%20%20%20%20%20%20%20%20%20this%2EdrawObj%28obj%2Equad%5Bi%5D%2C%20subsceneid%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Draw%20a%20subscene%0A%20%20%20%20%20%2A%20%40param%20%7B%20number%20%7D%20subsceneid%20%2D%20id%20of%20subscene%0A%20%20%20%20%20%2A%20%40param%20%7B%20boolean%20%7D%20opaquePass%20%2D%20is%20this%20the%20opaque%20drawing%20pass%3F%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EdrawSubscene%20%3D%20function%28subsceneid%2C%20opaquePass%29%20%7B%0A%20%20%20%20%20%20var%20gl%20%3D%20this%2Egl%20%7C%7C%20this%2EinitGL%28%29%2C%0A%20%20%20%20%20%20%20%20%20%20obj%20%3D%20this%2EgetObj%28subsceneid%29%2C%0A%20%20%20%20%20%20%20%20%20%20objects%20%3D%20this%2Escene%2Eobjects%2C%0A%20%20%20%20%20%20%20%20%20%20subids%20%3D%20obj%2Eobjects%2C%0A%20%20%20%20%20%20%20%20%20%20subscene%5Fhas%5Ffaces%20%3D%20false%2C%0A%20%20%20%20%20%20%20%20%20%20subscene%5Fneeds%5Fsorting%20%3D%20false%2C%0A%20%20%20%20%20%20%20%20%20%20flags%2C%20i%3B%0A%20%20%20%20%20%20if%20%28obj%2Epar3d%2EskipRedraw%29%0A%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20for%20%28i%3D0%3B%20i%20%3C%20subids%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20flags%20%3D%20objects%5Bsubids%5Bi%5D%5D%2Eflags%3B%0A%20%20%20%20%20%20%20%20if%20%28typeof%20flags%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20subscene%5Fhas%5Ffaces%20%7C%3D%20%28flags%20%26%20this%2Ef%5Fis%5Flit%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%26%20%21%28flags%20%26%20this%2Ef%5Ffixed%5Fquads%29%3B%0A%20%20%20%20%20%20%20%20%20%20subscene%5Fneeds%5Fsorting%20%7C%3D%20%28flags%20%26%20this%2Ef%5Fdepth%5Fsort%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20this%2EsetViewport%28subsceneid%29%3B%0A%0A%20%20%20%20%20%20if%20%28typeof%20obj%2EbackgroundId%20%21%3D%3D%20%22undefined%22%20%26%26%20opaquePass%29%0A%20%20%20%20%20%20%20%20%20%20this%2EdrawBackground%28obj%2EbackgroundId%2C%20subsceneid%29%3B%0A%0A%20%20%20%20%20%20if%20%28subids%2Elength%29%20%7B%0A%20%20%20%20%20%20%20%20this%2EsetprMatrix%28subsceneid%29%3B%0A%20%20%20%20%20%20%20%20this%2EsetmvMatrix%28subsceneid%29%3B%0A%0A%20%20%20%20%20%20%20%20if%20%28subscene%5Fhas%5Ffaces%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20this%2EsetnormMatrix%28subsceneid%29%3B%0A%20%20%20%20%20%20%20%20%20%20if%20%28%28obj%2Eflags%20%26%20this%2Ef%5Fsprites%5F3d%29%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20typeof%20obj%2EspriteNormmat%20%3D%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20obj%2EspriteNormmat%20%3D%20new%20CanvasMatrix4%28this%2EnormMatrix%29%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20if%20%28subscene%5Fneeds%5Fsorting%20%26%26%20%21opaquePass%29%0A%20%20%20%20%20%20%20%20%20%20this%2EsetprmvMatrix%28%29%3B%0A%0A%20%20%20%20%20%20%20%20var%20clipids%20%3D%20obj%2Eclipplanes%3B%0A%20%20%20%20%20%20%20%20if%20%28typeof%20clipids%20%3D%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20console%2Ewarn%28%22bad%20clipids%22%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20if%20%28clipids%2Elength%20%3E%200%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20this%2EinvMatrix%20%3D%20new%20CanvasMatrix4%28this%2EmvMatrix%29%3B%0A%20%20%20%20%20%20%20%20%20%20this%2EinvMatrix%2Einvert%28%29%3B%0A%20%20%20%20%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20clipids%2Elength%3B%20i%2B%2B%29%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2EdrawObj%28clipids%5Bi%5D%2C%20subsceneid%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20subids%20%3D%20obj%2Eopaque%3B%0A%20%20%20%20%20%20%20%20if%20%28subids%2Elength%20%3E%200%20%26%26%20opaquePass%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20gl%2Eenable%28gl%2EDEPTH%5FTEST%29%3B%0A%20%20%20%20%20%20%20%20%20%20gl%2EdepthMask%28true%29%3B%0A%20%20%20%20%20%20%20%20%20%20gl%2Edisable%28gl%2EBLEND%29%3B%0A%20%20%20%20%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20subids%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2EdrawObj%28subids%5Bi%5D%2C%20subsceneid%29%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20subids%20%3D%20obj%2Etransparent%3B%0A%20%20%20%20%20%20%20%20if%20%28subids%2Elength%20%3E%200%20%26%26%20%21opaquePass%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20gl%2EdepthMask%28false%29%3B%0A%20%20%20%20%20%20%20%20%20%20gl%2EblendFuncSeparate%28gl%2ESRC%5FALPHA%2C%20gl%2EONE%5FMINUS%5FSRC%5FALPHA%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20gl%2EONE%2C%20gl%2EONE%29%3B%0A%20%20%20%20%20%20%20%20%20%20gl%2Eenable%28gl%2EBLEND%29%3B%0A%20%20%20%20%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20subids%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2EdrawObj%28subids%5Bi%5D%2C%20subsceneid%29%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20subids%20%3D%20obj%2Esubscenes%3B%0A%20%20%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20subids%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20this%2EdrawSubscene%28subids%5Bi%5D%2C%20opaquePass%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Compute%20mouse%20coordinates%20relative%20to%20current%20canvas%0A%20%20%20%20%20%2A%20%40returns%20%7B%20Object%20%7D%0A%20%20%20%20%20%2A%20%40param%20%7B%20Object%20%7D%20event%20%2D%20event%20object%20from%20mouse%20click%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2ErelMouseCoords%20%3D%20function%28event%29%20%7B%0A%20%20%20%20%20%20var%20totalOffsetX%20%3D%200%2C%0A%20%20%20%20%20%20totalOffsetY%20%3D%200%2C%0A%20%20%20%20%20%20currentElement%20%3D%20this%2Ecanvas%3B%0A%0A%20%20%20%20%20%20do%20%7B%0A%20%20%20%20%20%20%20%20totalOffsetX%20%2B%3D%20currentElement%2EoffsetLeft%3B%0A%20%20%20%20%20%20%20%20totalOffsetY%20%2B%3D%20currentElement%2EoffsetTop%3B%0A%20%20%20%20%20%20%20%20currentElement%20%3D%20currentElement%2EoffsetParent%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20while%28currentElement%29%3B%0A%0A%20%20%20%20%20%20var%20canvasX%20%3D%20event%2EpageX%20%2D%20totalOffsetX%2C%0A%20%20%20%20%20%20%20%20%20%20canvasY%20%3D%20event%2EpageY%20%2D%20totalOffsetY%3B%0A%0A%20%20%20%20%20%20return%20%7Bx%3AcanvasX%2C%20y%3AcanvasY%7D%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Set%20mouse%20handlers%20for%20the%20scene%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EsetMouseHandlers%20%3D%20function%28%29%20%7B%0A%20%20%20%20%20%20var%20self%20%3D%20this%2C%20activeSubscene%2C%20handler%2C%0A%20%20%20%20%20%20%20%20%20%20handlers%20%3D%20%7B%7D%2C%20drag%20%3D%200%3B%0A%0A%20%20%20%20%20%20handlers%2ErotBase%20%3D%200%3B%0A%0A%20%20%20%20%20%20this%2EscreenToVector%20%3D%20function%28x%2C%20y%29%20%7B%0A%20%20%20%20%20%20%20%20var%20viewport%20%3D%20this%2EgetObj%28activeSubscene%29%2Epar3d%2Eviewport%2C%0A%20%20%20%20%20%20%20%20%20%20width%20%3D%20viewport%2Ewidth%2Athis%2Ecanvas%2Ewidth%2C%0A%20%20%20%20%20%20%20%20%20%20height%20%3D%20viewport%2Eheight%2Athis%2Ecanvas%2Eheight%2C%0A%20%20%20%20%20%20%20%20%20%20radius%20%3D%20Math%2Emax%28width%2C%20height%29%2F2%2E0%2C%0A%20%20%20%20%20%20%20%20%20%20cx%20%3D%20width%2F2%2E0%2C%0A%20%20%20%20%20%20%20%20%20%20cy%20%3D%20height%2F2%2E0%2C%0A%20%20%20%20%20%20%20%20%20%20px%20%3D%20%28x%2Dcx%29%2Fradius%2C%0A%20%20%20%20%20%20%20%20%20%20py%20%3D%20%28y%2Dcy%29%2Fradius%2C%0A%20%20%20%20%20%20%20%20%20%20plen%20%3D%20Math%2Esqrt%28px%2Apx%2Bpy%2Apy%29%3B%0A%20%20%20%20%20%20%20%20if%20%28plen%20%3E%201%2Ee%2D6%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20px%20%3D%20px%2Fplen%3B%0A%20%20%20%20%20%20%20%20%20%20py%20%3D%20py%2Fplen%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20var%20angle%20%3D%20%28Math%2ESQRT2%20%2D%20plen%29%2FMath%2ESQRT2%2AMath%2EPI%2F2%2C%0A%20%20%20%20%20%20%20%20%20%20z%20%3D%20Math%2Esin%28angle%29%2C%0A%20%20%20%20%20%20%20%20%20%20zlen%20%3D%20Math%2Esqrt%281%2E0%20%2D%20z%2Az%29%3B%0A%20%20%20%20%20%20%20%20px%20%3D%20px%20%2A%20zlen%3B%0A%20%20%20%20%20%20%20%20py%20%3D%20py%20%2A%20zlen%3B%0A%20%20%20%20%20%20%20%20return%20%5Bpx%2C%20py%2C%20z%5D%3B%0A%20%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%20%20handlers%2Etrackballdown%20%3D%20function%28x%2Cy%29%20%7B%0A%20%20%20%20%20%20%20%20var%20activeSub%20%3D%20this%2EgetObj%28activeSubscene%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20activeModel%20%3D%20this%2EgetObj%28this%2Euseid%28activeSub%2Eid%2C%20%22model%22%29%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20i%2C%20l%20%3D%20activeModel%2Epar3d%2Elisteners%3B%0A%20%20%20%20%20%20%20%20handlers%2ErotBase%20%3D%20this%2EscreenToVector%28x%2C%20y%29%3B%0A%20%20%20%20%20%20%20%20this%2EsaveMat%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20l%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20activeSub%20%3D%20this%2EgetObj%28l%5Bi%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20activeSub%2EsaveMat%20%3D%20new%20CanvasMatrix4%28activeSub%2Epar3d%2EuserMatrix%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%20%20handlers%2Etrackballmove%20%3D%20function%28x%2Cy%29%20%7B%0A%20%20%20%20%20%20%20%20var%20rotCurrent%20%3D%20this%2EscreenToVector%28x%2Cy%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20rotBase%20%3D%20handlers%2ErotBase%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20dot%20%3D%20rotBase%5B0%5D%2ArotCurrent%5B0%5D%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20rotBase%5B1%5D%2ArotCurrent%5B1%5D%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20rotBase%5B2%5D%2ArotCurrent%5B2%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20angle%20%3D%20Math%2Eacos%28%20dot%2Fthis%2Evlen%28rotBase%29%2Fthis%2Evlen%28rotCurrent%29%20%29%2A180%2E0%2FMath%2EPI%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20axis%20%3D%20this%2Exprod%28rotBase%2C%20rotCurrent%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20objects%20%3D%20this%2Escene%2Eobjects%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20activeSub%20%3D%20this%2EgetObj%28activeSubscene%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20activeModel%20%3D%20this%2EgetObj%28this%2Euseid%28activeSub%2Eid%2C%20%22model%22%29%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20l%20%3D%20activeModel%2Epar3d%2Elisteners%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20i%3B%0A%20%20%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20l%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20activeSub%20%3D%20this%2EgetObj%28l%5Bi%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20activeSub%2Epar3d%2EuserMatrix%2Eload%28objects%5Bl%5Bi%5D%5D%2EsaveMat%29%3B%0A%20%20%20%20%20%20%20%20%20%20activeSub%2Epar3d%2EuserMatrix%2Erotate%28angle%2C%20axis%5B0%5D%2C%20axis%5B1%5D%2C%20axis%5B2%5D%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20this%2EdrawScene%28%29%3B%0A%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%20%20handlers%2Etrackballend%20%3D%200%3B%0A%0A%20%20%20%20%20%20this%2Eclamp%20%3D%20function%28x%2C%20lo%2C%20hi%29%20%7B%0A%20%20%20%20%20%20%09return%20Math%2Emax%28lo%2C%20Math%2Emin%28x%2C%20hi%29%29%3B%0A%20%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%20%20this%2EscreenToPolar%20%3D%20function%28x%2Cy%29%20%7B%0A%20%20%20%20%20%20%20%20var%20viewport%20%3D%20this%2EgetObj%28activeSubscene%29%2Epar3d%2Eviewport%2C%0A%20%20%20%20%20%20%20%20%20%20width%20%3D%20viewport%2Ewidth%2Athis%2Ecanvas%2Ewidth%2C%0A%20%20%20%20%20%20%20%20%20%20height%20%3D%20viewport%2Eheight%2Athis%2Ecanvas%2Eheight%2C%0A%20%20%20%20%09%20%20r%20%3D%20Math%2Emin%28width%2C%20height%29%2F2%2C%0A%20%20%20%20%09%20%20dx%20%3D%20this%2Eclamp%28x%20%2D%20width%2F2%2C%20%2Dr%2C%20r%29%2C%0A%20%20%20%20%09%20%20dy%20%3D%20this%2Eclamp%28y%20%2D%20height%2F2%2C%20%2Dr%2C%20r%29%3B%0A%20%20%20%20%09%20%20return%20%5BMath%2Easin%28dx%2Fr%29%2C%20Math%2Easin%28%2Ddy%2Fr%29%5D%3B%0A%20%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%20%20handlers%2Epolardown%20%3D%20function%28x%2Cy%29%20%7B%0A%20%20%20%20%20%20%20%20var%20activeSub%20%3D%20this%2EgetObj%28activeSubscene%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20activeModel%20%3D%20this%2EgetObj%28this%2Euseid%28activeSub%2Eid%2C%20%22model%22%29%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20i%2C%20l%20%3D%20activeModel%2Epar3d%2Elisteners%3B%0A%20%20%20%20%20%20%20%20handlers%2EdragBase%20%3D%20this%2EscreenToPolar%28x%2C%20y%29%3B%0A%20%20%20%20%20%20%20%20this%2EsaveMat%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20l%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20activeSub%20%3D%20this%2EgetObj%28l%5Bi%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20activeSub%2EsaveMat%20%3D%20new%20CanvasMatrix4%28activeSub%2Epar3d%2EuserMatrix%29%3B%0A%20%20%20%20%20%20%20%20%20%20activeSub%2EcamBase%20%3D%20%5B%2DMath%2Eatan2%28activeSub%2EsaveMat%2Em13%2C%20activeSub%2EsaveMat%2Em11%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Math%2Eatan2%28activeSub%2EsaveMat%2Em32%2C%20activeSub%2EsaveMat%2Em22%29%5D%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%20%20handlers%2Epolarmove%20%3D%20function%28x%2Cy%29%20%7B%0A%20%20%20%20%20%20%20%20var%20dragCurrent%20%3D%20this%2EscreenToPolar%28x%2Cy%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20activeSub%20%3D%20this%2EgetObj%28activeSubscene%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20activeModel%20%3D%20this%2EgetObj%28this%2Euseid%28activeSub%2Eid%2C%20%22model%22%29%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20objects%20%3D%20this%2Escene%2Eobjects%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20l%20%3D%20activeModel%2Epar3d%2Elisteners%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20i%2C%20changepos%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20l%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20activeSub%20%3D%20this%2EgetObj%28l%5Bi%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20for%20%28j%3D0%3B%20j%3C2%3B%20j%2B%2B%29%0A%20%20%20%20%20%20%20%20%20%20%20%20changepos%5Bj%5D%20%3D%20%2D%28dragCurrent%5Bj%5D%20%2D%20handlers%2EdragBase%5Bj%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20activeSub%2Epar3d%2EuserMatrix%2EmakeIdentity%28%29%3B%0A%20%20%20%20%20%20%20%20%20%20activeSub%2Epar3d%2EuserMatrix%2Erotate%28changepos%5B0%5D%2A180%2FMath%2EPI%2C%200%2C%2D1%2C0%29%3B%0A%20%20%20%20%20%20%20%20%20%20activeSub%2Epar3d%2EuserMatrix%2EmultRight%28objects%5Bl%5Bi%5D%5D%2EsaveMat%29%3B%0A%20%20%20%20%20%20%20%20%20%20activeSub%2Epar3d%2EuserMatrix%2Erotate%28changepos%5B1%5D%2A180%2FMath%2EPI%2C%20%2D1%2C0%2C0%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20this%2EdrawScene%28%29%3B%0A%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%20%20handlers%2Epolarend%20%3D%200%3B%0A%0A%20%20%20%20%20%20handlers%2Eaxisdown%20%3D%20function%28x%2Cy%29%20%7B%0A%20%20%20%20%20%20%20%20handlers%2ErotBase%20%3D%20this%2EscreenToVector%28x%2C%20this%2Ecanvas%2Eheight%2F2%29%3B%0A%20%20%20%20%20%20%20%20var%20activeSub%20%3D%20this%2EgetObj%28activeSubscene%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20activeModel%20%3D%20this%2EgetObj%28this%2Euseid%28activeSub%2Eid%2C%20%22model%22%29%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20i%2C%20l%20%3D%20activeModel%2Epar3d%2Elisteners%3B%0A%20%20%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20l%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20activeSub%20%3D%20this%2EgetObj%28l%5Bi%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20activeSub%2EsaveMat%20%3D%20new%20CanvasMatrix4%28activeSub%2Epar3d%2EuserMatrix%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%20%20handlers%2Eaxismove%20%3D%20function%28x%2Cy%29%20%7B%0A%20%20%20%20%20%20%20%20var%20rotCurrent%20%3D%20this%2EscreenToVector%28x%2C%20this%2Ecanvas%2Eheight%2F2%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20rotBase%20%3D%20handlers%2ErotBase%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20angle%20%3D%20%28rotCurrent%5B0%5D%20%2D%20rotBase%5B0%5D%29%2A180%2FMath%2EPI%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20rotMat%20%3D%20new%20CanvasMatrix4%28%29%3B%0A%20%20%20%20%20%20%20%20rotMat%2Erotate%28angle%2C%20handlers%2Eaxis%5B0%5D%2C%20handlers%2Eaxis%5B1%5D%2C%20handlers%2Eaxis%5B2%5D%29%3B%0A%20%20%20%20%20%20%20%20var%20activeSub%20%3D%20this%2EgetObj%28activeSubscene%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20activeModel%20%3D%20this%2EgetObj%28this%2Euseid%28activeSub%2Eid%2C%20%22model%22%29%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20i%2C%20l%20%3D%20activeModel%2Epar3d%2Elisteners%3B%0A%20%20%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20l%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20activeSub%20%3D%20this%2EgetObj%28l%5Bi%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20activeSub%2Epar3d%2EuserMatrix%2Eload%28activeSub%2EsaveMat%29%3B%0A%20%20%20%20%20%20%20%20%20%20activeSub%2Epar3d%2EuserMatrix%2EmultLeft%28rotMat%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20this%2EdrawScene%28%29%3B%0A%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%20%20handlers%2Eaxisend%20%3D%200%3B%0A%0A%20%20%20%20%20%20handlers%2Ey0zoom%20%3D%200%3B%0A%20%20%20%20%20%20handlers%2Ezoom0%20%3D%200%3B%0A%20%20%20%20%20%20handlers%2Ezoomdown%20%3D%20function%28x%2C%20y%29%20%7B%0A%20%20%20%20%20%20%20%20var%20activeSub%20%3D%20this%2EgetObj%28activeSubscene%29%2C%0A%20%20%20%20%20%20%20%20%20%20activeProjection%20%3D%20this%2EgetObj%28this%2Euseid%28activeSub%2Eid%2C%20%22projection%22%29%29%2C%0A%20%20%20%20%20%20%20%20%20%20i%2C%20l%20%3D%20activeProjection%2Epar3d%2Elisteners%3B%0A%20%20%20%20%20%20%20%20handlers%2Ey0zoom%20%3D%20y%3B%0A%20%20%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20l%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20activeSub%20%3D%20this%2EgetObj%28l%5Bi%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20activeSub%2Ezoom0%20%3D%20Math%2Elog%28activeSub%2Epar3d%2Ezoom%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%20%20handlers%2Ezoommove%20%3D%20function%28x%2C%20y%29%20%7B%0A%20%20%20%20%20%20%20%20var%20activeSub%20%3D%20this%2EgetObj%28activeSubscene%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20activeProjection%20%3D%20this%2EgetObj%28this%2Euseid%28activeSub%2Eid%2C%20%22projection%22%29%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20i%2C%20l%20%3D%20activeProjection%2Epar3d%2Elisteners%3B%0A%20%20%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20l%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20activeSub%20%3D%20this%2EgetObj%28l%5Bi%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20activeSub%2Epar3d%2Ezoom%20%3D%20Math%2Eexp%28activeSub%2Ezoom0%20%2B%20%28y%2Dhandlers%2Ey0zoom%29%2Fthis%2Ecanvas%2Eheight%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20this%2EdrawScene%28%29%3B%0A%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%20%20handlers%2Ezoomend%20%3D%200%3B%0A%0A%20%20%20%20%20%20handlers%2Ey0fov%20%3D%200%3B%0A%20%20%20%20%20%20handlers%2Efovdown%20%3D%20function%28x%2C%20y%29%20%7B%0A%20%20%20%20%20%20%20%20handlers%2Ey0fov%20%3D%20y%3B%0A%20%20%20%20%20%20%20%20var%20activeSub%20%3D%20this%2EgetObj%28activeSubscene%29%2C%0A%20%20%20%20%20%20%20%20%20%20activeProjection%20%3D%20this%2EgetObj%28this%2Euseid%28activeSub%2Eid%2C%20%22projection%22%29%29%2C%0A%20%20%20%20%20%20%20%20%20%20i%2C%20l%20%3D%20activeProjection%2Epar3d%2Elisteners%3B%0A%20%20%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20l%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20activeSub%20%3D%20this%2EgetObj%28l%5Bi%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20activeSub%2Efov0%20%3D%20activeSub%2Epar3d%2EFOV%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%20%20handlers%2Efovmove%20%3D%20function%28x%2C%20y%29%20%7B%0A%20%20%20%20%20%20%20%20var%20activeSub%20%3D%20this%2EgetObj%28activeSubscene%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20activeProjection%20%3D%20this%2EgetObj%28this%2Euseid%28activeSub%2Eid%2C%20%22projection%22%29%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20i%2C%20l%20%3D%20activeProjection%2Epar3d%2Elisteners%3B%0A%20%20%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20l%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20activeSub%20%3D%20this%2EgetObj%28l%5Bi%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20activeSub%2Epar3d%2EFOV%20%3D%20Math%2Emax%281%2C%20Math%2Emin%28179%2C%20activeSub%2Efov0%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20180%2A%28y%2Dhandlers%2Ey0fov%29%2Fthis%2Ecanvas%2Eheight%29%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20this%2EdrawScene%28%29%3B%0A%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%20%20handlers%2Efovend%20%3D%200%3B%0A%0A%20%20%20%20%20%20this%2Ecanvas%2Eonmousedown%20%3D%20function%20%28%20ev%20%29%7B%0A%20%20%20%20%20%20%20%20if%20%28%21ev%2Ewhich%29%20%2F%2F%20Use%20w3c%20defns%20in%20preference%20to%20MS%0A%20%20%20%20%20%20%20%20switch%20%28ev%2Ebutton%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20case%200%3A%20ev%2Ewhich%20%3D%201%3B%20break%3B%0A%20%20%20%20%20%20%20%20%20%20case%201%3A%0A%20%20%20%20%20%20%20%20%20%20case%204%3A%20ev%2Ewhich%20%3D%202%3B%20break%3B%0A%20%20%20%20%20%20%20%20%20%20case%202%3A%20ev%2Ewhich%20%3D%203%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20drag%20%3D%20%5B%22left%22%2C%20%22middle%22%2C%20%22right%22%5D%5Bev%2Ewhich%2D1%5D%3B%0A%20%20%20%20%20%20%20%20var%20coords%20%3D%20self%2ErelMouseCoords%28ev%29%3B%0A%20%20%20%20%20%20%20%20coords%2Ey%20%3D%20self%2Ecanvas%2Eheight%2Dcoords%2Ey%3B%0A%20%20%20%20%20%20%20%20activeSubscene%20%3D%20self%2EwhichSubscene%28coords%29%3B%0A%20%20%20%20%20%20%20%20var%20sub%20%3D%20self%2EgetObj%28activeSubscene%29%2C%20f%3B%0A%20%20%20%20%20%20%20%20handler%20%3D%20sub%2Epar3d%2EmouseMode%5Bdrag%5D%3B%0A%20%20%20%20%20%20%20%20switch%20%28handler%29%20%7B%0A%20%20%20%20%20%20%20%20case%20%22xAxis%22%3A%0A%20%20%20%20%20%20%20%20%20%20handler%20%3D%20%22axis%22%3B%0A%20%20%20%20%20%20%20%20%20%20handlers%2Eaxis%20%3D%20%5B1%2E0%2C%200%2E0%2C%200%2E0%5D%3B%0A%20%20%20%20%20%20%20%20%20%20break%3B%0A%20%20%20%20%20%20%20%20case%20%22yAxis%22%3A%0A%20%20%20%20%20%20%20%20%20%20handler%20%3D%20%22axis%22%3B%0A%20%20%20%20%20%20%20%20%20%20handlers%2Eaxis%20%3D%20%5B0%2E0%2C%201%2E0%2C%200%2E0%5D%3B%0A%20%20%20%20%20%20%20%20%20%20break%3B%0A%20%20%20%20%20%20%20%20case%20%22zAxis%22%3A%0A%20%20%20%20%20%20%20%20%20%20handler%20%3D%20%22axis%22%3B%0A%20%20%20%20%20%20%20%20%20%20handlers%2Eaxis%20%3D%20%5B0%2E0%2C%200%2E0%2C%201%2E0%5D%3B%0A%20%20%20%20%20%20%20%20%20%20break%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20f%20%3D%20handlers%5Bhandler%20%2B%20%22down%22%5D%3B%0A%20%20%20%20%20%20%20%20if%20%28f%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20coords%20%3D%20self%2EtranslateCoords%28activeSubscene%2C%20coords%29%3B%0A%20%20%20%20%20%20%20%20%20%20f%2Ecall%28self%2C%20coords%2Ex%2C%20coords%2Ey%29%3B%0A%20%20%20%20%20%20%20%20%20%20ev%2EpreventDefault%28%29%3B%0A%20%20%20%20%20%20%20%20%7D%20else%0A%20%20%20%20%20%20%20%20%20%20console%2Ewarn%28%22Mouse%20handler%20%27%22%20%2B%20handler%20%2B%20%22%27%20is%20not%20implemented%2E%22%29%3B%0A%0A%20%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%20%20this%2Ecanvas%2Eonmouseup%20%3D%20function%20%28%20ev%20%29%7B%0A%20%20%20%20%20%20%20%20if%20%28%20drag%20%3D%3D%3D%200%20%29%20return%3B%0A%20%20%20%20%20%20%20%20var%20f%20%3D%20handlers%5Bhandler%20%2B%20%22up%22%5D%3B%0A%20%20%20%20%20%20%20%20if%20%28f%29%0A%20%20%20%20%20%20%20%20%20%20f%28%29%3B%0A%20%20%20%20%20%20%20%20drag%20%3D%200%3B%0A%20%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%20%20this%2Ecanvas%2Eonmouseout%20%3D%20this%2Ecanvas%2Eonmouseup%3B%0A%0A%20%20%20%20%20%20this%2Ecanvas%2Eonmousemove%20%3D%20function%20%28%20ev%20%29%20%7B%0A%20%20%20%20%20%20%20%20if%20%28%20drag%20%3D%3D%3D%200%20%29%20return%3B%0A%20%20%20%20%20%20%20%20var%20f%20%3D%20handlers%5Bhandler%20%2B%20%22move%22%5D%3B%0A%20%20%20%20%20%20%20%20if%20%28f%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20var%20coords%20%3D%20self%2ErelMouseCoords%28ev%29%3B%0A%20%20%20%20%20%20%20%20%20%20coords%2Ey%20%3D%20self%2Ecanvas%2Eheight%20%2D%20coords%2Ey%3B%0A%20%20%20%20%20%20%20%20%20%20coords%20%3D%20self%2EtranslateCoords%28activeSubscene%2C%20coords%29%3B%0A%20%20%20%20%20%20%20%20%20%20f%2Ecall%28self%2C%20coords%2Ex%2C%20coords%2Ey%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%20%20handlers%2EwheelHandler%20%3D%20function%28ev%29%20%7B%0A%20%20%20%20%20%20%20%20var%20del%20%3D%201%2E02%2C%20i%3B%0A%20%20%20%20%20%20%20%20if%20%28ev%2EshiftKey%29%20del%20%3D%201%2E002%3B%0A%20%20%20%20%20%20%20%20var%20ds%20%3D%20%28%28ev%2Edetail%20%7C%7C%20ev%2EwheelDelta%29%20%3E%200%29%20%3F%20del%20%3A%20%281%20%2F%20del%29%3B%0A%20%20%20%20%20%20%20%20if%20%28typeof%20activeSubscene%20%3D%3D%3D%20%22undefined%22%29%0A%20%20%20%20%20%20%20%20%20%20activeSubscene%20%3D%20self%2Escene%2ErootSubscene%3B%0A%20%20%20%20%20%20%20%20var%20activeSub%20%3D%20self%2EgetObj%28activeSubscene%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20activeProjection%20%3D%20self%2EgetObj%28self%2Euseid%28activeSub%2Eid%2C%20%22projection%22%29%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20l%20%3D%20activeProjection%2Epar3d%2Elisteners%3B%0A%0A%20%20%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20l%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20activeSub%20%3D%20self%2EgetObj%28l%5Bi%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20activeSub%2Epar3d%2Ezoom%20%2A%3D%20ds%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20self%2EdrawScene%28%29%3B%0A%20%20%20%20%20%20%20%20ev%2EpreventDefault%28%29%3B%0A%20%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%20%20this%2Ecanvas%2EaddEventListener%28%22DOMMouseScroll%22%2C%20handlers%2EwheelHandler%2C%20false%29%3B%0A%20%20%20%20%20%20this%2Ecanvas%2EaddEventListener%28%22mousewheel%22%2C%20handlers%2EwheelHandler%2C%20false%29%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Find%20a%20particular%20subscene%20by%20inheritance%0A%20%20%20%20%20%2A%20%40returns%20%7B%20number%20%7D%20id%20of%20subscene%20to%20use%0A%20%20%20%20%20%2A%20%40param%20%7B%20number%20%7D%20subsceneid%20%2D%20child%20subscene%0A%20%20%20%20%20%2A%20%40param%20%7B%20string%20%7D%20type%20%2D%20type%20of%20inheritance%3A%20%20%22projection%22%20or%20%22model%22%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2Euseid%20%3D%20function%28subsceneid%2C%20type%29%20%7B%0A%20%20%20%20%20%20var%20sub%20%3D%20this%2EgetObj%28subsceneid%29%3B%0A%20%20%20%20%20%20if%20%28sub%2Eembeddings%5Btype%5D%20%3D%3D%3D%20%22inherit%22%29%0A%20%20%20%20%20%20%20%20return%28this%2Euseid%28sub%2Eparent%2C%20type%29%29%3B%0A%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20return%20subsceneid%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Check%20whether%20point%20is%20in%20viewport%20of%20subscene%0A%20%20%20%20%20%2A%20%40returns%20%7Bboolean%7D%0A%20%20%20%20%20%2A%20%40param%20%7B%20Object%20%7D%20coords%20%2D%20screen%20coordinates%20of%20point%0A%20%20%20%20%20%2A%20%40param%20%7B%20number%20%7D%20subsceneid%20%2D%20subscene%20to%20check%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EinViewport%20%3D%20function%28coords%2C%20subsceneid%29%20%7B%0A%20%20%20%20%20%20var%20viewport%20%3D%20this%2EgetObj%28subsceneid%29%2Epar3d%2Eviewport%2C%0A%20%20%20%20%20%20%20%20x0%20%3D%20coords%2Ex%20%2D%20viewport%2Ex%2Athis%2Ecanvas%2Ewidth%2C%0A%20%20%20%20%20%20%20%20y0%20%3D%20coords%2Ey%20%2D%20viewport%2Ey%2Athis%2Ecanvas%2Eheight%3B%0A%20%20%20%20%20%20return%200%20%3C%3D%20x0%20%26%26%20x0%20%3C%3D%20viewport%2Ewidth%2Athis%2Ecanvas%2Ewidth%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%200%20%3C%3D%20y0%20%26%26%20y0%20%3C%3D%20viewport%2Eheight%2Athis%2Ecanvas%2Eheight%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Find%20which%20subscene%20contains%20a%20point%0A%20%20%20%20%20%2A%20%40returns%20%7B%20number%20%7D%20subscene%20id%0A%20%20%20%20%20%2A%20%40param%20%7B%20Object%20%7D%20coords%20%2D%20coordinates%20of%20point%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EwhichSubscene%20%3D%20function%28coords%29%20%7B%0A%20%20%20%20%20%20var%20self%20%3D%20this%2C%0A%20%20%20%20%20%20%20%20%20%20recurse%20%3D%20function%28subsceneid%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20subscenes%20%3D%20self%2EgetChildSubscenes%28subsceneid%29%2C%20i%2C%20id%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20%28i%3D0%3B%20i%20%3C%20subscenes%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20id%20%3D%20recurse%28subscenes%5Bi%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28typeof%28id%29%20%21%3D%3D%20%22undefined%22%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%28id%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28self%2EinViewport%28coords%2C%20subsceneid%29%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%28subsceneid%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20undefined%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20rootid%20%3D%20this%2Escene%2ErootSubscene%2C%0A%20%20%20%20%20%20%20%20%20%20result%20%3D%20recurse%28rootid%29%3B%0A%20%20%20%20%20%20if%20%28typeof%28result%29%20%3D%3D%3D%20%22undefined%22%29%0A%20%20%20%20%20%20%20%20result%20%3D%20rootid%3B%0A%20%20%20%20%20%20return%20result%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Translate%20from%20window%20coordinates%20to%20viewport%20coordinates%0A%20%20%20%20%20%2A%20%40returns%20%7B%20Object%20%7D%20translated%20coordinates%0A%20%20%20%20%20%2A%20%40param%20%7B%20number%20%7D%20subsceneid%20%2D%20which%20subscene%20to%20use%3F%0A%20%20%20%20%20%2A%20%40param%20%7B%20Object%20%7D%20coords%20%2D%20point%20to%20translate%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EtranslateCoords%20%3D%20function%28subsceneid%2C%20coords%29%20%7B%0A%20%20%20%20%20%20var%20viewport%20%3D%20this%2EgetObj%28subsceneid%29%2Epar3d%2Eviewport%3B%0A%20%20%20%20%20%20return%20%7Bx%3A%20coords%2Ex%20%2D%20viewport%2Ex%2Athis%2Ecanvas%2Ewidth%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20y%3A%20coords%2Ey%20%2D%20viewport%2Ey%2Athis%2Ecanvas%2Eheight%7D%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Initialize%20the%20sphere%20object%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EinitSphere%20%3D%20function%28%29%20%7B%0A%20%20%20%20%20%20var%20verts%20%3D%20this%2Escene%2EsphereVerts%2C%0A%20%20%20%20%20%20%20%20%20%20reuse%20%3D%20verts%2Ereuse%2C%20result%3B%0A%20%20%20%20%20%20if%20%28typeof%20reuse%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%20%20var%20prev%20%3D%20document%2EgetElementById%28reuse%29%2Erglinstance%2Esphere%3B%0A%20%20%20%20%20%20%20%20result%20%3D%20%7Bvalues%3A%20prev%2Evalues%2C%20vOffsets%3A%20prev%2EvOffsets%2C%20it%3A%20prev%2Eit%7D%3B%0A%20%20%20%20%20%20%7D%20else%0A%20%20%20%20%20%20%20%20result%20%3D%20%7Bvalues%3A%20new%20Float32Array%28this%2Eflatten%28this%2Ecbind%28this%2Etranspose%28verts%2Evb%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this%2Etranspose%28verts%2Etexcoords%29%29%29%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20it%3A%20new%20Uint16Array%28this%2Eflatten%28this%2Etranspose%28verts%2Eit%29%29%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20vOffsets%3A%20%7Bvofs%3A0%2C%20cofs%3A%2D1%2C%20nofs%3A%2D1%2C%20radofs%3A%2D1%2C%20oofs%3A%2D1%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20tofs%3A3%2C%20stride%3A5%7D%7D%3B%0A%0A%20%20%20%20%20%20result%2EsphereCount%20%3D%20result%2Eit%2Elength%3B%0A%20%20%20%20%20%20this%2Esphere%20%3D%20result%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Do%20the%20gl%20part%20of%20initializing%20the%20sphere%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EinitSphereGL%20%3D%20function%28%29%20%7B%0A%20%20%20%20%20%20var%20gl%20%3D%20this%2Egl%20%7C%7C%20this%2EinitGL%28%29%2C%20sphere%20%3D%20this%2Esphere%3B%0A%20%20%20%20%20%20if%20%28gl%2EisContextLost%28%29%29%20return%3B%0A%20%20%20%20%20%20sphere%2Ebuf%20%3D%20gl%2EcreateBuffer%28%29%3B%0A%20%20%20%20%20%20gl%2EbindBuffer%28gl%2EARRAY%5FBUFFER%2C%20sphere%2Ebuf%29%3B%0A%20%20%20%20%20%20gl%2EbufferData%28gl%2EARRAY%5FBUFFER%2C%20sphere%2Evalues%2C%20gl%2ESTATIC%5FDRAW%29%3B%0A%20%20%20%20%20%20sphere%2Eibuf%20%3D%20gl%2EcreateBuffer%28%29%3B%0A%20%20%20%20%20%20gl%2EbindBuffer%28gl%2EELEMENT%5FARRAY%5FBUFFER%2C%20sphere%2Eibuf%29%3B%0A%20%20%20%20%20%20gl%2EbufferData%28gl%2EELEMENT%5FARRAY%5FBUFFER%2C%20sphere%2Eit%2C%20gl%2ESTATIC%5FDRAW%29%3B%0A%20%20%20%20%20%20return%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Initialize%20the%20DOM%20object%0A%20%20%20%20%20%2A%20%40param%20%7B%20Object%20%7D%20el%20%2D%20the%20DOM%20object%0A%20%20%20%20%20%2A%20%40param%20%7B%20Object%20%7D%20x%20%2D%20the%20scene%20data%20sent%20by%20JSON%20from%20R%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2Einitialize%20%3D%20function%28el%2C%20x%29%20%7B%0A%20%20%20%20%20%20this%2EtextureCanvas%20%3D%20document%2EcreateElement%28%22canvas%22%29%3B%0A%20%20%20%20%20%20this%2EtextureCanvas%2Estyle%2Edisplay%20%3D%20%22block%22%3B%0A%20%20%20%20%20%20this%2Escene%20%3D%20x%3B%0A%20%20%20%20%20%20this%2EnormMatrix%20%3D%20new%20CanvasMatrix4%28%29%3B%0A%20%20%20%20%20%20this%2EsaveMat%20%3D%20%7B%7D%3B%0A%20%20%20%20%20%20this%2Edistance%20%3D%20null%3B%0A%20%20%20%20%20%20this%2EposLoc%20%3D%200%3B%0A%20%20%20%20%20%20this%2EcolLoc%20%3D%201%3B%0A%20%20%20%20%20%20if%20%28el%29%20%7B%0A%20%20%20%20%20%20%20%20el%2Erglinstance%20%3D%20this%3B%0A%20%20%20%20%20%20%20%20this%2Eel%20%3D%20el%3B%0A%20%20%20%20%20%20%20%20this%2EwebGLoptions%20%3D%20el%2Erglinstance%2Escene%2EwebGLoptions%3B%0A%20%20%20%20%20%20%20%20this%2EinitCanvas%28%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Restart%20the%20WebGL%20canvas%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2ErestartCanvas%20%3D%20function%28%29%20%7B%0A%20%20%20%20%20%20var%20newcanvas%20%3D%20document%2EcreateElement%28%22canvas%22%29%3B%0A%20%20%20%20%20%20newcanvas%2Ewidth%20%3D%20this%2Eel%2Ewidth%3B%0A%20%20%20%20%20%20newcanvas%2Eheight%20%3D%20this%2Eel%2Eheight%3B%0A%20%20%20%20%20%20newcanvas%2EaddEventListener%28%22webglcontextrestored%22%2C%0A%20%20%20%20%20%20%20%20this%2EonContextRestored%2C%20false%29%3B%0A%20%20%20%20%20%20newcanvas%2EaddEventListener%28%22webglcontextlost%22%2C%0A%20%20%20%20%20%20%20%20this%2EonContextLost%2C%20false%29%3B%0A%20%20%20%20%20%20while%20%28this%2Eel%2EfirstChild%29%20%7B%0A%20%20%20%20%20%20%20%20this%2Eel%2EremoveChild%28this%2Eel%2EfirstChild%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20this%2Eel%2EappendChild%28newcanvas%29%3B%0A%20%20%20%20%20%20this%2Ecanvas%20%3D%20newcanvas%3B%0A%20%20%20%20%20%20this%2EsetMouseHandlers%28%29%3B%0A%20%20%20%20%20%20this%2Egl%20%3D%20null%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Initialize%20the%20WebGL%20canvas%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EinitCanvas%20%3D%20function%28%29%20%7B%0A%20%20%20%20%20%20this%2ErestartCanvas%28%29%3B%0A%20%20%20%20%20%20var%20objs%20%3D%20this%2Escene%2Eobjects%2C%0A%20%20%20%20%20%20%20%20%20%20self%20%3D%20this%3B%0A%20%20%20%20%20%20Object%2Ekeys%28objs%29%2EforEach%28function%28key%29%7B%0A%20%20%20%20%20%20%20%20var%20id%20%3D%20parseInt%28key%2C%2010%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20obj%20%3D%20self%2EgetObj%28id%29%3B%0A%20%20%20%20%20%20%20%20if%20%28typeof%20obj%2Ereuse%20%21%3D%3D%20%22undefined%22%29%0A%20%20%20%20%20%20%20%20%20%20self%2EcopyObj%28id%2C%20obj%2Ereuse%29%3B%0A%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%20%20Object%2Ekeys%28objs%29%2EforEach%28function%28key%29%7B%0A%20%20%20%20%20%20%20%20self%2EinitSubscene%28parseInt%28key%2C%2010%29%29%3B%0A%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%20%20this%2EsetMouseHandlers%28%29%3B%0A%20%20%20%20%20%20this%2EinitSphere%28%29%3B%0A%0A%20%20%20%20%20%20this%2EonContextRestored%20%3D%20function%28event%29%20%7B%0A%20%20%20%20%20%20%20%20self%2EinitGL%28%29%3B%0A%20%20%20%20%20%20%20%20self%2EdrawScene%28%29%3B%0A%20%20%20%20%20%20%20%20%2F%2F%20console%2Elog%28%22restored%20context%20for%20%22%2Bself%2Escene%2ErootSubscene%29%3B%0A%20%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%20%20this%2EonContextLost%20%3D%20function%28event%29%20%7B%0A%20%20%20%20%20%20%20%20if%20%28%21self%2Edrawing%29%0A%20%20%20%20%20%20%20%20%20%20this%2Egl%20%3D%20null%3B%0A%20%20%20%20%20%20%20%20event%2EpreventDefault%28%29%3B%0A%20%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%20%20this%2EinitGL0%28%29%3B%0A%20%20%20%20%20%20this%2ElazyLoadScene%20%3D%20function%28%29%20%7B%0A%20%20%20%20%20%20%09if%20%28typeof%20self%2Eslide%20%3D%3D%3D%20%22undefined%22%29%0A%20%20%20%20%20%20%09%20%20self%2Eslide%20%3D%20self%2EgetSlide%28%29%3B%0A%20%20%20%20%20%20%09if%20%28self%2EisInBrowserViewport%28%29%29%20%7B%0A%20%20%20%20%20%20%09%20%20if%20%28%21self%2Egl%20%7C%7C%20self%2Egl%2EisContextLost%28%29%29%0A%20%20%20%20%20%20%09%20%20%20%20self%2EinitGL%28%29%3B%0A%20%20%20%20%20%20%09%20%20self%2EdrawScene%28%29%3B%0A%20%20%20%20%20%20%09%7D%0A%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%20%20window%2EaddEventListener%28%22DOMContentLoaded%22%2C%20this%2ElazyLoadScene%2C%20false%29%3B%0A%20%20%20%20%20%20window%2EaddEventListener%28%22load%22%2C%20this%2ElazyLoadScene%2C%20false%29%3B%0A%20%20%20%20%20%20window%2EaddEventListener%28%22resize%22%2C%20this%2ElazyLoadScene%2C%20false%29%3B%0A%20%20%20%20%20%20window%2EaddEventListener%28%22scroll%22%2C%20this%2ElazyLoadScene%2C%20false%29%3B%0A%20%20%20%20%20%20this%2Eslide%20%3D%20this%2EgetSlide%28%29%3B%0A%20%20%20%20%20%20if%20%28this%2Eslide%29%20%7B%0A%20%20%20%20%20%20%20%20if%20%28typeof%20this%2Eslide%2Ergl%20%3D%3D%3D%20%22undefined%22%29%0A%20%20%20%20%20%20%20%20%20%20this%2Eslide%2Ergl%20%3D%20%5Bthis%5D%3B%0A%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20this%2Eslide%2Ergl%2Epush%28this%29%3B%0A%20%20%20%20%20%20%20%20if%20%28this%2Escene%2Econtext%2Ermarkdown%20%3D%3D%3D%20%22ioslides%5Fpresentation%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20this%2Eslide%2EsetAttribute%28%22slideenter%22%2C%20%22this%2Ergl%2EforEach%28function%28scene%29%20%7B%20scene%2ElazyLoadScene%2Ecall%28window%29%3B%7D%29%22%29%3B%0A%20%20%20%20%20%20%20%20%7D%20else%20if%20%28this%2Escene%2Econtext%2Ermarkdown%20%3D%3D%3D%20%22slidy%5Fpresentation%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20This%20method%20would%20also%20work%20in%20ioslides%2C%20but%20it%20gets%20triggered%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20something%20like%205%20times%20per%20slide%20for%20every%20slide%20change%2C%20so%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20you%27d%20need%20a%20quicker%20function%20than%20lazyLoadScene%2E%0A%20%20%20%20%20%20%20%20%20%20var%20MutationObserver%20%3D%20window%2EMutationObserver%20%7C%7C%20window%2EWebKitMutationObserver%20%7C%7C%20window%2EMozMutationObserver%2C%0A%20%20%20%20%20%20%20%20%20%20observer%20%3D%20new%20MutationObserver%28function%28mutations%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20mutations%2EforEach%28function%28mutation%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20console%2Elog%28%22type%3D%22%2Bmutation%2Etype%2B%22%20attributeName%3D%22%2Bmutation%2E%20attributeName%2B%22%20self%3D%22%2Bself%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20self%2Eslide%2Ergl%2EforEach%28function%28scene%29%20%7B%20scene%2ElazyLoadScene%2Ecall%28window%29%3B%20%7D%29%3B%7D%29%3B%7D%29%3B%0A%20%20%20%20%20%20%20%20%20%20observer%2Eobserve%28this%2Eslide%2C%20%7B%20attributes%3A%20true%2C%20attributeFilter%3A%5B%22class%22%5D%20%7D%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Start%20the%20writeWebGL%20scene%2E%20This%20is%20only%20used%20by%20writeWebGL%3B%20rglwidget%20has%0A%20%20%20%20%20%20%20no%20debug%20element%20and%20does%20the%20drawing%20in%20rglwidget%2Ejs%2E%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2Estart%20%3D%20function%28%29%20%7B%0A%20%20%20%20%20%20if%20%28typeof%20this%2Eprefix%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%20%20this%2Edebugelement%20%3D%20document%2EgetElementById%28this%2Eprefix%20%2B%20%22debug%22%29%3B%0A%20%20%20%20%20%20%20%20this%2Edebug%28%22%22%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20this%2Edrag%20%3D%200%3B%0A%20%20%20%20%20%20this%2EdrawScene%28%29%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Display%20a%20debug%20message%0A%20%20%20%20%20%2A%20%40param%20%7B%20string%20%7D%20msg%20%2D%20The%20message%20to%20display%0A%20%20%20%20%20%2A%20%40param%20%7B%20Object%20%7D%20%5Bimg%5D%20%2D%20Image%20to%20insert%20before%20message%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2Edebug%20%3D%20function%28msg%2C%20img%29%20%7B%0A%20%20%20%20%20%20if%20%28typeof%20this%2Edebugelement%20%21%3D%3D%20%22undefined%22%20%26%26%20this%2Edebugelement%20%21%3D%3D%20null%29%20%7B%0A%20%20%20%20%20%20%20%20this%2Edebugelement%2EinnerHTML%20%3D%20msg%3B%0A%20%20%20%20%20%20%20%20if%20%28typeof%20img%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20this%2Edebugelement%2EinsertBefore%28img%2C%20this%2Edebugelement%2EfirstChild%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%20else%20if%20%28msg%20%21%3D%3D%20%22%22%29%0A%20%20%20%20%20%20%20%20alert%28msg%29%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Get%20the%20snapshot%20image%20of%20this%20scene%0A%20%20%20%20%20%2A%20%40returns%20%7B%20Object%20%7D%20The%20img%20DOM%20element%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EgetSnapshot%20%3D%20function%28%29%20%7B%0A%20%20%20%20%20%20var%20img%3B%0A%20%20%20%20%20%20if%20%28typeof%20this%2Escene%2Esnapshot%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%20%20img%20%3D%20document%2EcreateElement%28%22img%22%29%3B%0A%20%20%20%20%20%20%20%20img%2Esrc%20%3D%20this%2Escene%2Esnapshot%3B%0A%20%20%20%20%20%20%20%20img%2Ealt%20%3D%20%22Snapshot%22%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20return%20img%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Initial%20test%20for%20WebGL%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EinitGL0%20%3D%20function%28%29%20%7B%0A%20%20%20%20%20%20if%20%28%21window%2EWebGLRenderingContext%29%7B%0A%20%20%20%20%20%20%20%20alert%28%22Your%20browser%20does%20not%20support%20WebGL%2E%20See%20http%3A%2F%2Fget%2Ewebgl%2Eorg%22%29%3B%0A%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20If%20we%20are%20in%20an%20ioslides%20or%20slidy%20presentation%2C%20get%20the%0A%20%20%20%20%20%2A%20DOM%20element%20of%20the%20current%20slide%0A%20%20%20%20%20%2A%20%40returns%20%7B%20Object%20%7D%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EgetSlide%20%3D%20function%28%29%20%7B%0A%20%20%20%20%20%20var%20result%20%3D%20this%2Eel%2C%20done%20%3D%20false%3B%0A%20%20%20%20%20%20while%20%28result%20%26%26%20%21done%29%20%7B%0A%20%20%20%20%20%20%09switch%28this%2Escene%2Econtext%2Ermarkdown%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20case%20%22ioslides%5Fpresentation%22%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28result%2EtagName%20%3D%3D%3D%20%22SLIDE%22%29%20return%20result%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20else%20done%20%3D%20true%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20break%3B%0A%20%20%20%20%20%20%20%20%20%20case%20%22slidy%5Fpresentation%22%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28result%2EtagName%20%3D%3D%3D%20%22DIV%22%20%26%26%20result%2EclassList%2Econtains%28%22slide%22%29%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20result%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20else%20done%20%3D%20true%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20break%3B%0A%20%20%20%20%20%20%20%20%20%20default%3A%20return%20null%3B%0A%20%20%20%20%20%20%09%7D%0A%20%20%20%20%20%20%09result%20%3D%20result%2EparentElement%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20return%20null%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Is%20this%20scene%20visible%20in%20the%20browser%3F%0A%20%20%20%20%20%2A%20%40returns%20%7B%20boolean%20%7D%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EisInBrowserViewport%20%3D%20function%28%29%20%7B%0A%20%20%20%20%20%20var%20rect%20%3D%20this%2Ecanvas%2EgetBoundingClientRect%28%29%2C%0A%20%20%20%20%20%20%20%20%20%20windHeight%20%3D%20%28window%2EinnerHeight%20%7C%7C%20document%2EdocumentElement%2EclientHeight%29%2C%0A%20%20%20%20%20%20%20%20%20%20windWidth%20%3D%20%28window%2EinnerWidth%20%7C%7C%20document%2EdocumentElement%2EclientWidth%29%3B%0A%20%20%20%20%20%20if%20%28this%2Escene%2Econtext%20%26%26%20this%2Escene%2Econtext%2Ermarkdown%20%21%3D%3D%20null%29%20%7B%0A%20%20%20%20%20%20%09if%20%28this%2Eslide%29%0A%20%20%20%20%20%20%09%20%20return%20%28this%2Escene%2Econtext%2Ermarkdown%20%3D%3D%3D%20%22ioslides%5Fpresentation%22%20%26%26%0A%20%20%20%20%20%20%09%20%20%20%20%20%20%20%20%20%20this%2Eslide%2EclassList%2Econtains%28%22current%22%29%29%20%7C%7C%0A%20%20%20%20%20%20%09%20%20%20%20%20%20%20%20%20%28this%2Escene%2Econtext%2Ermarkdown%20%3D%3D%3D%20%22slidy%5Fpresentation%22%20%26%26%0A%20%20%20%20%20%20%09%20%20%20%20%20%20%20%20%20%20%21this%2Eslide%2EclassList%2Econtains%28%22hidden%22%29%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20return%20%28%0A%20%20%20%20%20%20%09rect%2Etop%20%3E%3D%20%2DwindHeight%20%26%26%0A%20%20%20%20%20%20%09rect%2Eleft%20%3E%3D%20%2DwindWidth%20%26%26%0A%20%20%20%20%20%20%09rect%2Ebottom%20%3C%3D%202%2AwindHeight%20%26%26%0A%20%20%20%20%20%20%09rect%2Eright%20%3C%3D%202%2AwindWidth%29%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Initialize%20WebGL%0A%20%20%20%20%20%2A%20%40returns%20%7B%20Object%20%7D%20the%20WebGL%20context%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EinitGL%20%3D%20function%28%29%20%7B%0A%20%20%20%20%20%20var%20self%20%3D%20this%3B%0A%20%20%20%20%20%20if%20%28this%2Egl%29%20%7B%0A%20%20%20%20%20%20%09if%20%28%21this%2Edrawing%20%26%26%20this%2Egl%2EisContextLost%28%29%29%0A%20%20%20%20%20%20%20%20%20%20this%2ErestartCanvas%28%29%3B%0A%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20return%20this%2Egl%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%2F%2F%20if%20%28%21this%2EisInBrowserViewport%28%29%29%20return%3B%20Return%20what%3F%3F%3F%20At%20this%20point%20we%20know%20this%2Egl%20is%20null%2E%0A%20%20%20%20%20%20this%2Ecanvas%2EaddEventListener%28%22webglcontextrestored%22%2C%0A%20%20%20%20%20%20%20%20this%2EonContextRestored%2C%20false%29%3B%0A%20%20%20%20%20%20this%2Ecanvas%2EaddEventListener%28%22webglcontextlost%22%2C%0A%20%20%20%20%20%20%20%20this%2EonContextLost%2C%20false%29%3B%0A%20%20%20%20%20%20this%2Egl%20%3D%20this%2Ecanvas%2EgetContext%28%22webgl%22%2C%20this%2EwebGLoptions%29%20%7C%7C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this%2Ecanvas%2EgetContext%28%22experimental%2Dwebgl%22%2C%20this%2EwebGLoptions%29%3B%0A%20%20%20%20%20%20this%2Eindex%5Fuint%20%3D%20this%2Egl%2EgetExtension%28%22OES%5Felement%5Findex%5Fuint%22%29%3B%0A%20%20%20%20%20%20var%20save%20%3D%20this%2EstartDrawing%28%29%3B%0A%20%20%20%20%20%20this%2EinitSphereGL%28%29%3B%0A%20%20%20%20%20%20Object%2Ekeys%28this%2Escene%2Eobjects%29%2EforEach%28function%28key%29%7B%0A%20%20%20%20%20%20%20%20self%2EinitObj%28parseInt%28key%2C%2010%29%29%3B%0A%20%20%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%20%20this%2EstopDrawing%28save%29%3B%0A%20%20%20%20%20%20return%20this%2Egl%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Resize%20the%20display%20to%20match%20element%0A%20%20%20%20%20%2A%20%40param%20%7B%20Object%20%7D%20el%20%2D%20DOM%20element%20to%20match%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2Eresize%20%3D%20function%28el%29%20%7B%0A%20%20%20%20%20%20this%2Ecanvas%2Ewidth%20%3D%20el%2Ewidth%3B%0A%20%20%20%20%20%20this%2Ecanvas%2Eheight%20%3D%20el%2Eheight%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Draw%20the%20whole%20scene%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EdrawScene%20%3D%20function%28%29%20%7B%0A%20%20%20%20%20%20var%20gl%20%3D%20this%2Egl%20%7C%7C%20this%2EinitGL%28%29%2C%0A%20%20%20%20%20%20%20%20%20%20save%20%3D%20this%2EstartDrawing%28%29%3B%0A%20%20%20%20%20%20gl%2Eenable%28gl%2EDEPTH%5FTEST%29%3B%0A%20%20%20%20%20%20gl%2EdepthFunc%28gl%2ELEQUAL%29%3B%0A%20%20%20%20%20%20gl%2EclearDepth%281%2E0%29%3B%0A%20%20%20%20%20%20gl%2EclearColor%281%2C1%2C1%2C1%29%3B%0A%20%20%20%20%20%20gl%2EdepthMask%28true%29%3B%20%2F%2F%20Must%20be%20true%20before%20clearing%20depth%20buffer%0A%20%20%20%20%20%20gl%2Eclear%28gl%2ECOLOR%5FBUFFER%5FBIT%20%7C%20gl%2EDEPTH%5FBUFFER%5FBIT%29%3B%0A%20%20%20%20%20%20this%2EdrawSubscene%28this%2Escene%2ErootSubscene%2C%20true%29%3B%0A%20%20%20%20%20%20this%2EdrawSubscene%28this%2Escene%2ErootSubscene%2C%20false%29%3B%0A%20%20%20%20%20%20this%2EstopDrawing%28save%29%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Change%20the%20displayed%20subset%0A%20%20%20%20%20%2A%20%40param%20%7B%20Object%20%7D%20el%20%2D%20Element%20of%20the%20control%3B%20not%20used%2E%0A%20%20%20%20%20%2A%20%40param%20%7B%20Object%20%7D%20control%20%2D%20The%20subset%20control%20data%2E%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EsubsetSetter%20%3D%20function%28el%2C%20control%29%20%7B%0A%20%20%20%20%20%20if%20%28typeof%20control%2Esubscenes%20%3D%3D%3D%20%22undefined%22%20%7C%7C%0A%20%20%20%20%20%20%20%20%20%20control%2Esubscenes%20%3D%3D%3D%20null%29%0A%20%20%20%20%20%20%20%20control%2Esubscenes%20%3D%20this%2Escene%2ErootSubscene%3B%0A%20%20%20%20%20%20var%20value%20%3D%20Math%2Eround%28control%2Evalue%29%2C%0A%20%20%20%20%20%20%20%20%20%20subscenes%20%3D%20%5B%5D%2Econcat%28control%2Esubscenes%29%2C%0A%20%20%20%20%20%20%20%20%20%20fullset%20%3D%20%5B%5D%2Econcat%28control%2Efullset%29%2C%0A%20%20%20%20%20%20%20%20%20%20i%2C%20j%2C%20entries%2C%20subsceneid%2C%0A%20%20%20%20%20%20%20%20%20%20adds%20%3D%20%5B%5D%2C%20deletes%20%3D%20%5B%5D%2C%0A%20%20%20%20%20%20%20%20%20%20ismissing%20%3D%20function%28x%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20fullset%2EindexOf%28x%29%20%3C%200%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20tointeger%20%3D%20function%28x%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20parseInt%28x%2C%2010%29%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%20%20if%20%28isNaN%28value%29%29%0A%20%20%20%20%20%20%20%20value%20%3D%20control%2Evalue%20%3D%200%3B%0A%20%20%20%20%20%20if%20%28control%2Eaccumulate%29%0A%20%20%20%20%20%20%20%20for%20%28i%3D0%3B%20i%20%3C%3D%20value%3B%20i%2B%2B%29%0A%20%20%20%20%20%20%20%20%20%20adds%20%3D%20adds%2Econcat%28control%2Esubsets%5Bi%5D%29%3B%0A%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20adds%20%3D%20adds%2Econcat%28control%2Esubsets%5Bvalue%5D%29%3B%0A%20%20%20%20%20%20deletes%20%3D%20fullset%2Efilter%28function%28x%29%20%7B%20return%20adds%2EindexOf%28x%29%20%3C%200%3B%20%7D%29%3B%0A%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20subscenes%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20subsceneid%20%3D%20subscenes%5Bi%5D%3B%0A%20%20%20%20%20%20%20%20if%20%28typeof%20this%2EgetObj%28subsceneid%29%20%3D%3D%3D%20%22undefined%22%29%0A%20%20%20%20%20%20%20%20%20%20this%2EalertOnce%28%22typeof%20object%20is%20undefined%22%29%3B%0A%20%20%20%20%20%20%20%20for%20%28j%20%3D%200%3B%20j%20%3C%20adds%2Elength%3B%20j%2B%2B%29%0A%20%20%20%20%20%20%20%20%20%20this%2EaddToSubscene%28adds%5Bj%5D%2C%20subsceneid%29%3B%0A%20%20%20%20%20%20%20%20for%20%28j%20%3D%200%3B%20j%20%3C%20deletes%2Elength%3B%20j%2B%2B%29%0A%20%20%20%20%20%20%20%20%20%20this%2EdelFromSubscene%28deletes%5Bj%5D%2C%20subsceneid%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Change%20the%20requested%20property%0A%20%20%20%20%20%2A%20%40param%20%7B%20Object%20%7D%20el%20%2D%20Element%20of%20the%20control%3B%20not%20used%2E%0A%20%20%20%20%20%2A%20%40param%20%7B%20Object%20%7D%20control%20%2D%20The%20property%20setter%20control%20data%2E%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EpropertySetter%20%3D%20function%28el%2C%20control%29%20%20%7B%0A%20%20%20%20%20%20var%20value%20%3D%20control%2Evalue%2C%0A%20%20%20%20%20%20%20%20%20%20values%20%3D%20%5B%5D%2Econcat%28control%2Evalues%29%2C%0A%20%20%20%20%20%20%20%20%20%20svals%20%3D%20%5B%5D%2Econcat%28control%2Eparam%29%2C%0A%20%20%20%20%20%20%20%20%20%20direct%20%3D%20values%5B0%5D%20%3D%3D%3D%20null%2C%0A%20%20%20%20%20%20%20%20%20%20entries%20%3D%20%5B%5D%2Econcat%28control%2Eentries%29%2C%0A%20%20%20%20%20%20%20%20%20%20ncol%20%3D%20entries%2Elength%2C%0A%20%20%20%20%20%20%20%20%20%20nrow%20%3D%20values%2Elength%2Fncol%2C%0A%20%20%20%20%20%20%20%20%20%20properties%20%3D%20this%2ErepeatToLen%28control%2Eproperties%2C%20ncol%29%2C%0A%20%20%20%20%20%20%20%20%20%20objids%20%3D%20this%2ErepeatToLen%28control%2Eobjids%2C%20ncol%29%2C%0A%20%20%20%20%20%20%20%20%20%20property%2C%20objid%20%3D%20objids%5B0%5D%2C%0A%20%20%20%20%20%20%20%20%20%20obj%20%3D%20this%2EgetObj%28objid%29%2C%0A%20%20%20%20%20%20%20%20%20%20propvals%2C%20i%2C%20v1%2C%20v2%2C%20p%2C%20entry%2C%20gl%2C%20needsBinding%2C%0A%20%20%20%20%20%20%20%20%20%20newprop%2C%20newid%2C%0A%0A%20%20%20%20%20%20%20%20%20%20getPropvals%20%3D%20function%28%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28property%20%3D%3D%3D%20%22userMatrix%22%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20obj%2Epar3d%2EuserMatrix%2EgetAsArray%28%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20%28property%20%3D%3D%3D%20%22scale%22%20%7C%7C%20property%20%3D%3D%3D%20%22FOV%22%20%7C%7C%20property%20%3D%3D%3D%20%22zoom%22%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%5B%5D%2Econcat%28obj%2Epar3d%5Bproperty%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%5B%5D%2Econcat%28obj%5Bproperty%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%20%20%20%20%20%20putPropvals%20%3D%20function%28newvals%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28newvals%2Elength%20%3D%3D%201%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20newvals%20%3D%20newvals%5B0%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28property%20%3D%3D%3D%20%22userMatrix%22%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20obj%2Epar3d%2EuserMatrix%2Eload%28newvals%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20%28property%20%3D%3D%3D%20%22scale%22%20%7C%7C%20property%20%3D%3D%3D%20%22FOV%22%20%7C%7C%20property%20%3D%3D%3D%20%22zoom%22%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20obj%2Epar3d%5Bproperty%5D%20%3D%20newvals%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20obj%5Bproperty%5D%20%3D%20newvals%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%20%20if%20%28direct%20%26%26%20typeof%20value%20%3D%3D%3D%20%22undefined%22%29%0A%20%20%20%20%20%20%20%20return%3B%0A%0A%20%20%20%20%20%20if%20%28control%2Einterp%29%20%7B%0A%20%20%20%20%20%20%20%20values%20%3D%20values%2Eslice%280%2C%20ncol%29%2Econcat%28values%29%2E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20concat%28values%2Eslice%28ncol%2A%28nrow%2D1%29%2C%20ncol%2Anrow%29%29%3B%0A%20%20%20%20%20%20%20%20svals%20%3D%20%5B%2DInfinity%5D%2Econcat%28svals%29%2Econcat%28Infinity%29%3B%0A%20%20%20%20%20%20%20%20for%20%28i%20%3D%201%3B%20i%20%3C%20svals%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20if%20%28value%20%3C%3D%20svals%5Bi%5D%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28svals%5Bi%5D%20%3D%3D%3D%20Infinity%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20p%20%3D%201%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20p%20%3D%20%28svals%5Bi%5D%20%2D%20value%29%2F%28svals%5Bi%5D%20%2D%20svals%5Bi%2D1%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20break%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%20else%20if%20%28%21direct%29%20%7B%0A%20%20%20%20%20%20%20%20value%20%3D%20Math%2Eround%28value%29%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20for%20%28j%3D0%3B%20j%3Centries%2Elength%3B%20j%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20entry%20%3D%20entries%5Bj%5D%3B%0A%20%20%20%20%20%20%20%20newprop%20%3D%20properties%5Bj%5D%3B%0A%20%20%20%20%20%20%20%20newid%20%3D%20objids%5Bj%5D%3B%0A%0A%20%20%20%20%20%20%20%20if%20%28newprop%20%21%3D%3D%20property%20%7C%7C%20newid%20%21%3D%20objid%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20property%20%21%3D%3D%20%22undefined%22%29%0A%20%20%20%20%20%20%20%20%20%20%20%20putPropvals%28propvals%29%3B%0A%20%20%20%20%20%20%20%20%20%20property%20%3D%20newprop%3B%0A%20%20%20%20%20%20%20%20%20%20objid%20%3D%20newid%3B%0A%20%20%20%20%20%20%20%20%20%20obj%20%3D%20this%2EgetObj%28objid%29%3B%0A%20%20%20%20%20%20%20%20%20%20propvals%20%3D%20getPropvals%28%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20if%20%28control%2Einterp%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20v1%20%3D%20values%5Bncol%2A%28i%2D1%29%20%2B%20j%5D%3B%0A%20%20%20%20%20%20%20%20%20%20v2%20%3D%20values%5Bncol%2Ai%20%2B%20j%5D%3B%0A%20%20%20%20%20%20%20%20%20%20this%2EsetElement%28propvals%2C%20entry%2C%20p%2Av1%20%2B%20%281%2Dp%29%2Av2%29%3B%0A%20%20%20%20%20%20%20%20%7D%20else%20if%20%28%21direct%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20this%2EsetElement%28propvals%2C%20entry%2C%20values%5Bncol%2Avalue%20%2B%20j%5D%29%3B%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20this%2EsetElement%28propvals%2C%20entry%2C%20value%5Bj%5D%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20putPropvals%28propvals%29%3B%0A%0A%20%20%20%20%20%20needsBinding%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20for%20%28j%3D0%3B%20j%20%3C%20entries%2Elength%3B%20j%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20if%20%28properties%5Bj%5D%20%3D%3D%3D%20%22values%22%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20needsBinding%2EindexOf%28objids%5Bj%5D%29%20%3D%3D%3D%20%2D1%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20needsBinding%2Epush%28objids%5Bj%5D%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20for%20%28j%3D0%3B%20j%20%3C%20needsBinding%2Elength%3B%20j%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20gl%20%3D%20this%2Egl%20%7C%7C%20this%2EinitGL%28%29%3B%0A%20%20%20%20%20%20%20%20obj%20%3D%20this%2EgetObj%28needsBinding%5Bj%5D%29%3B%0A%20%20%20%20%20%20%20%20gl%2EbindBuffer%28gl%2EARRAY%5FBUFFER%2C%20obj%2Ebuf%29%3B%0A%20%20%20%20%20%20%20%20gl%2EbufferData%28gl%2EARRAY%5FBUFFER%2C%20obj%2Evalues%2C%20gl%2ESTATIC%5FDRAW%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Change%20the%20requested%20vertices%0A%20%20%20%20%20%2A%20%40param%20%7B%20Object%20%7D%20el%20%2D%20Element%20of%20the%20control%3B%20not%20used%2E%0A%20%20%20%20%20%2A%20%40param%20%7B%20Object%20%7D%20control%20%2D%20The%20vertext%20setter%20control%20data%2E%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EvertexSetter%20%3D%20function%28el%2C%20control%29%20%20%7B%0A%20%20%20%20%20%20var%20svals%20%3D%20%5B%5D%2Econcat%28control%2Eparam%29%2C%0A%20%20%20%20%20%20%20%20%20%20j%2C%20k%2C%20p%2C%20a%2C%20propvals%2C%20stride%2C%20ofs%2C%20obj%2C%20entry%2C%0A%20%20%20%20%20%20%20%20%20%20attrib%2C%0A%20%20%20%20%20%20%20%20%20%20ofss%20%20%20%20%3D%20%7Bx%3A%22vofs%22%2C%20y%3A%22vofs%22%2C%20z%3A%22vofs%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20red%3A%22cofs%22%2C%20green%3A%22cofs%22%2C%20blue%3A%22cofs%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20alpha%3A%22cofs%22%2C%20radii%3A%22radofs%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20nx%3A%22nofs%22%2C%20ny%3A%22nofs%22%2C%20nz%3A%22nofs%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ox%3A%22oofs%22%2C%20oy%3A%22oofs%22%2C%20oz%3A%22oofs%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ts%3A%22tofs%22%2C%20tt%3A%22tofs%22%7D%2C%0A%20%20%20%20%20%20%20%20%20%20pos%20%20%20%20%20%3D%20%7Bx%3A0%2C%20y%3A1%2C%20z%3A2%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20red%3A0%2C%20green%3A1%2C%20blue%3A2%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20alpha%3A3%2Cradii%3A0%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20nx%3A0%2C%20ny%3A1%2C%20nz%3A2%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ox%3A0%2C%20oy%3A1%2C%20oz%3A2%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ts%3A0%2C%20tt%3A1%7D%2C%0A%20%20%20%20%20%20%20%20values%20%3D%20control%2Evalues%2C%0A%20%20%20%20%20%20%20%20direct%20%3D%20values%20%3D%3D%3D%20null%2C%0A%20%20%20%20%20%20%20%20ncol%2C%0A%20%20%20%20%20%20%20%20interp%20%3D%20control%2Einterp%2C%0A%20%20%20%20%20%20%20%20vertices%20%3D%20%5B%5D%2Econcat%28control%2Evertices%29%2C%0A%20%20%20%20%20%20%20%20attributes%20%3D%20%5B%5D%2Econcat%28control%2Eattributes%29%2C%0A%20%20%20%20%20%20%20%20value%20%3D%20control%2Evalue%2C%20newval%2C%20aliases%2C%20alias%3B%0A%0A%20%20%20%20%20%20ncol%20%3D%20Math%2Emax%28vertices%2Elength%2C%20attributes%2Elength%29%3B%0A%0A%20%20%20%20%20%20if%20%28%21ncol%29%0A%20%20%20%20%20%20%20%20return%3B%0A%0A%20%20%20%20%20%20vertices%20%3D%20this%2ErepeatToLen%28vertices%2C%20ncol%29%3B%0A%20%20%20%20%20%20attributes%20%3D%20this%2ErepeatToLen%28attributes%2C%20ncol%29%3B%0A%0A%20%20%20%20%20%20if%20%28direct%29%0A%20%20%20%20%20%20%20%20interp%20%3D%20false%3B%0A%0A%20%20%20%20%20%20%2F%2A%20JSON%20doesn%27t%20pass%20Infinity%20%2A%2F%0A%20%20%20%20%20%20svals%5B0%5D%20%3D%20%2DInfinity%3B%0A%20%20%20%20%20%20svals%5Bsvals%2Elength%20%2D%201%5D%20%3D%20Infinity%3B%0A%0A%20%20%20%20%20%20for%20%28j%20%3D%201%3B%20j%20%3C%20svals%2Elength%3B%20j%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20if%20%28value%20%3C%3D%20svals%5Bj%5D%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20if%20%28interp%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28svals%5Bj%5D%20%3D%3D%3D%20Infinity%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20p%20%3D%201%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20p%20%3D%20%28svals%5Bj%5D%20%2D%20value%29%2F%28svals%5Bj%5D%20%2D%20svals%5Bj%2D1%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28svals%5Bj%5D%20%2D%20value%20%3E%20value%20%2D%20svals%5Bj%2D1%5D%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20j%20%3D%20j%20%2D%201%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20break%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20obj%20%3D%20this%2EgetObj%28control%2Eobjid%29%3B%0A%20%20%20%20%20%20%2F%2F%20First%2C%20make%20sure%20color%20attributes%20vary%20in%20original%0A%20%20%20%20%20%20if%20%28typeof%20obj%2EvOffsets%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%09varies%20%3D%20true%3B%0A%20%20%20%20%20%20%20%20for%20%28k%20%3D%200%3B%20k%20%3C%20ncol%3B%20k%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20attrib%20%3D%20attributes%5Bk%5D%3B%0A%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20attrib%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20ofs%20%3D%20obj%2EvOffsets%5Bofss%5Battrib%5D%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28ofs%20%3C%200%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20switch%28attrib%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%09case%20%22alpha%22%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%09case%20%22red%22%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%09case%20%22green%22%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%09case%20%22blue%22%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%09%20%20obj%2Ecolors%20%3D%20%5Bobj%2Ecolors%5B0%5D%2C%20obj%2Ecolors%5B0%5D%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%09%20%20break%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20varies%20%3D%20false%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20if%20%28%21varies%29%0A%20%20%20%20%20%20%20%20%20%20this%2EinitObj%28control%2Eobjid%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20propvals%20%3D%20obj%2Evalues%3B%0A%20%20%20%20%20%20aliases%20%3D%20obj%2Ealias%3B%0A%20%20%20%20%20%20if%20%28typeof%20aliases%20%3D%3D%3D%20%22undefined%22%29%0A%20%20%20%20%20%20%20%20aliases%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20for%20%28k%3D0%3B%20k%3Cncol%3B%20k%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20if%20%28direct%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20newval%20%3D%20value%3B%0A%20%20%20%20%20%20%20%20%7D%20else%20if%20%28interp%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20newval%20%3D%20p%2Avalues%5Bj%2D1%5D%5Bk%5D%20%2B%20%281%2Dp%29%2Avalues%5Bj%5D%5Bk%5D%3B%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20newval%20%3D%20values%5Bj%5D%5Bk%5D%3B%0A%20%20%20%20%20%20%20%20%7D%20%20%20%20%20%20%09%0A%20%20%20%20%20%20%20%20attrib%20%3D%20attributes%5Bk%5D%3B%0A%20%20%20%20%20%20%20%20vertex%20%3D%20vertices%5Bk%5D%3B%0A%20%20%20%20%20%20%20%20alias%20%3D%20aliases%5Bvertex%5D%3B%0A%20%20%20%20%20%20%20%20if%20%28obj%2Etype%20%3D%3D%3D%20%22planes%22%20%7C%7C%20obj%2Etype%20%3D%3D%3D%20%22clipplanes%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20ofs%20%3D%20%5B%22nx%22%2C%20%22ny%22%2C%20%22nz%22%2C%20%22offset%22%5D%2EindexOf%28attrib%29%3B%0A%20%20%20%20%20%20%20%20%20%20if%20%28ofs%20%3E%3D%200%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28ofs%20%3C%203%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28obj%2Enormals%5Bvertex%5D%5Bofs%5D%20%21%3D%20newval%29%20%7B%20%20%2F%2F%20Assume%20no%20aliases%20here%2E%2E%2E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%09obj%2Enormals%5Bvertex%5D%5Bofs%5D%20%3D%20newval%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%09obj%2Einitialized%20%3D%20false%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28obj%2Eoffsets%5Bvertex%5D%5B0%5D%20%21%3D%20newval%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%09obj%2Eoffsets%5Bvertex%5D%5B0%5D%20%3D%20newval%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%09obj%2Einitialized%20%3D%20false%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20continue%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%2F%2F%20Not%20a%20plane%20setting%2E%2E%2E%0A%20%20%20%20%20%20%20%20ofs%20%3D%20obj%2EvOffsets%5Bofss%5Battrib%5D%5D%3B%0A%20%20%20%20%20%20%20%20if%20%28ofs%20%3C%200%29%0A%20%20%20%20%20%20%20%20%20%20this%2EalertOnce%28%22Attribute%20%27%22%2Battrib%2B%22%27%20not%20found%20in%20object%20%22%2Bcontrol%2Eobjid%29%3B%0A%20%20%20%20%20%20%20%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20stride%20%3D%20obj%2EvOffsets%2Estride%3B%0A%20%20%20%20%20%20%20%20%20%20ofs%20%3D%20ofs%20%2B%20pos%5Battrib%5D%3B%0A%20%20%20%20%20%20%20%20%20%20entry%20%3D%20vertex%2Astride%20%2B%20ofs%3B%0A%20%20%20%20%20%20%20%20%20%20propvals%5Bentry%5D%20%3D%20newval%3B%0A%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20alias%20%21%3D%3D%20%22undefined%22%29%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20%28a%20%3D%200%3B%20a%20%3C%20alias%2Elength%3B%20a%2B%2B%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20propvals%5Balias%5Ba%5D%2Astride%20%2B%20ofs%5D%20%3D%20newval%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20if%20%28typeof%20obj%2Ebuf%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%20%20var%20gl%20%3D%20this%2Egl%20%7C%7C%20this%2EinitGL%28%29%3B%0A%20%20%20%20%20%20%20%20gl%2EbindBuffer%28gl%2EARRAY%5FBUFFER%2C%20obj%2Ebuf%29%3B%0A%20%20%20%20%20%20%20%20gl%2EbufferData%28gl%2EARRAY%5FBUFFER%2C%20propvals%2C%20gl%2ESTATIC%5FDRAW%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Change%20the%20requested%20vertex%20properties%20by%20age%0A%20%20%20%20%20%2A%20%40param%20%7B%20Object%20%7D%20el%20%2D%20Element%20of%20the%20control%3B%20not%20used%2E%0A%20%20%20%20%20%2A%20%40param%20%7B%20Object%20%7D%20control%20%2D%20The%20age%20setter%20control%20data%2E%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EageSetter%20%3D%20function%28el%2C%20control%29%20%7B%0A%20%20%20%20%20%20var%20objids%20%3D%20%5B%5D%2Econcat%28control%2Eobjids%29%2C%0A%20%20%20%20%20%20%20%20%20%20nobjs%20%3D%20objids%2Elength%2C%0A%20%20%20%20%20%20%20%20%20%20time%20%3D%20control%2Evalue%2C%0A%20%20%20%20%20%20%20%20%20%20births%20%3D%20%5B%5D%2Econcat%28control%2Ebirths%29%2C%0A%20%20%20%20%20%20%20%20%20%20ages%20%3D%20%5B%5D%2Econcat%28control%2Eages%29%2C%0A%20%20%20%20%20%20%20%20%20%20steps%20%3D%20births%2Elength%2C%0A%20%20%20%20%20%20%20%20%20%20j%20%3D%20Array%28steps%29%2C%0A%20%20%20%20%20%20%20%20%20%20p%20%3D%20Array%28steps%29%2C%0A%20%20%20%20%20%20%20%20%20%20i%2C%20k%2C%20age%2C%20j0%2C%20propvals%2C%20stride%2C%20ofs%2C%20objid%2C%20obj%2C%0A%20%20%20%20%20%20%20%20%20%20attrib%2C%20dim%2C%20varies%2C%20alias%2C%20aliases%2C%20a%2C%20d%2C%0A%20%20%20%20%20%20%20%20%20%20attribs%20%3D%20%5B%22colors%22%2C%20%22alpha%22%2C%20%22radii%22%2C%20%22vertices%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22normals%22%2C%20%22origins%22%2C%20%22texcoords%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22x%22%2C%20%22y%22%2C%20%22z%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22red%22%2C%20%22green%22%2C%20%22blue%22%5D%2C%0A%20%20%20%20%20%20%20%20%20%20ofss%20%20%20%20%3D%20%5B%22cofs%22%2C%20%22cofs%22%2C%20%22radofs%22%2C%20%22vofs%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22nofs%22%2C%20%22oofs%22%2C%20%22tofs%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22vofs%22%2C%20%22vofs%22%2C%20%22vofs%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22cofs%22%2C%20%22cofs%22%2C%20%22cofs%22%5D%2C%0A%20%20%20%20%20%20%20%20%20%20dims%20%20%20%20%3D%20%5B3%2C1%2C1%2C3%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%203%2C2%2C2%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%201%2C1%2C1%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%201%2C1%2C1%5D%2C%0A%20%20%20%20%20%20%20%20%20%20pos%20%20%20%20%20%3D%20%5B0%2C3%2C0%2C0%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%200%2C0%2C0%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%200%2C1%2C2%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%200%2C1%2C2%5D%3B%0A%20%20%20%20%20%20%2F%2A%20Infinity%20doesn%27t%20make%20it%20through%20JSON%20%2A%2F%0A%20%20%20%20%20%20ages%5B0%5D%20%3D%20%2DInfinity%3B%0A%20%20%20%20%20%20ages%5Bages%2Elength%2D1%5D%20%3D%20Infinity%3B%0A%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20steps%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20if%20%28births%5Bi%5D%20%21%3D%3D%20null%29%20%7B%20%20%2F%2F%20NA%20in%20R%20becomes%20null%0A%20%20%20%20%20%20%20%20%20%20age%20%3D%20time%20%2D%20births%5Bi%5D%3B%0A%20%20%20%20%20%20%20%20%20%20for%20%28j0%20%3D%201%3B%20age%20%3E%20ages%5Bj0%5D%3B%20j0%2B%2B%29%3B%0A%20%20%20%20%20%20%20%20%20%20if%20%28ages%5Bj0%5D%20%3D%3D%20Infinity%29%0A%20%20%20%20%20%20%20%20%20%20%20%20p%5Bi%5D%20%3D%201%3B%0A%20%20%20%20%20%20%20%20%20%20else%20if%20%28ages%5Bj0%5D%20%3E%20ages%5Bj0%2D1%5D%29%0A%20%20%20%20%20%20%20%20%20%20%20%20p%5Bi%5D%20%3D%20%28ages%5Bj0%5D%20%2D%20age%29%2F%28ages%5Bj0%5D%20%2D%20ages%5Bj0%2D1%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20p%5Bi%5D%20%3D%200%3B%0A%20%20%20%20%20%20%20%20%20%20j%5Bi%5D%20%3D%20j0%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%2F%2F%20First%2C%20make%20sure%20color%20attributes%20vary%20in%20original%0A%20%20%20%20%20%20for%20%28l%20%3D%200%3B%20l%20%3C%20nobjs%3B%20l%2B%2B%29%20%7B%0A%20%20%20%20%20%20%09objid%20%3D%20objids%5Bl%5D%3B%0A%20%20%20%20%20%20%09obj%20%3D%20this%2EgetObj%28objid%29%3B%0A%20%20%20%20%20%20%09varies%20%3D%20true%3B%0A%20%20%20%20%20%20%20%20if%20%28typeof%20obj%2EvOffsets%20%3D%3D%3D%20%22undefined%22%29%0A%20%20%20%20%20%20%20%20%20%20continue%3B%0A%20%20%20%20%20%20%20%20for%20%28k%20%3D%200%3B%20k%20%3C%20attribs%2Elength%3B%20k%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20attrib%20%3D%20control%5Battribs%5Bk%5D%5D%3B%0A%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20attrib%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20ofs%20%3D%20obj%2EvOffsets%5Bofss%5Bk%5D%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28ofs%20%3C%200%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20switch%28attribs%5Bk%5D%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%09case%20%22colors%22%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%09case%20%22alpha%22%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%09case%20%22red%22%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%09case%20%22green%22%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%09case%20%22blue%22%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%09%20%20obj%2Ecolors%20%3D%20%5Bobj%2Ecolors%5B0%5D%2C%20obj%2Ecolors%5B0%5D%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%09%20%20break%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20varies%20%3D%20false%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20if%20%28%21varies%29%0A%20%20%20%20%20%20%20%20%20%20this%2EinitObj%28objid%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20for%20%28l%20%3D%200%3B%20l%20%3C%20nobjs%3B%20l%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20objid%20%3D%20objids%5Bl%5D%3B%0A%20%20%20%20%20%20%20%20obj%20%3D%20this%2EgetObj%28objid%29%3B%0A%20%20%20%20%20%20%20%20if%20%28typeof%20obj%2EvOffsets%20%3D%3D%3D%20%22undefined%22%29%0A%20%20%20%20%20%20%20%20%20%20continue%3B%0A%20%20%20%20%20%20%20%20aliases%20%3D%20obj%2Ealias%3B%0A%20%20%20%20%20%20%20%20if%20%28typeof%20aliases%20%3D%3D%3D%20%22undefined%22%29%0A%20%20%20%20%20%20%20%20%20%20aliases%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20%20%20propvals%20%3D%20obj%2Evalues%3B%0A%20%20%20%20%20%20%20%20stride%20%3D%20obj%2EvOffsets%2Estride%3B%0A%20%20%20%20%20%20%20%20for%20%28k%20%3D%200%3B%20k%20%3C%20attribs%2Elength%3B%20k%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20attrib%20%3D%20control%5Battribs%5Bk%5D%5D%3B%0A%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20attrib%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20ofs%20%3D%20obj%2EvOffsets%5Bofss%5Bk%5D%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28ofs%20%3E%3D%200%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20dim%20%3D%20dims%5Bk%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20ofs%20%3D%20ofs%20%2B%20pos%5Bk%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20steps%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%09alias%20%3D%20aliases%5Bi%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28births%5Bi%5D%20%21%3D%3D%20null%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20%28d%3D0%3B%20d%20%3C%20dim%3B%20d%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20propvals%5Bi%2Astride%20%2B%20ofs%20%2B%20d%5D%20%3D%20p%5Bi%5D%2Aattrib%5Bdim%2A%28j%5Bi%5D%2D1%29%20%2B%20d%5D%20%2B%20%281%2Dp%5Bi%5D%29%2Aattrib%5Bdim%2Aj%5Bi%5D%20%2B%20d%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20alias%20%21%3D%3D%20%22undefined%22%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20%28a%3D0%3B%20a%20%3C%20alias%2Elength%3B%20a%2B%2B%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20propvals%5Balias%5Ba%5D%2Astride%20%2B%20ofs%20%2B%20d%5D%20%3D%20propvals%5Bi%2Astride%20%2B%20ofs%20%2B%20d%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20this%2EalertOnce%28%22%5C%27%22%2Battribs%5Bk%5D%2B%22%5C%27%20property%20not%20found%20in%20object%20%22%2Bobjid%29%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20obj%2Evalues%20%3D%20propvals%3B%0A%20%20%20%20%20%20%20%20if%20%28typeof%20obj%2Ebuf%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20gl%20%3D%20this%2Egl%20%7C%7C%20this%2EinitGL%28%29%3B%0A%20%20%20%20%20%20%20%20%20%20gl%2EbindBuffer%28gl%2EARRAY%5FBUFFER%2C%20obj%2Ebuf%29%3B%0A%20%20%20%20%20%20%20%20%20%20gl%2EbufferData%28gl%2EARRAY%5FBUFFER%2C%20obj%2Evalues%2C%20gl%2ESTATIC%5FDRAW%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Bridge%20to%20old%20style%20control%0A%20%20%20%20%20%2A%20%40param%20%7B%20Object%20%7D%20el%20%2D%20Element%20of%20the%20control%3B%20not%20used%2E%0A%20%20%20%20%20%2A%20%40param%20%7B%20Object%20%7D%20control%20%2D%20The%20bridge%20control%20data%2E%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EoldBridge%20%3D%20function%28el%2C%20control%29%20%7B%0A%20%20%20%20%20%20var%20attrname%2C%20global%20%3D%20window%5Bcontrol%2Eprefix%20%2B%20%22rgl%22%5D%3B%0A%20%20%20%20%20%20if%20%28typeof%20global%20%21%3D%3D%20%22undefined%22%29%0A%20%20%20%20%20%20%20%20for%20%28attrname%20in%20global%29%0A%20%20%20%20%20%20%20%20%20%20this%5Battrname%5D%20%3D%20global%5Battrname%5D%3B%0A%20%20%20%20%20%20window%5Bcontrol%2Eprefix%20%2B%20%22rgl%22%5D%20%3D%20this%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Set%20up%20a%20player%20control%0A%20%20%20%20%20%2A%20%40param%20%7B%20Object%20%7D%20el%20%2D%20The%20player%20control%20element%0A%20%20%20%20%20%2A%20%40param%20%7B%20Object%20%7D%20control%20%2D%20The%20player%20data%2E%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EPlayer%20%3D%20function%28el%2C%20control%29%20%7B%0A%20%20%20%20%20%20var%0A%20%20%20%20%20%20%20%20self%20%3D%20this%2C%0A%20%20%20%20%20%20%20%20components%20%3D%20%5B%5D%2Econcat%28control%2Ecomponents%29%2C%0A%20%20%20%20%20%20%20%20buttonLabels%20%3D%20%5B%5D%2Econcat%28control%2EbuttonLabels%29%2C%0A%0A%20%20%20%20%20%20%20%20Tick%20%3D%20function%28%29%20%7B%20%2F%2A%20%22this%22%20will%20be%20a%20timer%20%2A%2F%0A%20%20%20%20%20%20%20%20%20%20var%20i%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20nominal%20%3D%20this%2Evalue%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20slider%20%3D%20this%2ESlider%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20labels%20%3D%20this%2EoutputLabels%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20output%20%3D%20this%2EOutput%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20step%3B%0A%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20slider%20%21%3D%3D%20%22undefined%22%20%26%26%20nominal%20%21%3D%20slider%2Evalue%29%0A%20%20%20%20%20%20%20%20%20%20%20%20slider%2Evalue%20%3D%20nominal%3B%0A%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20output%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20step%20%3D%20Math%2Eround%28%28nominal%20%2D%20output%2EsliderMin%29%2Foutput%2EsliderStep%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28labels%20%21%3D%3D%20null%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20output%2EinnerHTML%20%3D%20labels%5Bstep%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20step%20%3D%20step%2Aoutput%2EsliderStep%20%2B%20output%2EsliderMin%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20output%2EinnerHTML%20%3D%20step%2EtoPrecision%28output%2EoutputPrecision%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20for%20%28i%3D0%3B%20i%20%3C%20this%2Eactions%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Eactions%5Bi%5D%2Evalue%20%3D%20nominal%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20self%2EapplyControls%28el%2C%20this%2Eactions%2C%20false%29%3B%0A%20%20%20%20%20%20%20%20%20%20self%2EdrawScene%28%29%3B%0A%20%20%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20%20%20OnSliderInput%20%3D%20function%28%29%20%7B%20%2F%2A%20%22this%22%20will%20be%20the%20slider%20%2A%2F%0A%20%20%20%20%20%20%20%20%20%20this%2Ergltimer%2Evalue%20%3D%20Number%28this%2Evalue%29%3B%0A%20%20%20%20%20%20%20%20%20%20this%2Ergltimer%2ETick%28%29%3B%0A%20%20%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20%20%20addSlider%20%3D%20function%28min%2C%20max%2C%20step%2C%20value%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20var%20slider%20%3D%20document%2EcreateElement%28%22input%22%29%3B%0A%20%20%20%20%20%20%20%20%20%20slider%2Etype%20%3D%20%22range%22%3B%0A%20%20%20%20%20%20%20%20%20%20slider%2Emin%20%3D%20min%3B%0A%20%20%20%20%20%20%20%20%20%20slider%2Emax%20%3D%20max%3B%0A%20%20%20%20%20%20%20%20%20%20slider%2Estep%20%3D%20step%3B%0A%20%20%20%20%20%20%20%20%20%20slider%2Evalue%20%3D%20value%3B%0A%20%20%20%20%20%20%20%20%20%20slider%2Eoninput%20%3D%20OnSliderInput%3B%0A%20%20%20%20%20%20%20%20%20%20slider%2EsliderActions%20%3D%20control%2Eactions%3B%0A%20%20%20%20%20%20%20%20%20%20slider%2EsliderScene%20%3D%20this%3B%0A%20%20%20%20%20%20%20%20%20%20slider%2EclassName%20%3D%20%22rgl%2Dslider%22%3B%0A%20%20%20%20%20%20%20%20%20%20slider%2Eid%20%3D%20el%2Eid%20%2B%20%22%2Dslider%22%3B%0A%20%20%20%20%20%20%20%20%20%20el%2Ergltimer%2ESlider%20%3D%20slider%3B%0A%20%20%20%20%20%20%20%20%20%20slider%2Ergltimer%20%3D%20el%2Ergltimer%3B%0A%20%20%20%20%20%20%20%20%20%20el%2EappendChild%28slider%29%3B%0A%20%20%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20%20%20addLabel%20%3D%20function%28labels%2C%20min%2C%20step%2C%20precision%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20var%20output%20%3D%20document%2EcreateElement%28%22output%22%29%3B%0A%20%20%20%20%20%20%20%20%20%20output%2EsliderMin%20%3D%20min%3B%0A%20%20%20%20%20%20%20%20%20%20output%2EsliderStep%20%3D%20step%3B%0A%20%20%20%20%20%20%20%20%20%20output%2EoutputPrecision%20%3D%20precision%3B%0A%20%20%20%20%20%20%20%20%20%20output%2EclassName%20%3D%20%22rgl%2Dlabel%22%3B%0A%20%20%20%20%20%20%20%20%20%20output%2Eid%20%3D%20el%2Eid%20%2B%20%22%2Dlabel%22%3B%0A%20%20%20%20%20%20%20%20%20%20el%2Ergltimer%2EOutput%20%3D%20output%3B%0A%20%20%20%20%20%20%20%20%20%20el%2Ergltimer%2EoutputLabels%20%3D%20labels%3B%0A%20%20%20%20%20%20%20%20%20%20el%2EappendChild%28output%29%3B%0A%20%20%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20%20%20addButton%20%3D%20function%28which%2C%20label%2C%20active%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20var%20button%20%3D%20document%2EcreateElement%28%22input%22%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20onclicks%20%3D%20%7BReverse%3A%20function%28%29%20%7B%20this%2Ergltimer%2Ereverse%28%29%3B%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Play%3A%20function%28%29%20%7B%20this%2Ergltimer%2Eplay%28%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this%2Evalue%20%3D%20this%2Ergltimer%2Eenabled%20%3F%20this%2EinactiveValue%20%3A%20this%2EactiveValue%3B%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Slower%3A%20function%28%29%20%7B%20this%2Ergltimer%2Eslower%28%29%3B%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Faster%3A%20function%28%29%20%7B%20this%2Ergltimer%2Efaster%28%29%3B%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Reset%3A%20function%28%29%20%7B%20this%2Ergltimer%2Ereset%28%29%3B%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%09%20%20%20Step%3A%20%20function%28%29%20%7B%20this%2Ergltimer%2Estep%28%29%3B%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%20%20%20%20%20%20button%2Ergltimer%20%3D%20el%2Ergltimer%3B%0A%20%20%20%20%20%20%20%20%20%20button%2Etype%20%3D%20%22button%22%3B%0A%20%20%20%20%20%20%20%20%20%20button%2Evalue%20%3D%20label%3B%0A%20%20%20%20%20%20%20%20%20%20button%2EactiveValue%20%3D%20label%3B%0A%20%20%20%20%20%20%20%20%20%20button%2EinactiveValue%20%3D%20active%3B%0A%20%20%20%20%20%20%20%20%20%20if%20%28which%20%3D%3D%3D%20%22Play%22%29%0A%20%20%20%20%20%20%20%20%20%20%20%20button%2Ergltimer%2EPlayButton%20%3D%20button%3B%0A%20%20%20%20%20%20%20%20%20%20button%2Eonclick%20%3D%20onclicks%5Bwhich%5D%3B%0A%20%20%20%20%20%20%20%20%20%20button%2EclassName%20%3D%20%22rgl%2Dbutton%22%3B%0A%20%20%20%20%20%20%20%20%20%20button%2Eid%20%3D%20el%2Eid%20%2B%20%22%2D%22%20%2B%20which%3B%0A%20%20%20%20%20%20%20%20%20%20el%2EappendChild%28button%29%3B%0A%20%20%20%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%20%20%20%20if%20%28typeof%20control%2Ereinit%20%21%3D%3D%20%22undefined%22%20%26%26%20control%2Ereinit%20%21%3D%3D%20null%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20control%2Eactions%2Ereinit%20%3D%20control%2Ereinit%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20el%2Ergltimer%20%3D%20new%20rgltimerClass%28Tick%2C%20control%2Estart%2C%20control%2Einterval%2C%20control%2Estop%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20control%2Estep%2C%20control%2Evalue%2C%20control%2Erate%2C%20control%2Eloop%2C%20control%2Eactions%29%3B%0A%20%20%20%20%20%20%20%20for%20%28var%20i%3D0%3B%20i%20%3C%20components%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20switch%28components%5Bi%5D%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20case%20%22Slider%22%3A%20addSlider%28control%2Estart%2C%20control%2Estop%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20control%2Estep%2C%20control%2Evalue%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20break%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20case%20%22Label%22%3A%20addLabel%28control%2Elabels%2C%20control%2Estart%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20control%2Estep%2C%20control%2Eprecision%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20break%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20default%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20addButton%28components%5Bi%5D%2C%20buttonLabels%5Bi%5D%2C%20control%2Epause%29%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20el%2Ergltimer%2ETick%28%29%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Apply%20all%20registered%20controls%0A%20%20%20%20%20%2A%20%40param%20%7B%20Object%20%7D%20el%20%2D%20DOM%20element%20of%20the%20control%0A%20%20%20%20%20%2A%20%40param%20%7B%20Object%20%7D%20x%20%2D%20List%20of%20actions%20to%20apply%0A%20%20%20%20%20%2A%20%40param%20%7B%20boolean%20%7D%20%5Bdraw%3Dtrue%5D%20%2D%20Whether%20to%20redraw%20after%20applying%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EapplyControls%20%3D%20function%28el%2C%20x%2C%20draw%29%20%7B%0A%20%20%20%20%20%20var%20self%20%3D%20this%2C%20reinit%20%3D%20x%2Ereinit%2C%20i%2C%20control%2C%20type%3B%0A%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20x%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20control%20%3D%20x%5Bi%5D%3B%0A%20%20%20%20%20%20%20%20type%20%3D%20control%2Etype%3B%0A%20%20%20%20%20%20%20%20self%5Btype%5D%28el%2C%20control%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20if%20%28typeof%20reinit%20%21%3D%3D%20%22undefined%22%20%26%26%20reinit%20%21%3D%3D%20null%29%20%7B%0A%20%20%20%20%20%20%20%20reinit%20%3D%20%5B%5D%2Econcat%28reinit%29%3B%0A%20%20%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20reinit%2Elength%3B%20i%2B%2B%29%0A%20%20%20%20%20%20%20%20%20%20self%2EgetObj%28reinit%5Bi%5D%29%2Einitialized%20%3D%20false%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20if%20%28typeof%20draw%20%3D%3D%3D%20%22undefined%22%20%7C%7C%20draw%29%0A%20%20%20%20%20%20%20%20self%2EdrawScene%28%29%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F%2A%2A%0A%20%20%20%20%20%2A%20Handler%20for%20scene%20change%0A%20%20%20%20%20%2A%20%40param%20%7B%20Object%20%7D%20message%20%2D%20What%20sort%20of%20scene%20change%20to%20do%3F%0A%20%20%20%20%20%2A%2F%0A%20%20%20%20rglwidgetClass%2Eprototype%2EsceneChangeHandler%20%3D%20function%28message%29%20%7B%0A%20%20%20%20%20%20var%20self%20%3D%20document%2EgetElementById%28message%2EelementId%29%2Erglinstance%2C%0A%20%20%20%20%20%20%20%20%20%20objs%20%3D%20message%2Eobjects%2C%20mat%20%3D%20message%2Ematerial%2C%0A%20%20%20%20%20%20%20%20%20%20root%20%3D%20message%2ErootSubscene%2C%0A%20%20%20%20%20%20%20%20%20%20initSubs%20%3D%20message%2EinitSubscenes%2C%0A%20%20%20%20%20%20%20%20%20%20redraw%20%3D%20message%2EredrawScene%2C%0A%20%20%20%20%20%20%20%20%20%20skipRedraw%20%3D%20message%2EskipRedraw%2C%0A%20%20%20%20%20%20%20%20%20%20deletes%2C%20subs%2C%20allsubs%20%3D%20%5B%5D%2C%20i%2Cj%3B%0A%20%20%20%20%20%20if%20%28typeof%20message%2Edelete%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%20%20deletes%20%3D%20%5B%5D%2Econcat%28message%2Edelete%29%3B%0A%20%20%20%20%20%20%20%20if%20%28typeof%20message%2EdelfromSubscenes%20%21%3D%3D%20%22undefined%22%29%0A%20%20%20%20%20%20%20%20%20%20subs%20%3D%20%5B%5D%2Econcat%28message%2EdelfromSubscenes%29%3B%0A%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20subs%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20deletes%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20for%20%28j%20%3D%200%3B%20j%20%3C%20subs%2Elength%3B%20j%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20self%2EdelFromSubscene%28deletes%5Bi%5D%2C%20subs%5Bj%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20delete%20self%2Escene%2Eobjects%5Bdeletes%5Bi%5D%5D%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20if%20%28typeof%20objs%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%20%20Object%2Ekeys%28objs%29%2EforEach%28function%28key%29%7B%0A%20%20%20%20%20%20%20%20%20%20key%20%3D%20parseInt%28key%2C%2010%29%3B%0A%20%20%20%20%20%20%20%20%20%20self%2Escene%2Eobjects%5Bkey%5D%20%3D%20objs%5Bkey%5D%3B%0A%20%20%20%20%20%20%20%20%20%20self%2EinitObj%28key%29%3B%0A%20%20%20%20%20%20%20%20%20%20var%20obj%20%3D%20self%2EgetObj%28key%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20subs%20%3D%20%5B%5D%2Econcat%28obj%2EinSubscenes%29%2C%20k%3B%0A%20%20%20%20%20%20%20%20%20%20allsubs%20%3D%20allsubs%2Econcat%28subs%29%3B%0A%20%20%20%20%20%20%20%20%20%20for%20%28k%20%3D%200%3B%20k%20%3C%20subs%2Elength%3B%20k%2B%2B%29%0A%20%20%20%20%20%20%20%20%20%20%20%20self%2EaddToSubscene%28key%2C%20subs%5Bk%5D%29%3B%0A%20%20%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20if%20%28typeof%20mat%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%20%20self%2Escene%2Ematerial%20%3D%20mat%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20if%20%28typeof%20root%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%20%20self%2Escene%2ErootSubscene%20%3D%20root%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20if%20%28typeof%20initSubs%20%21%3D%3D%20%22undefined%22%29%0A%20%20%20%20%20%20%20%20allsubs%20%3D%20allsubs%2Econcat%28initSubs%29%3B%0A%20%20%20%20%20%20allsubs%20%3D%20self%2Eunique%28allsubs%29%3B%0A%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20allsubs%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20self%2EinitSubscene%28allsubs%5Bi%5D%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20if%20%28typeof%20skipRedraw%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%20%20root%20%3D%20self%2EgetObj%28self%2Escene%2ErootSubscene%29%3B%0A%20%20%20%20%20%20%20%20root%2Epar3d%2EskipRedraw%20%3D%20skipRedraw%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20if%20%28redraw%29%0A%20%20%20%20%20%20%20%20self%2EdrawScene%28%29%3B%0A%20%20%20%20%7D%3B%0A%0A%2F%2A%2A%0A%20%2A%20The%20class%20of%20an%20rgl%20timer%20object%0A%20%2A%20%40class%0A%2A%2F%0A%0A%2F%2A%2A%0A%20%2A%20Construct%20an%20rgltimerClass%20object%0A%20%2A%20%40constructor%0A%20%2A%20%40param%20%7B%20function%20%7D%20Tick%20%2D%20action%20when%20timer%20fires%0A%20%2A%20%40param%20%7B%20number%20%7D%20startTime%20%2D%20nominal%20start%20time%20in%20seconds%0A%20%2A%20%40param%20%7B%20number%20%7D%20interval%20%2D%20seconds%20between%20updates%0A%20%2A%20%40param%20%7B%20number%20%7D%20stopTime%20%2D%20nominal%20stop%20time%20in%20seconds%0A%20%2A%20%40param%20%7B%20number%20%7D%20stepSize%20%2D%20nominal%20step%20size%0A%20%2A%20%40param%20%7B%20number%20%7D%20value%20%2D%20current%20nominal%20time%0A%20%2A%20%40param%20%7B%20number%20%7D%20rate%20%2D%20nominal%20units%20per%20second%0A%20%2A%20%40param%20%7B%20string%20%7D%20loop%20%2D%20%22none%22%2C%20%22cycle%22%20or%20%22oscillate%22%0A%20%2A%20%40param%20%7B%20Object%20%7D%20actions%20%2D%20list%20of%20actions%0A%20%2A%2F%0ArgltimerClass%20%3D%20function%28Tick%2C%20startTime%2C%20interval%2C%20stopTime%2C%20stepSize%2C%20value%2C%20rate%2C%20loop%2C%20actions%29%20%7B%0A%20%20this%2Eenabled%20%3D%20false%3B%0A%20%20this%2EtimerId%20%3D%200%3B%0A%20%20%2F%2A%2A%20nominal%20start%20time%20in%20seconds%20%2A%2F%0A%20%20this%2EstartTime%20%3D%20startTime%3B%20%20%20%0A%20%20%2F%2A%2A%20current%20nominal%20time%20%2A%2F%20%20%20%20%20%20%0A%20%20this%2Evalue%20%3D%20value%3B%0A%20%20%2F%2A%2A%20seconds%20between%20updates%20%2A%2F%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20this%2Einterval%20%3D%20interval%3B%0A%20%20%2F%2A%2A%20nominal%20stop%20time%20%2A%2F%20%20%20%20%20%20%20%20%20%20%20%0A%20%20this%2EstopTime%20%3D%20stopTime%3B%0A%20%20%2F%2A%2A%20nominal%20step%20size%20%2A%2F%20%20%20%20%20%20%20%20%20%20%20%0A%20%20this%2EstepSize%20%3D%20stepSize%3B%0A%20%20%2F%2A%2A%20nominal%20units%20per%20second%20%2A%2F%20%20%20%20%20%20%20%20%20%20%20%0A%20%20this%2Erate%20%3D%20rate%3B%0A%20%20%2F%2A%2A%20%22none%22%2C%20%22cycle%22%2C%20or%20%22oscillate%22%20%2A%2F%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20this%2Eloop%20%3D%20loop%3B%0A%20%20%2F%2A%2A%20real%20world%20start%20time%20%2A%2F%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20this%2ErealStart%20%3D%20undefined%3B%0A%20%20%2F%2A%2A%20multiplier%20for%20fast%2Dforward%20or%20reverse%20%2A%2F%20%20%20%20%20%20%20%20%20%0A%20%20this%2Emultiplier%20%3D%201%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20this%2Eactions%20%3D%20actions%3B%0A%20%20this%2ETick%20%3D%20Tick%3B%0A%7D%3B%0A%0A%20%20%2F%2A%2A%0A%20%20%20%2A%20Start%20playing%20timer%20object%0A%20%20%20%2A%2F%0A%20%20rgltimerClass%2Eprototype%2Eplay%20%3D%20function%28%29%20%7B%0A%20%20%20%20if%20%28this%2Eenabled%29%20%7B%0A%20%20%20%20%20%20this%2Eenabled%20%3D%20false%3B%0A%20%20%20%20%20%20window%2EclearInterval%28this%2EtimerId%29%3B%0A%20%20%20%20%20%20this%2EtimerId%20%3D%200%3B%0A%20%20%20%20%20%20return%3B%0A%20%20%20%20%7D%0A%20%20%20%20var%20tick%20%3D%20function%28self%29%20%7B%0A%20%20%20%20%20%20var%20now%20%3D%20new%20Date%28%29%3B%0A%20%20%20%20%20%20self%2Evalue%20%3D%20self%2Emultiplier%2Aself%2Erate%2A%28now%20%2D%20self%2ErealStart%29%2F1000%20%2B%20self%2EstartTime%3B%0A%20%20%20%20%20%20self%2EforceToRange%28%29%3B%0A%20%20%20%20%20%20if%20%28typeof%20self%2ETick%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%20%20self%2ETick%28self%2Evalue%29%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%7D%3B%0A%20%20%20%20this%2ErealStart%20%3D%20new%20Date%28%29%20%2D%201000%2A%28this%2Evalue%20%2D%20this%2EstartTime%29%2Fthis%2Erate%2Fthis%2Emultiplier%3B%0A%20%20%20%20this%2EtimerId%20%3D%20window%2EsetInterval%28tick%2C%201000%2Athis%2Einterval%2C%20this%29%3B%0A%20%20%20%20this%2Eenabled%20%3D%20true%3B%0A%20%20%7D%3B%0A%0A%20%20%2F%2A%2A%0A%20%20%20%2A%20Force%20value%20into%20legal%20range%0A%20%20%20%2A%2F%0A%20%20rgltimerClass%2Eprototype%2EforceToRange%20%3D%20function%28%29%20%7B%0A%20%20%20%20if%20%28this%2Evalue%20%3E%20this%2EstopTime%20%2B%20this%2EstepSize%2F2%20%7C%7C%20this%2Evalue%20%3C%20this%2EstartTime%20%2D%20this%2EstepSize%2F2%29%20%7B%0A%20%20%20%20%20%20if%20%28%21this%2Eloop%29%20%7B%0A%20%20%20%20%20%20%20%20this%2Ereset%28%29%3B%0A%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20var%20cycle%20%3D%20this%2EstopTime%20%2D%20this%2EstartTime%20%2B%20this%2EstepSize%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20newval%20%3D%20%28this%2Evalue%20%2D%20this%2EstartTime%29%20%25%20cycle%20%2B%20this%2EstartTime%3B%0A%20%20%20%20%20%20%20%20if%20%28newval%20%3C%20this%2EstartTime%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20newval%20%2B%3D%20cycle%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20this%2ErealStart%20%2B%3D%20%28this%2Evalue%20%2D%20newval%29%2A1000%2Fthis%2Emultiplier%2Fthis%2Erate%3B%0A%20%20%20%20%20%20%20%20this%2Evalue%20%3D%20newval%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%7D%3B%0A%0A%20%20%2F%2A%2A%0A%20%20%20%2A%20Reset%20to%20start%20values%0A%20%20%20%2A%2F%0A%20%20rgltimerClass%2Eprototype%2Ereset%20%3D%20function%28%29%20%7B%0A%20%20%20%20this%2Evalue%20%3D%20this%2EstartTime%3B%0A%20%20%20%20this%2Enewmultiplier%281%29%3B%0A%20%20%20%20if%20%28typeof%20this%2ETick%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%20%20this%2ETick%28this%2Evalue%29%3B%0A%20%20%20%20%7D%0A%20%20%20%20if%20%28this%2Eenabled%29%0A%20%20%20%20%20%20this%2Eplay%28%29%3B%20%20%2F%2A%20really%20pause%2E%2E%2E%20%2A%2F%0A%20%20%20%20if%20%28typeof%20this%2EPlayButton%20%21%3D%3D%20%22undefined%22%29%0A%20%20%20%20%20%20this%2EPlayButton%2Evalue%20%3D%20%22Play%22%3B%0A%20%20%7D%3B%0A%0A%20%20%2F%2A%2A%0A%20%20%20%2A%20Increase%20the%20multiplier%20to%20play%20faster%0A%20%20%20%2A%2F%0A%20%20rgltimerClass%2Eprototype%2Efaster%20%3D%20function%28%29%20%7B%0A%20%20%20%20this%2Enewmultiplier%28Math%2ESQRT2%2Athis%2Emultiplier%29%3B%0A%20%20%7D%3B%0A%0A%20%20%2F%2A%2A%0A%20%20%20%2A%20Decrease%20the%20multiplier%20to%20play%20slower%0A%20%20%20%2A%2F%0A%20%20rgltimerClass%2Eprototype%2Eslower%20%3D%20function%28%29%20%7B%0A%20%20%20%20this%2Enewmultiplier%28this%2Emultiplier%2FMath%2ESQRT2%29%3B%0A%20%20%7D%3B%0A%0A%20%20%2F%2A%2A%0A%20%20%20%2A%20Change%20sign%20of%20multiplier%20to%20reverse%20direction%0A%20%20%20%2A%2F%0A%20%20rgltimerClass%2Eprototype%2Ereverse%20%3D%20function%28%29%20%7B%0A%20%20%20%20this%2Enewmultiplier%28%2Dthis%2Emultiplier%29%3B%0A%20%20%7D%3B%0A%0A%20%20%2F%2A%2A%0A%20%20%20%2A%20Set%20multiplier%20for%20play%20speed%0A%20%20%20%2A%20%40param%20%7B%20number%20%7D%20newmult%20%2D%20new%20value%0A%20%20%20%2A%2F%0A%20%20rgltimerClass%2Eprototype%2Enewmultiplier%20%3D%20function%28newmult%29%20%7B%0A%20%20%20%20if%20%28newmult%20%21%3D%20this%2Emultiplier%29%20%7B%0A%20%20%20%20%20%20this%2ErealStart%20%2B%3D%201000%2A%28this%2Evalue%20%2D%20this%2EstartTime%29%2Fthis%2Erate%2A%281%2Fthis%2Emultiplier%20%2D%201%2Fnewmult%29%3B%0A%20%20%20%20%20%20this%2Emultiplier%20%3D%20newmult%3B%0A%20%20%20%20%7D%0A%20%20%7D%3B%0A%0A%20%20%2F%2A%2A%0A%20%20%20%2A%20Take%20one%20step%0A%20%20%20%2A%2F%0A%20%20rgltimerClass%2Eprototype%2Estep%20%3D%20function%28%29%20%7B%0A%20%20%20%20this%2Evalue%20%2B%3D%20this%2Erate%2Athis%2Emultiplier%3B%0A%20%20%20%20this%2EforceToRange%28%29%3B%0A%20%20%20%20if%20%28typeof%20this%2ETick%20%21%3D%3D%20%22undefined%22%29%0A%20%20%20%20%20%20this%2ETick%28this%2Evalue%29%3B%0A%20%20%7D%3B%0A"></script>
<script src="data:application/x-javascript,%2F%2A%0A%20%2A%20Copyright%20%28C%29%202009%20Apple%20Inc%2E%20All%20Rights%20Reserved%2E%0A%20%2A%0A%20%2A%20Redistribution%20and%20use%20in%20source%20and%20binary%20forms%2C%20with%20or%20without%0A%20%2A%20modification%2C%20are%20permitted%20provided%20that%20the%20following%20conditions%0A%20%2A%20are%20met%3A%0A%20%2A%201%2E%20Redistributions%20of%20source%20code%20must%20retain%20the%20above%20copyright%0A%20%2A%20%20%20%20notice%2C%20this%20list%20of%20conditions%20and%20the%20following%20disclaimer%2E%0A%20%2A%202%2E%20Redistributions%20in%20binary%20form%20must%20reproduce%20the%20above%20copyright%0A%20%2A%20%20%20%20notice%2C%20this%20list%20of%20conditions%20and%20the%20following%20disclaimer%20in%20the%0A%20%2A%20%20%20%20documentation%20and%2For%20other%20materials%20provided%20with%20the%20distribution%2E%0A%20%2A%0A%20%2A%20THIS%20SOFTWARE%20IS%20PROVIDED%20BY%20APPLE%20INC%2E%20%60%60AS%20IS%27%27%20AND%20ANY%0A%20%2A%20EXPRESS%20OR%20IMPLIED%20WARRANTIES%2C%20INCLUDING%2C%20BUT%20NOT%20LIMITED%20TO%2C%20THE%0A%20%2A%20IMPLIED%20WARRANTIES%20OF%20MERCHANTABILITY%20AND%20FITNESS%20FOR%20A%20PARTICULAR%0A%20%2A%20PURPOSE%20ARE%20DISCLAIMED%2E%20%20IN%20NO%20EVENT%20SHALL%20APPLE%20INC%2E%20OR%0A%20%2A%20CONTRIBUTORS%20BE%20LIABLE%20FOR%20ANY%20DIRECT%2C%20INDIRECT%2C%20INCIDENTAL%2C%20SPECIAL%2C%0A%20%2A%20EXEMPLARY%2C%20OR%20CONSEQUENTIAL%20DAMAGES%20%28INCLUDING%2C%20BUT%20NOT%20LIMITED%20TO%2C%0A%20%2A%20PROCUREMENT%20OF%20SUBSTITUTE%20GOODS%20OR%20SERVICES%3B%20LOSS%20OF%20USE%2C%20DATA%2C%20OR%0A%20%2A%20PROFITS%3B%20OR%20BUSINESS%20INTERRUPTION%29%20HOWEVER%20CAUSED%20AND%20ON%20ANY%20THEORY%0A%20%2A%20OF%20LIABILITY%2C%20WHETHER%20IN%20CONTRACT%2C%20STRICT%20LIABILITY%2C%20OR%20TORT%0A%20%2A%20%28INCLUDING%20NEGLIGENCE%20OR%20OTHERWISE%29%20ARISING%20IN%20ANY%20WAY%20OUT%20OF%20THE%20USE%0A%20%2A%20OF%20THIS%20SOFTWARE%2C%20EVEN%20IF%20ADVISED%20OF%20THE%20POSSIBILITY%20OF%20SUCH%20DAMAGE%2E%0A%0A%20%2A%20Copyright%20%282016%29%20Duncan%20Murdoch%20%2D%20fixed%20CanvasMatrix4%2Eortho%2C%0A%20%2A%20cleaned%20up%2E%0A%20%2A%2F%0A%2F%2A%0A%20%20%20%20CanvasMatrix4%20class%0A%0A%20%20%20%20This%20class%20implements%20a%204x4%20matrix%2E%20It%20has%20functions%20which%0A%20%20%20%20duplicate%20the%20functionality%20of%20the%20OpenGL%20matrix%20stack%20and%0A%20%20%20%20glut%20functions%2E%0A%0A%20%20%20%20IDL%3A%0A%0A%20%20%20%20%5B%0A%20%20%20%20%20%20%20%20Constructor%28in%20CanvasMatrix4%20matrix%29%2C%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20copy%20passed%20matrix%20into%20new%20CanvasMatrix4%0A%20%20%20%20%20%20%20%20Constructor%28in%20sequence%3Cfloat%3E%20array%29%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20create%20new%20CanvasMatrix4%20with%2016%20floats%20%28row%20major%29%0A%20%20%20%20%20%20%20%20Constructor%28%29%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20create%20new%20CanvasMatrix4%20with%20identity%20matrix%0A%20%20%20%20%5D%0A%20%20%20%20interface%20CanvasMatrix4%20%7B%0A%20%20%20%20%20%20%20%20attribute%20float%20m11%3B%0A%20%20%20%20%20%20%20%20attribute%20float%20m12%3B%0A%20%20%20%20%20%20%20%20attribute%20float%20m13%3B%0A%20%20%20%20%20%20%20%20attribute%20float%20m14%3B%0A%20%20%20%20%20%20%20%20attribute%20float%20m21%3B%0A%20%20%20%20%20%20%20%20attribute%20float%20m22%3B%0A%20%20%20%20%20%20%20%20attribute%20float%20m23%3B%0A%20%20%20%20%20%20%20%20attribute%20float%20m24%3B%0A%20%20%20%20%20%20%20%20attribute%20float%20m31%3B%0A%20%20%20%20%20%20%20%20attribute%20float%20m32%3B%0A%20%20%20%20%20%20%20%20attribute%20float%20m33%3B%0A%20%20%20%20%20%20%20%20attribute%20float%20m34%3B%0A%20%20%20%20%20%20%20%20attribute%20float%20m41%3B%0A%20%20%20%20%20%20%20%20attribute%20float%20m42%3B%0A%20%20%20%20%20%20%20%20attribute%20float%20m43%3B%0A%20%20%20%20%20%20%20%20attribute%20float%20m44%3B%0A%0A%20%20%20%20%20%20%20%20void%20load%28in%20CanvasMatrix4%20matrix%29%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20copy%20the%20values%20from%20the%20passed%20matrix%0A%20%20%20%20%20%20%20%20void%20load%28in%20sequence%3Cfloat%3E%20array%29%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20copy%2016%20floats%20into%20the%20matrix%0A%20%20%20%20%20%20%20%20sequence%3Cfloat%3E%20getAsArray%28%29%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20return%20the%20matrix%20as%20an%20array%20of%2016%20floats%0A%20%20%20%20%20%20%20%20WebGLFloatArray%20getAsCanvasFloatArray%28%29%3B%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20return%20the%20matrix%20as%20a%20WebGLFloatArray%20with%2016%20values%0A%20%20%20%20%20%20%20%20void%20makeIdentity%28%29%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20replace%20the%20matrix%20with%20identity%0A%20%20%20%20%20%20%20%20void%20transpose%28%29%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20replace%20the%20matrix%20with%20its%20transpose%0A%20%20%20%20%20%20%20%20void%20invert%28%29%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20replace%20the%20matrix%20with%20its%20inverse%0A%0A%20%20%20%20%20%20%20%20void%20translate%28in%20float%20x%2C%20in%20float%20y%2C%20in%20float%20z%29%3B%20%2F%2F%20multiply%20the%20matrix%20by%20passed%20translation%20values%20on%20the%20right%0A%20%20%20%20%20%20%20%20void%20scale%28in%20float%20x%2C%20in%20float%20y%2C%20in%20float%20z%29%3B%20%20%20%20%20%2F%2F%20multiply%20the%20matrix%20by%20passed%20scale%20values%20on%20the%20right%0A%20%20%20%20%20%20%20%20void%20rotate%28in%20float%20angle%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20multiply%20the%20matrix%20by%20passed%20rotation%20values%20on%20the%20right%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20in%20float%20x%2C%20in%20float%20y%2C%20in%20float%20z%29%3B%20%20%20%20%2F%2F%20%28angle%20is%20in%20degrees%29%0A%20%20%20%20%20%20%20%20void%20multRight%28in%20CanvasMatrix%20matrix%29%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20multiply%20the%20matrix%20by%20the%20passed%20matrix%20on%20the%20right%0A%20%20%20%20%20%20%20%20void%20multLeft%28in%20CanvasMatrix%20matrix%29%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20multiply%20the%20matrix%20by%20the%20passed%20matrix%20on%20the%20left%0A%20%20%20%20%20%20%20%20void%20ortho%28in%20float%20left%2C%20in%20float%20right%2C%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20multiply%20the%20matrix%20by%20the%20passed%20ortho%20values%20on%20the%20right%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20in%20float%20bottom%2C%20in%20float%20top%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20in%20float%20near%2C%20in%20float%20far%29%3B%0A%20%20%20%20%20%20%20%20void%20frustum%28in%20float%20left%2C%20in%20float%20right%2C%20%20%20%20%20%20%20%20%20%2F%2F%20multiply%20the%20matrix%20by%20the%20passed%20frustum%20values%20on%20the%20right%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20in%20float%20bottom%2C%20in%20float%20top%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20in%20float%20near%2C%20in%20float%20far%29%3B%0A%20%20%20%20%20%20%20%20void%20perspective%28in%20float%20fovy%2C%20in%20float%20aspect%2C%20%20%20%20%2F%2F%20multiply%20the%20matrix%20by%20the%20passed%20perspective%20values%20on%20the%20right%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20in%20float%20zNear%2C%20in%20float%20zFar%29%3B%0A%20%20%20%20%20%20%20%20void%20lookat%28in%20float%20eyex%2C%20in%20float%20eyey%2C%20in%20float%20eyez%2C%20%20%20%20%2F%2F%20multiply%20the%20matrix%20by%20the%20passed%20lookat%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20in%20float%20ctrx%2C%20in%20float%20ctry%2C%20in%20float%20ctrz%2C%20%20%20%20%2F%2F%20values%20on%20the%20right%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20in%20float%20upx%2C%20in%20float%20upy%2C%20in%20float%20upz%29%3B%0A%20%20%20%20%7D%0A%2A%2F%0A%0ACanvasMatrix4%20%3D%20function%28m%29%0A%7B%0A%20%20%20%20if%20%28typeof%20m%20%3D%3D%20%27object%27%29%20%7B%0A%20%20%20%20%20%20%20%20if%20%28%22length%22%20in%20m%20%26%26%20m%2Elength%20%3E%3D%2016%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Eload%28m%5B0%5D%2C%20m%5B1%5D%2C%20m%5B2%5D%2C%20m%5B3%5D%2C%20m%5B4%5D%2C%20m%5B5%5D%2C%20m%5B6%5D%2C%20m%5B7%5D%2C%20m%5B8%5D%2C%20m%5B9%5D%2C%20m%5B10%5D%2C%20m%5B11%5D%2C%20m%5B12%5D%2C%20m%5B13%5D%2C%20m%5B14%5D%2C%20m%5B15%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20else%20if%20%28m%20instanceof%20CanvasMatrix4%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Eload%28m%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20this%2EmakeIdentity%28%29%3B%0A%7D%3B%0A%0ACanvasMatrix4%2Eprototype%2Eload%20%3D%20function%28%29%0A%7B%0A%20%20%20%20if%20%28arguments%2Elength%20%3D%3D%201%20%26%26%20typeof%20arguments%5B0%5D%20%3D%3D%20%27object%27%29%20%7B%0A%20%20%20%20%20%20%20%20var%20matrix%20%3D%20arguments%5B0%5D%3B%0A%0A%20%20%20%20%20%20%20%20if%20%28%22length%22%20in%20matrix%20%26%26%20matrix%2Elength%20%3D%3D%2016%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em11%20%3D%20matrix%5B0%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em12%20%3D%20matrix%5B1%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em13%20%3D%20matrix%5B2%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em14%20%3D%20matrix%5B3%5D%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em21%20%3D%20matrix%5B4%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em22%20%3D%20matrix%5B5%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em23%20%3D%20matrix%5B6%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em24%20%3D%20matrix%5B7%5D%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em31%20%3D%20matrix%5B8%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em32%20%3D%20matrix%5B9%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em33%20%3D%20matrix%5B10%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em34%20%3D%20matrix%5B11%5D%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em41%20%3D%20matrix%5B12%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em42%20%3D%20matrix%5B13%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em43%20%3D%20matrix%5B14%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em44%20%3D%20matrix%5B15%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20if%20%28arguments%5B0%5D%20instanceof%20CanvasMatrix4%29%20%7B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em11%20%3D%20matrix%2Em11%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em12%20%3D%20matrix%2Em12%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em13%20%3D%20matrix%2Em13%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em14%20%3D%20matrix%2Em14%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em21%20%3D%20matrix%2Em21%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em22%20%3D%20matrix%2Em22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em23%20%3D%20matrix%2Em23%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em24%20%3D%20matrix%2Em24%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em31%20%3D%20matrix%2Em31%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em32%20%3D%20matrix%2Em32%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em33%20%3D%20matrix%2Em33%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em34%20%3D%20matrix%2Em34%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em41%20%3D%20matrix%2Em41%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em42%20%3D%20matrix%2Em42%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em43%20%3D%20matrix%2Em43%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20this%2Em44%20%3D%20matrix%2Em44%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20this%2EmakeIdentity%28%29%3B%0A%7D%3B%0A%0ACanvasMatrix4%2Eprototype%2EgetAsArray%20%3D%20function%28%29%0A%7B%0A%20%20%20%20return%20%5B%0A%20%20%20%20%20%20%20%20this%2Em11%2C%20this%2Em12%2C%20this%2Em13%2C%20this%2Em14%2C%0A%20%20%20%20%20%20%20%20this%2Em21%2C%20this%2Em22%2C%20this%2Em23%2C%20this%2Em24%2C%0A%20%20%20%20%20%20%20%20this%2Em31%2C%20this%2Em32%2C%20this%2Em33%2C%20this%2Em34%2C%0A%20%20%20%20%20%20%20%20this%2Em41%2C%20this%2Em42%2C%20this%2Em43%2C%20this%2Em44%0A%20%20%20%20%5D%3B%0A%7D%3B%0A%0ACanvasMatrix4%2Eprototype%2EgetAsWebGLFloatArray%20%3D%20function%28%29%0A%7B%0A%20%20%20%20return%20new%20WebGLFloatArray%28this%2EgetAsArray%28%29%29%3B%0A%7D%3B%0A%0ACanvasMatrix4%2Eprototype%2EmakeIdentity%20%3D%20function%28%29%0A%7B%0A%20%20%20%20this%2Em11%20%3D%201%3B%0A%20%20%20%20this%2Em12%20%3D%200%3B%0A%20%20%20%20this%2Em13%20%3D%200%3B%0A%20%20%20%20this%2Em14%20%3D%200%3B%0A%0A%20%20%20%20this%2Em21%20%3D%200%3B%0A%20%20%20%20this%2Em22%20%3D%201%3B%0A%20%20%20%20this%2Em23%20%3D%200%3B%0A%20%20%20%20this%2Em24%20%3D%200%3B%0A%0A%20%20%20%20this%2Em31%20%3D%200%3B%0A%20%20%20%20this%2Em32%20%3D%200%3B%0A%20%20%20%20this%2Em33%20%3D%201%3B%0A%20%20%20%20this%2Em34%20%3D%200%3B%0A%0A%20%20%20%20this%2Em41%20%3D%200%3B%0A%20%20%20%20this%2Em42%20%3D%200%3B%0A%20%20%20%20this%2Em43%20%3D%200%3B%0A%20%20%20%20this%2Em44%20%3D%201%3B%0A%7D%3B%0A%0ACanvasMatrix4%2Eprototype%2Etranspose%20%3D%20function%28%29%0A%7B%0A%20%20%20%20var%20tmp%20%3D%20this%2Em12%3B%0A%20%20%20%20this%2Em12%20%3D%20this%2Em21%3B%0A%20%20%20%20this%2Em21%20%3D%20tmp%3B%0A%0A%20%20%20%20tmp%20%3D%20this%2Em13%3B%0A%20%20%20%20this%2Em13%20%3D%20this%2Em31%3B%0A%20%20%20%20this%2Em31%20%3D%20tmp%3B%0A%0A%20%20%20%20tmp%20%3D%20this%2Em14%3B%0A%20%20%20%20this%2Em14%20%3D%20this%2Em41%3B%0A%20%20%20%20this%2Em41%20%3D%20tmp%3B%0A%0A%20%20%20%20tmp%20%3D%20this%2Em23%3B%0A%20%20%20%20this%2Em23%20%3D%20this%2Em32%3B%0A%20%20%20%20this%2Em32%20%3D%20tmp%3B%0A%0A%20%20%20%20tmp%20%3D%20this%2Em24%3B%0A%20%20%20%20this%2Em24%20%3D%20this%2Em42%3B%0A%20%20%20%20this%2Em42%20%3D%20tmp%3B%0A%0A%20%20%20%20tmp%20%3D%20this%2Em34%3B%0A%20%20%20%20this%2Em34%20%3D%20this%2Em43%3B%0A%20%20%20%20this%2Em43%20%3D%20tmp%3B%0A%7D%3B%0A%0ACanvasMatrix4%2Eprototype%2Einvert%20%3D%20function%28%29%0A%7B%0A%20%20%20%20%2F%2F%20Calculate%20the%204x4%20determinant%0A%20%20%20%20%2F%2F%20If%20the%20determinant%20is%20zero%2C%0A%20%20%20%20%2F%2F%20then%20the%20inverse%20matrix%20is%20not%20unique%2E%0A%20%20%20%20var%20det%20%3D%20this%2E%5Fdeterminant4x4%28%29%3B%0A%0A%20%20%20%20if%20%28Math%2Eabs%28det%29%20%3C%201e%2D8%29%0A%20%20%20%20%20%20%20%20return%20null%3B%0A%0A%20%20%20%20this%2E%5FmakeAdjoint%28%29%3B%0A%0A%20%20%20%20%2F%2F%20Scale%20the%20adjoint%20matrix%20to%20get%20the%20inverse%0A%20%20%20%20this%2Em11%20%2F%3D%20det%3B%0A%20%20%20%20this%2Em12%20%2F%3D%20det%3B%0A%20%20%20%20this%2Em13%20%2F%3D%20det%3B%0A%20%20%20%20this%2Em14%20%2F%3D%20det%3B%0A%0A%20%20%20%20this%2Em21%20%2F%3D%20det%3B%0A%20%20%20%20this%2Em22%20%2F%3D%20det%3B%0A%20%20%20%20this%2Em23%20%2F%3D%20det%3B%0A%20%20%20%20this%2Em24%20%2F%3D%20det%3B%0A%0A%20%20%20%20this%2Em31%20%2F%3D%20det%3B%0A%20%20%20%20this%2Em32%20%2F%3D%20det%3B%0A%20%20%20%20this%2Em33%20%2F%3D%20det%3B%0A%20%20%20%20this%2Em34%20%2F%3D%20det%3B%0A%0A%20%20%20%20this%2Em41%20%2F%3D%20det%3B%0A%20%20%20%20this%2Em42%20%2F%3D%20det%3B%0A%20%20%20%20this%2Em43%20%2F%3D%20det%3B%0A%20%20%20%20this%2Em44%20%2F%3D%20det%3B%0A%7D%3B%0A%0ACanvasMatrix4%2Eprototype%2Etranslate%20%3D%20function%28x%2Cy%2Cz%29%0A%7B%0A%20%20%20%20if%20%28x%20%3D%3D%3D%20undefined%29%0A%20%20%20%20%20%20%20%20x%20%3D%200%3B%0A%20%20%20%20if%20%28y%20%3D%3D%3D%20undefined%29%0A%20%20%20%20%20%20%20%20y%20%3D%200%3B%0A%20%20%20%20if%20%28z%20%3D%3D%3D%20undefined%29%0A%20%20%20%20%20%20%20%20z%20%3D%200%3B%0A%0A%20%20%20%20var%20matrix%20%3D%20new%20CanvasMatrix4%28%29%3B%0A%20%20%20%20matrix%2Em41%20%3D%20x%3B%0A%20%20%20%20matrix%2Em42%20%3D%20y%3B%0A%20%20%20%20matrix%2Em43%20%3D%20z%3B%0A%0A%20%20%20%20this%2EmultRight%28matrix%29%3B%0A%7D%3B%0A%0ACanvasMatrix4%2Eprototype%2Escale%20%3D%20function%28x%2Cy%2Cz%29%0A%7B%0A%20%20%20%20if%20%28x%20%3D%3D%3D%20undefined%29%0A%20%20%20%20%20%20%20%20x%20%3D%201%3B%0A%20%20%20%20if%20%28z%20%3D%3D%3D%20undefined%29%20%7B%0A%20%20%20%20%20%20%20%20if%20%28y%20%3D%3D%3D%20undefined%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20y%20%3D%20x%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20z%20%3D%20x%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20z%20%3D%201%3B%0A%20%20%20%20%7D%0A%20%20%20%20else%20if%20%28y%20%3D%3D%3D%20undefined%29%0A%20%20%20%20%20%20%20%20y%20%3D%20x%3B%0A%0A%20%20%20%20var%20matrix%20%3D%20new%20CanvasMatrix4%28%29%3B%0A%20%20%20%20matrix%2Em11%20%3D%20x%3B%0A%20%20%20%20matrix%2Em22%20%3D%20y%3B%0A%20%20%20%20matrix%2Em33%20%3D%20z%3B%0A%0A%20%20%20%20this%2EmultRight%28matrix%29%3B%0A%7D%3B%0A%0ACanvasMatrix4%2Eprototype%2Erotate%20%3D%20function%28angle%2Cx%2Cy%2Cz%29%0A%7B%0A%20%20%20%20%2F%2F%20angles%20are%20in%20degrees%2E%20Switch%20to%20radians%0A%20%20%20%20angle%20%3D%20angle%20%2F%20180%20%2A%20Math%2EPI%3B%0A%0A%20%20%20%20angle%20%2F%3D%202%3B%0A%20%20%20%20var%20sinA%20%3D%20Math%2Esin%28angle%29%3B%0A%20%20%20%20var%20cosA%20%3D%20Math%2Ecos%28angle%29%3B%0A%20%20%20%20var%20sinA2%20%3D%20sinA%20%2A%20sinA%3B%0A%0A%20%20%20%20%2F%2F%20normalize%0A%20%20%20%20var%20length%20%3D%20Math%2Esqrt%28x%20%2A%20x%20%2B%20y%20%2A%20y%20%2B%20z%20%2A%20z%29%3B%0A%20%20%20%20if%20%28length%20%3D%3D%3D%200%29%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F%20bad%20vector%2C%20just%20use%20something%20reasonable%0A%20%20%20%20%20%20%20%20x%20%3D%200%3B%0A%20%20%20%20%20%20%20%20y%20%3D%200%3B%0A%20%20%20%20%20%20%20%20z%20%3D%201%3B%0A%20%20%20%20%7D%20else%20if%20%28length%20%21%3D%201%29%20%7B%0A%20%20%20%20%20%20%20%20x%20%2F%3D%20length%3B%0A%20%20%20%20%20%20%20%20y%20%2F%3D%20length%3B%0A%20%20%20%20%20%20%20%20z%20%2F%3D%20length%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20var%20mat%20%3D%20new%20CanvasMatrix4%28%29%3B%0A%0A%20%20%20%20%2F%2F%20optimize%20case%20where%20axis%20is%20along%20major%20axis%0A%20%20%20%20if%20%28x%20%3D%3D%201%20%26%26%20y%20%3D%3D%3D%200%20%26%26%20z%20%3D%3D%3D%200%29%20%7B%0A%20%20%20%20%20%20%20%20mat%2Em11%20%3D%201%3B%0A%20%20%20%20%20%20%20%20mat%2Em12%20%3D%200%3B%0A%20%20%20%20%20%20%20%20mat%2Em13%20%3D%200%3B%0A%20%20%20%20%20%20%20%20mat%2Em21%20%3D%200%3B%0A%20%20%20%20%20%20%20%20mat%2Em22%20%3D%201%20%2D%202%20%2A%20sinA2%3B%0A%20%20%20%20%20%20%20%20mat%2Em23%20%3D%202%20%2A%20sinA%20%2A%20cosA%3B%0A%20%20%20%20%20%20%20%20mat%2Em31%20%3D%200%3B%0A%20%20%20%20%20%20%20%20mat%2Em32%20%3D%20%2D2%20%2A%20sinA%20%2A%20cosA%3B%0A%20%20%20%20%20%20%20%20mat%2Em33%20%3D%201%20%2D%202%20%2A%20sinA2%3B%0A%20%20%20%20%20%20%20%20mat%2Em14%20%3D%20mat%2Em24%20%3D%20mat%2Em34%20%3D%200%3B%0A%20%20%20%20%20%20%20%20mat%2Em41%20%3D%20mat%2Em42%20%3D%20mat%2Em43%20%3D%200%3B%0A%20%20%20%20%20%20%20%20mat%2Em44%20%3D%201%3B%0A%20%20%20%20%7D%20else%20if%20%28x%20%3D%3D%3D%200%20%26%26%20y%20%3D%3D%201%20%26%26%20z%20%3D%3D%3D%200%29%20%7B%0A%20%20%20%20%20%20%20%20mat%2Em11%20%3D%201%20%2D%202%20%2A%20sinA2%3B%0A%20%20%20%20%20%20%20%20mat%2Em12%20%3D%200%3B%0A%20%20%20%20%20%20%20%20mat%2Em13%20%3D%20%2D2%20%2A%20sinA%20%2A%20cosA%3B%0A%20%20%20%20%20%20%20%20mat%2Em21%20%3D%200%3B%0A%20%20%20%20%20%20%20%20mat%2Em22%20%3D%201%3B%0A%20%20%20%20%20%20%20%20mat%2Em23%20%3D%200%3B%0A%20%20%20%20%20%20%20%20mat%2Em31%20%3D%202%20%2A%20sinA%20%2A%20cosA%3B%0A%20%20%20%20%20%20%20%20mat%2Em32%20%3D%200%3B%0A%20%20%20%20%20%20%20%20mat%2Em33%20%3D%201%20%2D%202%20%2A%20sinA2%3B%0A%20%20%20%20%20%20%20%20mat%2Em14%20%3D%20mat%2Em24%20%3D%20mat%2Em34%20%3D%200%3B%0A%20%20%20%20%20%20%20%20mat%2Em41%20%3D%20mat%2Em42%20%3D%20mat%2Em43%20%3D%200%3B%0A%20%20%20%20%20%20%20%20mat%2Em44%20%3D%201%3B%0A%20%20%20%20%7D%20else%20if%20%28x%20%3D%3D%3D%200%20%26%26%20y%20%3D%3D%3D%200%20%26%26%20z%20%3D%3D%201%29%20%7B%0A%20%20%20%20%20%20%20%20mat%2Em11%20%3D%201%20%2D%202%20%2A%20sinA2%3B%0A%20%20%20%20%20%20%20%20mat%2Em12%20%3D%202%20%2A%20sinA%20%2A%20cosA%3B%0A%20%20%20%20%20%20%20%20mat%2Em13%20%3D%200%3B%0A%20%20%20%20%20%20%20%20mat%2Em21%20%3D%20%2D2%20%2A%20sinA%20%2A%20cosA%3B%0A%20%20%20%20%20%20%20%20mat%2Em22%20%3D%201%20%2D%202%20%2A%20sinA2%3B%0A%20%20%20%20%20%20%20%20mat%2Em23%20%3D%200%3B%0A%20%20%20%20%20%20%20%20mat%2Em31%20%3D%200%3B%0A%20%20%20%20%20%20%20%20mat%2Em32%20%3D%200%3B%0A%20%20%20%20%20%20%20%20mat%2Em33%20%3D%201%3B%0A%20%20%20%20%20%20%20%20mat%2Em14%20%3D%20mat%2Em24%20%3D%20mat%2Em34%20%3D%200%3B%0A%20%20%20%20%20%20%20%20mat%2Em41%20%3D%20mat%2Em42%20%3D%20mat%2Em43%20%3D%200%3B%0A%20%20%20%20%20%20%20%20mat%2Em44%20%3D%201%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20var%20x2%20%3D%20x%2Ax%3B%0A%20%20%20%20%20%20%20%20var%20y2%20%3D%20y%2Ay%3B%0A%20%20%20%20%20%20%20%20var%20z2%20%3D%20z%2Az%3B%0A%0A%20%20%20%20%20%20%20%20mat%2Em11%20%3D%201%20%2D%202%20%2A%20%28y2%20%2B%20z2%29%20%2A%20sinA2%3B%0A%20%20%20%20%20%20%20%20mat%2Em12%20%3D%202%20%2A%20%28x%20%2A%20y%20%2A%20sinA2%20%2B%20z%20%2A%20sinA%20%2A%20cosA%29%3B%0A%20%20%20%20%20%20%20%20mat%2Em13%20%3D%202%20%2A%20%28x%20%2A%20z%20%2A%20sinA2%20%2D%20y%20%2A%20sinA%20%2A%20cosA%29%3B%0A%20%20%20%20%20%20%20%20mat%2Em21%20%3D%202%20%2A%20%28y%20%2A%20x%20%2A%20sinA2%20%2D%20z%20%2A%20sinA%20%2A%20cosA%29%3B%0A%20%20%20%20%20%20%20%20mat%2Em22%20%3D%201%20%2D%202%20%2A%20%28z2%20%2B%20x2%29%20%2A%20sinA2%3B%0A%20%20%20%20%20%20%20%20mat%2Em23%20%3D%202%20%2A%20%28y%20%2A%20z%20%2A%20sinA2%20%2B%20x%20%2A%20sinA%20%2A%20cosA%29%3B%0A%20%20%20%20%20%20%20%20mat%2Em31%20%3D%202%20%2A%20%28z%20%2A%20x%20%2A%20sinA2%20%2B%20y%20%2A%20sinA%20%2A%20cosA%29%3B%0A%20%20%20%20%20%20%20%20mat%2Em32%20%3D%202%20%2A%20%28z%20%2A%20y%20%2A%20sinA2%20%2D%20x%20%2A%20sinA%20%2A%20cosA%29%3B%0A%20%20%20%20%20%20%20%20mat%2Em33%20%3D%201%20%2D%202%20%2A%20%28x2%20%2B%20y2%29%20%2A%20sinA2%3B%0A%20%20%20%20%20%20%20%20mat%2Em14%20%3D%20mat%2Em24%20%3D%20mat%2Em34%20%3D%200%3B%0A%20%20%20%20%20%20%20%20mat%2Em41%20%3D%20mat%2Em42%20%3D%20mat%2Em43%20%3D%200%3B%0A%20%20%20%20%20%20%20%20mat%2Em44%20%3D%201%3B%0A%20%20%20%20%7D%0A%20%20%20%20this%2EmultRight%28mat%29%3B%0A%7D%3B%0A%0ACanvasMatrix4%2Eprototype%2EmultRight%20%3D%20function%28mat%29%0A%7B%0A%20%20%20%20var%20m11%20%3D%20%28this%2Em11%20%2A%20mat%2Em11%20%2B%20this%2Em12%20%2A%20mat%2Em21%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this%2Em13%20%2A%20mat%2Em31%20%2B%20this%2Em14%20%2A%20mat%2Em41%29%3B%0A%20%20%20%20var%20m12%20%3D%20%28this%2Em11%20%2A%20mat%2Em12%20%2B%20this%2Em12%20%2A%20mat%2Em22%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this%2Em13%20%2A%20mat%2Em32%20%2B%20this%2Em14%20%2A%20mat%2Em42%29%3B%0A%20%20%20%20var%20m13%20%3D%20%28this%2Em11%20%2A%20mat%2Em13%20%2B%20this%2Em12%20%2A%20mat%2Em23%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this%2Em13%20%2A%20mat%2Em33%20%2B%20this%2Em14%20%2A%20mat%2Em43%29%3B%0A%20%20%20%20var%20m14%20%3D%20%28this%2Em11%20%2A%20mat%2Em14%20%2B%20this%2Em12%20%2A%20mat%2Em24%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this%2Em13%20%2A%20mat%2Em34%20%2B%20this%2Em14%20%2A%20mat%2Em44%29%3B%0A%0A%20%20%20%20var%20m21%20%3D%20%28this%2Em21%20%2A%20mat%2Em11%20%2B%20this%2Em22%20%2A%20mat%2Em21%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this%2Em23%20%2A%20mat%2Em31%20%2B%20this%2Em24%20%2A%20mat%2Em41%29%3B%0A%20%20%20%20var%20m22%20%3D%20%28this%2Em21%20%2A%20mat%2Em12%20%2B%20this%2Em22%20%2A%20mat%2Em22%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this%2Em23%20%2A%20mat%2Em32%20%2B%20this%2Em24%20%2A%20mat%2Em42%29%3B%0A%20%20%20%20var%20m23%20%3D%20%28this%2Em21%20%2A%20mat%2Em13%20%2B%20this%2Em22%20%2A%20mat%2Em23%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this%2Em23%20%2A%20mat%2Em33%20%2B%20this%2Em24%20%2A%20mat%2Em43%29%3B%0A%20%20%20%20var%20m24%20%3D%20%28this%2Em21%20%2A%20mat%2Em14%20%2B%20this%2Em22%20%2A%20mat%2Em24%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this%2Em23%20%2A%20mat%2Em34%20%2B%20this%2Em24%20%2A%20mat%2Em44%29%3B%0A%0A%20%20%20%20var%20m31%20%3D%20%28this%2Em31%20%2A%20mat%2Em11%20%2B%20this%2Em32%20%2A%20mat%2Em21%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this%2Em33%20%2A%20mat%2Em31%20%2B%20this%2Em34%20%2A%20mat%2Em41%29%3B%0A%20%20%20%20var%20m32%20%3D%20%28this%2Em31%20%2A%20mat%2Em12%20%2B%20this%2Em32%20%2A%20mat%2Em22%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this%2Em33%20%2A%20mat%2Em32%20%2B%20this%2Em34%20%2A%20mat%2Em42%29%3B%0A%20%20%20%20var%20m33%20%3D%20%28this%2Em31%20%2A%20mat%2Em13%20%2B%20this%2Em32%20%2A%20mat%2Em23%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this%2Em33%20%2A%20mat%2Em33%20%2B%20this%2Em34%20%2A%20mat%2Em43%29%3B%0A%20%20%20%20var%20m34%20%3D%20%28this%2Em31%20%2A%20mat%2Em14%20%2B%20this%2Em32%20%2A%20mat%2Em24%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this%2Em33%20%2A%20mat%2Em34%20%2B%20this%2Em34%20%2A%20mat%2Em44%29%3B%0A%0A%20%20%20%20var%20m41%20%3D%20%28this%2Em41%20%2A%20mat%2Em11%20%2B%20this%2Em42%20%2A%20mat%2Em21%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this%2Em43%20%2A%20mat%2Em31%20%2B%20this%2Em44%20%2A%20mat%2Em41%29%3B%0A%20%20%20%20var%20m42%20%3D%20%28this%2Em41%20%2A%20mat%2Em12%20%2B%20this%2Em42%20%2A%20mat%2Em22%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this%2Em43%20%2A%20mat%2Em32%20%2B%20this%2Em44%20%2A%20mat%2Em42%29%3B%0A%20%20%20%20var%20m43%20%3D%20%28this%2Em41%20%2A%20mat%2Em13%20%2B%20this%2Em42%20%2A%20mat%2Em23%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this%2Em43%20%2A%20mat%2Em33%20%2B%20this%2Em44%20%2A%20mat%2Em43%29%3B%0A%20%20%20%20var%20m44%20%3D%20%28this%2Em41%20%2A%20mat%2Em14%20%2B%20this%2Em42%20%2A%20mat%2Em24%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this%2Em43%20%2A%20mat%2Em34%20%2B%20this%2Em44%20%2A%20mat%2Em44%29%3B%0A%0A%20%20%20%20this%2Em11%20%3D%20m11%3B%0A%20%20%20%20this%2Em12%20%3D%20m12%3B%0A%20%20%20%20this%2Em13%20%3D%20m13%3B%0A%20%20%20%20this%2Em14%20%3D%20m14%3B%0A%0A%20%20%20%20this%2Em21%20%3D%20m21%3B%0A%20%20%20%20this%2Em22%20%3D%20m22%3B%0A%20%20%20%20this%2Em23%20%3D%20m23%3B%0A%20%20%20%20this%2Em24%20%3D%20m24%3B%0A%0A%20%20%20%20this%2Em31%20%3D%20m31%3B%0A%20%20%20%20this%2Em32%20%3D%20m32%3B%0A%20%20%20%20this%2Em33%20%3D%20m33%3B%0A%20%20%20%20this%2Em34%20%3D%20m34%3B%0A%0A%20%20%20%20this%2Em41%20%3D%20m41%3B%0A%20%20%20%20this%2Em42%20%3D%20m42%3B%0A%20%20%20%20this%2Em43%20%3D%20m43%3B%0A%20%20%20%20this%2Em44%20%3D%20m44%3B%0A%7D%3B%0A%0ACanvasMatrix4%2Eprototype%2EmultLeft%20%3D%20function%28mat%29%0A%7B%0A%20%20%20%20var%20m11%20%3D%20%28mat%2Em11%20%2A%20this%2Em11%20%2B%20mat%2Em12%20%2A%20this%2Em21%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mat%2Em13%20%2A%20this%2Em31%20%2B%20mat%2Em14%20%2A%20this%2Em41%29%3B%0A%20%20%20%20var%20m12%20%3D%20%28mat%2Em11%20%2A%20this%2Em12%20%2B%20mat%2Em12%20%2A%20this%2Em22%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mat%2Em13%20%2A%20this%2Em32%20%2B%20mat%2Em14%20%2A%20this%2Em42%29%3B%0A%20%20%20%20var%20m13%20%3D%20%28mat%2Em11%20%2A%20this%2Em13%20%2B%20mat%2Em12%20%2A%20this%2Em23%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mat%2Em13%20%2A%20this%2Em33%20%2B%20mat%2Em14%20%2A%20this%2Em43%29%3B%0A%20%20%20%20var%20m14%20%3D%20%28mat%2Em11%20%2A%20this%2Em14%20%2B%20mat%2Em12%20%2A%20this%2Em24%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mat%2Em13%20%2A%20this%2Em34%20%2B%20mat%2Em14%20%2A%20this%2Em44%29%3B%0A%0A%20%20%20%20var%20m21%20%3D%20%28mat%2Em21%20%2A%20this%2Em11%20%2B%20mat%2Em22%20%2A%20this%2Em21%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mat%2Em23%20%2A%20this%2Em31%20%2B%20mat%2Em24%20%2A%20this%2Em41%29%3B%0A%20%20%20%20var%20m22%20%3D%20%28mat%2Em21%20%2A%20this%2Em12%20%2B%20mat%2Em22%20%2A%20this%2Em22%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mat%2Em23%20%2A%20this%2Em32%20%2B%20mat%2Em24%20%2A%20this%2Em42%29%3B%0A%20%20%20%20var%20m23%20%3D%20%28mat%2Em21%20%2A%20this%2Em13%20%2B%20mat%2Em22%20%2A%20this%2Em23%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mat%2Em23%20%2A%20this%2Em33%20%2B%20mat%2Em24%20%2A%20this%2Em43%29%3B%0A%20%20%20%20var%20m24%20%3D%20%28mat%2Em21%20%2A%20this%2Em14%20%2B%20mat%2Em22%20%2A%20this%2Em24%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mat%2Em23%20%2A%20this%2Em34%20%2B%20mat%2Em24%20%2A%20this%2Em44%29%3B%0A%0A%20%20%20%20var%20m31%20%3D%20%28mat%2Em31%20%2A%20this%2Em11%20%2B%20mat%2Em32%20%2A%20this%2Em21%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mat%2Em33%20%2A%20this%2Em31%20%2B%20mat%2Em34%20%2A%20this%2Em41%29%3B%0A%20%20%20%20var%20m32%20%3D%20%28mat%2Em31%20%2A%20this%2Em12%20%2B%20mat%2Em32%20%2A%20this%2Em22%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mat%2Em33%20%2A%20this%2Em32%20%2B%20mat%2Em34%20%2A%20this%2Em42%29%3B%0A%20%20%20%20var%20m33%20%3D%20%28mat%2Em31%20%2A%20this%2Em13%20%2B%20mat%2Em32%20%2A%20this%2Em23%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mat%2Em33%20%2A%20this%2Em33%20%2B%20mat%2Em34%20%2A%20this%2Em43%29%3B%0A%20%20%20%20var%20m34%20%3D%20%28mat%2Em31%20%2A%20this%2Em14%20%2B%20mat%2Em32%20%2A%20this%2Em24%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mat%2Em33%20%2A%20this%2Em34%20%2B%20mat%2Em34%20%2A%20this%2Em44%29%3B%0A%0A%20%20%20%20var%20m41%20%3D%20%28mat%2Em41%20%2A%20this%2Em11%20%2B%20mat%2Em42%20%2A%20this%2Em21%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mat%2Em43%20%2A%20this%2Em31%20%2B%20mat%2Em44%20%2A%20this%2Em41%29%3B%0A%20%20%20%20var%20m42%20%3D%20%28mat%2Em41%20%2A%20this%2Em12%20%2B%20mat%2Em42%20%2A%20this%2Em22%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mat%2Em43%20%2A%20this%2Em32%20%2B%20mat%2Em44%20%2A%20this%2Em42%29%3B%0A%20%20%20%20var%20m43%20%3D%20%28mat%2Em41%20%2A%20this%2Em13%20%2B%20mat%2Em42%20%2A%20this%2Em23%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mat%2Em43%20%2A%20this%2Em33%20%2B%20mat%2Em44%20%2A%20this%2Em43%29%3B%0A%20%20%20%20var%20m44%20%3D%20%28mat%2Em41%20%2A%20this%2Em14%20%2B%20mat%2Em42%20%2A%20this%2Em24%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mat%2Em43%20%2A%20this%2Em34%20%2B%20mat%2Em44%20%2A%20this%2Em44%29%3B%0A%0A%20%20%20%20this%2Em11%20%3D%20m11%3B%0A%20%20%20%20this%2Em12%20%3D%20m12%3B%0A%20%20%20%20this%2Em13%20%3D%20m13%3B%0A%20%20%20%20this%2Em14%20%3D%20m14%3B%0A%0A%20%20%20%20this%2Em21%20%3D%20m21%3B%0A%20%20%20%20this%2Em22%20%3D%20m22%3B%0A%20%20%20%20this%2Em23%20%3D%20m23%3B%0A%20%20%20%20this%2Em24%20%3D%20m24%3B%0A%0A%20%20%20%20this%2Em31%20%3D%20m31%3B%0A%20%20%20%20this%2Em32%20%3D%20m32%3B%0A%20%20%20%20this%2Em33%20%3D%20m33%3B%0A%20%20%20%20this%2Em34%20%3D%20m34%3B%0A%0A%20%20%20%20this%2Em41%20%3D%20m41%3B%0A%20%20%20%20this%2Em42%20%3D%20m42%3B%0A%20%20%20%20this%2Em43%20%3D%20m43%3B%0A%20%20%20%20this%2Em44%20%3D%20m44%3B%0A%7D%3B%0A%0ACanvasMatrix4%2Eprototype%2Eortho%20%3D%20function%28left%2C%20right%2C%20bottom%2C%20top%2C%20near%2C%20far%29%0A%7B%0A%20%20%20%20var%20tx%20%3D%20%28left%20%2B%20right%29%20%2F%20%28left%20%2D%20right%29%3B%0A%20%20%20%20var%20ty%20%3D%20%28top%20%2B%20bottom%29%20%2F%20%28bottom%20%2D%20top%29%3B%0A%20%20%20%20var%20tz%20%3D%20%28far%20%2B%20near%29%20%2F%20%28near%20%2D%20far%29%3B%0A%0A%20%20%20%20var%20matrix%20%3D%20new%20CanvasMatrix4%28%29%3B%0A%20%20%20%20matrix%2Em11%20%3D%202%20%2F%20%28right%20%2D%20left%29%3B%0A%20%20%20%20matrix%2Em12%20%3D%200%3B%0A%20%20%20%20matrix%2Em13%20%3D%200%3B%0A%20%20%20%20matrix%2Em14%20%3D%200%3B%0A%20%20%20%20matrix%2Em21%20%3D%200%3B%0A%20%20%20%20matrix%2Em22%20%3D%202%20%2F%20%28top%20%2D%20bottom%29%3B%0A%20%20%20%20matrix%2Em23%20%3D%200%3B%0A%20%20%20%20matrix%2Em24%20%3D%200%3B%0A%20%20%20%20matrix%2Em31%20%3D%200%3B%0A%20%20%20%20matrix%2Em32%20%3D%200%3B%0A%20%20%20%20matrix%2Em33%20%3D%20%2D2%20%2F%20%28far%20%2D%20near%29%3B%0A%20%20%20%20matrix%2Em34%20%3D%200%3B%0A%20%20%20%20matrix%2Em41%20%3D%20tx%3B%0A%20%20%20%20matrix%2Em42%20%3D%20ty%3B%0A%20%20%20%20matrix%2Em43%20%3D%20tz%3B%0A%20%20%20%20matrix%2Em44%20%3D%201%3B%0A%0A%20%20%20%20this%2EmultRight%28matrix%29%3B%0A%7D%3B%0A%0ACanvasMatrix4%2Eprototype%2Efrustum%20%3D%20function%28left%2C%20right%2C%20bottom%2C%20top%2C%20near%2C%20far%29%0A%7B%0A%20%20%20%20var%20matrix%20%3D%20new%20CanvasMatrix4%28%29%3B%0A%20%20%20%20var%20A%20%3D%20%28right%20%2B%20left%29%20%2F%20%28right%20%2D%20left%29%3B%0A%20%20%20%20var%20B%20%3D%20%28top%20%2B%20bottom%29%20%2F%20%28top%20%2D%20bottom%29%3B%0A%20%20%20%20var%20C%20%3D%20%2D%28far%20%2B%20near%29%20%2F%20%28far%20%2D%20near%29%3B%0A%20%20%20%20var%20D%20%3D%20%2D%282%20%2A%20far%20%2A%20near%29%20%2F%20%28far%20%2D%20near%29%3B%0A%0A%20%20%20%20matrix%2Em11%20%3D%20%282%20%2A%20near%29%20%2F%20%28right%20%2D%20left%29%3B%0A%20%20%20%20matrix%2Em12%20%3D%200%3B%0A%20%20%20%20matrix%2Em13%20%3D%200%3B%0A%20%20%20%20matrix%2Em14%20%3D%200%3B%0A%0A%20%20%20%20matrix%2Em21%20%3D%200%3B%0A%20%20%20%20matrix%2Em22%20%3D%202%20%2A%20near%20%2F%20%28top%20%2D%20bottom%29%3B%0A%20%20%20%20matrix%2Em23%20%3D%200%3B%0A%20%20%20%20matrix%2Em24%20%3D%200%3B%0A%0A%20%20%20%20matrix%2Em31%20%3D%20A%3B%0A%20%20%20%20matrix%2Em32%20%3D%20B%3B%0A%20%20%20%20matrix%2Em33%20%3D%20C%3B%0A%20%20%20%20matrix%2Em34%20%3D%20%2D1%3B%0A%0A%20%20%20%20matrix%2Em41%20%3D%200%3B%0A%20%20%20%20matrix%2Em42%20%3D%200%3B%0A%20%20%20%20matrix%2Em43%20%3D%20D%3B%0A%20%20%20%20matrix%2Em44%20%3D%200%3B%0A%0A%20%20%20%20this%2EmultRight%28matrix%29%3B%0A%7D%3B%0A%0ACanvasMatrix4%2Eprototype%2Eperspective%20%3D%20function%28fovy%2C%20aspect%2C%20zNear%2C%20zFar%29%0A%7B%0A%20%20%20%20var%20top%20%3D%20Math%2Etan%28fovy%20%2A%20Math%2EPI%20%2F%20360%29%20%2A%20zNear%3B%0A%20%20%20%20var%20bottom%20%3D%20%2Dtop%3B%0A%20%20%20%20var%20left%20%3D%20aspect%20%2A%20bottom%3B%0A%20%20%20%20var%20right%20%3D%20aspect%20%2A%20top%3B%0A%20%20%20%20this%2Efrustum%28left%2C%20right%2C%20bottom%2C%20top%2C%20zNear%2C%20zFar%29%3B%0A%7D%3B%0A%0ACanvasMatrix4%2Eprototype%2Elookat%20%3D%20function%28eyex%2C%20eyey%2C%20eyez%2C%20centerx%2C%20centery%2C%20centerz%2C%20upx%2C%20upy%2C%20upz%29%0A%7B%0A%20%20%20%20var%20matrix%20%3D%20new%20CanvasMatrix4%28%29%3B%0A%0A%20%20%20%20%2F%2F%20Make%20rotation%20matrix%0A%0A%20%20%20%20%2F%2F%20Z%20vector%0A%20%20%20%20var%20zx%20%3D%20eyex%20%2D%20centerx%3B%0A%20%20%20%20var%20zy%20%3D%20eyey%20%2D%20centery%3B%0A%20%20%20%20var%20zz%20%3D%20eyez%20%2D%20centerz%3B%0A%20%20%20%20var%20mag%20%3D%20Math%2Esqrt%28zx%20%2A%20zx%20%2B%20zy%20%2A%20zy%20%2B%20zz%20%2A%20zz%29%3B%0A%20%20%20%20if%20%28mag%29%20%7B%0A%20%20%20%20%20%20%20%20zx%20%2F%3D%20mag%3B%0A%20%20%20%20%20%20%20%20zy%20%2F%3D%20mag%3B%0A%20%20%20%20%20%20%20%20zz%20%2F%3D%20mag%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F%2F%20Y%20vector%0A%20%20%20%20var%20yx%20%3D%20upx%3B%0A%20%20%20%20var%20yy%20%3D%20upy%3B%0A%20%20%20%20var%20yz%20%3D%20upz%3B%0A%0A%20%20%20%20%2F%2F%20X%20vector%20%3D%20Y%20cross%20Z%0A%20%20%20%20xx%20%3D%20%20yy%20%2A%20zz%20%2D%20yz%20%2A%20zy%3B%0A%20%20%20%20xy%20%3D%20%2Dyx%20%2A%20zz%20%2B%20yz%20%2A%20zx%3B%0A%20%20%20%20xz%20%3D%20%20yx%20%2A%20zy%20%2D%20yy%20%2A%20zx%3B%0A%0A%20%20%20%20%2F%2F%20Recompute%20Y%20%3D%20Z%20cross%20X%0A%20%20%20%20yx%20%3D%20zy%20%2A%20xz%20%2D%20zz%20%2A%20xy%3B%0A%20%20%20%20yy%20%3D%20%2Dzx%20%2A%20xz%20%2B%20zz%20%2A%20xx%3B%0A%20%20%20%20yx%20%3D%20zx%20%2A%20xy%20%2D%20zy%20%2A%20xx%3B%0A%0A%20%20%20%20%2F%2F%20cross%20product%20gives%20area%20of%20parallelogram%2C%20which%20is%20%3C%201%2E0%20for%0A%20%20%20%20%2F%2F%20non%2Dperpendicular%20unit%2Dlength%20vectors%3B%20so%20normalize%20x%2C%20y%20here%0A%0A%20%20%20%20mag%20%3D%20Math%2Esqrt%28xx%20%2A%20xx%20%2B%20xy%20%2A%20xy%20%2B%20xz%20%2A%20xz%29%3B%0A%20%20%20%20if%20%28mag%29%20%7B%0A%20%20%20%20%20%20%20%20xx%20%2F%3D%20mag%3B%0A%20%20%20%20%20%20%20%20xy%20%2F%3D%20mag%3B%0A%20%20%20%20%20%20%20%20xz%20%2F%3D%20mag%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20mag%20%3D%20Math%2Esqrt%28yx%20%2A%20yx%20%2B%20yy%20%2A%20yy%20%2B%20yz%20%2A%20yz%29%3B%0A%20%20%20%20if%20%28mag%29%20%7B%0A%20%20%20%20%20%20%20%20yx%20%2F%3D%20mag%3B%0A%20%20%20%20%20%20%20%20yy%20%2F%3D%20mag%3B%0A%20%20%20%20%20%20%20%20yz%20%2F%3D%20mag%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20matrix%2Em11%20%3D%20xx%3B%0A%20%20%20%20matrix%2Em12%20%3D%20xy%3B%0A%20%20%20%20matrix%2Em13%20%3D%20xz%3B%0A%20%20%20%20matrix%2Em14%20%3D%200%3B%0A%0A%20%20%20%20matrix%2Em21%20%3D%20yx%3B%0A%20%20%20%20matrix%2Em22%20%3D%20yy%3B%0A%20%20%20%20matrix%2Em23%20%3D%20yz%3B%0A%20%20%20%20matrix%2Em24%20%3D%200%3B%0A%0A%20%20%20%20matrix%2Em31%20%3D%20zx%3B%0A%20%20%20%20matrix%2Em32%20%3D%20zy%3B%0A%20%20%20%20matrix%2Em33%20%3D%20zz%3B%0A%20%20%20%20matrix%2Em34%20%3D%200%3B%0A%0A%20%20%20%20matrix%2Em41%20%3D%200%3B%0A%20%20%20%20matrix%2Em42%20%3D%200%3B%0A%20%20%20%20matrix%2Em43%20%3D%200%3B%0A%20%20%20%20matrix%2Em44%20%3D%201%3B%0A%20%20%20%20matrix%2Etranslate%28%2Deyex%2C%20%2Deyey%2C%20%2Deyez%29%3B%0A%0A%20%20%20%20this%2EmultRight%28matrix%29%3B%0A%7D%3B%0A%0A%2F%2F%20Support%20functions%0ACanvasMatrix4%2Eprototype%2E%5Fdeterminant2x2%20%3D%20function%28a%2C%20b%2C%20c%2C%20d%29%0A%7B%0A%20%20%20%20return%20a%20%2A%20d%20%2D%20b%20%2A%20c%3B%0A%7D%3B%0A%0ACanvasMatrix4%2Eprototype%2E%5Fdeterminant3x3%20%3D%20function%28a1%2C%20a2%2C%20a3%2C%20b1%2C%20b2%2C%20b3%2C%20c1%2C%20c2%2C%20c3%29%0A%7B%0A%20%20%20%20return%20a1%20%2A%20this%2E%5Fdeterminant2x2%28b2%2C%20b3%2C%20c2%2C%20c3%29%20%2D%0A%20%20%20%20%20%20%20%20%20b1%20%2A%20this%2E%5Fdeterminant2x2%28a2%2C%20a3%2C%20c2%2C%20c3%29%20%2B%0A%20%20%20%20%20%20%20%20%20c1%20%2A%20this%2E%5Fdeterminant2x2%28a2%2C%20a3%2C%20b2%2C%20b3%29%3B%0A%7D%3B%0A%0ACanvasMatrix4%2Eprototype%2E%5Fdeterminant4x4%20%3D%20function%28%29%0A%7B%0A%20%20%20%20var%20a1%20%3D%20this%2Em11%3B%0A%20%20%20%20var%20b1%20%3D%20this%2Em12%3B%0A%20%20%20%20var%20c1%20%3D%20this%2Em13%3B%0A%20%20%20%20var%20d1%20%3D%20this%2Em14%3B%0A%0A%20%20%20%20var%20a2%20%3D%20this%2Em21%3B%0A%20%20%20%20var%20b2%20%3D%20this%2Em22%3B%0A%20%20%20%20var%20c2%20%3D%20this%2Em23%3B%0A%20%20%20%20var%20d2%20%3D%20this%2Em24%3B%0A%0A%20%20%20%20var%20a3%20%3D%20this%2Em31%3B%0A%20%20%20%20var%20b3%20%3D%20this%2Em32%3B%0A%20%20%20%20var%20c3%20%3D%20this%2Em33%3B%0A%20%20%20%20var%20d3%20%3D%20this%2Em34%3B%0A%0A%20%20%20%20var%20a4%20%3D%20this%2Em41%3B%0A%20%20%20%20var%20b4%20%3D%20this%2Em42%3B%0A%20%20%20%20var%20c4%20%3D%20this%2Em43%3B%0A%20%20%20%20var%20d4%20%3D%20this%2Em44%3B%0A%0A%20%20%20%20return%20a1%20%2A%20this%2E%5Fdeterminant3x3%28b2%2C%20b3%2C%20b4%2C%20c2%2C%20c3%2C%20c4%2C%20d2%2C%20d3%2C%20d4%29%20%2D%0A%20%20%20%20%20%20%20%20%20b1%20%2A%20this%2E%5Fdeterminant3x3%28a2%2C%20a3%2C%20a4%2C%20c2%2C%20c3%2C%20c4%2C%20d2%2C%20d3%2C%20d4%29%20%2B%0A%20%20%20%20%20%20%20%20%20c1%20%2A%20this%2E%5Fdeterminant3x3%28a2%2C%20a3%2C%20a4%2C%20b2%2C%20b3%2C%20b4%2C%20d2%2C%20d3%2C%20d4%29%20%2D%0A%20%20%20%20%20%20%20%20%20d1%20%2A%20this%2E%5Fdeterminant3x3%28a2%2C%20a3%2C%20a4%2C%20b2%2C%20b3%2C%20b4%2C%20c2%2C%20c3%2C%20c4%29%3B%0A%7D%3B%0A%0ACanvasMatrix4%2Eprototype%2E%5FmakeAdjoint%20%3D%20function%28%29%0A%7B%0A%20%20%20%20var%20a1%20%3D%20this%2Em11%3B%0A%20%20%20%20var%20b1%20%3D%20this%2Em12%3B%0A%20%20%20%20var%20c1%20%3D%20this%2Em13%3B%0A%20%20%20%20var%20d1%20%3D%20this%2Em14%3B%0A%0A%20%20%20%20var%20a2%20%3D%20this%2Em21%3B%0A%20%20%20%20var%20b2%20%3D%20this%2Em22%3B%0A%20%20%20%20var%20c2%20%3D%20this%2Em23%3B%0A%20%20%20%20var%20d2%20%3D%20this%2Em24%3B%0A%0A%20%20%20%20var%20a3%20%3D%20this%2Em31%3B%0A%20%20%20%20var%20b3%20%3D%20this%2Em32%3B%0A%20%20%20%20var%20c3%20%3D%20this%2Em33%3B%0A%20%20%20%20var%20d3%20%3D%20this%2Em34%3B%0A%0A%20%20%20%20var%20a4%20%3D%20this%2Em41%3B%0A%20%20%20%20var%20b4%20%3D%20this%2Em42%3B%0A%20%20%20%20var%20c4%20%3D%20this%2Em43%3B%0A%20%20%20%20var%20d4%20%3D%20this%2Em44%3B%0A%0A%20%20%20%20%2F%2F%20Row%20column%20labeling%20reversed%20since%20we%20transpose%20rows%20%26%20columns%0A%20%20%20%20this%2Em11%20%20%3D%20%20%20this%2E%5Fdeterminant3x3%28b2%2C%20b3%2C%20b4%2C%20c2%2C%20c3%2C%20c4%2C%20d2%2C%20d3%2C%20d4%29%3B%0A%20%20%20%20this%2Em21%20%20%3D%20%2D%20this%2E%5Fdeterminant3x3%28a2%2C%20a3%2C%20a4%2C%20c2%2C%20c3%2C%20c4%2C%20d2%2C%20d3%2C%20d4%29%3B%0A%20%20%20%20this%2Em31%20%20%3D%20%20%20this%2E%5Fdeterminant3x3%28a2%2C%20a3%2C%20a4%2C%20b2%2C%20b3%2C%20b4%2C%20d2%2C%20d3%2C%20d4%29%3B%0A%20%20%20%20this%2Em41%20%20%3D%20%2D%20this%2E%5Fdeterminant3x3%28a2%2C%20a3%2C%20a4%2C%20b2%2C%20b3%2C%20b4%2C%20c2%2C%20c3%2C%20c4%29%3B%0A%0A%20%20%20%20this%2Em12%20%20%3D%20%2D%20this%2E%5Fdeterminant3x3%28b1%2C%20b3%2C%20b4%2C%20c1%2C%20c3%2C%20c4%2C%20d1%2C%20d3%2C%20d4%29%3B%0A%20%20%20%20this%2Em22%20%20%3D%20%20%20this%2E%5Fdeterminant3x3%28a1%2C%20a3%2C%20a4%2C%20c1%2C%20c3%2C%20c4%2C%20d1%2C%20d3%2C%20d4%29%3B%0A%20%20%20%20this%2Em32%20%20%3D%20%2D%20this%2E%5Fdeterminant3x3%28a1%2C%20a3%2C%20a4%2C%20b1%2C%20b3%2C%20b4%2C%20d1%2C%20d3%2C%20d4%29%3B%0A%20%20%20%20this%2Em42%20%20%3D%20%20%20this%2E%5Fdeterminant3x3%28a1%2C%20a3%2C%20a4%2C%20b1%2C%20b3%2C%20b4%2C%20c1%2C%20c3%2C%20c4%29%3B%0A%0A%20%20%20%20this%2Em13%20%20%3D%20%20%20this%2E%5Fdeterminant3x3%28b1%2C%20b2%2C%20b4%2C%20c1%2C%20c2%2C%20c4%2C%20d1%2C%20d2%2C%20d4%29%3B%0A%20%20%20%20this%2Em23%20%20%3D%20%2D%20this%2E%5Fdeterminant3x3%28a1%2C%20a2%2C%20a4%2C%20c1%2C%20c2%2C%20c4%2C%20d1%2C%20d2%2C%20d4%29%3B%0A%20%20%20%20this%2Em33%20%20%3D%20%20%20this%2E%5Fdeterminant3x3%28a1%2C%20a2%2C%20a4%2C%20b1%2C%20b2%2C%20b4%2C%20d1%2C%20d2%2C%20d4%29%3B%0A%20%20%20%20this%2Em43%20%20%3D%20%2D%20this%2E%5Fdeterminant3x3%28a1%2C%20a2%2C%20a4%2C%20b1%2C%20b2%2C%20b4%2C%20c1%2C%20c2%2C%20c4%29%3B%0A%0A%20%20%20%20this%2Em14%20%20%3D%20%2D%20this%2E%5Fdeterminant3x3%28b1%2C%20b2%2C%20b3%2C%20c1%2C%20c2%2C%20c3%2C%20d1%2C%20d2%2C%20d3%29%3B%0A%20%20%20%20this%2Em24%20%20%3D%20%20%20this%2E%5Fdeterminant3x3%28a1%2C%20a2%2C%20a3%2C%20c1%2C%20c2%2C%20c3%2C%20d1%2C%20d2%2C%20d3%29%3B%0A%20%20%20%20this%2Em34%20%20%3D%20%2D%20this%2E%5Fdeterminant3x3%28a1%2C%20a2%2C%20a3%2C%20b1%2C%20b2%2C%20b3%2C%20d1%2C%20d2%2C%20d3%29%3B%0A%20%20%20%20this%2Em44%20%20%3D%20%20%20this%2E%5Fdeterminant3x3%28a1%2C%20a2%2C%20a3%2C%20b1%2C%20b2%2C%20b3%2C%20c1%2C%20c2%2C%20c3%29%3B%0A%7D%3B%0A"></script>
<script src="data:application/x-javascript,%2F%2A%20el%20is%20the%20div%2C%20holding%20the%20rgl%20object%20as%20el%2Erglinstance%2C%0A%20%20%20%20%20which%20holds%20x%20as%20el%2Erglinstance%2Escene%0A%20%20%20x%20is%20the%20JSON%20encoded%20rglwidget%2E%0A%2A%2F%0A%0A%0AHTMLWidgets%2Ewidget%28%7B%0A%0A%20%20name%3A%20%27rglWebGL%27%2C%0A%0A%20%20type%3A%20%27output%27%2C%0A%0A%20%20initialize%3A%20function%28el%2C%20width%2C%20height%29%20%7B%0A%20%20%20%20el%2Ewidth%20%3D%20width%3B%0A%20%20%20%20el%2Eheight%20%3D%20height%3B%0A%20%20%20%20return%20%7B%7D%3B%0A%0A%20%20%7D%2C%0A%0A%20%20renderValue%3A%20function%28el%2C%20x%29%20%7B%0A%20%20%20%20var%20rgl%20%3D%20new%20rglwidgetClass%28%29%2C%20i%2C%20pel%2C%20player%3B%0A%20%20%20%20%0A%20%20%20%20rgl%2Einitialize%28el%2C%20x%29%3B%0A%20%20%20%20rgl%2EinitGL%28%29%3B%0A%20%20%20%20%0A%20%20%20%20%2F%2A%20We%20might%20have%20been%20called%20after%20%28some%20of%29%20the%20players%20were%20rendered%2E%0A%20%20%20%20%20%20%20We%20need%20to%20make%20sure%20we%20respond%20to%20their%20initial%20values%2E%20%2A%2F%0A%0A%20%20%20%20if%20%28typeof%20x%2Eplayers%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20var%20players%20%3D%20%5B%5D%2Econcat%28x%2Eplayers%29%3B%0A%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20players%2Elength%3B%20i%2B%2B%29%20%7B%0A%20%20%20%20%20%20%20%20pel%20%3D%20window%5Bplayers%5Bi%5D%5D%3B%0A%20%20%20%20%20%20%20%20if%20%28typeof%20pel%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20player%20%3D%20pel%2ErglPlayer%3B%0A%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20player%20%21%3D%3D%20%22undefined%22%20%26%26%20%21player%2Einitialized%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20rgl%2EPlayer%28pel%2C%20player%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20player%2Einitialized%20%3D%20true%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%20else%0A%20%20%20%20%20%20%20%20%20%20rgl%2EalertOnce%28%22Controller%20%27%22%20%2B%20players%5Bi%5D%20%2B%20%22%27%20not%20found%2E%22%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20rgl%2Edrag%20%3D%200%3B%0A%20%20%20%20rgl%2EdrawScene%28%29%3B%0A%20%20%7D%2C%0A%0A%20%20resize%3A%20function%28el%2C%20width%2C%20height%29%20%7B%0A%20%20%20%20el%2Ewidth%20%3D%20width%3B%0A%20%20%20%20el%2Eheight%20%3D%20height%3B%0A%20%20%20%20el%2Erglinstance%2Eresize%28el%29%3B%0A%20%20%20%20el%2Erglinstance%2EdrawScene%28%29%3B%0A%20%20%7D%0A%0A%7D%29%3B%0A"></script>
<script src="data:application/x-javascript,%2F%2A%20el%20is%20the%20%3Cspan%3E%2C%20holding%20x%20as%20el%2ErglPlayer%0A%20%20%20x%20is%20the%20JSON%20encoded%20playwidget%2E%0A%20%20%20instance%20holds%20x%20as%20instance%2ErglPlayer%0A%2A%2F%0A%0AHTMLWidgets%2Ewidget%28%7B%0A%0A%20%20name%3A%20%27rglPlayer%27%2C%0A%0A%20%20type%3A%20%27output%27%2C%0A%0A%20%20initialize%3A%20function%28el%2C%20width%2C%20height%29%20%7B%0A%20%20%20%20return%20%7B%0A%20%20%20%20%7D%3B%0A%0A%20%20%7D%2C%0A%0A%20%20renderValue%3A%20function%28el%2C%20x%2C%20instance%29%20%7B%0A%20%20%20%20var%20ShowValue%20%3D%20function%28value%29%20%7B%0A%20%20%20%20%20%20%20%20var%20rglinstance%20%3D%20window%5Bx%2EsceneId%5D%2Erglinstance%3B%0A%20%20%20%20%20%20%20%20x%2Evalue%20%3D%20value%3B%0A%20%20%20%20%20%20%2F%2A%20We%20might%20be%20running%20before%20the%20scene%20exists%2E%20%20If%20so%2C%20it%0A%20%20%20%20%20%20%20%20%20will%20have%20to%20apply%20our%20initial%20value%2E%20%2A%2F%0A%20%20%20%20%20%20%20%20if%20%28typeof%20rglinstance%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20rglinstance%2EPlayer%28el%2C%20x%29%3B%0A%20%20%20%20%20%20%20%20%20%20x%2Einitialized%20%3D%20true%3B%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20x%2Einitialized%20%3D%20false%3B%0A%20%20%20%20%20%20%20%20%20%20instance%2ErglPlayer%20%3D%20x%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20el%2ErglPlayer%20%3D%20x%3B%0A%20%20%20%20instance%2ErglPlayer%20%3D%20x%3B%0A%0A%20%20%20%20if%20%28x%2ErespondTo%20%21%3D%3D%20null%29%20%7B%0A%20%20%20%20%20%20var%20control%20%3D%20window%5Bx%2ErespondTo%5D%3B%0A%20%20%20%20%20%20if%20%28typeof%20control%20%21%3D%3D%20%22undefined%22%29%20%7B%0A%20%20%20%20%20%20%20%20var%20self%20%3D%20this%2C%20i%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20state%20%3D%20%22idle%22%3B%0A%0A%20%20%20%20%20%20%20%20%2F%2A%20Store%20the%20previous%20handler%20on%20the%20control%2C%0A%20%20%20%20%20%20%20%20%20%20%20so%20multiple%20calls%20here%20don%27t%20pile%20up%20a%20chain%20of%0A%20%20%20%20%20%20%20%20%20%20%20old%20handlers%20%2A%2F%0A%0A%20%20%20%20%20%20%20%20if%20%28typeof%20control%2ErglOldhandler%20%3D%3D%3D%20%22undefined%22%29%0A%20%20%20%20%20%20%20%20%20%20control%2ErglOldhandler%20%3D%20control%2Eonchange%3B%0A%0A%20%20%20%20%20%20%20%20control%2Eonchange%20%3D%20function%28%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20var%20value%3B%0A%20%20%20%20%20%20%20%20%20%20%2F%2A%20If%20we%20are%20called%20n%3E0%20times%20while%20servicing%20a%20previous%20call%2C%20we%20want%20to%20finish%0A%20%20%20%20%20%20%20%20%20%20%20%20%20the%20current%20call%2C%20then%20run%20again%2E%20%20But%20the%20old%20handler%20might%20want%20to%0A%20%20%20%20%20%20%20%20%20%20%20%20%20see%20every%20change%2E%20%2A%2F%0A%20%20%20%20%20%20%20%20%20%20if%20%28state%20%21%3D%3D%20%22idle%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20state%20%3D%20%22interrupted%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28control%2ErglOldhandler%20%21%3D%3D%20null%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20control%2ErglOldhandler%2Ecall%28this%29%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20do%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20state%20%3D%20%22busy%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28control%2ErglOldhandler%20%21%3D%3D%20null%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20control%2ErglOldhandler%2Ecall%28this%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28control%2Etype%20%3D%3D%20%22checkbox%22%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20%3D%20control%2Echecked%20%3F%200%20%3A%201%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20%3D%20control%2Evalue%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20ShowValue%28value%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28state%20%3D%3D%3D%20%22busy%22%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20state%20%3D%20%22idle%22%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%20while%20%28state%20%21%3D%3D%20%22idle%22%29%3B%0A%20%20%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%20%20%20%20control%2Eonchange%28%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20ShowValue%28x%2Evalue%29%3B%0A%20%20%7D%2C%0A%0A%20%20resize%3A%20function%28el%2C%20width%2C%20height%2C%20instance%29%20%7B%0A%20%20%7D%0A%0A%7D%29%3B%0A"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>



<link href="data:text/css,body%20%7B%0A%20%20background%2Dcolor%3A%20%23fff%3B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20max%2Dwidth%3A%20700px%3B%0A%20%20overflow%3A%20visible%3B%0A%20%20padding%2Dleft%3A%202em%3B%0A%20%20padding%2Dright%3A%202em%3B%0A%20%20font%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0A%20%20font%2Dsize%3A%2014px%3B%0A%20%20line%2Dheight%3A%201%2E35%3B%0A%7D%0A%0A%23header%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0A%0A%23TOC%20%7B%0A%20%20clear%3A%20both%3B%0A%20%20margin%3A%200%200%2010px%2010px%3B%0A%20%20padding%3A%204px%3B%0A%20%20width%3A%20400px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20border%2Dradius%3A%205px%3B%0A%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20font%2Dsize%3A%2013px%3B%0A%20%20line%2Dheight%3A%201%2E3%3B%0A%7D%0A%20%20%23TOC%20%2Etoctitle%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%20%20font%2Dsize%3A%2015px%3B%0A%20%20%20%20margin%2Dleft%3A%205px%3B%0A%20%20%7D%0A%0A%20%20%23TOC%20ul%20%7B%0A%20%20%20%20padding%2Dleft%3A%2040px%3B%0A%20%20%20%20margin%2Dleft%3A%20%2D1%2E5em%3B%0A%20%20%20%20margin%2Dtop%3A%205px%3B%0A%20%20%20%20margin%2Dbottom%3A%205px%3B%0A%20%20%7D%0A%20%20%23TOC%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dleft%3A%20%2D2em%3B%0A%20%20%7D%0A%20%20%23TOC%20li%20%7B%0A%20%20%20%20line%2Dheight%3A%2016px%3B%0A%20%20%7D%0A%0Atable%20%7B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dcolor%3A%20%23DDDDDD%3B%0A%20%20border%2Dstyle%3A%20outset%3B%0A%20%20border%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0A%20%20border%2Dwidth%3A%202px%3B%0A%20%20padding%3A%205px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%20%20line%2Dheight%3A%2018px%3B%0A%20%20padding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0A%20%20border%2Dleft%2Dstyle%3A%20none%3B%0A%20%20border%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Ap%20%7B%0A%20%20margin%3A%200%2E5em%200%3B%0A%7D%0A%0Ablockquote%20%7B%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20padding%3A%200%2E25em%200%2E75em%3B%0A%7D%0A%0Ahr%20%7B%0A%20%20border%2Dstyle%3A%20solid%3B%0A%20%20border%3A%20none%3B%0A%20%20border%2Dtop%3A%201px%20solid%20%23777%3B%0A%20%20margin%3A%2028px%200%3B%0A%7D%0A%0Adl%20%7B%0A%20%20margin%2Dleft%3A%200%3B%0A%7D%0A%20%20dl%20dd%20%7B%0A%20%20%20%20margin%2Dbottom%3A%2013px%3B%0A%20%20%20%20margin%2Dleft%3A%2013px%3B%0A%20%20%7D%0A%20%20dl%20dt%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%7D%0A%0Aul%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%7D%0A%20%20ul%20li%20%7B%0A%20%20%20%20list%2Dstyle%3A%20circle%20outside%3B%0A%20%20%7D%0A%20%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dbottom%3A%200%3B%0A%20%20%7D%0A%0Apre%2C%20code%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20color%3A%20%23333%3B%0A%20%20white%2Dspace%3A%20pre%2Dwrap%3B%20%20%20%20%2F%2A%20Wrap%20long%20lines%20%2A%2F%0A%7D%0Apre%20%7B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20margin%3A%205px%200px%2010px%200px%3B%0A%20%20padding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Acode%20%7B%0A%20%20font%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0A%20%20font%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0A%20%20padding%3A%202px%200px%3B%0A%7D%0A%0Adiv%2Efigure%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0A%20%20background%2Dcolor%3A%20%23FFFFFF%3B%0A%20%20padding%3A%202px%3B%0A%20%20border%3A%201px%20solid%20%23DDDDDD%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20margin%3A%200%205px%3B%0A%7D%0A%0Ah1%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%20%20font%2Dsize%3A%2035px%3B%0A%20%20line%2Dheight%3A%2040px%3B%0A%7D%0A%0Ah2%20%7B%0A%20%20border%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20padding%2Dbottom%3A%202px%3B%0A%20%20font%2Dsize%3A%20145%25%3B%0A%7D%0A%0Ah3%20%7B%0A%20%20border%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20font%2Dsize%3A%20120%25%3B%0A%7D%0A%0Ah4%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0A%20%20margin%2Dleft%3A%208px%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Ah5%2C%20h6%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23ccc%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Aa%20%7B%0A%20%20color%3A%20%230033dd%3B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%7D%0A%20%20a%3Ahover%20%7B%0A%20%20%20%20color%3A%20%236666ff%3B%20%7D%0A%20%20a%3Avisited%20%7B%0A%20%20%20%20color%3A%20%23800080%3B%20%7D%0A%20%20a%3Avisited%3Ahover%20%7B%0A%20%20%20%20color%3A%20%23BB00BB%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%0A%2F%2A%20Class%20described%20in%20https%3A%2F%2Fbenjeffrey%2Ecom%2Fposts%2Fpandoc%2Dsyntax%2Dhighlighting%2Dcss%0A%20%20%20Colours%20from%20https%3A%2F%2Fgist%2Egithub%2Ecom%2Frobsimmons%2F1172277%20%2A%2F%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Keyword%20%2A%2F%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%2F%2A%20DataType%20%2A%2F%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%2F%2A%20DecVal%20%28decimal%20values%29%20%2A%2F%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20BaseN%20%2A%2F%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Float%20%2A%2F%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Char%20%2A%2F%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20String%20%2A%2F%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%2F%2A%20Comment%20%2A%2F%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%2F%2A%20OtherToken%20%2A%2F%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20AlertToken%20%2A%2F%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Function%20calls%20%2A%2F%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%2F%2A%20ErrorTok%20%2A%2F%0A%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Legacy WebGL Methods</h1>
<h4 class="author"><em>Duncan Murdoch</em></h4>
<h4 class="date"><em>December 12, 2017</em></h4>


<div id="TOC">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#browser-support">Browser support</a></li>
<li><a href="#examples">Examples</a></li>
<li><a href="#autogenerated-controls">Autogenerated controls</a></li>
<li><a href="#user-defined-mouse-controls">User defined mouse controls</a></li>
<li><a href="#reference-for-rglclass">Reference for <code>rglClass</code></a><ul>
<li><a href="#methods">Methods</a></li>
<li><a href="#properties">Properties</a></li>
</ul></li>
<li><a href="#index">Index</a></li>
</ul>
</div>

<style>
    .nostripes tr.even {background-color: white;}
    table {border-style: none;}
    table th {border-style: none;}
    table td {border-style: none;}
    a[href^=".."] {text-decoration: underline;}
    </style>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>This document describes the original ways to embed <code>rgl</code> scenes in HTML documents and use embedded Javascript to control a WebGL display in an HTML document. For more general information, see <a href="rgl.html">rgl Overview</a>. For more recent recommended methods, see <a href="WebGL.html">User Interaction in WebGL</a>.</p>
<p>We mainly assume that the HTML document is produced from R markdown source using <code>knitr</code> or <code>rmarkdown</code>, though some methods dont require this. This format mixes text with Markdown markup with chunks of R code.</p>
<p>There are two ways to embed an <code>rgl</code> scene in the document. The older one is to use the chunk option <code>webgl = TRUE</code>. With that option, whatever <code>rgl</code> scene is active at the end of the chunk will be embedded. See the <a href="../../rgl/help/setupKnitr"><code>setupKnitr</code></a> help page.</p>
<p>The second way is to use a call to <a href="#rglwidget"><code>rglwidget</code></a>. Each call to this function will insert a scene into the document. Do not set <code>webgl = TRUE</code>. That is the recommended method, and is described in <a href="WebGL.html">User Interaction in WebGL</a>.</p>
<p>The second method is easier for me to maintain, and will receive more support in the future, but for now both methods are supported, and there are examples of both in this document.</p>
</div>
<div id="browser-support" class="section level2">
<h2>Browser support</h2>
<p>Most browsers now support WebGL, but it may be disabled by default. See <a href="http://get.webgl.org" class="uri">http://get.webgl.org</a> for help on a number of different browsers.</p>
<p>If you are using the internal browser in RStudio, support varies by version. I believe it is enabled by default in Windows versions, but until recently was not enabled in Mac OSX versions. You can run this command in Terminal:</p>
<pre><code>defaults write org.rstudio.RStudio WebKitWebGLEnabled -bool YES</code></pre>
<p>to enable it. I do not have much experience with RStudio in Linux, but it does seem that WebGL is enabled there.</p>
</div>
<div id="examples" class="section level2">
<h2>Examples</h2>
<p>We start with two simple examples. The next section gives reference information.</p>
<p>Consider the simple plot of the iris data. We insert a code chunk and call the <a href="#rglwidget"><code>rglwidget</code></a> function with optional argument <code>elementId</code>. This allows later Javascript code to refer to the image.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rgl)
<span class="kw">with</span>(iris, <span class="kw">plot3d</span>(Sepal.Length, Sepal.Width, Petal.Length, 
                  <span class="dt">type=</span><span class="st">&quot;s&quot;</span>, <span class="dt">col=</span><span class="kw">as.numeric</span>(Species)))
subid &lt;-<span class="st"> </span><span class="kw">currentSubscene3d</span>()
<span class="kw">rglwidget</span>(<span class="dt">elementId=</span><span class="st">&quot;plot3drgl&quot;</span>)</code></pre>
<p><div id="plot3drgl" style="width:480px;height:480px;" class="rglWebGL html-widget"></div>
<script type="application/json" data-for="plot3drgl">{"x":{"material":{"color":"#000000","alpha":1,"lit":true,"ambient":"#000000","specular":"#FFFFFF","emission":"#000000","shininess":50,"smooth":true,"front":"filled","back":"filled","size":3,"lwd":1,"fog":false,"point_antialias":false,"line_antialias":false,"texture":null,"textype":"rgb","texmipmap":false,"texminfilter":"linear","texmagfilter":"linear","texenvmap":false,"depth_mask":true,"depth_test":"less","isTransparent":false},"rootSubscene":1,"objects":{"156":{"id":156,"type":"spheres","material":{},"vertices":[[5.09999990463257,3.5,1.39999997615814],[4.90000009536743,3,1.39999997615814],[4.69999980926514,3.20000004768372,1.29999995231628],[4.59999990463257,3.09999990463257,1.5],[5,3.59999990463257,1.39999997615814],[5.40000009536743,3.90000009536743,1.70000004768372],[4.59999990463257,3.40000009536743,1.39999997615814],[5,3.40000009536743,1.5],[4.40000009536743,2.90000009536743,1.39999997615814],[4.90000009536743,3.09999990463257,1.5],[5.40000009536743,3.70000004768372,1.5],[4.80000019073486,3.40000009536743,1.60000002384186],[4.80000019073486,3,1.39999997615814],[4.30000019073486,3,1.10000002384186],[5.80000019073486,4,1.20000004768372],[5.69999980926514,4.40000009536743,1.5],[5.40000009536743,3.90000009536743,1.29999995231628],[5.09999990463257,3.5,1.39999997615814],[5.69999980926514,3.79999995231628,1.70000004768372],[5.09999990463257,3.79999995231628,1.5],[5.40000009536743,3.40000009536743,1.70000004768372],[5.09999990463257,3.70000004768372,1.5],[4.59999990463257,3.59999990463257,1],[5.09999990463257,3.29999995231628,1.70000004768372],[4.80000019073486,3.40000009536743,1.89999997615814],[5,3,1.60000002384186],[5,3.40000009536743,1.60000002384186],[5.19999980926514,3.5,1.5],[5.19999980926514,3.40000009536743,1.39999997615814],[4.69999980926514,3.20000004768372,1.60000002384186],[4.80000019073486,3.09999990463257,1.60000002384186],[5.40000009536743,3.40000009536743,1.5],[5.19999980926514,4.09999990463257,1.5],[5.5,4.19999980926514,1.39999997615814],[4.90000009536743,3.09999990463257,1.5],[5,3.20000004768372,1.20000004768372],[5.5,3.5,1.29999995231628],[4.90000009536743,3.59999990463257,1.39999997615814],[4.40000009536743,3,1.29999995231628],[5.09999990463257,3.40000009536743,1.5],[5,3.5,1.29999995231628],[4.5,2.29999995231628,1.29999995231628],[4.40000009536743,3.20000004768372,1.29999995231628],[5,3.5,1.60000002384186],[5.09999990463257,3.79999995231628,1.89999997615814],[4.80000019073486,3,1.39999997615814],[5.09999990463257,3.79999995231628,1.60000002384186],[4.59999990463257,3.20000004768372,1.39999997615814],[5.30000019073486,3.70000004768372,1.5],[5,3.29999995231628,1.39999997615814],[7,3.20000004768372,4.69999980926514],[6.40000009536743,3.20000004768372,4.5],[6.90000009536743,3.09999990463257,4.90000009536743],[5.5,2.29999995231628,4],[6.5,2.79999995231628,4.59999990463257],[5.69999980926514,2.79999995231628,4.5],[6.30000019073486,3.29999995231628,4.69999980926514],[4.90000009536743,2.40000009536743,3.29999995231628],[6.59999990463257,2.90000009536743,4.59999990463257],[5.19999980926514,2.70000004768372,3.90000009536743],[5,2,3.5],[5.90000009536743,3,4.19999980926514],[6,2.20000004768372,4],[6.09999990463257,2.90000009536743,4.69999980926514],[5.59999990463257,2.90000009536743,3.59999990463257],[6.69999980926514,3.09999990463257,4.40000009536743],[5.59999990463257,3,4.5],[5.80000019073486,2.70000004768372,4.09999990463257],[6.19999980926514,2.20000004768372,4.5],[5.59999990463257,2.5,3.90000009536743],[5.90000009536743,3.20000004768372,4.80000019073486],[6.09999990463257,2.79999995231628,4],[6.30000019073486,2.5,4.90000009536743],[6.09999990463257,2.79999995231628,4.69999980926514],[6.40000009536743,2.90000009536743,4.30000019073486],[6.59999990463257,3,4.40000009536743],[6.80000019073486,2.79999995231628,4.80000019073486],[6.69999980926514,3,5],[6,2.90000009536743,4.5],[5.69999980926514,2.59999990463257,3.5],[5.5,2.40000009536743,3.79999995231628],[5.5,2.40000009536743,3.70000004768372],[5.80000019073486,2.70000004768372,3.90000009536743],[6,2.70000004768372,5.09999990463257],[5.40000009536743,3,4.5],[6,3.40000009536743,4.5],[6.69999980926514,3.09999990463257,4.69999980926514],[6.30000019073486,2.29999995231628,4.40000009536743],[5.59999990463257,3,4.09999990463257],[5.5,2.5,4],[5.5,2.59999990463257,4.40000009536743],[6.09999990463257,3,4.59999990463257],[5.80000019073486,2.59999990463257,4],[5,2.29999995231628,3.29999995231628],[5.59999990463257,2.70000004768372,4.19999980926514],[5.69999980926514,3,4.19999980926514],[5.69999980926514,2.90000009536743,4.19999980926514],[6.19999980926514,2.90000009536743,4.30000019073486],[5.09999990463257,2.5,3],[5.69999980926514,2.79999995231628,4.09999990463257],[6.30000019073486,3.29999995231628,6],[5.80000019073486,2.70000004768372,5.09999990463257],[7.09999990463257,3,5.90000009536743],[6.30000019073486,2.90000009536743,5.59999990463257],[6.5,3,5.80000019073486],[7.59999990463257,3,6.59999990463257],[4.90000009536743,2.5,4.5],[7.30000019073486,2.90000009536743,6.30000019073486],[6.69999980926514,2.5,5.80000019073486],[7.19999980926514,3.59999990463257,6.09999990463257],[6.5,3.20000004768372,5.09999990463257],[6.40000009536743,2.70000004768372,5.30000019073486],[6.80000019073486,3,5.5],[5.69999980926514,2.5,5],[5.80000019073486,2.79999995231628,5.09999990463257],[6.40000009536743,3.20000004768372,5.30000019073486],[6.5,3,5.5],[7.69999980926514,3.79999995231628,6.69999980926514],[7.69999980926514,2.59999990463257,6.90000009536743],[6,2.20000004768372,5],[6.90000009536743,3.20000004768372,5.69999980926514],[5.59999990463257,2.79999995231628,4.90000009536743],[7.69999980926514,2.79999995231628,6.69999980926514],[6.30000019073486,2.70000004768372,4.90000009536743],[6.69999980926514,3.29999995231628,5.69999980926514],[7.19999980926514,3.20000004768372,6],[6.19999980926514,2.79999995231628,4.80000019073486],[6.09999990463257,3,4.90000009536743],[6.40000009536743,2.79999995231628,5.59999990463257],[7.19999980926514,3,5.80000019073486],[7.40000009536743,2.79999995231628,6.09999990463257],[7.90000009536743,3.79999995231628,6.40000009536743],[6.40000009536743,2.79999995231628,5.59999990463257],[6.30000019073486,2.79999995231628,5.09999990463257],[6.09999990463257,2.59999990463257,5.59999990463257],[7.69999980926514,3,6.09999990463257],[6.30000019073486,3.40000009536743,5.59999990463257],[6.40000009536743,3.09999990463257,5.5],[6,3,4.80000019073486],[6.90000009536743,3.09999990463257,5.40000009536743],[6.69999980926514,3.09999990463257,5.59999990463257],[6.90000009536743,3.09999990463257,5.09999990463257],[5.80000019073486,2.70000004768372,5.09999990463257],[6.80000019073486,3.20000004768372,5.90000009536743],[6.69999980926514,3.29999995231628,5.69999980926514],[6.69999980926514,3,5.19999980926514],[6.30000019073486,2.5,5],[6.5,3,5.19999980926514],[6.19999980926514,3.40000009536743,5.40000009536743],[5.90000009536743,3,5.09999990463257]],"colors":[[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1]],"radii":[[0.21120685338974]],"centers":[[5.09999990463257,3.5,1.39999997615814],[4.90000009536743,3,1.39999997615814],[4.69999980926514,3.20000004768372,1.29999995231628],[4.59999990463257,3.09999990463257,1.5],[5,3.59999990463257,1.39999997615814],[5.40000009536743,3.90000009536743,1.70000004768372],[4.59999990463257,3.40000009536743,1.39999997615814],[5,3.40000009536743,1.5],[4.40000009536743,2.90000009536743,1.39999997615814],[4.90000009536743,3.09999990463257,1.5],[5.40000009536743,3.70000004768372,1.5],[4.80000019073486,3.40000009536743,1.60000002384186],[4.80000019073486,3,1.39999997615814],[4.30000019073486,3,1.10000002384186],[5.80000019073486,4,1.20000004768372],[5.69999980926514,4.40000009536743,1.5],[5.40000009536743,3.90000009536743,1.29999995231628],[5.09999990463257,3.5,1.39999997615814],[5.69999980926514,3.79999995231628,1.70000004768372],[5.09999990463257,3.79999995231628,1.5],[5.40000009536743,3.40000009536743,1.70000004768372],[5.09999990463257,3.70000004768372,1.5],[4.59999990463257,3.59999990463257,1],[5.09999990463257,3.29999995231628,1.70000004768372],[4.80000019073486,3.40000009536743,1.89999997615814],[5,3,1.60000002384186],[5,3.40000009536743,1.60000002384186],[5.19999980926514,3.5,1.5],[5.19999980926514,3.40000009536743,1.39999997615814],[4.69999980926514,3.20000004768372,1.60000002384186],[4.80000019073486,3.09999990463257,1.60000002384186],[5.40000009536743,3.40000009536743,1.5],[5.19999980926514,4.09999990463257,1.5],[5.5,4.19999980926514,1.39999997615814],[4.90000009536743,3.09999990463257,1.5],[5,3.20000004768372,1.20000004768372],[5.5,3.5,1.29999995231628],[4.90000009536743,3.59999990463257,1.39999997615814],[4.40000009536743,3,1.29999995231628],[5.09999990463257,3.40000009536743,1.5],[5,3.5,1.29999995231628],[4.5,2.29999995231628,1.29999995231628],[4.40000009536743,3.20000004768372,1.29999995231628],[5,3.5,1.60000002384186],[5.09999990463257,3.79999995231628,1.89999997615814],[4.80000019073486,3,1.39999997615814],[5.09999990463257,3.79999995231628,1.60000002384186],[4.59999990463257,3.20000004768372,1.39999997615814],[5.30000019073486,3.70000004768372,1.5],[5,3.29999995231628,1.39999997615814],[7,3.20000004768372,4.69999980926514],[6.40000009536743,3.20000004768372,4.5],[6.90000009536743,3.09999990463257,4.90000009536743],[5.5,2.29999995231628,4],[6.5,2.79999995231628,4.59999990463257],[5.69999980926514,2.79999995231628,4.5],[6.30000019073486,3.29999995231628,4.69999980926514],[4.90000009536743,2.40000009536743,3.29999995231628],[6.59999990463257,2.90000009536743,4.59999990463257],[5.19999980926514,2.70000004768372,3.90000009536743],[5,2,3.5],[5.90000009536743,3,4.19999980926514],[6,2.20000004768372,4],[6.09999990463257,2.90000009536743,4.69999980926514],[5.59999990463257,2.90000009536743,3.59999990463257],[6.69999980926514,3.09999990463257,4.40000009536743],[5.59999990463257,3,4.5],[5.80000019073486,2.70000004768372,4.09999990463257],[6.19999980926514,2.20000004768372,4.5],[5.59999990463257,2.5,3.90000009536743],[5.90000009536743,3.20000004768372,4.80000019073486],[6.09999990463257,2.79999995231628,4],[6.30000019073486,2.5,4.90000009536743],[6.09999990463257,2.79999995231628,4.69999980926514],[6.40000009536743,2.90000009536743,4.30000019073486],[6.59999990463257,3,4.40000009536743],[6.80000019073486,2.79999995231628,4.80000019073486],[6.69999980926514,3,5],[6,2.90000009536743,4.5],[5.69999980926514,2.59999990463257,3.5],[5.5,2.40000009536743,3.79999995231628],[5.5,2.40000009536743,3.70000004768372],[5.80000019073486,2.70000004768372,3.90000009536743],[6,2.70000004768372,5.09999990463257],[5.40000009536743,3,4.5],[6,3.40000009536743,4.5],[6.69999980926514,3.09999990463257,4.69999980926514],[6.30000019073486,2.29999995231628,4.40000009536743],[5.59999990463257,3,4.09999990463257],[5.5,2.5,4],[5.5,2.59999990463257,4.40000009536743],[6.09999990463257,3,4.59999990463257],[5.80000019073486,2.59999990463257,4],[5,2.29999995231628,3.29999995231628],[5.59999990463257,2.70000004768372,4.19999980926514],[5.69999980926514,3,4.19999980926514],[5.69999980926514,2.90000009536743,4.19999980926514],[6.19999980926514,2.90000009536743,4.30000019073486],[5.09999990463257,2.5,3],[5.69999980926514,2.79999995231628,4.09999990463257],[6.30000019073486,3.29999995231628,6],[5.80000019073486,2.70000004768372,5.09999990463257],[7.09999990463257,3,5.90000009536743],[6.30000019073486,2.90000009536743,5.59999990463257],[6.5,3,5.80000019073486],[7.59999990463257,3,6.59999990463257],[4.90000009536743,2.5,4.5],[7.30000019073486,2.90000009536743,6.30000019073486],[6.69999980926514,2.5,5.80000019073486],[7.19999980926514,3.59999990463257,6.09999990463257],[6.5,3.20000004768372,5.09999990463257],[6.40000009536743,2.70000004768372,5.30000019073486],[6.80000019073486,3,5.5],[5.69999980926514,2.5,5],[5.80000019073486,2.79999995231628,5.09999990463257],[6.40000009536743,3.20000004768372,5.30000019073486],[6.5,3,5.5],[7.69999980926514,3.79999995231628,6.69999980926514],[7.69999980926514,2.59999990463257,6.90000009536743],[6,2.20000004768372,5],[6.90000009536743,3.20000004768372,5.69999980926514],[5.59999990463257,2.79999995231628,4.90000009536743],[7.69999980926514,2.79999995231628,6.69999980926514],[6.30000019073486,2.70000004768372,4.90000009536743],[6.69999980926514,3.29999995231628,5.69999980926514],[7.19999980926514,3.20000004768372,6],[6.19999980926514,2.79999995231628,4.80000019073486],[6.09999990463257,3,4.90000009536743],[6.40000009536743,2.79999995231628,5.59999990463257],[7.19999980926514,3,5.80000019073486],[7.40000009536743,2.79999995231628,6.09999990463257],[7.90000009536743,3.79999995231628,6.40000009536743],[6.40000009536743,2.79999995231628,5.59999990463257],[6.30000019073486,2.79999995231628,5.09999990463257],[6.09999990463257,2.59999990463257,5.59999990463257],[7.69999980926514,3,6.09999990463257],[6.30000019073486,3.40000009536743,5.59999990463257],[6.40000009536743,3.09999990463257,5.5],[6,3,4.80000019073486],[6.90000009536743,3.09999990463257,5.40000009536743],[6.69999980926514,3.09999990463257,5.59999990463257],[6.90000009536743,3.09999990463257,5.09999990463257],[5.80000019073486,2.70000004768372,5.09999990463257],[6.80000019073486,3.20000004768372,5.90000009536743],[6.69999980926514,3.29999995231628,5.69999980926514],[6.69999980926514,3,5.19999980926514],[6.30000019073486,2.5,5],[6.5,3,5.19999980926514],[6.19999980926514,3.40000009536743,5.40000009536743],[5.90000009536743,3,5.09999990463257]],"ignoreExtent":false,"flags":3},"158":{"id":158,"type":"text","material":{"lit":false},"vertices":[[6.10000038146973,1.43252003192902,-0.395055055618286]],"colors":[[0,0,0,1]],"texts":[["Sepal.Length"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[6.10000038146973,1.43252003192902,-0.395055055618286]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":2064},"159":{"id":159,"type":"text","material":{"lit":false},"vertices":[[3.44878053665161,3.20000004768372,-0.395055055618286]],"colors":[[0,0,0,1]],"texts":[["Sepal.Width"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[3.44878053665161,3.20000004768372,-0.395055055618286]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":2064},"160":{"id":160,"type":"text","material":{"lit":false},"vertices":[[3.44878053665161,1.43252003192902,3.95000004768372]],"colors":[[0,0,0,1]],"texts":[["Petal.Length"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[3.44878053665161,1.43252003192902,3.95000004768372]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":2064},"5":{"id":5,"type":"light","vertices":[[0,0,1]],"colors":[[1,1,1,1],[1,1,1,1],[1,1,1,1]],"viewpoint":true,"finite":false},"6":{"id":6,"type":"background","material":{"lit":false,"back":"lines"},"colors":[[1,1,1,1]],"centers":[[0,0,0]],"sphere":false,"fogtype":"none","flags":0},"157":{"id":157,"type":"bboxdeco","material":{"front":"lines","back":"lines"},"vertices":[[5,"NA","NA"],[6,"NA","NA"],[7,"NA","NA"],[8,"NA","NA"],["NA",2,"NA"],["NA",2.5,"NA"],["NA",3,"NA"],["NA",3.5,"NA"],["NA",4,"NA"],["NA",4.5,"NA"],["NA","NA",1],["NA","NA",2],["NA","NA",3],["NA","NA",4],["NA","NA",5],["NA","NA",6],["NA","NA",7]],"colors":[[0,0,0,1]],"draw_front":true,"newIds":[168,169,170,171,172,173,174]},"1":{"id":1,"type":"subscene","par3d":{"antialias":1,"FOV":30,"ignoreExtent":false,"listeners":1,"mouseMode":{"left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,19.6937026977539],"modelMatrix":[[1.17337155342102,0,0,-7.15756702423096],[0,0.60197502374649,0.672778010368347,-4.58379316329956],[0,-1.65391266345978,0.24487116932869,-15.3684234619141],[0,0,0,1]],"projMatrix":[[3.73205065727234,0,0,0],[0,3.73205065727234,0,0],[0,0,-3.86370277404785,-70.9935150146484],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[1,0,0,0],[0,0.342020143325668,0.939692620785909,0],[0,-0.939692620785909,0.342020143325668,0],[0,0,0,1]],"scale":[1.17337155342102,1.76005709171295,0.715955376625061],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[4.12000036239624,8.07999992370605,1.87999999523163,4.51999998092651,0.704999983310699,7.19500017166138],"windowRect":[0,0,256,256],"family":"sans","font":1,"cex":1,"useFreeType":false,"fontname":"NULL","maxClipPlanes":2147483647,"glVersion":"NaN"},"embeddings":{"viewport":"replace","projection":"replace","model":"replace"},"objects":[6,157,156,158,159,160,5,168,169,170,171,172,173,174],"subscenes":[],"flags":2643},"168":{"id":168,"type":"lines","material":{"lit":false},"vertices":[[5,1.84039998054504,0.607649981975555],[8,1.84039998054504,0.607649981975555],[5,1.84039998054504,0.607649981975555],[5,1.77242004871368,0.440532475709915],[6,1.84039998054504,0.607649981975555],[6,1.77242004871368,0.440532475709915],[7,1.84039998054504,0.607649981975555],[7,1.77242004871368,0.440532475709915],[8,1.84039998054504,0.607649981975555],[8,1.77242004871368,0.440532475709915]],"colors":[[0,0,0,1]],"centers":[[6.5,1.84039998054504,0.607649981975555],[5,1.80641007423401,0.524091243743896],[6,1.80641007423401,0.524091243743896],[7,1.80641007423401,0.524091243743896],[8,1.80641007423401,0.524091243743896]],"ignoreExtent":true,"origId":157,"flags":64},"169":{"id":169,"type":"text","material":{"lit":false},"vertices":[[5,1.63645994663239,0.106297463178635],[6,1.63645994663239,0.106297463178635],[7,1.63645994663239,0.106297463178635],[8,1.63645994663239,0.106297463178635]],"colors":[[0,0,0,1]],"texts":[["5"],["6"],["7"],["8"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[5,1.63645994663239,0.106297463178635],[6,1.63645994663239,0.106297463178635],[7,1.63645994663239,0.106297463178635],[8,1.63645994663239,0.106297463178635]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"origId":157,"flags":2064},"170":{"id":170,"type":"lines","material":{"lit":false},"vertices":[[4.06060028076172,2,0.607649981975555],[4.06060028076172,4.5,0.607649981975555],[4.06060028076172,2,0.607649981975555],[3.95863032341003,2,0.440532475709915],[4.06060028076172,2.5,0.607649981975555],[3.95863032341003,2.5,0.440532475709915],[4.06060028076172,3,0.607649981975555],[3.95863032341003,3,0.440532475709915],[4.06060028076172,3.5,0.607649981975555],[3.95863032341003,3.5,0.440532475709915],[4.06060028076172,4,0.607649981975555],[3.95863032341003,4,0.440532475709915],[4.06060028076172,4.5,0.607649981975555],[3.95863032341003,4.5,0.440532475709915]],"colors":[[0,0,0,1]],"centers":[[4.06060028076172,3.25,0.607649981975555],[4.00961542129517,2,0.524091243743896],[4.00961542129517,2.5,0.524091243743896],[4.00961542129517,3,0.524091243743896],[4.00961542129517,3.5,0.524091243743896],[4.00961542129517,4,0.524091243743896],[4.00961542129517,4.5,0.524091243743896]],"ignoreExtent":true,"origId":157,"flags":64},"171":{"id":171,"type":"text","material":{"lit":false},"vertices":[[3.75469040870667,2,0.106297463178635],[3.75469040870667,2.5,0.106297463178635],[3.75469040870667,3,0.106297463178635],[3.75469040870667,3.5,0.106297463178635],[3.75469040870667,4,0.106297463178635],[3.75469040870667,4.5,0.106297463178635]],"colors":[[0,0,0,1]],"texts":[["2"],["2.5"],["3"],["3.5"],["4"],["4.5"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[3.75469040870667,2,0.106297463178635],[3.75469040870667,2.5,0.106297463178635],[3.75469040870667,3,0.106297463178635],[3.75469040870667,3.5,0.106297463178635],[3.75469040870667,4,0.106297463178635],[3.75469040870667,4.5,0.106297463178635]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"origId":157,"flags":2064},"172":{"id":172,"type":"lines","material":{"lit":false},"vertices":[[4.06060028076172,1.84039998054504,1],[4.06060028076172,1.84039998054504,7],[4.06060028076172,1.84039998054504,1],[3.95863032341003,1.77242004871368,1],[4.06060028076172,1.84039998054504,2],[3.95863032341003,1.77242004871368,2],[4.06060028076172,1.84039998054504,3],[3.95863032341003,1.77242004871368,3],[4.06060028076172,1.84039998054504,4],[3.95863032341003,1.77242004871368,4],[4.06060028076172,1.84039998054504,5],[3.95863032341003,1.77242004871368,5],[4.06060028076172,1.84039998054504,6],[3.95863032341003,1.77242004871368,6],[4.06060028076172,1.84039998054504,7],[3.95863032341003,1.77242004871368,7]],"colors":[[0,0,0,1]],"centers":[[4.06060028076172,1.84039998054504,4],[4.00961542129517,1.80641007423401,1],[4.00961542129517,1.80641007423401,2],[4.00961542129517,1.80641007423401,3],[4.00961542129517,1.80641007423401,4],[4.00961542129517,1.80641007423401,5],[4.00961542129517,1.80641007423401,6],[4.00961542129517,1.80641007423401,7]],"ignoreExtent":true,"origId":157,"flags":64},"173":{"id":173,"type":"text","material":{"lit":false},"vertices":[[3.75469040870667,1.63645994663239,1],[3.75469040870667,1.63645994663239,2],[3.75469040870667,1.63645994663239,3],[3.75469040870667,1.63645994663239,4],[3.75469040870667,1.63645994663239,5],[3.75469040870667,1.63645994663239,6],[3.75469040870667,1.63645994663239,7]],"colors":[[0,0,0,1]],"texts":[["1"],["2"],["3"],["4"],["5"],["6"],["7"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[3.75469040870667,1.63645994663239,1],[3.75469040870667,1.63645994663239,2],[3.75469040870667,1.63645994663239,3],[3.75469040870667,1.63645994663239,4],[3.75469040870667,1.63645994663239,5],[3.75469040870667,1.63645994663239,6],[3.75469040870667,1.63645994663239,7]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"origId":157,"flags":2064},"174":{"id":174,"type":"lines","material":{"lit":false},"vertices":[[4.06060028076172,1.84039998054504,0.607649981975555],[4.06060028076172,4.55959987640381,0.607649981975555],[4.06060028076172,1.84039998054504,7.29235029220581],[4.06060028076172,4.55959987640381,7.29235029220581],[4.06060028076172,1.84039998054504,0.607649981975555],[4.06060028076172,1.84039998054504,7.29235029220581],[4.06060028076172,4.55959987640381,0.607649981975555],[4.06060028076172,4.55959987640381,7.29235029220581],[4.06060028076172,1.84039998054504,0.607649981975555],[8.13939952850342,1.84039998054504,0.607649981975555],[4.06060028076172,1.84039998054504,7.29235029220581],[8.13939952850342,1.84039998054504,7.29235029220581],[4.06060028076172,4.55959987640381,0.607649981975555],[8.13939952850342,4.55959987640381,0.607649981975555],[4.06060028076172,4.55959987640381,7.29235029220581],[8.13939952850342,4.55959987640381,7.29235029220581],[8.13939952850342,1.84039998054504,0.607649981975555],[8.13939952850342,4.55959987640381,0.607649981975555],[8.13939952850342,1.84039998054504,7.29235029220581],[8.13939952850342,4.55959987640381,7.29235029220581],[8.13939952850342,1.84039998054504,0.607649981975555],[8.13939952850342,1.84039998054504,7.29235029220581],[8.13939952850342,4.55959987640381,0.607649981975555],[8.13939952850342,4.55959987640381,7.29235029220581]],"colors":[[0,0,0,1]],"centers":[[4.06060028076172,3.19999980926514,0.607649981975555],[4.06060028076172,3.19999980926514,7.29235029220581],[4.06060028076172,1.84039998054504,3.95000004768372],[4.06060028076172,4.55959987640381,3.95000004768372],[6.09999990463257,1.84039998054504,0.607649981975555],[6.09999990463257,1.84039998054504,7.29235029220581],[6.09999990463257,4.55959987640381,0.607649981975555],[6.09999990463257,4.55959987640381,7.29235029220581],[8.13939952850342,3.19999980926514,0.607649981975555],[8.13939952850342,3.19999980926514,7.29235029220581],[8.13939952850342,1.84039998054504,3.95000004768372],[8.13939952850342,4.55959987640381,3.95000004768372]],"ignoreExtent":true,"origId":157,"flags":64}},"width":480,"height":480,"sphereVerts":{"vb":[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.0746578340503426,0.146446609406726,0.212607523691814,0.270598050073098,0.318189645143208,0.353553390593274,0.375330277517865,0.38268343236509,0.375330277517865,0.353553390593274,0.318189645143208,0.270598050073098,0.212607523691814,0.146446609406726,0.0746578340503426,0,0,0.137949689641471,0.270598050073098,0.392847479193551,0.5,0.587937801209679,0.653281482438188,0.693519922661074,0.707106781186547,0.693519922661074,0.653281482438188,0.587937801209679,0.5,0.392847479193551,0.270598050073098,0.137949689641471,0,0,0.180239955501737,0.353553390593274,0.513279967159337,0.653281482438188,0.768177756711416,0.853553390593274,0.906127446352888,0.923879532511287,0.906127446352888,0.853553390593274,0.768177756711416,0.653281482438188,0.513279967159337,0.353553390593274,0.180239955501737,0,0,0.195090322016128,0.38268343236509,0.555570233019602,0.707106781186547,0.831469612302545,0.923879532511287,0.98078528040323,1,0.98078528040323,0.923879532511287,0.831469612302545,0.707106781186547,0.555570233019602,0.38268343236509,0.195090322016128,0,0,0.180239955501737,0.353553390593274,0.513279967159337,0.653281482438188,0.768177756711416,0.853553390593274,0.906127446352888,0.923879532511287,0.906127446352888,0.853553390593274,0.768177756711416,0.653281482438188,0.513279967159337,0.353553390593274,0.180239955501737,0,0,0.137949689641471,0.270598050073098,0.392847479193551,0.5,0.587937801209679,0.653281482438188,0.693519922661074,0.707106781186547,0.693519922661074,0.653281482438188,0.587937801209679,0.5,0.392847479193551,0.270598050073098,0.137949689641471,0,0,0.0746578340503426,0.146446609406726,0.212607523691814,0.270598050073098,0.318189645143208,0.353553390593274,0.375330277517865,0.38268343236509,0.375330277517865,0.353553390593274,0.318189645143208,0.270598050073098,0.212607523691814,0.146446609406726,0.0746578340503426,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-0,-0.0746578340503426,-0.146446609406726,-0.212607523691814,-0.270598050073098,-0.318189645143208,-0.353553390593274,-0.375330277517865,-0.38268343236509,-0.375330277517865,-0.353553390593274,-0.318189645143208,-0.270598050073098,-0.212607523691814,-0.146446609406726,-0.0746578340503426,-0,-0,-0.137949689641471,-0.270598050073098,-0.392847479193551,-0.5,-0.587937801209679,-0.653281482438188,-0.693519922661074,-0.707106781186547,-0.693519922661074,-0.653281482438188,-0.587937801209679,-0.5,-0.392847479193551,-0.270598050073098,-0.137949689641471,-0,-0,-0.180239955501737,-0.353553390593274,-0.513279967159337,-0.653281482438188,-0.768177756711416,-0.853553390593274,-0.906127446352888,-0.923879532511287,-0.906127446352888,-0.853553390593274,-0.768177756711416,-0.653281482438188,-0.513279967159337,-0.353553390593274,-0.180239955501737,-0,-0,-0.195090322016128,-0.38268343236509,-0.555570233019602,-0.707106781186547,-0.831469612302545,-0.923879532511287,-0.98078528040323,-1,-0.98078528040323,-0.923879532511287,-0.831469612302545,-0.707106781186547,-0.555570233019602,-0.38268343236509,-0.195090322016128,-0,-0,-0.180239955501737,-0.353553390593274,-0.513279967159337,-0.653281482438188,-0.768177756711416,-0.853553390593274,-0.906127446352888,-0.923879532511287,-0.906127446352888,-0.853553390593274,-0.768177756711416,-0.653281482438188,-0.513279967159337,-0.353553390593274,-0.180239955501737,-0,-0,-0.137949689641471,-0.270598050073098,-0.392847479193551,-0.5,-0.587937801209679,-0.653281482438188,-0.693519922661074,-0.707106781186547,-0.693519922661074,-0.653281482438188,-0.587937801209679,-0.5,-0.392847479193551,-0.270598050073098,-0.137949689641471,-0,-0,-0.0746578340503426,-0.146446609406726,-0.212607523691814,-0.270598050073098,-0.318189645143208,-0.353553390593274,-0.375330277517865,-0.38268343236509,-0.375330277517865,-0.353553390593274,-0.318189645143208,-0.270598050073098,-0.212607523691814,-0.146446609406726,-0.0746578340503426,-0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-1,-0.98078528040323,-0.923879532511287,-0.831469612302545,-0.707106781186547,-0.555570233019602,-0.38268343236509,-0.195090322016128,0,0.195090322016128,0.38268343236509,0.555570233019602,0.707106781186547,0.831469612302545,0.923879532511287,0.98078528040323,1,-1,-0.98078528040323,-0.923879532511287,-0.831469612302545,-0.707106781186547,-0.555570233019602,-0.38268343236509,-0.195090322016128,0,0.195090322016128,0.38268343236509,0.555570233019602,0.707106781186547,0.831469612302545,0.923879532511287,0.98078528040323,1,-1,-0.98078528040323,-0.923879532511287,-0.831469612302545,-0.707106781186547,-0.555570233019602,-0.38268343236509,-0.195090322016128,0,0.195090322016128,0.38268343236509,0.555570233019602,0.707106781186547,0.831469612302545,0.923879532511287,0.98078528040323,1,-1,-0.98078528040323,-0.923879532511287,-0.831469612302545,-0.707106781186547,-0.555570233019602,-0.38268343236509,-0.195090322016128,0,0.195090322016128,0.38268343236509,0.555570233019602,0.707106781186547,0.831469612302545,0.923879532511287,0.98078528040323,1,-1,-0.98078528040323,-0.923879532511287,-0.831469612302545,-0.707106781186547,-0.555570233019602,-0.38268343236509,-0.195090322016128,0,0.195090322016128,0.38268343236509,0.555570233019602,0.707106781186547,0.831469612302545,0.923879532511287,0.98078528040323,1,-1,-0.98078528040323,-0.923879532511287,-0.831469612302545,-0.707106781186547,-0.555570233019602,-0.38268343236509,-0.195090322016128,0,0.195090322016128,0.38268343236509,0.555570233019602,0.707106781186547,0.831469612302545,0.923879532511287,0.98078528040323,1,-1,-0.98078528040323,-0.923879532511287,-0.831469612302545,-0.707106781186547,-0.555570233019602,-0.38268343236509,-0.195090322016128,0,0.195090322016128,0.38268343236509,0.555570233019602,0.707106781186547,0.831469612302545,0.923879532511287,0.98078528040323,1,-1,-0.98078528040323,-0.923879532511287,-0.831469612302545,-0.707106781186547,-0.555570233019602,-0.38268343236509,-0.195090322016128,0,0.195090322016128,0.38268343236509,0.555570233019602,0.707106781186547,0.831469612302545,0.923879532511287,0.98078528040323,1,-1,-0.98078528040323,-0.923879532511287,-0.831469612302545,-0.707106781186547,-0.555570233019602,-0.38268343236509,-0.195090322016128,0,0.195090322016128,0.38268343236509,0.555570233019602,0.707106781186547,0.831469612302545,0.923879532511287,0.98078528040323,1,-1,-0.98078528040323,-0.923879532511287,-0.831469612302545,-0.707106781186547,-0.555570233019602,-0.38268343236509,-0.195090322016128,0,0.195090322016128,0.38268343236509,0.555570233019602,0.707106781186547,0.831469612302545,0.923879532511287,0.98078528040323,1,-1,-0.98078528040323,-0.923879532511287,-0.831469612302545,-0.707106781186547,-0.555570233019602,-0.38268343236509,-0.195090322016128,0,0.195090322016128,0.38268343236509,0.555570233019602,0.707106781186547,0.831469612302545,0.923879532511287,0.98078528040323,1,-1,-0.98078528040323,-0.923879532511287,-0.831469612302545,-0.707106781186547,-0.555570233019602,-0.38268343236509,-0.195090322016128,0,0.195090322016128,0.38268343236509,0.555570233019602,0.707106781186547,0.831469612302545,0.923879532511287,0.98078528040323,1,-1,-0.98078528040323,-0.923879532511287,-0.831469612302545,-0.707106781186547,-0.555570233019602,-0.38268343236509,-0.195090322016128,0,0.195090322016128,0.38268343236509,0.555570233019602,0.707106781186547,0.831469612302545,0.923879532511287,0.98078528040323,1,-1,-0.98078528040323,-0.923879532511287,-0.831469612302545,-0.707106781186547,-0.555570233019602,-0.38268343236509,-0.195090322016128,0,0.195090322016128,0.38268343236509,0.555570233019602,0.707106781186547,0.831469612302545,0.923879532511287,0.98078528040323,1,-1,-0.98078528040323,-0.923879532511287,-0.831469612302545,-0.707106781186547,-0.555570233019602,-0.38268343236509,-0.195090322016128,0,0.195090322016128,0.38268343236509,0.555570233019602,0.707106781186547,0.831469612302545,0.923879532511287,0.98078528040323,1,-1,-0.98078528040323,-0.923879532511287,-0.831469612302545,-0.707106781186547,-0.555570233019602,-0.38268343236509,-0.195090322016128,0,0.195090322016128,0.38268343236509,0.555570233019602,0.707106781186547,0.831469612302545,0.923879532511287,0.98078528040323,1,-1,-0.98078528040323,-0.923879532511287,-0.831469612302545,-0.707106781186547,-0.555570233019602,-0.38268343236509,-0.195090322016128,0,0.195090322016128,0.38268343236509,0.555570233019602,0.707106781186547,0.831469612302545,0.923879532511287,0.98078528040323,1],[0,0.195090322016128,0.38268343236509,0.555570233019602,0.707106781186547,0.831469612302545,0.923879532511287,0.98078528040323,1,0.98078528040323,0.923879532511287,0.831469612302545,0.707106781186547,0.555570233019602,0.38268343236509,0.195090322016128,0,0,0.180239955501737,0.353553390593274,0.513279967159337,0.653281482438188,0.768177756711416,0.853553390593274,0.906127446352888,0.923879532511287,0.906127446352888,0.853553390593274,0.768177756711416,0.653281482438188,0.513279967159337,0.353553390593274,0.180239955501737,0,0,0.137949689641471,0.270598050073098,0.392847479193551,0.5,0.587937801209679,0.653281482438188,0.693519922661074,0.707106781186547,0.693519922661074,0.653281482438188,0.587937801209679,0.5,0.392847479193551,0.270598050073098,0.137949689641471,0,0,0.0746578340503426,0.146446609406726,0.212607523691814,0.270598050073098,0.318189645143208,0.353553390593274,0.375330277517865,0.38268343236509,0.375330277517865,0.353553390593274,0.318189645143208,0.270598050073098,0.212607523691814,0.146446609406726,0.0746578340503426,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-0,-0.0746578340503426,-0.146446609406726,-0.212607523691814,-0.270598050073098,-0.318189645143208,-0.353553390593274,-0.375330277517865,-0.38268343236509,-0.375330277517865,-0.353553390593274,-0.318189645143208,-0.270598050073098,-0.212607523691814,-0.146446609406726,-0.0746578340503426,-0,-0,-0.137949689641471,-0.270598050073098,-0.392847479193551,-0.5,-0.587937801209679,-0.653281482438188,-0.693519922661074,-0.707106781186547,-0.693519922661074,-0.653281482438188,-0.587937801209679,-0.5,-0.392847479193551,-0.270598050073098,-0.137949689641471,-0,-0,-0.180239955501737,-0.353553390593274,-0.513279967159337,-0.653281482438188,-0.768177756711416,-0.853553390593274,-0.906127446352888,-0.923879532511287,-0.906127446352888,-0.853553390593274,-0.768177756711416,-0.653281482438188,-0.513279967159337,-0.353553390593274,-0.180239955501737,-0,-0,-0.195090322016128,-0.38268343236509,-0.555570233019602,-0.707106781186547,-0.831469612302545,-0.923879532511287,-0.98078528040323,-1,-0.98078528040323,-0.923879532511287,-0.831469612302545,-0.707106781186547,-0.555570233019602,-0.38268343236509,-0.195090322016128,-0,-0,-0.180239955501737,-0.353553390593274,-0.513279967159337,-0.653281482438188,-0.768177756711416,-0.853553390593274,-0.906127446352888,-0.923879532511287,-0.906127446352888,-0.853553390593274,-0.768177756711416,-0.653281482438188,-0.513279967159337,-0.353553390593274,-0.180239955501737,-0,-0,-0.137949689641471,-0.270598050073098,-0.392847479193551,-0.5,-0.587937801209679,-0.653281482438188,-0.693519922661074,-0.707106781186547,-0.693519922661074,-0.653281482438188,-0.587937801209679,-0.5,-0.392847479193551,-0.270598050073098,-0.137949689641471,-0,-0,-0.0746578340503426,-0.146446609406726,-0.212607523691814,-0.270598050073098,-0.318189645143208,-0.353553390593274,-0.375330277517865,-0.38268343236509,-0.375330277517865,-0.353553390593274,-0.318189645143208,-0.270598050073098,-0.212607523691814,-0.146446609406726,-0.0746578340503426,-0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.0746578340503426,0.146446609406726,0.212607523691814,0.270598050073098,0.318189645143208,0.353553390593274,0.375330277517865,0.38268343236509,0.375330277517865,0.353553390593274,0.318189645143208,0.270598050073098,0.212607523691814,0.146446609406726,0.0746578340503426,0,0,0.137949689641471,0.270598050073098,0.392847479193551,0.5,0.587937801209679,0.653281482438188,0.693519922661074,0.707106781186547,0.693519922661074,0.653281482438188,0.587937801209679,0.5,0.392847479193551,0.270598050073098,0.137949689641471,0,0,0.180239955501737,0.353553390593274,0.513279967159337,0.653281482438188,0.768177756711416,0.853553390593274,0.906127446352888,0.923879532511287,0.906127446352888,0.853553390593274,0.768177756711416,0.653281482438188,0.513279967159337,0.353553390593274,0.180239955501737,0,0,0.195090322016128,0.38268343236509,0.555570233019602,0.707106781186547,0.831469612302545,0.923879532511287,0.98078528040323,1,0.98078528040323,0.923879532511287,0.831469612302545,0.707106781186547,0.555570233019602,0.38268343236509,0.195090322016128,0]],"it":[[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270],[17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288],[18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271]],"primitivetype":"triangle","material":null,"normals":null,"texcoords":[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1]]},"webGLoptions":{"preserveDrawingBuffer":true},"context":{"shiny":false,"rmarkdown":"rmarkdown::html_vignette"}},"evals":[],"jsHooks":[]}</script> We might like a button on the web page to cause a change to the display, e.g.a rotation of the plot. First we add buttons, with the onclick event set to a function described below:</p>
<pre><code>&lt;button type=&quot;button&quot; onclick=&quot;rotate(10)&quot;&gt;Forward&lt;/button&gt;
&lt;button type=&quot;button&quot; onclick=&quot;rotate(-10)&quot;&gt;Backward&lt;/button&gt;</code></pre>
which produces these buttons:
<button type="button" onclick="rotate(10)">
Forward
</button>
<button type="button" onclick="rotate(-10)">
Backward
</button>
<p>We stored the subscene number that is currently active in <code>subid</code> in the code chunk above, and use it as <code class="r"><code>`r subid`</code></code> in the script below. <code>knitr</code> substitutes the value 1 when it processes the document.</p>
<p>The <code>rotate()</code> function uses the Javascript function <code>document.getElementById</code> to retrieve the <code>&lt;div&gt;</code> component of the web page containing the scene. It will have a component named <code>rglinstance</code> which contains information about the scene that we can modify:</p>
<pre><code>&lt;script type=&quot;text/javascript&quot;&gt;
var rotate = function(angle) {
  var rgl = document.getElementById(&quot;plot3drgl&quot;).rglinstance;
  rgl.getObj(`r subid`).par3d.userMatrix.rotate(angle, 0,1,0);
  rgl.drawScene();
};
&lt;/script&gt;</code></pre>
<script type="text/javascript">
var rotate = function(angle) {
  var rgl = document.getElementById("plot3drgl").rglinstance;
  rgl.getObj(1).par3d.userMatrix.rotate(angle, 0,1,0);
  rgl.drawScene();
};
</script>
<p>If we had used <code>webGL=TRUE</code> in the chunk header, the <code>knitr</code> WebGL support would create a global object with a name of the form <code>&lt;chunkname&gt;rgl</code>. For example, if the code chunk was named <code>plot3d</code>, the object would be called <code>plot3drgl</code>, and this code would work:</p>
<pre><code>&lt;script type=&quot;text/javascript&quot;&gt;
var rotate = function(angle) {
  plot3drgl.getObj(`r subid`).par3d.userMatrix.rotate(angle, 0,1,0);
  plot3drgl.drawScene();
};
&lt;/script&gt;</code></pre>
</div>
<div id="autogenerated-controls" class="section level2">
<h2>Autogenerated controls</h2>
<p>We can also change the contents of the plot using <a name="toggleButton"><a href="../../rgl/help/toggleButton"><code>toggleButton</code></a></a> (or the more recent <a name="toggleWidget"><a href="../../rgl/help/toggleWidget"><code>toggleWidget</code></a></a>). For example, we can redo the previous plot, but with the three species as separate spheres objects and buttons to toggle them:</p>
<pre class="sourceCode r"><code class="sourceCode r">sphereid &lt;-<span class="st"> </span><span class="kw">with</span>(<span class="kw">subset</span>(iris, Species ==<span class="st"> &quot;setosa&quot;</span>), 
     <span class="kw">spheres3d</span>(Sepal.Length, Sepal.Width, Petal.Length, 
                  <span class="dt">col=</span><span class="kw">as.numeric</span>(Species),
                  <span class="dt">radius =</span> <span class="fl">0.211</span>))
<span class="kw">with</span>(<span class="kw">subset</span>(iris, Species ==<span class="st"> &quot;versicolor&quot;</span>), 
     <span class="kw">spheres3d</span>(Sepal.Length, Sepal.Width, Petal.Length, 
               <span class="dt">col=</span><span class="kw">as.numeric</span>(Species),
               <span class="dt">radius =</span> <span class="fl">0.211</span>))
<span class="kw">with</span>(<span class="kw">subset</span>(iris, Species ==<span class="st"> &quot;virginica&quot;</span>), 
     <span class="kw">spheres3d</span>(Sepal.Length, Sepal.Width, Petal.Length, 
               <span class="dt">col=</span><span class="kw">as.numeric</span>(Species),
               <span class="dt">radius =</span> <span class="fl">0.211</span>))
<span class="kw">aspect3d</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)
axesid &lt;-<span class="st"> </span><span class="kw">decorate3d</span>()
subid &lt;-<span class="st"> </span><span class="kw">currentSubscene3d</span>()</code></pre>
<script>/*
* Copyright (C) 2009 Apple Inc. All Rights Reserved.
*
* Redistribution and use in source and binary forms, with or without
* modification, are permitted provided that the following conditions
* are met:
* 1. Redistributions of source code must retain the above copyright
*    notice, this list of conditions and the following disclaimer.
* 2. Redistributions in binary form must reproduce the above copyright
*    notice, this list of conditions and the following disclaimer in the
*    documentation and/or other materials provided with the distribution.
*
* THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS'' AND ANY
* EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
* IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
* PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
* EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
* PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
* PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
* OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
* (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
* OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
* Copyright (2016) Duncan Murdoch - fixed CanvasMatrix4.ortho,
* cleaned up.
*/
/*
CanvasMatrix4 class
This class implements a 4x4 matrix. It has functions which
duplicate the functionality of the OpenGL matrix stack and
glut functions.
IDL:
[
Constructor(in CanvasMatrix4 matrix),           // copy passed matrix into new CanvasMatrix4
Constructor(in sequence<float> array)           // create new CanvasMatrix4 with 16 floats (row major)
Constructor()                                   // create new CanvasMatrix4 with identity matrix
]
interface CanvasMatrix4 {
attribute float m11;
attribute float m12;
attribute float m13;
attribute float m14;
attribute float m21;
attribute float m22;
attribute float m23;
attribute float m24;
attribute float m31;
attribute float m32;
attribute float m33;
attribute float m34;
attribute float m41;
attribute float m42;
attribute float m43;
attribute float m44;
void load(in CanvasMatrix4 matrix);                 // copy the values from the passed matrix
void load(in sequence<float> array);                // copy 16 floats into the matrix
sequence<float> getAsArray();                       // return the matrix as an array of 16 floats
WebGLFloatArray getAsCanvasFloatArray();           // return the matrix as a WebGLFloatArray with 16 values
void makeIdentity();                                // replace the matrix with identity
void transpose();                                   // replace the matrix with its transpose
void invert();                                      // replace the matrix with its inverse
void translate(in float x, in float y, in float z); // multiply the matrix by passed translation values on the right
void scale(in float x, in float y, in float z);     // multiply the matrix by passed scale values on the right
void rotate(in float angle,                         // multiply the matrix by passed rotation values on the right
in float x, in float y, in float z);    // (angle is in degrees)
void multRight(in CanvasMatrix matrix);             // multiply the matrix by the passed matrix on the right
void multLeft(in CanvasMatrix matrix);              // multiply the matrix by the passed matrix on the left
void ortho(in float left, in float right,           // multiply the matrix by the passed ortho values on the right
in float bottom, in float top,
in float near, in float far);
void frustum(in float left, in float right,         // multiply the matrix by the passed frustum values on the right
in float bottom, in float top,
in float near, in float far);
void perspective(in float fovy, in float aspect,    // multiply the matrix by the passed perspective values on the right
in float zNear, in float zFar);
void lookat(in float eyex, in float eyey, in float eyez,    // multiply the matrix by the passed lookat
in float ctrx, in float ctry, in float ctrz,    // values on the right
in float upx, in float upy, in float upz);
}
*/
CanvasMatrix4 = function(m)
{
if (typeof m == 'object') {
if ("length" in m && m.length >= 16) {
this.load(m[0], m[1], m[2], m[3], m[4], m[5], m[6], m[7], m[8], m[9], m[10], m[11], m[12], m[13], m[14], m[15]);
return;
}
else if (m instanceof CanvasMatrix4) {
this.load(m);
return;
}
}
this.makeIdentity();
};
CanvasMatrix4.prototype.load = function()
{
if (arguments.length == 1 && typeof arguments[0] == 'object') {
var matrix = arguments[0];
if ("length" in matrix && matrix.length == 16) {
this.m11 = matrix[0];
this.m12 = matrix[1];
this.m13 = matrix[2];
this.m14 = matrix[3];
this.m21 = matrix[4];
this.m22 = matrix[5];
this.m23 = matrix[6];
this.m24 = matrix[7];
this.m31 = matrix[8];
this.m32 = matrix[9];
this.m33 = matrix[10];
this.m34 = matrix[11];
this.m41 = matrix[12];
this.m42 = matrix[13];
this.m43 = matrix[14];
this.m44 = matrix[15];
return;
}
if (arguments[0] instanceof CanvasMatrix4) {
this.m11 = matrix.m11;
this.m12 = matrix.m12;
this.m13 = matrix.m13;
this.m14 = matrix.m14;
this.m21 = matrix.m21;
this.m22 = matrix.m22;
this.m23 = matrix.m23;
this.m24 = matrix.m24;
this.m31 = matrix.m31;
this.m32 = matrix.m32;
this.m33 = matrix.m33;
this.m34 = matrix.m34;
this.m41 = matrix.m41;
this.m42 = matrix.m42;
this.m43 = matrix.m43;
this.m44 = matrix.m44;
return;
}
}
this.makeIdentity();
};
CanvasMatrix4.prototype.getAsArray = function()
{
return [
this.m11, this.m12, this.m13, this.m14,
this.m21, this.m22, this.m23, this.m24,
this.m31, this.m32, this.m33, this.m34,
this.m41, this.m42, this.m43, this.m44
];
};
CanvasMatrix4.prototype.getAsWebGLFloatArray = function()
{
return new WebGLFloatArray(this.getAsArray());
};
CanvasMatrix4.prototype.makeIdentity = function()
{
this.m11 = 1;
this.m12 = 0;
this.m13 = 0;
this.m14 = 0;
this.m21 = 0;
this.m22 = 1;
this.m23 = 0;
this.m24 = 0;
this.m31 = 0;
this.m32 = 0;
this.m33 = 1;
this.m34 = 0;
this.m41 = 0;
this.m42 = 0;
this.m43 = 0;
this.m44 = 1;
};
CanvasMatrix4.prototype.transpose = function()
{
var tmp = this.m12;
this.m12 = this.m21;
this.m21 = tmp;
tmp = this.m13;
this.m13 = this.m31;
this.m31 = tmp;
tmp = this.m14;
this.m14 = this.m41;
this.m41 = tmp;
tmp = this.m23;
this.m23 = this.m32;
this.m32 = tmp;
tmp = this.m24;
this.m24 = this.m42;
this.m42 = tmp;
tmp = this.m34;
this.m34 = this.m43;
this.m43 = tmp;
};
CanvasMatrix4.prototype.invert = function()
{
// Calculate the 4x4 determinant
// If the determinant is zero,
// then the inverse matrix is not unique.
var det = this._determinant4x4();
if (Math.abs(det) < 1e-8)
return null;
this._makeAdjoint();
// Scale the adjoint matrix to get the inverse
this.m11 /= det;
this.m12 /= det;
this.m13 /= det;
this.m14 /= det;
this.m21 /= det;
this.m22 /= det;
this.m23 /= det;
this.m24 /= det;
this.m31 /= det;
this.m32 /= det;
this.m33 /= det;
this.m34 /= det;
this.m41 /= det;
this.m42 /= det;
this.m43 /= det;
this.m44 /= det;
};
CanvasMatrix4.prototype.translate = function(x,y,z)
{
if (x === undefined)
x = 0;
if (y === undefined)
y = 0;
if (z === undefined)
z = 0;
var matrix = new CanvasMatrix4();
matrix.m41 = x;
matrix.m42 = y;
matrix.m43 = z;
this.multRight(matrix);
};
CanvasMatrix4.prototype.scale = function(x,y,z)
{
if (x === undefined)
x = 1;
if (z === undefined) {
if (y === undefined) {
y = x;
z = x;
}
else
z = 1;
}
else if (y === undefined)
y = x;
var matrix = new CanvasMatrix4();
matrix.m11 = x;
matrix.m22 = y;
matrix.m33 = z;
this.multRight(matrix);
};
CanvasMatrix4.prototype.rotate = function(angle,x,y,z)
{
// angles are in degrees. Switch to radians
angle = angle / 180 * Math.PI;
angle /= 2;
var sinA = Math.sin(angle);
var cosA = Math.cos(angle);
var sinA2 = sinA * sinA;
// normalize
var length = Math.sqrt(x * x + y * y + z * z);
if (length === 0) {
// bad vector, just use something reasonable
x = 0;
y = 0;
z = 1;
} else if (length != 1) {
x /= length;
y /= length;
z /= length;
}
var mat = new CanvasMatrix4();
// optimize case where axis is along major axis
if (x == 1 && y === 0 && z === 0) {
mat.m11 = 1;
mat.m12 = 0;
mat.m13 = 0;
mat.m21 = 0;
mat.m22 = 1 - 2 * sinA2;
mat.m23 = 2 * sinA * cosA;
mat.m31 = 0;
mat.m32 = -2 * sinA * cosA;
mat.m33 = 1 - 2 * sinA2;
mat.m14 = mat.m24 = mat.m34 = 0;
mat.m41 = mat.m42 = mat.m43 = 0;
mat.m44 = 1;
} else if (x === 0 && y == 1 && z === 0) {
mat.m11 = 1 - 2 * sinA2;
mat.m12 = 0;
mat.m13 = -2 * sinA * cosA;
mat.m21 = 0;
mat.m22 = 1;
mat.m23 = 0;
mat.m31 = 2 * sinA * cosA;
mat.m32 = 0;
mat.m33 = 1 - 2 * sinA2;
mat.m14 = mat.m24 = mat.m34 = 0;
mat.m41 = mat.m42 = mat.m43 = 0;
mat.m44 = 1;
} else if (x === 0 && y === 0 && z == 1) {
mat.m11 = 1 - 2 * sinA2;
mat.m12 = 2 * sinA * cosA;
mat.m13 = 0;
mat.m21 = -2 * sinA * cosA;
mat.m22 = 1 - 2 * sinA2;
mat.m23 = 0;
mat.m31 = 0;
mat.m32 = 0;
mat.m33 = 1;
mat.m14 = mat.m24 = mat.m34 = 0;
mat.m41 = mat.m42 = mat.m43 = 0;
mat.m44 = 1;
} else {
var x2 = x*x;
var y2 = y*y;
var z2 = z*z;
mat.m11 = 1 - 2 * (y2 + z2) * sinA2;
mat.m12 = 2 * (x * y * sinA2 + z * sinA * cosA);
mat.m13 = 2 * (x * z * sinA2 - y * sinA * cosA);
mat.m21 = 2 * (y * x * sinA2 - z * sinA * cosA);
mat.m22 = 1 - 2 * (z2 + x2) * sinA2;
mat.m23 = 2 * (y * z * sinA2 + x * sinA * cosA);
mat.m31 = 2 * (z * x * sinA2 + y * sinA * cosA);
mat.m32 = 2 * (z * y * sinA2 - x * sinA * cosA);
mat.m33 = 1 - 2 * (x2 + y2) * sinA2;
mat.m14 = mat.m24 = mat.m34 = 0;
mat.m41 = mat.m42 = mat.m43 = 0;
mat.m44 = 1;
}
this.multRight(mat);
};
CanvasMatrix4.prototype.multRight = function(mat)
{
var m11 = (this.m11 * mat.m11 + this.m12 * mat.m21 +
this.m13 * mat.m31 + this.m14 * mat.m41);
var m12 = (this.m11 * mat.m12 + this.m12 * mat.m22 +
this.m13 * mat.m32 + this.m14 * mat.m42);
var m13 = (this.m11 * mat.m13 + this.m12 * mat.m23 +
this.m13 * mat.m33 + this.m14 * mat.m43);
var m14 = (this.m11 * mat.m14 + this.m12 * mat.m24 +
this.m13 * mat.m34 + this.m14 * mat.m44);
var m21 = (this.m21 * mat.m11 + this.m22 * mat.m21 +
this.m23 * mat.m31 + this.m24 * mat.m41);
var m22 = (this.m21 * mat.m12 + this.m22 * mat.m22 +
this.m23 * mat.m32 + this.m24 * mat.m42);
var m23 = (this.m21 * mat.m13 + this.m22 * mat.m23 +
this.m23 * mat.m33 + this.m24 * mat.m43);
var m24 = (this.m21 * mat.m14 + this.m22 * mat.m24 +
this.m23 * mat.m34 + this.m24 * mat.m44);
var m31 = (this.m31 * mat.m11 + this.m32 * mat.m21 +
this.m33 * mat.m31 + this.m34 * mat.m41);
var m32 = (this.m31 * mat.m12 + this.m32 * mat.m22 +
this.m33 * mat.m32 + this.m34 * mat.m42);
var m33 = (this.m31 * mat.m13 + this.m32 * mat.m23 +
this.m33 * mat.m33 + this.m34 * mat.m43);
var m34 = (this.m31 * mat.m14 + this.m32 * mat.m24 +
this.m33 * mat.m34 + this.m34 * mat.m44);
var m41 = (this.m41 * mat.m11 + this.m42 * mat.m21 +
this.m43 * mat.m31 + this.m44 * mat.m41);
var m42 = (this.m41 * mat.m12 + this.m42 * mat.m22 +
this.m43 * mat.m32 + this.m44 * mat.m42);
var m43 = (this.m41 * mat.m13 + this.m42 * mat.m23 +
this.m43 * mat.m33 + this.m44 * mat.m43);
var m44 = (this.m41 * mat.m14 + this.m42 * mat.m24 +
this.m43 * mat.m34 + this.m44 * mat.m44);
this.m11 = m11;
this.m12 = m12;
this.m13 = m13;
this.m14 = m14;
this.m21 = m21;
this.m22 = m22;
this.m23 = m23;
this.m24 = m24;
this.m31 = m31;
this.m32 = m32;
this.m33 = m33;
this.m34 = m34;
this.m41 = m41;
this.m42 = m42;
this.m43 = m43;
this.m44 = m44;
};
CanvasMatrix4.prototype.multLeft = function(mat)
{
var m11 = (mat.m11 * this.m11 + mat.m12 * this.m21 +
mat.m13 * this.m31 + mat.m14 * this.m41);
var m12 = (mat.m11 * this.m12 + mat.m12 * this.m22 +
mat.m13 * this.m32 + mat.m14 * this.m42);
var m13 = (mat.m11 * this.m13 + mat.m12 * this.m23 +
mat.m13 * this.m33 + mat.m14 * this.m43);
var m14 = (mat.m11 * this.m14 + mat.m12 * this.m24 +
mat.m13 * this.m34 + mat.m14 * this.m44);
var m21 = (mat.m21 * this.m11 + mat.m22 * this.m21 +
mat.m23 * this.m31 + mat.m24 * this.m41);
var m22 = (mat.m21 * this.m12 + mat.m22 * this.m22 +
mat.m23 * this.m32 + mat.m24 * this.m42);
var m23 = (mat.m21 * this.m13 + mat.m22 * this.m23 +
mat.m23 * this.m33 + mat.m24 * this.m43);
var m24 = (mat.m21 * this.m14 + mat.m22 * this.m24 +
mat.m23 * this.m34 + mat.m24 * this.m44);
var m31 = (mat.m31 * this.m11 + mat.m32 * this.m21 +
mat.m33 * this.m31 + mat.m34 * this.m41);
var m32 = (mat.m31 * this.m12 + mat.m32 * this.m22 +
mat.m33 * this.m32 + mat.m34 * this.m42);
var m33 = (mat.m31 * this.m13 + mat.m32 * this.m23 +
mat.m33 * this.m33 + mat.m34 * this.m43);
var m34 = (mat.m31 * this.m14 + mat.m32 * this.m24 +
mat.m33 * this.m34 + mat.m34 * this.m44);
var m41 = (mat.m41 * this.m11 + mat.m42 * this.m21 +
mat.m43 * this.m31 + mat.m44 * this.m41);
var m42 = (mat.m41 * this.m12 + mat.m42 * this.m22 +
mat.m43 * this.m32 + mat.m44 * this.m42);
var m43 = (mat.m41 * this.m13 + mat.m42 * this.m23 +
mat.m43 * this.m33 + mat.m44 * this.m43);
var m44 = (mat.m41 * this.m14 + mat.m42 * this.m24 +
mat.m43 * this.m34 + mat.m44 * this.m44);
this.m11 = m11;
this.m12 = m12;
this.m13 = m13;
this.m14 = m14;
this.m21 = m21;
this.m22 = m22;
this.m23 = m23;
this.m24 = m24;
this.m31 = m31;
this.m32 = m32;
this.m33 = m33;
this.m34 = m34;
this.m41 = m41;
this.m42 = m42;
this.m43 = m43;
this.m44 = m44;
};
CanvasMatrix4.prototype.ortho = function(left, right, bottom, top, near, far)
{
var tx = (left + right) / (left - right);
var ty = (top + bottom) / (bottom - top);
var tz = (far + near) / (near - far);
var matrix = new CanvasMatrix4();
matrix.m11 = 2 / (right - left);
matrix.m12 = 0;
matrix.m13 = 0;
matrix.m14 = 0;
matrix.m21 = 0;
matrix.m22 = 2 / (top - bottom);
matrix.m23 = 0;
matrix.m24 = 0;
matrix.m31 = 0;
matrix.m32 = 0;
matrix.m33 = -2 / (far - near);
matrix.m34 = 0;
matrix.m41 = tx;
matrix.m42 = ty;
matrix.m43 = tz;
matrix.m44 = 1;
this.multRight(matrix);
};
CanvasMatrix4.prototype.frustum = function(left, right, bottom, top, near, far)
{
var matrix = new CanvasMatrix4();
var A = (right + left) / (right - left);
var B = (top + bottom) / (top - bottom);
var C = -(far + near) / (far - near);
var D = -(2 * far * near) / (far - near);
matrix.m11 = (2 * near) / (right - left);
matrix.m12 = 0;
matrix.m13 = 0;
matrix.m14 = 0;
matrix.m21 = 0;
matrix.m22 = 2 * near / (top - bottom);
matrix.m23 = 0;
matrix.m24 = 0;
matrix.m31 = A;
matrix.m32 = B;
matrix.m33 = C;
matrix.m34 = -1;
matrix.m41 = 0;
matrix.m42 = 0;
matrix.m43 = D;
matrix.m44 = 0;
this.multRight(matrix);
};
CanvasMatrix4.prototype.perspective = function(fovy, aspect, zNear, zFar)
{
var top = Math.tan(fovy * Math.PI / 360) * zNear;
var bottom = -top;
var left = aspect * bottom;
var right = aspect * top;
this.frustum(left, right, bottom, top, zNear, zFar);
};
CanvasMatrix4.prototype.lookat = function(eyex, eyey, eyez, centerx, centery, centerz, upx, upy, upz)
{
var matrix = new CanvasMatrix4();
// Make rotation matrix
// Z vector
var zx = eyex - centerx;
var zy = eyey - centery;
var zz = eyez - centerz;
var mag = Math.sqrt(zx * zx + zy * zy + zz * zz);
if (mag) {
zx /= mag;
zy /= mag;
zz /= mag;
}
// Y vector
var yx = upx;
var yy = upy;
var yz = upz;
// X vector = Y cross Z
xx =  yy * zz - yz * zy;
xy = -yx * zz + yz * zx;
xz =  yx * zy - yy * zx;
// Recompute Y = Z cross X
yx = zy * xz - zz * xy;
yy = -zx * xz + zz * xx;
yx = zx * xy - zy * xx;
// cross product gives area of parallelogram, which is < 1.0 for
// non-perpendicular unit-length vectors; so normalize x, y here
mag = Math.sqrt(xx * xx + xy * xy + xz * xz);
if (mag) {
xx /= mag;
xy /= mag;
xz /= mag;
}
mag = Math.sqrt(yx * yx + yy * yy + yz * yz);
if (mag) {
yx /= mag;
yy /= mag;
yz /= mag;
}
matrix.m11 = xx;
matrix.m12 = xy;
matrix.m13 = xz;
matrix.m14 = 0;
matrix.m21 = yx;
matrix.m22 = yy;
matrix.m23 = yz;
matrix.m24 = 0;
matrix.m31 = zx;
matrix.m32 = zy;
matrix.m33 = zz;
matrix.m34 = 0;
matrix.m41 = 0;
matrix.m42 = 0;
matrix.m43 = 0;
matrix.m44 = 1;
matrix.translate(-eyex, -eyey, -eyez);
this.multRight(matrix);
};
// Support functions
CanvasMatrix4.prototype._determinant2x2 = function(a, b, c, d)
{
return a * d - b * c;
};
CanvasMatrix4.prototype._determinant3x3 = function(a1, a2, a3, b1, b2, b3, c1, c2, c3)
{
return a1 * this._determinant2x2(b2, b3, c2, c3) -
b1 * this._determinant2x2(a2, a3, c2, c3) +
c1 * this._determinant2x2(a2, a3, b2, b3);
};
CanvasMatrix4.prototype._determinant4x4 = function()
{
var a1 = this.m11;
var b1 = this.m12;
var c1 = this.m13;
var d1 = this.m14;
var a2 = this.m21;
var b2 = this.m22;
var c2 = this.m23;
var d2 = this.m24;
var a3 = this.m31;
var b3 = this.m32;
var c3 = this.m33;
var d3 = this.m34;
var a4 = this.m41;
var b4 = this.m42;
var c4 = this.m43;
var d4 = this.m44;
return a1 * this._determinant3x3(b2, b3, b4, c2, c3, c4, d2, d3, d4) -
b1 * this._determinant3x3(a2, a3, a4, c2, c3, c4, d2, d3, d4) +
c1 * this._determinant3x3(a2, a3, a4, b2, b3, b4, d2, d3, d4) -
d1 * this._determinant3x3(a2, a3, a4, b2, b3, b4, c2, c3, c4);
};
CanvasMatrix4.prototype._makeAdjoint = function()
{
var a1 = this.m11;
var b1 = this.m12;
var c1 = this.m13;
var d1 = this.m14;
var a2 = this.m21;
var b2 = this.m22;
var c2 = this.m23;
var d2 = this.m24;
var a3 = this.m31;
var b3 = this.m32;
var c3 = this.m33;
var d3 = this.m34;
var a4 = this.m41;
var b4 = this.m42;
var c4 = this.m43;
var d4 = this.m44;
// Row column labeling reversed since we transpose rows & columns
this.m11  =   this._determinant3x3(b2, b3, b4, c2, c3, c4, d2, d3, d4);
this.m21  = - this._determinant3x3(a2, a3, a4, c2, c3, c4, d2, d3, d4);
this.m31  =   this._determinant3x3(a2, a3, a4, b2, b3, b4, d2, d3, d4);
this.m41  = - this._determinant3x3(a2, a3, a4, b2, b3, b4, c2, c3, c4);
this.m12  = - this._determinant3x3(b1, b3, b4, c1, c3, c4, d1, d3, d4);
this.m22  =   this._determinant3x3(a1, a3, a4, c1, c3, c4, d1, d3, d4);
this.m32  = - this._determinant3x3(a1, a3, a4, b1, b3, b4, d1, d3, d4);
this.m42  =   this._determinant3x3(a1, a3, a4, b1, b3, b4, c1, c3, c4);
this.m13  =   this._determinant3x3(b1, b2, b4, c1, c2, c4, d1, d2, d4);
this.m23  = - this._determinant3x3(a1, a2, a4, c1, c2, c4, d1, d2, d4);
this.m33  =   this._determinant3x3(a1, a2, a4, b1, b2, b4, d1, d2, d4);
this.m43  = - this._determinant3x3(a1, a2, a4, b1, b2, b4, c1, c2, c4);
this.m14  = - this._determinant3x3(b1, b2, b3, c1, c2, c3, d1, d2, d3);
this.m24  =   this._determinant3x3(a1, a2, a3, c1, c2, c3, d1, d2, d3);
this.m34  = - this._determinant3x3(a1, a2, a3, b1, b2, b3, d1, d2, d3);
this.m44  =   this._determinant3x3(a1, a2, a3, b1, b2, b3, c1, c2, c3);
};</script>
<script>// To generate the help pages for this library, use
// jsdoc --destination ../../../doc/rglwidgetClass --template ~/node_modules/jsdoc-baseline rglClass.src.js
/**
* The class of an rgl widget
* @class
*/
rglwidgetClass = function() {
this.canvas = null;
this.userMatrix = new CanvasMatrix4();
this.types = [];
this.prMatrix = new CanvasMatrix4();
this.mvMatrix = new CanvasMatrix4();
this.vp = null;
this.prmvMatrix = null;
this.origs = null;
this.gl = null;
this.scene = null;
};
/**
* Multiply matrix by vector
* @returns {number[]}
* @param M {number[][]} Left operand
* @param v {number[]} Right operand
*/
rglwidgetClass.prototype.multMV = function(M, v) {
return [ M.m11 * v[0] + M.m12 * v[1] + M.m13 * v[2] + M.m14 * v[3],
M.m21 * v[0] + M.m22 * v[1] + M.m23 * v[2] + M.m24 * v[3],
M.m31 * v[0] + M.m32 * v[1] + M.m33 * v[2] + M.m34 * v[3],
M.m41 * v[0] + M.m42 * v[1] + M.m43 * v[2] + M.m44 * v[3]
];
};
// (function() {
/**
* Euclidean length of a vector
* @returns {number}
* @param v {number[]}
*/
rglwidgetClass.prototype.vlen = function(v) {
return Math.sqrt(this.dotprod(v, v));
};
/**
* Dot product of two vectors
* @instance rglwidgetClass
* @returns {number}
* @param a {number[]}
* @param b {number[]}
*/
rglwidgetClass.prototype.dotprod = function(a, b) {
return a[0]*b[0] + a[1]*b[1] + a[2]*b[2];
};
/**
* Cross product of two vectors
* @returns {number[]}
* @param a {number[]}
* @param b {number[]}
*/
rglwidgetClass.prototype.xprod = function(a, b) {
return [a[1]*b[2] - a[2]*b[1],
a[2]*b[0] - a[0]*b[2],
a[0]*b[1] - a[1]*b[0]];
};
/**
* Bind vectors or matrices by columns
* @returns {number[][]}
* @param a {number[]|number[][]}
* @param b {number[]|number[][]}
*/
rglwidgetClass.prototype.cbind = function(a, b) {
if (b.length < a.length)
b = this.repeatToLen(b, a.length);
else if (a.length < b.length)
a = this.repeatToLen(a, b.length);
return a.map(function(currentValue, index, array) {
return currentValue.concat(b[index]);
});
};
/**
* Swap elements
* @returns {any[]}
* @param a {any[]}
* @param i {number} Element to swap
* @param j {number} Other element to swap
*/
rglwidgetClass.prototype.swap = function(a, i, j) {
var temp = a[i];
a[i] = a[j];
a[j] = temp;
};
/**
* Flatten a matrix into a vector
* @returns {any[]}
* @param a {any[][]}
*/
rglwidgetClass.prototype.flatten = function(arr, result) {
var value;
if (typeof result === "undefined") result = [];
for (var i = 0, length = arr.length; i < length; i++) {
value = arr[i];
if (Array.isArray(value)) {
this.flatten(value, result);
} else {
result.push(value);
}
}
return result;
};
/**
* set element of 1d or 2d array as if it was flattened.
* Column major, zero based!
* @returns {any[]|any[][]}
* @param {any[]|any[][]} a - array
* @param {number} i - element
* @param {any} value
*/
rglwidgetClass.prototype.setElement = function(a, i, value) {
if (Array.isArray(a[0])) {
var dim = a.length,
col = Math.floor(i/dim),
row = i % dim;
a[row][col] = value;
} else {
a[i] = value;
}
};
/**
* Transpose an array
* @returns {any[][]}
* @param {any[][]} a
*/
rglwidgetClass.prototype.transpose = function(a) {
var newArray = [],
n = a.length,
m = a[0].length,
i;
for(i = 0; i < m; i++){
newArray.push([]);
}
for(i = 0; i < n; i++){
for(var j = 0; j < m; j++){
newArray[j].push(a[i][j]);
}
}
return newArray;
};
/**
* Calculate sum of squares of a numeric vector
* @returns {number}
* @param {number[]} x
*/
rglwidgetClass.prototype.sumsq = function(x) {
var result = 0, i;
for (i=0; i < x.length; i++)
result += x[i]*x[i];
return result;
};
/**
* Convert a matrix to a CanvasMatrix4
* @returns {CanvasMatrix4}
* @param {number[][]|number[]} mat
*/
rglwidgetClass.prototype.toCanvasMatrix4 = function(mat) {
if (mat instanceof CanvasMatrix4)
return mat;
var result = new CanvasMatrix4();
mat = this.flatten(this.transpose(mat));
result.load(mat);
return result;
};
/**
* Convert an R-style numeric colour string to an rgb vector
* @returns {number[]}
* @param {string} s
*/
rglwidgetClass.prototype.stringToRgb = function(s) {
s = s.replace("#", "");
var bigint = parseInt(s, 16);
return [((bigint >> 16) & 255)/255,
((bigint >> 8) & 255)/255,
(bigint & 255)/255];
};
/**
* Take a component-by-component product of two 3 vectors
* @returns {number[]}
* @param {number[]} x
* @param {number[]} y
*/
rglwidgetClass.prototype.componentProduct = function(x, y) {
if (typeof y === "undefined") {
this.alertOnce("Bad arg to componentProduct");
}
var result = new Float32Array(3), i;
for (i = 0; i<3; i++)
result[i] = x[i]*y[i];
return result;
};
/**
* Get next higher power of two
* @returns { number }
* @param { number } value - input value
*/
rglwidgetClass.prototype.getPowerOfTwo = function(value) {
var pow = 1;
while(pow<value) {
pow *= 2;
}
return pow;
};
/**
* Unique entries
* @returns { any[] }
* @param { any[] } arr - An array
*/
rglwidgetClass.prototype.unique = function(arr) {
arr = [].concat(arr);
return arr.filter(function(value, index, self) {
return self.indexOf(value) === index;
});
};
/**
* Repeat an array to a desired length
* @returns {any[]}
* @param {any | any[]} arr The input array
* @param {number} len The desired output length
*/
rglwidgetClass.prototype.repeatToLen = function(arr, len) {
arr = [].concat(arr);
while (arr.length < len/2)
arr = arr.concat(arr);
return arr.concat(arr.slice(0, len - arr.length));
};
/**
* Give a single alert message, not to be repeated.
* @param {string} msg  The message to give.
*/
rglwidgetClass.prototype.alertOnce = function(msg) {
if (typeof this.alerted !== "undefined")
return;
this.alerted = true;
alert(msg);
};
rglwidgetClass.prototype.f_is_lit = 1;
rglwidgetClass.prototype.f_is_smooth = 2;
rglwidgetClass.prototype.f_has_texture = 4;
rglwidgetClass.prototype.f_depth_sort = 8;
rglwidgetClass.prototype.f_fixed_quads = 16;
rglwidgetClass.prototype.f_is_transparent = 32;
rglwidgetClass.prototype.f_is_lines = 64;
rglwidgetClass.prototype.f_sprites_3d = 128;
rglwidgetClass.prototype.f_sprite_3d = 256;
rglwidgetClass.prototype.f_is_subscene = 512;
rglwidgetClass.prototype.f_is_clipplanes = 1024;
rglwidgetClass.prototype.f_fixed_size = 2048;
rglwidgetClass.prototype.f_is_points = 4096;
rglwidgetClass.prototype.f_is_twosided = 8192;
rglwidgetClass.prototype.f_fat_lines = 16384;
/**
* Which list does a particular id come from?
* @returns { string }
* @param {number} id The id to look up.
*/
rglwidgetClass.prototype.whichList = function(id) {
var obj = this.getObj(id),
flags = obj.flags;
if (obj.type === "light")
return "lights";
if (flags & this.f_is_subscene)
return "subscenes";
if (flags & this.f_is_clipplanes)
return "clipplanes";
if (flags & this.f_is_transparent)
return "transparent";
return "opaque";
};
/**
* Get an object by id number.
* @returns { Object }
* @param {number} id
*/
rglwidgetClass.prototype.getObj = function(id) {
if (typeof id !== "number") {
this.alertOnce("getObj id is "+typeof id);
}
return this.scene.objects[id];
};
/**
* Get ids of a particular type from a subscene or the whole scene
* @returns { number[] }
* @param {string} type What type of object?
* @param {number} subscene  Which subscene?  If not given, find in the whole scene
*/
rglwidgetClass.prototype.getIdsByType = function(type, subscene) {
var
result = [], i, self = this;
if (typeof subscene === "undefined") {
Object.keys(this.scene.objects).forEach(
function(key) {
key = parseInt(key, 10);
if (self.getObj(key).type === type)
result.push(key);
});
} else {
ids = this.getObj(subscene).objects;
for (i=0; i < ids.length; i++) {
if (this.getObj(ids[i]).type === type) {
result.push(ids[i]);
}
}
}
return result;
};
/**
* Get a particular material property for an id
* @returns { any }
* @param {number} id  Which object?
* @param {string} property Which material property?
*/
rglwidgetClass.prototype.getMaterial = function(id, property) {
var obj = this.getObj(id),
mat = obj.material[property];
if (typeof mat === "undefined")
mat = this.scene.material[property];
return mat;
};
/**
* Is a particular id in a subscene?
* @returns { boolean }
* @param {number} id Which id?
* @param {number} subscene Which subscene id?
*/
rglwidgetClass.prototype.inSubscene = function(id, subscene) {
return this.getObj(subscene).objects.indexOf(id) > -1;
};
/**
* Add an id to a subscene.
* @param {number} id Which id?
* @param {number} subscene Which subscene id?
*/
rglwidgetClass.prototype.addToSubscene = function(id, subscene) {
var thelist,
thesub = this.getObj(subscene),
ids = [id],
obj = this.getObj(id), i;
if (typeof obj != "undefined" && typeof (obj.newIds) !== "undefined") {
ids = ids.concat(obj.newIds);
}
for (i = 0; i < ids.length; i++) {
id = ids[i];
if (thesub.objects.indexOf(id) == -1) {
thelist = this.whichList(id);
thesub.objects.push(id);
thesub[thelist].push(id);
}
}
};
/**
* Delete an id from a subscene
* @param { number } id - the id to add
* @param { number } subscene - the id of the subscene
*/
rglwidgetClass.prototype.delFromSubscene = function(id, subscene) {
var thelist,
thesub = this.getObj(subscene),
obj = this.getObj(id),
ids = [id], i;
if (typeof obj !== "undefined" && typeof (obj.newIds) !== "undefined")
ids = ids.concat(obj.newIds);
for (j=0; j<ids.length;j++) {
id = ids[j];
i = thesub.objects.indexOf(id);
if (i > -1) {
thesub.objects.splice(i, 1);
thelist = this.whichList(id);
i = thesub[thelist].indexOf(id);
thesub[thelist].splice(i, 1);
}
}
};
/**
* Set the ids in a subscene
* @param { number[] } ids - the ids to set
* @param { number } subsceneid - the id of the subscene
*/
rglwidgetClass.prototype.setSubsceneEntries = function(ids, subsceneid) {
var sub = this.getObj(subsceneid);
sub.objects = ids;
this.initSubscene(subsceneid);
};
/**
* Get the ids in a subscene
* @returns {number[]}
* @param { number } subscene - the id of the subscene
*/
rglwidgetClass.prototype.getSubsceneEntries = function(subscene) {
return this.getObj(subscene).objects;
};
/**
* Get the ids of the subscenes within a subscene
* @returns { number[] }
* @param { number } subscene - the id of the subscene
*/
rglwidgetClass.prototype.getChildSubscenes = function(subscene) {
return this.getObj(subscene).subscenes;
};
/**
* Start drawing
* @returns { boolean } Previous state
*/
rglwidgetClass.prototype.startDrawing = function() {
var value = this.drawing;
this.drawing = true;
return value;
};
/**
* Stop drawing and check for context loss
* @param { boolean } saved - Previous state
*/
rglwidgetClass.prototype.stopDrawing = function(saved) {
this.drawing = saved;
if (!saved && this.gl && this.gl.isContextLost())
this.restartCanvas();
};
/**
* Generate the vertex shader for an object
* @returns {string}
* @param { number } id - Id of object
*/
rglwidgetClass.prototype.getVertexShader = function(id) {
var obj = this.getObj(id),
userShader = obj.userVertexShader,
flags = obj.flags,
type = obj.type,
is_lit = flags & this.f_is_lit,
has_texture = flags & this.f_has_texture,
fixed_quads = flags & this.f_fixed_quads,
sprites_3d = flags & this.f_sprites_3d,
sprite_3d = flags & this.f_sprite_3d,
nclipplanes = this.countClipplanes(),
fixed_size = flags & this.f_fixed_size,
is_points = flags & this.f_is_points,
is_twosided = flags & this.f_is_twosided,
fat_lines = flags & this.f_fat_lines,
result;
if (type === "clipplanes" || sprites_3d) return;
if (typeof userShader !== "undefined") return userShader;
result = "  /* ****** "+type+" object "+id+" vertex shader ****** */\n"+
"  attribute vec3 aPos;\n"+
"  attribute vec4 aCol;\n"+
" uniform mat4 mvMatrix;\n"+
" uniform mat4 prMatrix;\n"+
" varying vec4 vCol;\n"+
" varying vec4 vPosition;\n";
if ((is_lit && !fixed_quads) || sprite_3d)
result = result + "  attribute vec3 aNorm;\n"+
" uniform mat4 normMatrix;\n"+
" varying vec3 vNormal;\n";
if (has_texture || type === "text")
result = result + " attribute vec2 aTexcoord;\n"+
" varying vec2 vTexcoord;\n";
if (fixed_size)
result = result + "  uniform vec2 textScale;\n";
if (fixed_quads)
result = result + "  attribute vec2 aOfs;\n";
else if (sprite_3d)
result = result + "  uniform vec3 uOrig;\n"+
"  uniform float uSize;\n"+
"  uniform mat4 usermat;\n";
if (is_twosided)
result = result + "  attribute vec3 aPos1;\n"+
"  attribute vec3 aPos2;\n"+
"  varying float normz;\n";
if (fat_lines) {
result = result +   "  attribute vec3 aNext;\n"+
"  attribute vec2 aPoint;\n"+
"  varying vec2 vPoint;\n"+
"  varying float vLength;\n"+
"  uniform float uAspect;\n"+
"  uniform float uLwd;\n";
}
result = result + "  void main(void) {\n";
if (nclipplanes || (!fixed_quads && !sprite_3d))
result = result + "    vPosition = mvMatrix * vec4(aPos, 1.);\n";
if (!fixed_quads && !sprite_3d)
result = result + "    gl_Position = prMatrix * vPosition;\n";
if (is_points) {
var size = this.getMaterial(id, "size");
result = result + "    gl_PointSize = "+size.toFixed(1)+";\n";
}
result = result + "    vCol = aCol;\n";
if (is_lit && !fixed_quads && !sprite_3d)
result = result + "    vNormal = normalize((normMatrix * vec4(aNorm, 1.)).xyz);\n";
if (has_texture || type == "text")
result = result + "    vTexcoord = aTexcoord;\n";
if (fixed_size)
result = result + "    vec4 pos = prMatrix * mvMatrix * vec4(aPos, 1.);\n"+
"   pos = pos/pos.w;\n"+
"   gl_Position = pos + vec4(aOfs*textScale, 0.,0.);\n";
if (type == "sprites" && !fixed_size)
result = result + "    vec4 pos = mvMatrix * vec4(aPos, 1.);\n"+
"   pos = pos/pos.w + vec4(aOfs, 0., 0.);\n"+
"   gl_Position = prMatrix*pos;\n";
if (sprite_3d)
result = result + "   vNormal = normalize((normMatrix * vec4(aNorm, 1.)).xyz);\n"+
"   vec4 pos = mvMatrix * vec4(uOrig, 1.);\n"+
"   vPosition = pos/pos.w + vec4(uSize*(vec4(aPos, 1.)*usermat).xyz,0.);\n"+
"   gl_Position = prMatrix * vPosition;\n";
if (is_twosided)
result = result + "   vec4 pos1 = prMatrix*(mvMatrix*vec4(aPos1, 1.));\n"+
"   pos1 = pos1/pos1.w - gl_Position/gl_Position.w;\n"+
"   vec4 pos2 = prMatrix*(mvMatrix*vec4(aPos2, 1.));\n"+
"   pos2 = pos2/pos2.w - gl_Position/gl_Position.w;\n"+
"   normz = pos1.x*pos2.y - pos1.y*pos2.x;\n";
if (fat_lines) 
/* This code was inspired by Matt Deslauriers' code in https://mattdesl.svbtle.com/drawing-lines-is-hard */
result = result + "   vec2 aspectVec = vec2(uAspect, 1.0);\n"+
"   mat4 projViewModel = prMatrix * mvMatrix;\n"+
"   vec4 currentProjected = projViewModel * vec4(aPos, 1.0);\n"+
"   currentProjected = currentProjected/currentProjected.w;\n"+
"   vec4 nextProjected = projViewModel * vec4(aNext, 1.0);\n"+
"   vec2 currentScreen = currentProjected.xy * aspectVec;\n"+
"   vec2 nextScreen = (nextProjected.xy / nextProjected.w) * aspectVec;\n"+
"   float len = uLwd;\n"+
"   vec2 dir = vec2(1.0, 0.0);\n"+
"   vPoint = aPoint;\n"+
"   vLength = length(nextScreen - currentScreen)/2.0;\n"+
"   vLength = vLength/(vLength + len);\n"+
"   if (vLength > 0.0) {\n"+
"     dir = normalize(nextScreen - currentScreen);\n"+
"   }\n"+
"   vec2 normal = vec2(-dir.y, dir.x);\n"+
"   dir.x /= uAspect;\n"+
"   normal.x /= uAspect;\n"+
"   vec4 offset = vec4(len*(normal*aPoint.x*aPoint.y - dir), 0.0, 0.0);\n"+
"   gl_Position = currentProjected + offset;\n";
result = result + "  }\n";
// console.log(result);
return result;
};
/**
* Generate the fragment shader for an object
* @returns {string}
* @param { number } id - Id of object
*/
rglwidgetClass.prototype.getFragmentShader = function(id) {
var obj = this.getObj(id),
userShader = obj.userFragmentShader,
flags = obj.flags,
type = obj.type,
is_lit = flags & this.f_is_lit,
has_texture = flags & this.f_has_texture,
fixed_quads = flags & this.f_fixed_quads,
sprites_3d = flags & this.f_sprites_3d,
is_twosided = (flags & this.f_is_twosided) > 0,
fat_lines = flags & this.f_fat_lines,
is_transparent = flags & this.f_is_transparent,
nclipplanes = this.countClipplanes(), i,
texture_format, nlights,
result;
if (type === "clipplanes" || sprites_3d) return;
if (typeof userShader !== "undefined") return userShader;
if (has_texture)
texture_format = this.getMaterial(id, "textype");
result = "/* ****** "+type+" object "+id+" fragment shader ****** */\n"+
"#ifdef GL_ES\n"+
"  precision highp float;\n"+
"#endif\n"+
"  varying vec4 vCol; // carries alpha\n"+
"  varying vec4 vPosition;\n";
if (has_texture || type === "text")
result = result + "  varying vec2 vTexcoord;\n"+
" uniform sampler2D uSampler;\n";
if (is_lit && !fixed_quads)
result = result + "  varying vec3 vNormal;\n";
for (i = 0; i < nclipplanes; i++)
result = result + "  uniform vec4 vClipplane"+i+";\n";
if (is_lit) {
nlights = this.countLights();
if (nlights)
result = result + "  uniform mat4 mvMatrix;\n";
else
is_lit = false;
}
if (is_lit) {
result = result + "   uniform vec3 emission;\n"+
"   uniform float shininess;\n";
for (i=0; i < nlights; i++) {
result = result + "   uniform vec3 ambient" + i + ";\n"+
"   uniform vec3 specular" + i +"; // light*material\n"+
"   uniform vec3 diffuse" + i + ";\n"+
"   uniform vec3 lightDir" + i + ";\n"+
"   uniform bool viewpoint" + i + ";\n"+
"   uniform bool finite" + i + ";\n";
}
}
if (is_twosided)
result = result + "   uniform bool front;\n"+
"   varying float normz;\n";
if (fat_lines)
result = result + "   varying vec2 vPoint;\n"+
"   varying float vLength;\n";
result = result + "  void main(void) {\n";
if (fat_lines) {
result = result + "    vec2 point = vPoint;\n"+
"    bool neg = point.y < 0.0;\n"+
"    point.y = neg ? "+
"      (point.y + vLength)/(1.0 - vLength) :\n"+
"     -(point.y - vLength)/(1.0 - vLength);\n";
if (is_transparent && type == "linestrip")
result = result+"    if (neg && length(point) <= 1.0) discard;\n";
result = result + "    point.y = min(point.y, 0.0);\n"+
"    if (length(point) > 1.0) discard;\n";
}
for (i=0; i < nclipplanes;i++)
result = result + "    if (dot(vPosition, vClipplane"+i+") < 0.0) discard;\n";
if (fixed_quads) {
result = result +   "    vec3 n = vec3(0., 0., 1.);\n";
} else if (is_lit) {
result = result +   "    vec3 n = normalize(vNormal);\n";
}
if (is_twosided) {
result = result +   "    if ((normz <= 0.) != front) discard;\n";
}
if (is_lit) {
result = result + "    vec3 eye = normalize(-vPosition.xyz);\n"+
"   vec3 lightdir;\n"+
"   vec4 colDiff;\n"+
"   vec3 halfVec;\n"+
"   vec4 lighteffect = vec4(emission, 0.);\n"+
"   vec3 col;\n"+
"   float nDotL;\n";
if (!fixed_quads) {
result = result +   "   n = -faceforward(n, n, eye);\n";
}
for (i=0; i < nlights; i++) {
result = result + "   colDiff = vec4(vCol.rgb * diffuse" + i + ", vCol.a);\n"+
"   lightdir = lightDir" + i + ";\n"+
"   if (!viewpoint" + i +")\n"+
"     lightdir = (mvMatrix * vec4(lightdir, 1.)).xyz;\n"+
"   if (!finite" + i + ") {\n"+
"     halfVec = normalize(lightdir + eye);\n"+
"   } else {\n"+
"     lightdir = normalize(lightdir - vPosition.xyz);\n"+
"     halfVec = normalize(lightdir + eye);\n"+
"   }\n"+
"    col = ambient" + i + ";\n"+
"   nDotL = dot(n, lightdir);\n"+
"   col = col + max(nDotL, 0.) * colDiff.rgb;\n"+
"   col = col + pow(max(dot(halfVec, n), 0.), shininess) * specular" + i + ";\n"+
"   lighteffect = lighteffect + vec4(col, colDiff.a);\n";
}
} else {
result = result +   "   vec4 colDiff = vCol;\n"+
"    vec4 lighteffect = colDiff;\n";
}
if (type === "text")
result = result +   "    vec4 textureColor = lighteffect*texture2D(uSampler, vTexcoord);\n";
if (has_texture) {
result = result + {
rgb:            "   vec4 textureColor = lighteffect*vec4(texture2D(uSampler, vTexcoord).rgb, 1.);\n",
rgba:           "   vec4 textureColor = lighteffect*texture2D(uSampler, vTexcoord);\n",
alpha:          "   vec4 textureColor = texture2D(uSampler, vTexcoord);\n"+
"   float luminance = dot(vec3(1.,1.,1.), textureColor.rgb)/3.;\n"+
"   textureColor =  vec4(lighteffect.rgb, lighteffect.a*luminance);\n",
luminance:      "   vec4 textureColor = vec4(lighteffect.rgb*dot(texture2D(uSampler, vTexcoord).rgb, vec3(1.,1.,1.))/3., lighteffect.a);\n",
"luminance.alpha":"    vec4 textureColor = texture2D(uSampler, vTexcoord);\n"+
"   float luminance = dot(vec3(1.,1.,1.),textureColor.rgb)/3.;\n"+
"   textureColor = vec4(lighteffect.rgb*luminance, lighteffect.a*textureColor.a);\n"
}[texture_format]+
"   gl_FragColor = textureColor;\n";
} else if (type === "text") {
result = result +   "    if (textureColor.a < 0.1)\n"+
"     discard;\n"+
"   else\n"+
"     gl_FragColor = textureColor;\n";
} else
result = result +   "   gl_FragColor = lighteffect;\n";
//if (fat_lines)
//  result = result +   "   gl_FragColor = vec4(0.0, abs(point.x), abs(point.y), 1.0);"
result = result + "  }\n";
// console.log(result);
return result;
};
/**
* Call gl functions to create and compile shader
* @returns {Object}
* @param { number } shaderType - gl code for shader type
* @param { string } code - code for the shader
*/
rglwidgetClass.prototype.getShader = function(shaderType, code) {
var gl = this.gl, shader;
shader = gl.createShader(shaderType);
gl.shaderSource(shader, code);
gl.compileShader(shader);
if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS) && !gl.isContextLost())
alert(gl.getShaderInfoLog(shader));
return shader;
};
/**
* Handle a texture after its image has been loaded
* @param { Object } texture - the gl texture object
* @param { Object } textureCanvas - the canvas holding the image
*/
rglwidgetClass.prototype.handleLoadedTexture = function(texture, textureCanvas) {
var gl = this.gl || this.initGL();
gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);
gl.bindTexture(gl.TEXTURE_2D, texture);
gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, textureCanvas);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_NEAREST);
gl.generateMipmap(gl.TEXTURE_2D);
gl.bindTexture(gl.TEXTURE_2D, null);
};
/**
* Load an image to a texture
* @param { string } uri - The image location
* @param { Object } texture - the gl texture object
*/
rglwidgetClass.prototype.loadImageToTexture = function(uri, texture) {
var canvas = this.textureCanvas,
ctx = canvas.getContext("2d"),
image = new Image(),
self = this;
image.onload = function() {
var w = image.width,
h = image.height,
canvasX = self.getPowerOfTwo(w),
canvasY = self.getPowerOfTwo(h),
gl = self.gl || self.initGL(),
maxTexSize = gl.getParameter(gl.MAX_TEXTURE_SIZE);
if (maxTexSize > 4096) maxTexSize = 4096;
while (canvasX > 1 && canvasY > 1 && (canvasX > maxTexSize || canvasY > maxTexSize)) {
canvasX /= 2;
canvasY /= 2;
}
canvas.width = canvasX;
canvas.height = canvasY;
ctx.imageSmoothingEnabled = true;
ctx.drawImage(image, 0, 0, canvasX, canvasY);
self.handleLoadedTexture(texture, canvas);
self.drawScene();
};
image.src = uri;
};
/**
* Draw text to the texture canvas
* @returns { Object } object with text measurements
* @param { string } text - the text
* @param { number } cex - expansion
* @param { string } family - font family
* @param { number } font - font number
*/
rglwidgetClass.prototype.drawTextToCanvas = function(text, cex, family, font) {
var canvasX, canvasY,
textY,
scaling = 20,
textColour = "white",
backgroundColour = "rgba(0,0,0,0)",
canvas = this.textureCanvas,
ctx = canvas.getContext("2d"),
i, textHeights = [], widths = [], offset = 0, offsets = [],
fontStrings = [],
getFontString = function(i) {
textHeights[i] = scaling*cex[i];
var fontString = textHeights[i] + "px",
family0 = family[i],
font0 = font[i];
if (family0 === "sans")
family0 = "sans-serif";
else if (family0 === "mono")
family0 = "monospace";
fontString = fontString + " " + family0;
if (font0 === 2 || font0 === 4)
fontString = "bold " + fontString;
if (font0 === 3 || font0 === 4)
fontString = "italic " + fontString;
return fontString;
};
cex = this.repeatToLen(cex, text.length);
family = this.repeatToLen(family, text.length);
font = this.repeatToLen(font, text.length);
canvasX = 1;
for (i = 0; i < text.length; i++)  {
ctx.font = fontStrings[i] = getFontString(i);
widths[i] = ctx.measureText(text[i]).width;
offset = offsets[i] = offset + 2*textHeights[i];
canvasX = (widths[i] > canvasX) ? widths[i] : canvasX;
}
canvasX = this.getPowerOfTwo(canvasX);
canvasY = this.getPowerOfTwo(offset);
canvas.width = canvasX;
canvas.height = canvasY;
ctx.fillStyle = backgroundColour;
ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);
ctx.textBaseline = "alphabetic";
for(i = 0; i < text.length; i++) {
textY = offsets[i];
ctx.font = fontStrings[i];
ctx.fillStyle = textColour;
ctx.textAlign = "left";
ctx.fillText(text[i], 0,  textY);
}
return {canvasX:canvasX, canvasY:canvasY,
widths:widths, textHeights:textHeights,
offsets:offsets};
};
/**
* Set the gl viewport and scissor test
* @param { number } id - id of subscene
*/
rglwidgetClass.prototype.setViewport = function(id) {
var gl = this.gl || this.initGL(),
vp = this.getObj(id).par3d.viewport,
x = vp.x*this.canvas.width,
y = vp.y*this.canvas.height,
width = vp.width*this.canvas.width,
height = vp.height*this.canvas.height;
this.vp = {x:x, y:y, width:width, height:height};
gl.viewport(x, y, width, height);
gl.scissor(x, y, width, height);
gl.enable(gl.SCISSOR_TEST);
};
/**
* Set the projection matrix for a subscene
* @param { number } id - id of subscene
*/
rglwidgetClass.prototype.setprMatrix = function(id) {
var subscene = this.getObj(id),
embedding = subscene.embeddings.projection;
if (embedding === "replace")
this.prMatrix.makeIdentity();
else
this.setprMatrix(subscene.parent);
if (embedding === "inherit")
return;
// This is based on the Frustum::enclose code from geom.cpp
var bbox = subscene.par3d.bbox,
scale = subscene.par3d.scale,
ranges = [(bbox[1]-bbox[0])*scale[0]/2,
(bbox[3]-bbox[2])*scale[1]/2,
(bbox[5]-bbox[4])*scale[2]/2],
radius = Math.sqrt(this.sumsq(ranges))*1.1; // A bit bigger to handle labels
if (radius <= 0) radius = 1;
var observer = subscene.par3d.observer,
distance = observer[2],
FOV = subscene.par3d.FOV, ortho = FOV === 0,
t = ortho ? 1 : Math.tan(FOV*Math.PI/360),
near = distance - radius,
far = distance + radius,
hlen,
aspect = this.vp.width/this.vp.height,
z = subscene.par3d.zoom;
if (far < 0.0)
far = 1.0;
if (near < far/100.0)
near = far/100.0;
hlen = t*near;
if (ortho) {
if (aspect > 1)
this.prMatrix.ortho(-hlen*aspect*z, hlen*aspect*z,
-hlen*z, hlen*z, near, far);
else
this.prMatrix.ortho(-hlen*z, hlen*z,
-hlen*z/aspect, hlen*z/aspect,
near, far);
} else {
if (aspect > 1)
this.prMatrix.frustum(-hlen*aspect*z, hlen*aspect*z,
-hlen*z, hlen*z, near, far);
else
this.prMatrix.frustum(-hlen*z, hlen*z,
-hlen*z/aspect, hlen*z/aspect,
near, far);
}
};
/**
* Set the model-view matrix for a subscene
* @param { number } id - id of the subscene
*/
rglwidgetClass.prototype.setmvMatrix = function(id) {
var observer = this.getObj(id).par3d.observer;
this.mvMatrix.makeIdentity();
this.setmodelMatrix(id);
this.mvMatrix.translate(-observer[0], -observer[1], -observer[2]);
};
/**
* Set the model matrix for a subscene
* @param { number } id - id of the subscene
*/
rglwidgetClass.prototype.setmodelMatrix = function(id) {
var subscene = this.getObj(id),
embedding = subscene.embeddings.model;
if (embedding !== "inherit") {
var scale = subscene.par3d.scale,
bbox = subscene.par3d.bbox,
center = [(bbox[0]+bbox[1])/2,
(bbox[2]+bbox[3])/2,
(bbox[4]+bbox[5])/2];
this.mvMatrix.translate(-center[0], -center[1], -center[2]);
this.mvMatrix.scale(scale[0], scale[1], scale[2]);
this.mvMatrix.multRight( subscene.par3d.userMatrix );
}
if (embedding !== "replace")
this.setmodelMatrix(subscene.parent);
};
/**
* Set the normals matrix for a subscene
* @param { number } subsceneid - id of the subscene
*/
rglwidgetClass.prototype.setnormMatrix = function(subsceneid) {
var self = this,
recurse = function(id) {
var sub = self.getObj(id),
embedding = sub.embeddings.model;
if (embedding !== "inherit") {
var scale = sub.par3d.scale;
self.normMatrix.scale(1/scale[0], 1/scale[1], 1/scale[2]);
self.normMatrix.multRight(sub.par3d.userMatrix);
}
if (embedding !== "replace")
recurse(sub.parent);
};
self.normMatrix.makeIdentity();
recurse(subsceneid);
};
/**
* Set the combined projection-model-view matrix
*/
rglwidgetClass.prototype.setprmvMatrix = function() {
this.prmvMatrix = new CanvasMatrix4( this.mvMatrix );
this.prmvMatrix.multRight( this.prMatrix );
};
/**
* Count clipping planes in a scene
* @returns {number}
*/
rglwidgetClass.prototype.countClipplanes = function() {
return this.countObjs("clipplanes");
};
/**
* Count lights in a scene
* @returns { number }
*/
rglwidgetClass.prototype.countLights = function() {
return this.countObjs("light");
};
/**
* Count objects of specific type in a scene
* @returns { number }
* @param { string } type - Type of object to count
*/
rglwidgetClass.prototype.countObjs = function(type) {
var self = this,
bound = 0;
Object.keys(this.scene.objects).forEach(
function(key) {
if (self.getObj(parseInt(key, 10)).type === type)
bound = bound + 1;
});
return bound;
};
/**
* Initialize a subscene
* @param { number } id - id of subscene.
*/
rglwidgetClass.prototype.initSubscene = function(id) {
var sub = this.getObj(id),
i, obj;
if (sub.type !== "subscene")
return;
sub.par3d.userMatrix = this.toCanvasMatrix4(sub.par3d.userMatrix);
sub.par3d.listeners = [].concat(sub.par3d.listeners);
sub.backgroundId = undefined;
sub.subscenes = [];
sub.clipplanes = [];
sub.transparent = [];
sub.opaque = [];
sub.lights = [];
for (i=0; i < sub.objects.length; i++) {
obj = this.getObj(sub.objects[i]);
if (typeof obj === "undefined") {
sub.objects.splice(i, 1);
i--;
} else if (obj.type === "background")
sub.backgroundId = obj.id;
else
sub[this.whichList(obj.id)].push(obj.id);
}
};
/**
* Copy object
* @param { number } id - id of object to copy
* @param { string } reuse - Document id of scene to reuse
*/
rglwidgetClass.prototype.copyObj = function(id, reuse) {
var obj = this.getObj(id),
prev = document.getElementById(reuse);
if (prev !== null) {
prev = prev.rglinstance;
var
prevobj = prev.getObj(id),
fields = ["flags", "type",
"colors", "vertices", "centers",
"normals", "offsets",
"texts", "cex", "family", "font", "adj",
"material",
"radii",
"texcoords",
"userMatrix", "ids",
"dim",
"par3d", "userMatrix",
"viewpoint", "finite"],
i;
for (i = 0; i < fields.length; i++) {
if (typeof prevobj[fields[i]] !== "undefined")
obj[fields[i]] = prevobj[fields[i]];
}
} else
console.warn("copyObj failed");
};
/**
* Update the triangles used to display a plane
* @param { number } id - id of the plane
* @param { Object } bbox - bounding box in which to display the plane
*/
rglwidgetClass.prototype.planeUpdateTriangles = function(id, bbox) {
var perms = [[0,0,1], [1,2,2], [2,1,0]],
x, xrow, elem, A, d, nhits, i, j, k, u, v, w, intersect, which, v0, v2, vx, reverse,
face1 = [], face2 = [], normals = [],
obj = this.getObj(id),
nPlanes = obj.normals.length;
obj.bbox = bbox;
obj.vertices = [];
obj.initialized = false;
for (elem = 0; elem < nPlanes; elem++) {
//    Vertex Av = normal.getRecycled(elem);
x = [];
A = obj.normals[elem];
d = obj.offsets[elem][0];
nhits = 0;
for (i=0; i<3; i++)
for (j=0; j<2; j++)
for (k=0; k<2; k++) {
u = perms[0][i];
v = perms[1][i];
w = perms[2][i];
if (A[w] !== 0.0) {
intersect = -(d + A[u]*bbox[j+2*u] + A[v]*bbox[k+2*v])/A[w];
if (bbox[2*w] < intersect && intersect < bbox[1+2*w]) {
xrow = [];
xrow[u] = bbox[j+2*u];
xrow[v] = bbox[k+2*v];
xrow[w] = intersect;
x.push(xrow);
face1[nhits] = j + 2*u;
face2[nhits] = k + 2*v;
nhits++;
}
}
}
if (nhits > 3) {
/* Re-order the intersections so the triangles work */
for (i=0; i<nhits-2; i++) {
which = 0; /* initialize to suppress warning */
for (j=i+1; j<nhits; j++) {
if (face1[i] == face1[j] || face1[i] == face2[j] ||
face2[i] == face1[j] || face2[i] == face2[j] ) {
which = j;
break;
}
}
if (which > i+1) {
this.swap(x, i+1, which);
this.swap(face1, i+1, which);
this.swap(face2, i+1, which);
}
}
}
if (nhits >= 3) {
/* Put in order so that the normal points out the FRONT of the faces */
v0 = [x[0][0] - x[1][0] , x[0][1] - x[1][1], x[0][2] - x[1][2]];
v2 = [x[2][0] - x[1][0] , x[2][1] - x[1][1], x[2][2] - x[1][2]];
/* cross-product */
vx = this.xprod(v0, v2);
reverse = this.dotprod(vx, A) > 0;
for (i=0; i<nhits-2; i++) {
obj.vertices.push(x[0]);
normals.push(A);
for (j=1; j<3; j++) {
obj.vertices.push(x[i + (reverse ? 3-j : j)]);
normals.push(A);
}
}
}
}
obj.pnormals = normals;
};
/**
* Initialize object for display
* @param { number } id - id of object to initialize
*/
rglwidgetClass.prototype.initObj = function(id) {
var obj = this.getObj(id),
flags = obj.flags,
type = obj.type,
is_lit = flags & this.f_is_lit,
is_lines = flags & this.f_is_lines,
fat_lines = flags & this.f_fat_lines,
has_texture = flags & this.f_has_texture,
fixed_quads = flags & this.f_fixed_quads,
depth_sort = flags & this.f_depth_sort,
sprites_3d = flags & this.f_sprites_3d,
sprite_3d = flags & this.f_sprite_3d,
fixed_size = flags & this.f_fixed_size,
is_twosided = (flags & this.f_is_twosided) > 0,
gl = this.gl || this.initGL(),
texinfo, drawtype, nclipplanes, f, nrows, oldrows,
i,j,v,v1,v2, mat, uri, matobj, pass, passes, pmode,
dim, nx, nz, attr;
if (typeof id !== "number") {
this.alertOnce("initObj id is "+typeof id);
}
obj.initialized = true;
if (type === "bboxdeco" || type === "subscene")
return;
if (type === "light") {
obj.ambient = new Float32Array(obj.colors[0].slice(0,3));
obj.diffuse = new Float32Array(obj.colors[1].slice(0,3));
obj.specular = new Float32Array(obj.colors[2].slice(0,3));
obj.lightDir = new Float32Array(obj.vertices[0]);
return;
}
if (type === "clipplanes") {
obj.vClipplane = this.flatten(this.cbind(obj.normals, obj.offsets));
return;
}
if (type == "background" && typeof obj.ids !== "undefined") {
obj.quad = this.flatten([].concat(obj.ids));
return;
}
if (typeof obj.vertices === "undefined")
obj.vertices = [];
v = obj.vertices;
obj.vertexCount = v.length;
if (!obj.vertexCount) return;
if (is_twosided) {
if (typeof obj.userAttributes === "undefined")
obj.userAttributes = {};
v1 = Array(v.length);
v2 = Array(v.length);
if (obj.type == "triangles" || obj.type == "quads") {
if (obj.type == "triangles")
nrow = 3;
else
nrow = 4;
for (i=0; i<Math.floor(v.length/nrow); i++)
for (j=0; j<nrow; j++) {
v1[nrow*i + j] = v[nrow*i + ((j+1) % nrow)];
v2[nrow*i + j] = v[nrow*i + ((j+2) % nrow)];
}
} else if (obj.type == "surface") {
dim = obj.dim[0];
nx = dim[0];
nz = dim[1];
for (j=0; j<nx; j++) {
for (i=0; i<nz; i++) {
if (i+1 < nz && j+1 < nx) {
v2[j + nx*i] = v[j + nx*(i+1)];
v1[j + nx*i] = v[j+1 + nx*(i+1)];
} else if (i+1 < nz) {
v2[j + nx*i] = v[j-1 + nx*i];
v1[j + nx*i] = v[j + nx*(i+1)];
} else {
v2[j + nx*i] = v[j + nx*(i-1)];
v1[j + nx*i] = v[j-1 + nx*(i-1)];
}
}
}
}
obj.userAttributes.aPos1 = v1;
obj.userAttributes.aPos2 = v2;
}
if (!sprites_3d) {
if (gl.isContextLost()) return;
obj.prog = gl.createProgram();
gl.attachShader(obj.prog, this.getShader( gl.VERTEX_SHADER,
this.getVertexShader(id) ));
gl.attachShader(obj.prog, this.getShader( gl.FRAGMENT_SHADER,
this.getFragmentShader(id) ));
//  Force aPos to location 0, aCol to location 1
gl.bindAttribLocation(obj.prog, 0, "aPos");
gl.bindAttribLocation(obj.prog, 1, "aCol");
gl.linkProgram(obj.prog);
var linked = gl.getProgramParameter(obj.prog, gl.LINK_STATUS);
if (!linked) {
// An error occurred while linking
var lastError = gl.getProgramInfoLog(obj.prog);
console.warn("Error in program linking:" + lastError);
gl.deleteProgram(obj.prog);
return;
}
}
if (type === "text") {
texinfo = this.drawTextToCanvas(obj.texts,
this.flatten(obj.cex),
this.flatten(obj.family),
this.flatten(obj.family));
}
if (fixed_quads && !sprites_3d) {
obj.ofsLoc = gl.getAttribLocation(obj.prog, "aOfs");
}
if (sprite_3d) {
obj.origLoc = gl.getUniformLocation(obj.prog, "uOrig");
obj.sizeLoc = gl.getUniformLocation(obj.prog, "uSize");
obj.usermatLoc = gl.getUniformLocation(obj.prog, "usermat");
}
if (has_texture || type == "text") {
obj.texture = gl.createTexture();
obj.texLoc = gl.getAttribLocation(obj.prog, "aTexcoord");
obj.sampler = gl.getUniformLocation(obj.prog, "uSampler");
}
if (has_texture) {
mat = obj.material;
if (typeof mat.uri !== "undefined")
uri = mat.uri;
else if (typeof mat.uriElementId === "undefined") {
matobj = this.getObj(mat.uriId);
if (typeof matobj !== "undefined") {
uri = matobj.material.uri;
} else {
uri = "";
}
} else
uri = document.getElementById(mat.uriElementId).rglinstance.getObj(mat.uriId).material.uri;
this.loadImageToTexture(uri, obj.texture);
}
if (type === "text") {
this.handleLoadedTexture(obj.texture, this.textureCanvas);
}
var stride = 3, nc, cofs, nofs, radofs, oofs, tofs, vnew, fnew,
nextofs = -1, pointofs = -1, alias;
obj.alias = undefined;
nc = obj.colorCount = obj.colors.length;
if (nc > 1) {
cofs = stride;
stride = stride + 4;
v = this.cbind(v, obj.colors);
} else {
cofs = -1;
obj.onecolor = this.flatten(obj.colors);
}
if (typeof obj.normals !== "undefined") {
nofs = stride;
stride = stride + 3;
v = this.cbind(v, typeof obj.pnormals !== "undefined" ? obj.pnormals : obj.normals);
} else
nofs = -1;
if (typeof obj.radii !== "undefined") {
radofs = stride;
stride = stride + 1;
// FIXME:  always concat the radii?
if (obj.radii.length === v.length) {
v = this.cbind(v, obj.radii);
} else if (obj.radii.length === 1) {
v = v.map(function(row, i, arr) { return row.concat(obj.radii[0]);});
}
} else
radofs = -1;
// Add default indices
f = Array(v.length);
for (i = 0; i < v.length; i++)
f[i] = i;
obj.f = [f,f];
if (type == "sprites" && !sprites_3d) {
tofs = stride;
stride += 2;
oofs = stride;
stride += 2;
vnew = new Array(4*v.length);
fnew = new Array(4*v.length);
alias = new Array(v.length);
var rescale = fixed_size ? 72 : 1,
size = obj.radii, s = rescale*size[0]/2;
last = v.length;
f = obj.f[0];
for (i=0; i < v.length; i++) {
if (size.length > 1)
s = rescale*size[i]/2;
vnew[i]  = v[i].concat([0,0,-s,-s]);
fnew[4*i] = f[i];
vnew[last]= v[i].concat([1,0, s,-s]);
fnew[4*i+1] = last++;
vnew[last]= v[i].concat([1,1, s, s]);
fnew[4*i+2] = last++;
vnew[last]= v[i].concat([0,1,-s, s]);
fnew[4*i+3] = last++;
alias[i] = [last-3, last-2, last-1];
}
v = vnew;
obj.vertexCount = v.length;
obj.f = [fnew, fnew];
} else if (type === "text") {
tofs = stride;
stride += 2;
oofs = stride;
stride += 2;
vnew = new Array(4*v.length);
f = obj.f[0];
fnew = new Array(4*f.length);
alias = new Array(v.length);
last = v.length;
for (i=0; i < v.length; i++) {
vnew[i]  = v[i].concat([0,-0.5]).concat(obj.adj[0]);
fnew[4*i] = f[i];
vnew[last] = v[i].concat([1,-0.5]).concat(obj.adj[0]);
fnew[4*i+1] = last++;
vnew[last] = v[i].concat([1, 1.5]).concat(obj.adj[0]);
fnew[4*i+2] = last++;
vnew[last] = v[i].concat([0, 1.5]).concat(obj.adj[0]);
fnew[4*i+3] = last++;
alias[i] = [last-3, last-2, last-1];
for (j=0; j < 4; j++) {
v1 = vnew[fnew[4*i+j]];
v1[tofs+2] = 2*(v1[tofs]-v1[tofs+2])*texinfo.widths[i];
v1[tofs+3] = 2*(v1[tofs+1]-v1[tofs+3])*texinfo.textHeights[i];
v1[tofs] *= texinfo.widths[i]/texinfo.canvasX;
v1[tofs+1] = 1.0-(texinfo.offsets[i] -
v1[tofs+1]*texinfo.textHeights[i])/texinfo.canvasY;
vnew[fnew[4*i+j]] = v1;
}
}
v = vnew;
obj.vertexCount = v.length;
obj.f = [fnew, fnew];
} else if (typeof obj.texcoords !== "undefined") {
tofs = stride;
stride += 2;
oofs = -1;
v = this.cbind(v, obj.texcoords);
} else {
tofs = -1;
oofs = -1;
}
obj.alias = alias;
if (typeof obj.userAttributes !== "undefined") {
obj.userAttribOffsets = {};
obj.userAttribLocations = {};
obj.userAttribSizes = {};
for (attr in obj.userAttributes) {
obj.userAttribLocations[attr] = gl.getAttribLocation(obj.prog, attr);
if (obj.userAttribLocations[attr] >= 0) { // Attribute may not have been used
obj.userAttribOffsets[attr] = stride;
v = this.cbind(v, obj.userAttributes[attr]);
stride = v[0].length;
obj.userAttribSizes[attr] = stride - obj.userAttribOffsets[attr];
}
}
}
if (typeof obj.userUniforms !== "undefined") {
obj.userUniformLocations = {};
for (attr in obj.userUniforms)
obj.userUniformLocations[attr] = gl.getUniformLocation(obj.prog, attr);
}
if (sprites_3d) {
obj.userMatrix = new CanvasMatrix4(obj.userMatrix);
obj.objects = this.flatten([].concat(obj.ids));
is_lit = false;
}
if (is_lit && !fixed_quads) {
obj.normLoc = gl.getAttribLocation(obj.prog, "aNorm");
}
nclipplanes = this.countClipplanes();
if (nclipplanes && !sprites_3d) {
obj.clipLoc = [];
for (i=0; i < nclipplanes; i++)
obj.clipLoc[i] = gl.getUniformLocation(obj.prog,"vClipplane" + i);
}
if (is_lit) {
obj.emissionLoc = gl.getUniformLocation(obj.prog, "emission");
obj.emission = new Float32Array(this.stringToRgb(this.getMaterial(id, "emission")));
obj.shininessLoc = gl.getUniformLocation(obj.prog, "shininess");
obj.shininess = this.getMaterial(id, "shininess");
obj.nlights = this.countLights();
obj.ambientLoc = [];
obj.ambient = new Float32Array(this.stringToRgb(this.getMaterial(id, "ambient")));
obj.specularLoc = [];
obj.specular = new Float32Array(this.stringToRgb(this.getMaterial(id, "specular")));
obj.diffuseLoc = [];
obj.lightDirLoc = [];
obj.viewpointLoc = [];
obj.finiteLoc = [];
for (i=0; i < obj.nlights; i++) {
obj.ambientLoc[i] = gl.getUniformLocation(obj.prog, "ambient" + i);
obj.specularLoc[i] = gl.getUniformLocation(obj.prog, "specular" + i);
obj.diffuseLoc[i] = gl.getUniformLocation(obj.prog, "diffuse" + i);
obj.lightDirLoc[i] = gl.getUniformLocation(obj.prog, "lightDir" + i);
obj.viewpointLoc[i] = gl.getUniformLocation(obj.prog, "viewpoint" + i);
obj.finiteLoc[i] = gl.getUniformLocation(obj.prog, "finite" + i);
}
}
obj.passes = is_twosided + 1;
obj.pmode = new Array(obj.passes);
for (pass = 0; pass < obj.passes; pass++) {
if (type === "triangles" || type === "quads" || type === "surface")
pmode = this.getMaterial(id, (pass === 0) ? "front" : "back");
else pmode = "filled";
obj.pmode[pass] = pmode;
}
obj.f.length = obj.passes;
for (pass = 0; pass < obj.passes; pass++) {
f = fnew = obj.f[pass];
pmode = obj.pmode[pass];
if (pmode === "culled")
f = [];
else if (pmode === "points") {
// stay with default
} else if ((type === "quads" || type === "text" ||
type === "sprites") && !sprites_3d) {
nrows = Math.floor(obj.vertexCount/4);
if (pmode === "filled") {
fnew = Array(6*nrows);
for (i=0; i < nrows; i++) {
fnew[6*i] = f[4*i];
fnew[6*i+1] = f[4*i + 1];
fnew[6*i+2] = f[4*i + 2];
fnew[6*i+3] = f[4*i];
fnew[6*i+4] = f[4*i + 2];
fnew[6*i+5] = f[4*i + 3];
}
} else {
fnew = Array(8*nrows);
for (i=0; i < nrows; i++) {
fnew[8*i] = f[4*i];
fnew[8*i+1] = f[4*i + 1];
fnew[8*i+2] = f[4*i + 1];
fnew[8*i+3] = f[4*i + 2];
fnew[8*i+4] = f[4*i + 2];
fnew[8*i+5] = f[4*i + 3];
fnew[8*i+6] = f[4*i + 3];
fnew[8*i+7] = f[4*i];
}
}
} else if (type === "triangles") {
nrows = Math.floor(obj.vertexCount/3);
if (pmode === "filled") {
fnew = Array(3*nrows);
for (i=0; i < fnew.length; i++) {
fnew[i] = f[i];
}
} else if (pmode === "lines") {
fnew = Array(6*nrows);
for (i=0; i < nrows; i++) {
fnew[6*i] = f[3*i];
fnew[6*i + 1] = f[3*i + 1];
fnew[6*i + 2] = f[3*i + 1];
fnew[6*i + 3] = f[3*i + 2];
fnew[6*i + 4] = f[3*i + 2];
fnew[6*i + 5] = f[3*i];
}
}
} else if (type === "spheres") {
// default
} else if (type === "surface") {
dim = obj.dim[0];
nx = dim[0];
nz = dim[1];
if (pmode === "filled") {
fnew = [];
for (j=0; j<nx-1; j++) {
for (i=0; i<nz-1; i++) {
fnew.push(f[j + nx*i],
f[j + nx*(i+1)],
f[j + 1 + nx*(i+1)],
f[j + nx*i],
f[j + 1 + nx*(i+1)],
f[j + 1 + nx*i]);
}
}
} else if (pmode === "lines") {
fnew = [];
for (j=0; j<nx; j++) {
for (i=0; i<nz; i++) {
if (i+1 < nz)
fnew.push(f[j + nx*i],
f[j + nx*(i+1)]);
if (j+1 < nx)
fnew.push(f[j + nx*i],
f[j+1 + nx*i]);
}
}
}
}
obj.f[pass] = fnew;
if (depth_sort) {
drawtype = "DYNAMIC_DRAW";
} else {
drawtype = "STATIC_DRAW";
}
}
if (fat_lines) {
alias = undefined;
obj.nextLoc = gl.getAttribLocation(obj.prog, "aNext");
obj.pointLoc = gl.getAttribLocation(obj.prog, "aPoint");
obj.aspectLoc = gl.getUniformLocation(obj.prog, "uAspect");
obj.lwdLoc = gl.getUniformLocation(obj.prog, "uLwd");
// Expand vertices to turn each segment into a pair of triangles
for (pass = 0; pass < obj.passes; pass++) {
f = obj.f[pass];    
oldrows = f.length;
if (obj.pmode[pass] === "lines") 
break;
}
if (type === "linestrip") 
nrows = 4*(oldrows - 1); 
else
nrows = 2*oldrows;
vnew = new Array(nrows);
fnew = new Array(1.5*nrows);
var fnext = new Array(nrows),
fpt = new Array(nrows), 
pt, start, gap = type === "linestrip" ? 3 : 1;
// We're going to turn each pair of vertices into 4 new ones, with the "next" and "pt" attributes
// added.
// We do this by copying the originals in the first pass, adding the new attributes, then in a 
// second pass add new vertices at the end.
for (i = 0; i < v.length; i++) {
vnew[i] = v[i].concat([0,0,0,0,0]); 
}
nextofs = stride;
pointofs = stride + 3;
stride = stride + 5;
// Now add the extras
last = v.length - 1;
ind = 0;
alias = new Array(f.length);
for (i = 0; i < f.length; i++)
alias[i] = [];
for (i = 0; i < f.length - 1; i++) {
if (type !== "linestrip" && i % 2 == 1)
continue;
k = ++last;
vnew[k] = vnew[f[i]].slice();
for (j=0; j<3; j++)
vnew[k][nextofs + j] = vnew[f[i+1]][j];
vnew[k][pointofs] = -1;
vnew[k][pointofs+1] = -1;
fnew[ind] = k;
last++;
vnew[last] = vnew[k].slice();
vnew[last][pointofs] = 1;
fnew[ind+1] = last;
alias[f[i]].push(last-1, last);
last++;
k = last;
vnew[k] = vnew[f[i+1]].slice();
for (j=0; j<3; j++)
vnew[k][nextofs + j] = vnew[f[i]][j];
vnew[k][pointofs] = -1;
vnew[k][pointofs+1] = 1;
fnew[ind+2] = k;
fnew[ind+3] = fnew[ind+1];
last++;
vnew[last] = vnew[k].slice();
vnew[last][pointofs] = 1;
fnew[ind+4] = last;
fnew[ind+5] = fnew[ind+2];
ind += 6;
alias[f[i+1]].push(last-1, last);
}
vnew.length = last+1;
v = vnew;
obj.vertexCount = v.length;
if (typeof alias !== "undefined" && typeof obj.alias !== "undefined") {  // Already have aliases from previous section?
var oldalias = obj.alias, newalias = Array(obj.alias.length);
for (i = 0; i < newalias.length; i++) {
newalias[i] = oldalias[i].slice();
for (j = 0; j < oldalias[i].length; j++)
Array.prototype.push.apply(newalias[i], alias[oldalias[j]]); // pushes each element 
}
obj.alias = newalias;
} else
obj.alias = alias;
for (pass = 0; pass < obj.passes; pass++)
if (type === "lines" || type === "linestrip" || obj.pmode[pass] == "lines") {
obj.f[pass] = fnew;
}
if (depth_sort) 
drawtype = "DYNAMIC_DRAW";
else
drawtype = "STATIC_DRAW";
}
for (pass = 0; pass < obj.passes; pass++) {
if (obj.vertexCount > 65535) {
if (this.index_uint) {
obj.f[pass] = new Uint32Array(obj.f[pass]);
obj.index_uint = true;
} else
this.alertOnce("Object has "+obj.vertexCount+" vertices, not supported in this browser.");
} else {
obj.f[pass] = new Uint16Array(obj.f[pass]);
obj.index_uint = false;
}
}
if (stride !== v[0].length) {
this.alertOnce("problem in stride calculation");
}
obj.vOffsets = {vofs:0, cofs:cofs, nofs:nofs, radofs:radofs, oofs:oofs, tofs:tofs,
nextofs:nextofs, pointofs:pointofs, stride:stride};
obj.values = new Float32Array(this.flatten(v));
if (type !== "spheres" && !sprites_3d) {
obj.buf = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, obj.buf);
gl.bufferData(gl.ARRAY_BUFFER, obj.values, gl.STATIC_DRAW); //
obj.ibuf = Array(obj.passes);
obj.ibuf[0] = gl.createBuffer();
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, obj.ibuf[0]);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, obj.f[0], gl[drawtype]);
if (is_twosided) {
obj.ibuf[1] = gl.createBuffer();
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, obj.ibuf[1]);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, obj.f[1], gl[drawtype]);
}
}
if (!sprites_3d) {
obj.mvMatLoc = gl.getUniformLocation(obj.prog, "mvMatrix");
obj.prMatLoc = gl.getUniformLocation(obj.prog, "prMatrix");
}
if (fixed_size) {
obj.textScaleLoc = gl.getUniformLocation(obj.prog, "textScale");
}
if (is_lit && !sprites_3d) {
obj.normMatLoc = gl.getUniformLocation(obj.prog, "normMatrix");
}
if (is_twosided) {
obj.frontLoc = gl.getUniformLocation(obj.prog, "front");
}
};
/**
* Set gl depth test based on object's material
* @param { number } id - object to use
*/
rglwidgetClass.prototype.setDepthTest = function(id) {
var gl = this.gl || this.initGL(),
tests = {never: gl.NEVER,
less:  gl.LESS,
equal: gl.EQUAL,
lequal:gl.LEQUAL,
greater: gl.GREATER,
notequal: gl.NOTEQUAL,
gequal: gl.GEQUAL,
always: gl.ALWAYS},
test = tests[this.getMaterial(id, "depth_test")];
gl.depthFunc(test);
};
rglwidgetClass.prototype.mode4type = {points : "POINTS",
linestrip : "LINE_STRIP",
abclines : "LINES",
lines : "LINES",
sprites : "TRIANGLES",
planes : "TRIANGLES",
text : "TRIANGLES",
quads : "TRIANGLES",
surface : "TRIANGLES",
triangles : "TRIANGLES"};
/**
* Sort objects from back to front
* @returns { number[] }
* @param { Object } obj - object to sort
*/
rglwidgetClass.prototype.depthSort = function(obj) {
var n = obj.centers.length,
depths = new Float32Array(n),
result = new Array(n),
compare = function(i,j) { return depths[j] - depths[i]; },
z, w;
for(i=0; i<n; i++) {
z = this.prmvMatrix.m13*obj.centers[i][0] +
this.prmvMatrix.m23*obj.centers[i][1] +
this.prmvMatrix.m33*obj.centers[i][2] +
this.prmvMatrix.m43;
w = this.prmvMatrix.m14*obj.centers[i][0] +
this.prmvMatrix.m24*obj.centers[i][1] +
this.prmvMatrix.m34*obj.centers[i][2] +
this.prmvMatrix.m44;
depths[i] = z/w;
result[i] = i;
}
result.sort(compare);
return result;
};
/**
* Draw an object in a subscene
* @param { number } id - object to draw
* @param { number } subsceneid - id of subscene
*/
rglwidgetClass.prototype.drawObj = function(id, subsceneid) {
var obj = this.getObj(id),
subscene = this.getObj(subsceneid),
flags = obj.flags,
type = obj.type,
is_lit = flags & this.f_is_lit,
has_texture = flags & this.f_has_texture,
fixed_quads = flags & this.f_fixed_quads,
depth_sort = flags & this.f_depth_sort,
sprites_3d = flags & this.f_sprites_3d,
sprite_3d = flags & this.f_sprite_3d,
is_lines = flags & this.f_is_lines,
fat_lines = flags & this.f_fat_lines,
is_points = flags & this.f_is_points,
fixed_size = flags & this.f_fixed_size,
is_twosided = (flags & this.f_is_twosided) > 0,
gl = this.gl || this.initGL(),
mat,
sphereMV, baseofs, ofs, sscale, i, count, light,
pass, mode, pmode, attr;
if (typeof id !== "number") {
this.alertOnce("drawObj id is "+typeof id);
}
if (type === "planes") {
if (obj.bbox !== subscene.par3d.bbox || !obj.initialized) {
this.planeUpdateTriangles(id, subscene.par3d.bbox);
}
}
if (!obj.initialized)
this.initObj(id);
if (type === "clipplanes") {
count = obj.offsets.length;
var IMVClip = [];
for (i=0; i < count; i++) {
IMVClip[i] = this.multMV(this.invMatrix, obj.vClipplane.slice(4*i, 4*(i+1)));
}
obj.IMVClip = IMVClip;
return;
}
if (type === "light" || type === "bboxdeco" || !obj.vertexCount)
return;
this.setDepthTest(id);
if (sprites_3d) {
var norigs = obj.vertices.length,
savenorm = new CanvasMatrix4(this.normMatrix);
this.origs = obj.vertices;
this.usermat = new Float32Array(obj.userMatrix.getAsArray());
this.radii = obj.radii;
this.normMatrix = subscene.spriteNormmat;
for (this.iOrig=0; this.iOrig < norigs; this.iOrig++) {
for (i=0; i < obj.objects.length; i++) {
this.drawObj(obj.objects[i], subsceneid);
}
}
this.normMatrix = savenorm;
return;
} else {
gl.useProgram(obj.prog);
}
if (sprite_3d) {
gl.uniform3fv(obj.origLoc, new Float32Array(this.origs[this.iOrig]));
if (this.radii.length > 1) {
gl.uniform1f(obj.sizeLoc, this.radii[this.iOrig][0]);
} else {
gl.uniform1f(obj.sizeLoc, this.radii[0][0]);
}
gl.uniformMatrix4fv(obj.usermatLoc, false, this.usermat);
}
if (type === "spheres") {
gl.bindBuffer(gl.ARRAY_BUFFER, this.sphere.buf);
} else {
gl.bindBuffer(gl.ARRAY_BUFFER, obj.buf);
}
gl.uniformMatrix4fv( obj.prMatLoc, false, new Float32Array(this.prMatrix.getAsArray()) );
gl.uniformMatrix4fv( obj.mvMatLoc, false, new Float32Array(this.mvMatrix.getAsArray()) );
var clipcheck = 0,
clipplaneids = subscene.clipplanes,
clip, j;
for (i=0; i < clipplaneids.length; i++) {
clip = this.getObj(clipplaneids[i]);
for (j=0; j < clip.offsets.length; j++) {
gl.uniform4fv(obj.clipLoc[clipcheck + j], clip.IMVClip[j]);
}
clipcheck += clip.offsets.length;
}
if (typeof obj.clipLoc !== "undefined")
for (i=clipcheck; i < obj.clipLoc.length; i++)
gl.uniform4f(obj.clipLoc[i], 0,0,0,0);
if (is_lit) {
gl.uniformMatrix4fv( obj.normMatLoc, false, new Float32Array(this.normMatrix.getAsArray()) );
gl.uniform3fv( obj.emissionLoc, obj.emission);
gl.uniform1f( obj.shininessLoc, obj.shininess);
for (i=0; i < subscene.lights.length; i++) {
light = this.getObj(subscene.lights[i]);
gl.uniform3fv( obj.ambientLoc[i], this.componentProduct(light.ambient, obj.ambient));
gl.uniform3fv( obj.specularLoc[i], this.componentProduct(light.specular, obj.specular));
gl.uniform3fv( obj.diffuseLoc[i], light.diffuse);
gl.uniform3fv( obj.lightDirLoc[i], light.lightDir);
gl.uniform1i( obj.viewpointLoc[i], light.viewpoint);
gl.uniform1i( obj.finiteLoc[i], light.finite);
}
for (i=subscene.lights.length; i < obj.nlights; i++) {
gl.uniform3f( obj.ambientLoc[i], 0,0,0);
gl.uniform3f( obj.specularLoc[i], 0,0,0);
gl.uniform3f( obj.diffuseLoc[i], 0,0,0);
}
}
if (fixed_size) {
gl.uniform2f( obj.textScaleLoc, 0.75/this.vp.width, 0.75/this.vp.height);
}
gl.enableVertexAttribArray( this.posLoc );
var nc = obj.colorCount;
count = obj.vertexCount;
if (type === "spheres") {
subscene = this.getObj(subsceneid);
var scale = subscene.par3d.scale,
scount = count, indices;
gl.vertexAttribPointer(this.posLoc,  3, gl.FLOAT, false, 4*this.sphere.vOffsets.stride,  0);
gl.enableVertexAttribArray(obj.normLoc );
gl.vertexAttribPointer(obj.normLoc,  3, gl.FLOAT, false, 4*this.sphere.vOffsets.stride,  0);
gl.disableVertexAttribArray( this.colLoc );
var sphereNorm = new CanvasMatrix4();
sphereNorm.scale(scale[0], scale[1], scale[2]);
sphereNorm.multRight(this.normMatrix);
gl.uniformMatrix4fv( obj.normMatLoc, false, new Float32Array(sphereNorm.getAsArray()) );
if (nc == 1) {
gl.vertexAttrib4fv( this.colLoc, new Float32Array(obj.onecolor));
}
if (has_texture) {
gl.enableVertexAttribArray( obj.texLoc );
gl.vertexAttribPointer(obj.texLoc, 2, gl.FLOAT, false, 4*this.sphere.vOffsets.stride,
4*this.sphere.vOffsets.tofs);
gl.activeTexture(gl.TEXTURE0);
gl.bindTexture(gl.TEXTURE_2D, obj.texture);
gl.uniform1i( obj.sampler, 0);
}
if (depth_sort)
indices = this.depthSort(obj);
for (i = 0; i < scount; i++) {
sphereMV = new CanvasMatrix4();
if (depth_sort) {
baseofs = indices[i]*obj.vOffsets.stride;
} else {
baseofs = i*obj.vOffsets.stride;
}
ofs = baseofs + obj.vOffsets.radofs;
sscale = obj.values[ofs];
sphereMV.scale(sscale/scale[0], sscale/scale[1], sscale/scale[2]);
sphereMV.translate(obj.values[baseofs],
obj.values[baseofs+1],
obj.values[baseofs+2]);
sphereMV.multRight(this.mvMatrix);
gl.uniformMatrix4fv( obj.mvMatLoc, false, new Float32Array(sphereMV.getAsArray()) );
if (nc > 1) {
ofs = baseofs + obj.vOffsets.cofs;
gl.vertexAttrib4f( this.colLoc, obj.values[ofs],
obj.values[ofs+1],
obj.values[ofs+2],
obj.values[ofs+3] );
}
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.sphere.ibuf);
gl.drawElements(gl.TRIANGLES, this.sphere.sphereCount, gl.UNSIGNED_SHORT, 0);
}
return;
} else {
if (obj.colorCount === 1) {
gl.disableVertexAttribArray( this.colLoc );
gl.vertexAttrib4fv( this.colLoc, new Float32Array(obj.onecolor));
} else {
gl.enableVertexAttribArray( this.colLoc );
gl.vertexAttribPointer(this.colLoc, 4, gl.FLOAT, false, 4*obj.vOffsets.stride, 4*obj.vOffsets.cofs);
}
}
if (is_lit && obj.vOffsets.nofs > 0) {
gl.enableVertexAttribArray( obj.normLoc );
gl.vertexAttribPointer(obj.normLoc, 3, gl.FLOAT, false, 4*obj.vOffsets.stride, 4*obj.vOffsets.nofs);
}
if (has_texture || type === "text") {
gl.enableVertexAttribArray( obj.texLoc );
gl.vertexAttribPointer(obj.texLoc, 2, gl.FLOAT, false, 4*obj.vOffsets.stride, 4*obj.vOffsets.tofs);
gl.activeTexture(gl.TEXTURE0);
gl.bindTexture(gl.TEXTURE_2D, obj.texture);
gl.uniform1i( obj.sampler, 0);
}
if (fixed_quads) {
gl.enableVertexAttribArray( obj.ofsLoc );
gl.vertexAttribPointer(obj.ofsLoc, 2, gl.FLOAT, false, 4*obj.vOffsets.stride, 4*obj.vOffsets.oofs);
}
if (typeof obj.userAttributes !== "undefined") {
for (attr in obj.userAttribSizes) {  // Not all attributes may have been used
gl.enableVertexAttribArray( obj.userAttribLocations[attr] );
gl.vertexAttribPointer( obj.userAttribLocations[attr], obj.userAttribSizes[attr],
gl.FLOAT, false, 4*obj.vOffsets.stride, 4*obj.userAttribOffsets[attr]);
}
}
if (typeof obj.userUniforms !== "undefined") {
for (attr in obj.userUniformLocations) {
var loc = obj.userUniformLocations[attr];
if (loc !== null) {
var uniform = obj.userUniforms[attr];
if (typeof uniform.length === "undefined")
gl.uniform1f(loc, uniform);
else if (typeof uniform[0].length === "undefined") {
uniform = new Float32Array(uniform);
switch(uniform.length) {
case 2: gl.uniform2fv(loc, uniform); break;
case 3: gl.uniform3fv(loc, uniform); break;
case 4: gl.uniform4fv(loc, uniform); break;
default: console.warn("bad uniform length");
}
} else if (uniform.length == 4 && uniform[0].length == 4)
gl.uniformMatrix4fv(loc, false, new Float32Array(uniform.getAsArray()));
else
console.warn("unsupported uniform matrix");
}
}
}
for (pass = 0; pass < obj.passes; pass++) {
pmode = obj.pmode[pass];
if (pmode === "culled")
continue;
mode = fat_lines && (is_lines || pmode == "lines") ? "TRIANGLES" : this.mode4type[type];
if (depth_sort && pmode == "filled") {// Don't try depthsorting on wireframe or points
var faces = this.depthSort(obj),
nfaces = faces.length,
frowsize = Math.floor(obj.f[pass].length/nfaces);
if (type !== "spheres") {
var f = obj.index_uint ? new Uint32Array(obj.f[pass].length) : new Uint16Array(obj.f[pass].length);
for (i=0; i<nfaces; i++) {
for (j=0; j<frowsize; j++) {
f[frowsize*i + j] = obj.f[pass][frowsize*faces[i] + j];
}
}
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, obj.ibuf[pass]);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, f, gl.DYNAMIC_DRAW);
}
}
if (is_twosided)
gl.uniform1i(obj.frontLoc, pass !== 0);
if (type !== "spheres") 
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, obj.ibuf[pass]);
if (type === "sprites" || type === "text" || type === "quads") {
count = count * 6/4;
} else if (type === "surface") {
count = obj.f[pass].length;
}
count = obj.f[pass].length;
if ((is_lines || pmode === "lines") && !fat_lines) {
mode = "LINES";
} else if (pmode === "points") {
mode = "POINTS";
}
if ((is_lines || pmode === "lines") && fat_lines) {
gl.enableVertexAttribArray(obj.pointLoc);
gl.vertexAttribPointer(obj.pointLoc, 2, gl.FLOAT, false, 4*obj.vOffsets.stride, 4*obj.vOffsets.pointofs);
gl.enableVertexAttribArray(obj.nextLoc );
gl.vertexAttribPointer(obj.nextLoc, 3, gl.FLOAT, false, 4*obj.vOffsets.stride, 4*obj.vOffsets.nextofs);
gl.uniform1f(obj.aspectLoc, this.vp.width/this.vp.height);
gl.uniform1f(obj.lwdLoc, this.getMaterial(id, "lwd")/this.vp.height);
}
gl.vertexAttribPointer(this.posLoc,  3, gl.FLOAT, false, 4*obj.vOffsets.stride,  4*obj.vOffsets.vofs);
gl.drawElements(gl[mode], count, obj.index_uint ? gl.UNSIGNED_INT : gl.UNSIGNED_SHORT, 0);
}
};
/**
* Draw the background for a subscene
* @param { number } id - id of background object
* @param { number } subsceneid - id of subscene
*/
rglwidgetClass.prototype.drawBackground = function(id, subsceneid) {
var gl = this.gl || this.initGL(),
obj = this.getObj(id),
bg, i;
if (!obj.initialized)
this.initObj(id);
if (obj.colors.length) {
bg = obj.colors[0];
gl.clearColor(bg[0], bg[1], bg[2], bg[3]);
gl.depthMask(true);
gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
}
if (typeof obj.quad !== "undefined") {
this.prMatrix.makeIdentity();
this.mvMatrix.makeIdentity();
gl.disable(gl.BLEND);
gl.disable(gl.DEPTH_TEST);
gl.depthMask(false);
for (i=0; i < obj.quad.length; i++)
this.drawObj(obj.quad[i], subsceneid);
}
};
/**
* Draw a subscene
* @param { number } subsceneid - id of subscene
* @param { boolean } opaquePass - is this the opaque drawing pass?
*/
rglwidgetClass.prototype.drawSubscene = function(subsceneid, opaquePass) {
var gl = this.gl || this.initGL(),
obj = this.getObj(subsceneid),
objects = this.scene.objects,
subids = obj.objects,
subscene_has_faces = false,
subscene_needs_sorting = false,
flags, i;
if (obj.par3d.skipRedraw)
return;
for (i=0; i < subids.length; i++) {
flags = objects[subids[i]].flags;
if (typeof flags !== "undefined") {
subscene_has_faces |= (flags & this.f_is_lit)
& !(flags & this.f_fixed_quads);
subscene_needs_sorting |= (flags & this.f_depth_sort);
}
}
this.setViewport(subsceneid);
if (typeof obj.backgroundId !== "undefined" && opaquePass)
this.drawBackground(obj.backgroundId, subsceneid);
if (subids.length) {
this.setprMatrix(subsceneid);
this.setmvMatrix(subsceneid);
if (subscene_has_faces) {
this.setnormMatrix(subsceneid);
if ((obj.flags & this.f_sprites_3d) &&
typeof obj.spriteNormmat === "undefined") {
obj.spriteNormmat = new CanvasMatrix4(this.normMatrix);
}
}
if (subscene_needs_sorting && !opaquePass)
this.setprmvMatrix();
var clipids = obj.clipplanes;
if (typeof clipids === "undefined") {
console.warn("bad clipids");
}
if (clipids.length > 0) {
this.invMatrix = new CanvasMatrix4(this.mvMatrix);
this.invMatrix.invert();
for (i = 0; i < clipids.length; i++)
this.drawObj(clipids[i], subsceneid);
}
subids = obj.opaque;
if (subids.length > 0 && opaquePass) {
gl.enable(gl.DEPTH_TEST);
gl.depthMask(true);
gl.disable(gl.BLEND);
for (i = 0; i < subids.length; i++) {
this.drawObj(subids[i], subsceneid);
}
}
subids = obj.transparent;
if (subids.length > 0 && !opaquePass) {
gl.depthMask(false);
gl.blendFuncSeparate(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA,
gl.ONE, gl.ONE);
gl.enable(gl.BLEND);
for (i = 0; i < subids.length; i++) {
this.drawObj(subids[i], subsceneid);
}
}
subids = obj.subscenes;
for (i = 0; i < subids.length; i++) {
this.drawSubscene(subids[i], opaquePass);
}
}
};
/**
* Compute mouse coordinates relative to current canvas
* @returns { Object }
* @param { Object } event - event object from mouse click
*/
rglwidgetClass.prototype.relMouseCoords = function(event) {
var totalOffsetX = 0,
totalOffsetY = 0,
currentElement = this.canvas;
do {
totalOffsetX += currentElement.offsetLeft;
totalOffsetY += currentElement.offsetTop;
currentElement = currentElement.offsetParent;
}
while(currentElement);
var canvasX = event.pageX - totalOffsetX,
canvasY = event.pageY - totalOffsetY;
return {x:canvasX, y:canvasY};
};
/**
* Set mouse handlers for the scene
*/
rglwidgetClass.prototype.setMouseHandlers = function() {
var self = this, activeSubscene, handler,
handlers = {}, drag = 0;
handlers.rotBase = 0;
this.screenToVector = function(x, y) {
var viewport = this.getObj(activeSubscene).par3d.viewport,
width = viewport.width*this.canvas.width,
height = viewport.height*this.canvas.height,
radius = Math.max(width, height)/2.0,
cx = width/2.0,
cy = height/2.0,
px = (x-cx)/radius,
py = (y-cy)/radius,
plen = Math.sqrt(px*px+py*py);
if (plen > 1.e-6) {
px = px/plen;
py = py/plen;
}
var angle = (Math.SQRT2 - plen)/Math.SQRT2*Math.PI/2,
z = Math.sin(angle),
zlen = Math.sqrt(1.0 - z*z);
px = px * zlen;
py = py * zlen;
return [px, py, z];
};
handlers.trackballdown = function(x,y) {
var activeSub = this.getObj(activeSubscene),
activeModel = this.getObj(this.useid(activeSub.id, "model")),
i, l = activeModel.par3d.listeners;
handlers.rotBase = this.screenToVector(x, y);
this.saveMat = [];
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.saveMat = new CanvasMatrix4(activeSub.par3d.userMatrix);
}
};
handlers.trackballmove = function(x,y) {
var rotCurrent = this.screenToVector(x,y),
rotBase = handlers.rotBase,
dot = rotBase[0]*rotCurrent[0] +
rotBase[1]*rotCurrent[1] +
rotBase[2]*rotCurrent[2],
angle = Math.acos( dot/this.vlen(rotBase)/this.vlen(rotCurrent) )*180.0/Math.PI,
axis = this.xprod(rotBase, rotCurrent),
objects = this.scene.objects,
activeSub = this.getObj(activeSubscene),
activeModel = this.getObj(this.useid(activeSub.id, "model")),
l = activeModel.par3d.listeners,
i;
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.par3d.userMatrix.load(objects[l[i]].saveMat);
activeSub.par3d.userMatrix.rotate(angle, axis[0], axis[1], axis[2]);
}
this.drawScene();
};
handlers.trackballend = 0;
this.clamp = function(x, lo, hi) {
return Math.max(lo, Math.min(x, hi));
};
this.screenToPolar = function(x,y) {
var viewport = this.getObj(activeSubscene).par3d.viewport,
width = viewport.width*this.canvas.width,
height = viewport.height*this.canvas.height,
r = Math.min(width, height)/2,
dx = this.clamp(x - width/2, -r, r),
dy = this.clamp(y - height/2, -r, r);
return [Math.asin(dx/r), Math.asin(-dy/r)];
};
handlers.polardown = function(x,y) {
var activeSub = this.getObj(activeSubscene),
activeModel = this.getObj(this.useid(activeSub.id, "model")),
i, l = activeModel.par3d.listeners;
handlers.dragBase = this.screenToPolar(x, y);
this.saveMat = [];
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.saveMat = new CanvasMatrix4(activeSub.par3d.userMatrix);
activeSub.camBase = [-Math.atan2(activeSub.saveMat.m13, activeSub.saveMat.m11),
Math.atan2(activeSub.saveMat.m32, activeSub.saveMat.m22)];
}
};
handlers.polarmove = function(x,y) {
var dragCurrent = this.screenToPolar(x,y),
activeSub = this.getObj(activeSubscene),
activeModel = this.getObj(this.useid(activeSub.id, "model")),
objects = this.scene.objects,
l = activeModel.par3d.listeners,
i, changepos = [];
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
for (j=0; j<2; j++)
changepos[j] = -(dragCurrent[j] - handlers.dragBase[j]);
activeSub.par3d.userMatrix.makeIdentity();
activeSub.par3d.userMatrix.rotate(changepos[0]*180/Math.PI, 0,-1,0);
activeSub.par3d.userMatrix.multRight(objects[l[i]].saveMat);
activeSub.par3d.userMatrix.rotate(changepos[1]*180/Math.PI, -1,0,0);
}
this.drawScene();
};
handlers.polarend = 0;
handlers.axisdown = function(x,y) {
handlers.rotBase = this.screenToVector(x, this.canvas.height/2);
var activeSub = this.getObj(activeSubscene),
activeModel = this.getObj(this.useid(activeSub.id, "model")),
i, l = activeModel.par3d.listeners;
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.saveMat = new CanvasMatrix4(activeSub.par3d.userMatrix);
}
};
handlers.axismove = function(x,y) {
var rotCurrent = this.screenToVector(x, this.canvas.height/2),
rotBase = handlers.rotBase,
angle = (rotCurrent[0] - rotBase[0])*180/Math.PI,
rotMat = new CanvasMatrix4();
rotMat.rotate(angle, handlers.axis[0], handlers.axis[1], handlers.axis[2]);
var activeSub = this.getObj(activeSubscene),
activeModel = this.getObj(this.useid(activeSub.id, "model")),
i, l = activeModel.par3d.listeners;
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.par3d.userMatrix.load(activeSub.saveMat);
activeSub.par3d.userMatrix.multLeft(rotMat);
}
this.drawScene();
};
handlers.axisend = 0;
handlers.y0zoom = 0;
handlers.zoom0 = 0;
handlers.zoomdown = function(x, y) {
var activeSub = this.getObj(activeSubscene),
activeProjection = this.getObj(this.useid(activeSub.id, "projection")),
i, l = activeProjection.par3d.listeners;
handlers.y0zoom = y;
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.zoom0 = Math.log(activeSub.par3d.zoom);
}
};
handlers.zoommove = function(x, y) {
var activeSub = this.getObj(activeSubscene),
activeProjection = this.getObj(this.useid(activeSub.id, "projection")),
i, l = activeProjection.par3d.listeners;
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.par3d.zoom = Math.exp(activeSub.zoom0 + (y-handlers.y0zoom)/this.canvas.height);
}
this.drawScene();
};
handlers.zoomend = 0;
handlers.y0fov = 0;
handlers.fovdown = function(x, y) {
handlers.y0fov = y;
var activeSub = this.getObj(activeSubscene),
activeProjection = this.getObj(this.useid(activeSub.id, "projection")),
i, l = activeProjection.par3d.listeners;
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.fov0 = activeSub.par3d.FOV;
}
};
handlers.fovmove = function(x, y) {
var activeSub = this.getObj(activeSubscene),
activeProjection = this.getObj(this.useid(activeSub.id, "projection")),
i, l = activeProjection.par3d.listeners;
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.par3d.FOV = Math.max(1, Math.min(179, activeSub.fov0 +
180*(y-handlers.y0fov)/this.canvas.height));
}
this.drawScene();
};
handlers.fovend = 0;
this.canvas.onmousedown = function ( ev ){
if (!ev.which) // Use w3c defns in preference to MS
switch (ev.button) {
case 0: ev.which = 1; break;
case 1:
case 4: ev.which = 2; break;
case 2: ev.which = 3;
}
drag = ["left", "middle", "right"][ev.which-1];
var coords = self.relMouseCoords(ev);
coords.y = self.canvas.height-coords.y;
activeSubscene = self.whichSubscene(coords);
var sub = self.getObj(activeSubscene), f;
handler = sub.par3d.mouseMode[drag];
switch (handler) {
case "xAxis":
handler = "axis";
handlers.axis = [1.0, 0.0, 0.0];
break;
case "yAxis":
handler = "axis";
handlers.axis = [0.0, 1.0, 0.0];
break;
case "zAxis":
handler = "axis";
handlers.axis = [0.0, 0.0, 1.0];
break;
}
f = handlers[handler + "down"];
if (f) {
coords = self.translateCoords(activeSubscene, coords);
f.call(self, coords.x, coords.y);
ev.preventDefault();
} else
console.warn("Mouse handler '" + handler + "' is not implemented.");
};
this.canvas.onmouseup = function ( ev ){
if ( drag === 0 ) return;
var f = handlers[handler + "up"];
if (f)
f();
drag = 0;
};
this.canvas.onmouseout = this.canvas.onmouseup;
this.canvas.onmousemove = function ( ev ) {
if ( drag === 0 ) return;
var f = handlers[handler + "move"];
if (f) {
var coords = self.relMouseCoords(ev);
coords.y = self.canvas.height - coords.y;
coords = self.translateCoords(activeSubscene, coords);
f.call(self, coords.x, coords.y);
}
};
handlers.wheelHandler = function(ev) {
var del = 1.02, i;
if (ev.shiftKey) del = 1.002;
var ds = ((ev.detail || ev.wheelDelta) > 0) ? del : (1 / del);
if (typeof activeSubscene === "undefined")
activeSubscene = self.scene.rootSubscene;
var activeSub = self.getObj(activeSubscene),
activeProjection = self.getObj(self.useid(activeSub.id, "projection")),
l = activeProjection.par3d.listeners;
for (i = 0; i < l.length; i++) {
activeSub = self.getObj(l[i]);
activeSub.par3d.zoom *= ds;
}
self.drawScene();
ev.preventDefault();
};
this.canvas.addEventListener("DOMMouseScroll", handlers.wheelHandler, false);
this.canvas.addEventListener("mousewheel", handlers.wheelHandler, false);
};
/**
* Find a particular subscene by inheritance
* @returns { number } id of subscene to use
* @param { number } subsceneid - child subscene
* @param { string } type - type of inheritance:  "projection" or "model"
*/
rglwidgetClass.prototype.useid = function(subsceneid, type) {
var sub = this.getObj(subsceneid);
if (sub.embeddings[type] === "inherit")
return(this.useid(sub.parent, type));
else
return subsceneid;
};
/**
* Check whether point is in viewport of subscene
* @returns {boolean}
* @param { Object } coords - screen coordinates of point
* @param { number } subsceneid - subscene to check
*/
rglwidgetClass.prototype.inViewport = function(coords, subsceneid) {
var viewport = this.getObj(subsceneid).par3d.viewport,
x0 = coords.x - viewport.x*this.canvas.width,
y0 = coords.y - viewport.y*this.canvas.height;
return 0 <= x0 && x0 <= viewport.width*this.canvas.width &&
0 <= y0 && y0 <= viewport.height*this.canvas.height;
};
/**
* Find which subscene contains a point
* @returns { number } subscene id
* @param { Object } coords - coordinates of point
*/
rglwidgetClass.prototype.whichSubscene = function(coords) {
var self = this,
recurse = function(subsceneid) {
var subscenes = self.getChildSubscenes(subsceneid), i, id;
for (i=0; i < subscenes.length; i++) {
id = recurse(subscenes[i]);
if (typeof(id) !== "undefined")
return(id);
}
if (self.inViewport(coords, subsceneid))
return(subsceneid);
else
return undefined;
},
rootid = this.scene.rootSubscene,
result = recurse(rootid);
if (typeof(result) === "undefined")
result = rootid;
return result;
};
/**
* Translate from window coordinates to viewport coordinates
* @returns { Object } translated coordinates
* @param { number } subsceneid - which subscene to use?
* @param { Object } coords - point to translate
*/
rglwidgetClass.prototype.translateCoords = function(subsceneid, coords) {
var viewport = this.getObj(subsceneid).par3d.viewport;
return {x: coords.x - viewport.x*this.canvas.width,
y: coords.y - viewport.y*this.canvas.height};
};
/**
* Initialize the sphere object
*/
rglwidgetClass.prototype.initSphere = function() {
var verts = this.scene.sphereVerts,
reuse = verts.reuse, result;
if (typeof reuse !== "undefined") {
var prev = document.getElementById(reuse).rglinstance.sphere;
result = {values: prev.values, vOffsets: prev.vOffsets, it: prev.it};
} else
result = {values: new Float32Array(this.flatten(this.cbind(this.transpose(verts.vb),
this.transpose(verts.texcoords)))),
it: new Uint16Array(this.flatten(this.transpose(verts.it))),
vOffsets: {vofs:0, cofs:-1, nofs:-1, radofs:-1, oofs:-1,
tofs:3, stride:5}};
result.sphereCount = result.it.length;
this.sphere = result;
};
/**
* Do the gl part of initializing the sphere
*/
rglwidgetClass.prototype.initSphereGL = function() {
var gl = this.gl || this.initGL(), sphere = this.sphere;
if (gl.isContextLost()) return;
sphere.buf = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, sphere.buf);
gl.bufferData(gl.ARRAY_BUFFER, sphere.values, gl.STATIC_DRAW);
sphere.ibuf = gl.createBuffer();
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, sphere.ibuf);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, sphere.it, gl.STATIC_DRAW);
return;
};
/**
* Initialize the DOM object
* @param { Object } el - the DOM object
* @param { Object } x - the scene data sent by JSON from R
*/
rglwidgetClass.prototype.initialize = function(el, x) {
this.textureCanvas = document.createElement("canvas");
this.textureCanvas.style.display = "block";
this.scene = x;
this.normMatrix = new CanvasMatrix4();
this.saveMat = {};
this.distance = null;
this.posLoc = 0;
this.colLoc = 1;
if (el) {
el.rglinstance = this;
this.el = el;
this.webGLoptions = el.rglinstance.scene.webGLoptions;
this.initCanvas();
}
};
/**
* Restart the WebGL canvas
*/
rglwidgetClass.prototype.restartCanvas = function() {
var newcanvas = document.createElement("canvas");
newcanvas.width = this.el.width;
newcanvas.height = this.el.height;
newcanvas.addEventListener("webglcontextrestored",
this.onContextRestored, false);
newcanvas.addEventListener("webglcontextlost",
this.onContextLost, false);
while (this.el.firstChild) {
this.el.removeChild(this.el.firstChild);
}
this.el.appendChild(newcanvas);
this.canvas = newcanvas;
this.setMouseHandlers();
this.gl = null;
};
/**
* Initialize the WebGL canvas
*/
rglwidgetClass.prototype.initCanvas = function() {
this.restartCanvas();
var objs = this.scene.objects,
self = this;
Object.keys(objs).forEach(function(key){
var id = parseInt(key, 10),
obj = self.getObj(id);
if (typeof obj.reuse !== "undefined")
self.copyObj(id, obj.reuse);
});
Object.keys(objs).forEach(function(key){
self.initSubscene(parseInt(key, 10));
});
this.setMouseHandlers();
this.initSphere();
this.onContextRestored = function(event) {
self.initGL();
self.drawScene();
// console.log("restored context for "+self.scene.rootSubscene);
};
this.onContextLost = function(event) {
if (!self.drawing)
this.gl = null;
event.preventDefault();
};
this.initGL0();
this.lazyLoadScene = function() {
if (typeof self.slide === "undefined")
self.slide = self.getSlide();
if (self.isInBrowserViewport()) {
if (!self.gl || self.gl.isContextLost())
self.initGL();
self.drawScene();
}
};
window.addEventListener("DOMContentLoaded", this.lazyLoadScene, false);
window.addEventListener("load", this.lazyLoadScene, false);
window.addEventListener("resize", this.lazyLoadScene, false);
window.addEventListener("scroll", this.lazyLoadScene, false);
this.slide = this.getSlide();
if (this.slide) {
if (typeof this.slide.rgl === "undefined")
this.slide.rgl = [this];
else
this.slide.rgl.push(this);
if (this.scene.context.rmarkdown === "ioslides_presentation") {
this.slide.setAttribute("slideenter", "this.rgl.forEach(function(scene) { scene.lazyLoadScene.call(window);})");
} else if (this.scene.context.rmarkdown === "slidy_presentation") {
// This method would also work in ioslides, but it gets triggered
// something like 5 times per slide for every slide change, so
// you'd need a quicker function than lazyLoadScene.
var MutationObserver = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver,
observer = new MutationObserver(function(mutations) {
mutations.forEach(function(mutation) {
// console.log("type="+mutation.type+" attributeName="+mutation. attributeName+" self="+self);
self.slide.rgl.forEach(function(scene) { scene.lazyLoadScene.call(window); });});});
observer.observe(this.slide, { attributes: true, attributeFilter:["class"] });
}
}
};
/**
* Start the writeWebGL scene. This is only used by writeWebGL; rglwidget has
no debug element and does the drawing in rglwidget.js.
*/
rglwidgetClass.prototype.start = function() {
if (typeof this.prefix !== "undefined") {
this.debugelement = document.getElementById(this.prefix + "debug");
this.debug("");
}
this.drag = 0;
this.drawScene();
};
/**
* Display a debug message
* @param { string } msg - The message to display
* @param { Object } [img] - Image to insert before message
*/
rglwidgetClass.prototype.debug = function(msg, img) {
if (typeof this.debugelement !== "undefined" && this.debugelement !== null) {
this.debugelement.innerHTML = msg;
if (typeof img !== "undefined") {
this.debugelement.insertBefore(img, this.debugelement.firstChild);
}
} else if (msg !== "")
alert(msg);
};
/**
* Get the snapshot image of this scene
* @returns { Object } The img DOM element
*/
rglwidgetClass.prototype.getSnapshot = function() {
var img;
if (typeof this.scene.snapshot !== "undefined") {
img = document.createElement("img");
img.src = this.scene.snapshot;
img.alt = "Snapshot";
}
return img;
};
/**
* Initial test for WebGL
*/
rglwidgetClass.prototype.initGL0 = function() {
if (!window.WebGLRenderingContext){
alert("Your browser does not support WebGL. See http://get.webgl.org");
return;
}
};
/**
* If we are in an ioslides or slidy presentation, get the
* DOM element of the current slide
* @returns { Object }
*/
rglwidgetClass.prototype.getSlide = function() {
var result = this.el, done = false;
while (result && !done) {
switch(this.scene.context.rmarkdown) {
case "ioslides_presentation":
if (result.tagName === "SLIDE") return result;
else done = true;
break;
case "slidy_presentation":
if (result.tagName === "DIV" && result.classList.contains("slide"))
return result;
else done = true;
break;
default: return null;
}
result = result.parentElement;
}
return null;
};
/**
* Is this scene visible in the browser?
* @returns { boolean }
*/
rglwidgetClass.prototype.isInBrowserViewport = function() {
var rect = this.canvas.getBoundingClientRect(),
windHeight = (window.innerHeight || document.documentElement.clientHeight),
windWidth = (window.innerWidth || document.documentElement.clientWidth);
if (this.scene.context && this.scene.context.rmarkdown !== null) {
if (this.slide)
return (this.scene.context.rmarkdown === "ioslides_presentation" &&
this.slide.classList.contains("current")) ||
(this.scene.context.rmarkdown === "slidy_presentation" &&
!this.slide.classList.contains("hidden"));
}
return (
rect.top >= -windHeight &&
rect.left >= -windWidth &&
rect.bottom <= 2*windHeight &&
rect.right <= 2*windWidth);
};
/**
* Initialize WebGL
* @returns { Object } the WebGL context
*/
rglwidgetClass.prototype.initGL = function() {
var self = this;
if (this.gl) {
if (!this.drawing && this.gl.isContextLost())
this.restartCanvas();
else
return this.gl;
}
// if (!this.isInBrowserViewport()) return; Return what??? At this point we know this.gl is null.
this.canvas.addEventListener("webglcontextrestored",
this.onContextRestored, false);
this.canvas.addEventListener("webglcontextlost",
this.onContextLost, false);
this.gl = this.canvas.getContext("webgl", this.webGLoptions) ||
this.canvas.getContext("experimental-webgl", this.webGLoptions);
this.index_uint = this.gl.getExtension("OES_element_index_uint");
var save = this.startDrawing();
this.initSphereGL();
Object.keys(this.scene.objects).forEach(function(key){
self.initObj(parseInt(key, 10));
});
this.stopDrawing(save);
return this.gl;
};
/**
* Resize the display to match element
* @param { Object } el - DOM element to match
*/
rglwidgetClass.prototype.resize = function(el) {
this.canvas.width = el.width;
this.canvas.height = el.height;
};
/**
* Draw the whole scene
*/
rglwidgetClass.prototype.drawScene = function() {
var gl = this.gl || this.initGL(),
save = this.startDrawing();
gl.enable(gl.DEPTH_TEST);
gl.depthFunc(gl.LEQUAL);
gl.clearDepth(1.0);
gl.clearColor(1,1,1,1);
gl.depthMask(true); // Must be true before clearing depth buffer
gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
this.drawSubscene(this.scene.rootSubscene, true);
this.drawSubscene(this.scene.rootSubscene, false);
this.stopDrawing(save);
};
/**
* Change the displayed subset
* @param { Object } el - Element of the control; not used.
* @param { Object } control - The subset control data.
*/
rglwidgetClass.prototype.subsetSetter = function(el, control) {
if (typeof control.subscenes === "undefined" ||
control.subscenes === null)
control.subscenes = this.scene.rootSubscene;
var value = Math.round(control.value),
subscenes = [].concat(control.subscenes),
fullset = [].concat(control.fullset),
i, j, entries, subsceneid,
adds = [], deletes = [],
ismissing = function(x) {
return fullset.indexOf(x) < 0;
},
tointeger = function(x) {
return parseInt(x, 10);
};
if (isNaN(value))
value = control.value = 0;
if (control.accumulate)
for (i=0; i <= value; i++)
adds = adds.concat(control.subsets[i]);
else
adds = adds.concat(control.subsets[value]);
deletes = fullset.filter(function(x) { return adds.indexOf(x) < 0; });
for (i = 0; i < subscenes.length; i++) {
subsceneid = subscenes[i];
if (typeof this.getObj(subsceneid) === "undefined")
this.alertOnce("typeof object is undefined");
for (j = 0; j < adds.length; j++)
this.addToSubscene(adds[j], subsceneid);
for (j = 0; j < deletes.length; j++)
this.delFromSubscene(deletes[j], subsceneid);
}
};
/**
* Change the requested property
* @param { Object } el - Element of the control; not used.
* @param { Object } control - The property setter control data.
*/
rglwidgetClass.prototype.propertySetter = function(el, control)  {
var value = control.value,
values = [].concat(control.values),
svals = [].concat(control.param),
direct = values[0] === null,
entries = [].concat(control.entries),
ncol = entries.length,
nrow = values.length/ncol,
properties = this.repeatToLen(control.properties, ncol),
objids = this.repeatToLen(control.objids, ncol),
property, objid = objids[0],
obj = this.getObj(objid),
propvals, i, v1, v2, p, entry, gl, needsBinding,
newprop, newid,
getPropvals = function() {
if (property === "userMatrix")
return obj.par3d.userMatrix.getAsArray();
else if (property === "scale" || property === "FOV" || property === "zoom")
return [].concat(obj.par3d[property]);
else
return [].concat(obj[property]);
};
putPropvals = function(newvals) {
if (newvals.length == 1)
newvals = newvals[0];
if (property === "userMatrix")
obj.par3d.userMatrix.load(newvals);
else if (property === "scale" || property === "FOV" || property === "zoom")
obj.par3d[property] = newvals;
else
obj[property] = newvals;
};
if (direct && typeof value === "undefined")
return;
if (control.interp) {
values = values.slice(0, ncol).concat(values).
concat(values.slice(ncol*(nrow-1), ncol*nrow));
svals = [-Infinity].concat(svals).concat(Infinity);
for (i = 1; i < svals.length; i++) {
if (value <= svals[i]) {
if (svals[i] === Infinity)
p = 1;
else
p = (svals[i] - value)/(svals[i] - svals[i-1]);
break;
}
}
} else if (!direct) {
value = Math.round(value);
}
for (j=0; j<entries.length; j++) {
entry = entries[j];
newprop = properties[j];
newid = objids[j];
if (newprop !== property || newid != objid) {
if (typeof property !== "undefined")
putPropvals(propvals);
property = newprop;
objid = newid;
obj = this.getObj(objid);
propvals = getPropvals();
}
if (control.interp) {
v1 = values[ncol*(i-1) + j];
v2 = values[ncol*i + j];
this.setElement(propvals, entry, p*v1 + (1-p)*v2);
} else if (!direct) {
this.setElement(propvals, entry, values[ncol*value + j]);
} else {
this.setElement(propvals, entry, value[j]);
}
}
putPropvals(propvals);
needsBinding = [];
for (j=0; j < entries.length; j++) {
if (properties[j] === "values" &&
needsBinding.indexOf(objids[j]) === -1) {
needsBinding.push(objids[j]);
}
}
for (j=0; j < needsBinding.length; j++) {
gl = this.gl || this.initGL();
obj = this.getObj(needsBinding[j]);
gl.bindBuffer(gl.ARRAY_BUFFER, obj.buf);
gl.bufferData(gl.ARRAY_BUFFER, obj.values, gl.STATIC_DRAW);
}
};
/**
* Change the requested vertices
* @param { Object } el - Element of the control; not used.
* @param { Object } control - The vertext setter control data.
*/
rglwidgetClass.prototype.vertexSetter = function(el, control)  {
var svals = [].concat(control.param),
j, k, p, a, propvals, stride, ofs, obj, entry,
attrib,
ofss    = {x:"vofs", y:"vofs", z:"vofs",
red:"cofs", green:"cofs", blue:"cofs",
alpha:"cofs", radii:"radofs",
nx:"nofs", ny:"nofs", nz:"nofs",
ox:"oofs", oy:"oofs", oz:"oofs",
ts:"tofs", tt:"tofs"},
pos     = {x:0, y:1, z:2,
red:0, green:1, blue:2,
alpha:3,radii:0,
nx:0, ny:1, nz:2,
ox:0, oy:1, oz:2,
ts:0, tt:1},
values = control.values,
direct = values === null,
ncol,
interp = control.interp,
vertices = [].concat(control.vertices),
attributes = [].concat(control.attributes),
value = control.value, newval, aliases, alias;
ncol = Math.max(vertices.length, attributes.length);
if (!ncol)
return;
vertices = this.repeatToLen(vertices, ncol);
attributes = this.repeatToLen(attributes, ncol);
if (direct)
interp = false;
/* JSON doesn't pass Infinity */
svals[0] = -Infinity;
svals[svals.length - 1] = Infinity;
for (j = 1; j < svals.length; j++) {
if (value <= svals[j]) {
if (interp) {
if (svals[j] === Infinity)
p = 1;
else
p = (svals[j] - value)/(svals[j] - svals[j-1]);
} else {
if (svals[j] - value > value - svals[j-1])
j = j - 1;
}
break;
}
}
obj = this.getObj(control.objid);
// First, make sure color attributes vary in original
if (typeof obj.vOffsets !== "undefined") {
varies = true;
for (k = 0; k < ncol; k++) {
attrib = attributes[k];
if (typeof attrib !== "undefined") {
ofs = obj.vOffsets[ofss[attrib]];
if (ofs < 0) {
switch(attrib) {
case "alpha":
case "red":
case "green":
case "blue":
obj.colors = [obj.colors[0], obj.colors[0]];
break;
}
varies = false;
}
}
}
if (!varies)
this.initObj(control.objid);
}
propvals = obj.values;
aliases = obj.alias;
if (typeof aliases === "undefined")
aliases = [];
for (k=0; k<ncol; k++) {
if (direct) {
newval = value;
} else if (interp) {
newval = p*values[j-1][k] + (1-p)*values[j][k];
} else {
newval = values[j][k];
}       
attrib = attributes[k];
vertex = vertices[k];
alias = aliases[vertex];
if (obj.type === "planes" || obj.type === "clipplanes") {
ofs = ["nx", "ny", "nz", "offset"].indexOf(attrib);
if (ofs >= 0) {
if (ofs < 3) {
if (obj.normals[vertex][ofs] != newval) {  // Assume no aliases here...
obj.normals[vertex][ofs] = newval;
obj.initialized = false;
}
} else {
if (obj.offsets[vertex][0] != newval) {
obj.offsets[vertex][0] = newval;
obj.initialized = false;
}
}
continue;
}
}
// Not a plane setting...
ofs = obj.vOffsets[ofss[attrib]];
if (ofs < 0)
this.alertOnce("Attribute '"+attrib+"' not found in object "+control.objid);
else {
stride = obj.vOffsets.stride;
ofs = ofs + pos[attrib];
entry = vertex*stride + ofs;
propvals[entry] = newval;
if (typeof alias !== "undefined")
for (a = 0; a < alias.length; a++)
propvals[alias[a]*stride + ofs] = newval;
}
}
if (typeof obj.buf !== "undefined") {
var gl = this.gl || this.initGL();
gl.bindBuffer(gl.ARRAY_BUFFER, obj.buf);
gl.bufferData(gl.ARRAY_BUFFER, propvals, gl.STATIC_DRAW);
}
};
/**
* Change the requested vertex properties by age
* @param { Object } el - Element of the control; not used.
* @param { Object } control - The age setter control data.
*/
rglwidgetClass.prototype.ageSetter = function(el, control) {
var objids = [].concat(control.objids),
nobjs = objids.length,
time = control.value,
births = [].concat(control.births),
ages = [].concat(control.ages),
steps = births.length,
j = Array(steps),
p = Array(steps),
i, k, age, j0, propvals, stride, ofs, objid, obj,
attrib, dim, varies, alias, aliases, a, d,
attribs = ["colors", "alpha", "radii", "vertices",
"normals", "origins", "texcoords",
"x", "y", "z",
"red", "green", "blue"],
ofss    = ["cofs", "cofs", "radofs", "vofs",
"nofs", "oofs", "tofs",
"vofs", "vofs", "vofs",
"cofs", "cofs", "cofs"],
dims    = [3,1,1,3,
3,2,2,
1,1,1,
1,1,1],
pos     = [0,3,0,0,
0,0,0,
0,1,2,
0,1,2];
/* Infinity doesn't make it through JSON */
ages[0] = -Infinity;
ages[ages.length-1] = Infinity;
for (i = 0; i < steps; i++) {
if (births[i] !== null) {  // NA in R becomes null
age = time - births[i];
for (j0 = 1; age > ages[j0]; j0++);
if (ages[j0] == Infinity)
p[i] = 1;
else if (ages[j0] > ages[j0-1])
p[i] = (ages[j0] - age)/(ages[j0] - ages[j0-1]);
else
p[i] = 0;
j[i] = j0;
}
}
// First, make sure color attributes vary in original
for (l = 0; l < nobjs; l++) {
objid = objids[l];
obj = this.getObj(objid);
varies = true;
if (typeof obj.vOffsets === "undefined")
continue;
for (k = 0; k < attribs.length; k++) {
attrib = control[attribs[k]];
if (typeof attrib !== "undefined") {
ofs = obj.vOffsets[ofss[k]];
if (ofs < 0) {
switch(attribs[k]) {
case "colors":
case "alpha":
case "red":
case "green":
case "blue":
obj.colors = [obj.colors[0], obj.colors[0]];
break;
}
varies = false;
}
}
}
if (!varies)
this.initObj(objid);
}
for (l = 0; l < nobjs; l++) {
objid = objids[l];
obj = this.getObj(objid);
if (typeof obj.vOffsets === "undefined")
continue;
aliases = obj.alias;
if (typeof aliases === "undefined")
aliases = [];
propvals = obj.values;
stride = obj.vOffsets.stride;
for (k = 0; k < attribs.length; k++) {
attrib = control[attribs[k]];
if (typeof attrib !== "undefined") {
ofs = obj.vOffsets[ofss[k]];
if (ofs >= 0) {
dim = dims[k];
ofs = ofs + pos[k];
for (i = 0; i < steps; i++) {
alias = aliases[i];
if (births[i] !== null) {
for (d=0; d < dim; d++) {
propvals[i*stride + ofs + d] = p[i]*attrib[dim*(j[i]-1) + d] + (1-p[i])*attrib[dim*j[i] + d];
if (typeof alias !== "undefined")
for (a=0; a < alias.length; a++)
propvals[alias[a]*stride + ofs + d] = propvals[i*stride + ofs + d];
}
}
}
} else
this.alertOnce("\'"+attribs[k]+"\' property not found in object "+objid);
}
}
obj.values = propvals;
if (typeof obj.buf !== "undefined") {
gl = this.gl || this.initGL();
gl.bindBuffer(gl.ARRAY_BUFFER, obj.buf);
gl.bufferData(gl.ARRAY_BUFFER, obj.values, gl.STATIC_DRAW);
}
}
};
/**
* Bridge to old style control
* @param { Object } el - Element of the control; not used.
* @param { Object } control - The bridge control data.
*/
rglwidgetClass.prototype.oldBridge = function(el, control) {
var attrname, global = window[control.prefix + "rgl"];
if (typeof global !== "undefined")
for (attrname in global)
this[attrname] = global[attrname];
window[control.prefix + "rgl"] = this;
};
/**
* Set up a player control
* @param { Object } el - The player control element
* @param { Object } control - The player data.
*/
rglwidgetClass.prototype.Player = function(el, control) {
var
self = this,
components = [].concat(control.components),
buttonLabels = [].concat(control.buttonLabels),
Tick = function() { /* "this" will be a timer */
var i,
nominal = this.value,
slider = this.Slider,
labels = this.outputLabels,
output = this.Output,
step;
if (typeof slider !== "undefined" && nominal != slider.value)
slider.value = nominal;
if (typeof output !== "undefined") {
step = Math.round((nominal - output.sliderMin)/output.sliderStep);
if (labels !== null) {
output.innerHTML = labels[step];
} else {
step = step*output.sliderStep + output.sliderMin;
output.innerHTML = step.toPrecision(output.outputPrecision);
}
}
for (i=0; i < this.actions.length; i++) {
this.actions[i].value = nominal;
}
self.applyControls(el, this.actions, false);
self.drawScene();
},
OnSliderInput = function() { /* "this" will be the slider */
this.rgltimer.value = Number(this.value);
this.rgltimer.Tick();
},
addSlider = function(min, max, step, value) {
var slider = document.createElement("input");
slider.type = "range";
slider.min = min;
slider.max = max;
slider.step = step;
slider.value = value;
slider.oninput = OnSliderInput;
slider.sliderActions = control.actions;
slider.sliderScene = this;
slider.className = "rgl-slider";
slider.id = el.id + "-slider";
el.rgltimer.Slider = slider;
slider.rgltimer = el.rgltimer;
el.appendChild(slider);
},
addLabel = function(labels, min, step, precision) {
var output = document.createElement("output");
output.sliderMin = min;
output.sliderStep = step;
output.outputPrecision = precision;
output.className = "rgl-label";
output.id = el.id + "-label";
el.rgltimer.Output = output;
el.rgltimer.outputLabels = labels;
el.appendChild(output);
},
addButton = function(which, label, active) {
var button = document.createElement("input"),
onclicks = {Reverse: function() { this.rgltimer.reverse();},
Play: function() { this.rgltimer.play();
this.value = this.rgltimer.enabled ? this.inactiveValue : this.activeValue; },
Slower: function() { this.rgltimer.slower(); },
Faster: function() { this.rgltimer.faster(); },
Reset: function() { this.rgltimer.reset(); },
Step:  function() { this.rgltimer.step(); }
};
button.rgltimer = el.rgltimer;
button.type = "button";
button.value = label;
button.activeValue = label;
button.inactiveValue = active;
if (which === "Play")
button.rgltimer.PlayButton = button;
button.onclick = onclicks[which];
button.className = "rgl-button";
button.id = el.id + "-" + which;
el.appendChild(button);
};
if (typeof control.reinit !== "undefined" && control.reinit !== null) {
control.actions.reinit = control.reinit;
}
el.rgltimer = new rgltimerClass(Tick, control.start, control.interval, control.stop,
control.step, control.value, control.rate, control.loop, control.actions);
for (var i=0; i < components.length; i++) {
switch(components[i]) {
case "Slider": addSlider(control.start, control.stop,
control.step, control.value);
break;
case "Label": addLabel(control.labels, control.start,
control.step, control.precision);
break;
default:
addButton(components[i], buttonLabels[i], control.pause);
}
}
el.rgltimer.Tick();
};
/**
* Apply all registered controls
* @param { Object } el - DOM element of the control
* @param { Object } x - List of actions to apply
* @param { boolean } [draw=true] - Whether to redraw after applying
*/
rglwidgetClass.prototype.applyControls = function(el, x, draw) {
var self = this, reinit = x.reinit, i, control, type;
for (i = 0; i < x.length; i++) {
control = x[i];
type = control.type;
self[type](el, control);
}
if (typeof reinit !== "undefined" && reinit !== null) {
reinit = [].concat(reinit);
for (i = 0; i < reinit.length; i++)
self.getObj(reinit[i]).initialized = false;
}
if (typeof draw === "undefined" || draw)
self.drawScene();
};
/**
* Handler for scene change
* @param { Object } message - What sort of scene change to do?
*/
rglwidgetClass.prototype.sceneChangeHandler = function(message) {
var self = document.getElementById(message.elementId).rglinstance,
objs = message.objects, mat = message.material,
root = message.rootSubscene,
initSubs = message.initSubscenes,
redraw = message.redrawScene,
skipRedraw = message.skipRedraw,
deletes, subs, allsubs = [], i,j;
if (typeof message.delete !== "undefined") {
deletes = [].concat(message.delete);
if (typeof message.delfromSubscenes !== "undefined")
subs = [].concat(message.delfromSubscenes);
else
subs = [];
for (i = 0; i < deletes.length; i++) {
for (j = 0; j < subs.length; j++) {
self.delFromSubscene(deletes[i], subs[j]);
}
delete self.scene.objects[deletes[i]];
}
}
if (typeof objs !== "undefined") {
Object.keys(objs).forEach(function(key){
key = parseInt(key, 10);
self.scene.objects[key] = objs[key];
self.initObj(key);
var obj = self.getObj(key),
subs = [].concat(obj.inSubscenes), k;
allsubs = allsubs.concat(subs);
for (k = 0; k < subs.length; k++)
self.addToSubscene(key, subs[k]);
});
}
if (typeof mat !== "undefined") {
self.scene.material = mat;
}
if (typeof root !== "undefined") {
self.scene.rootSubscene = root;
}
if (typeof initSubs !== "undefined")
allsubs = allsubs.concat(initSubs);
allsubs = self.unique(allsubs);
for (i = 0; i < allsubs.length; i++) {
self.initSubscene(allsubs[i]);
}
if (typeof skipRedraw !== "undefined") {
root = self.getObj(self.scene.rootSubscene);
root.par3d.skipRedraw = skipRedraw;
}
if (redraw)
self.drawScene();
};
/**
* The class of an rgl timer object
* @class
*/
/**
* Construct an rgltimerClass object
* @constructor
* @param { function } Tick - action when timer fires
* @param { number } startTime - nominal start time in seconds
* @param { number } interval - seconds between updates
* @param { number } stopTime - nominal stop time in seconds
* @param { number } stepSize - nominal step size
* @param { number } value - current nominal time
* @param { number } rate - nominal units per second
* @param { string } loop - "none", "cycle" or "oscillate"
* @param { Object } actions - list of actions
*/
rgltimerClass = function(Tick, startTime, interval, stopTime, stepSize, value, rate, loop, actions) {
this.enabled = false;
this.timerId = 0;
/** nominal start time in seconds */
this.startTime = startTime;   
/** current nominal time */      
this.value = value;
/** seconds between updates */                 
this.interval = interval;
/** nominal stop time */           
this.stopTime = stopTime;
/** nominal step size */           
this.stepSize = stepSize;
/** nominal units per second */           
this.rate = rate;
/** "none", "cycle", or "oscillate" */                   
this.loop = loop;
/** real world start time */                   
this.realStart = undefined;
/** multiplier for fast-forward or reverse */         
this.multiplier = 1;                
this.actions = actions;
this.Tick = Tick;
};
/**
* Start playing timer object
*/
rgltimerClass.prototype.play = function() {
if (this.enabled) {
this.enabled = false;
window.clearInterval(this.timerId);
this.timerId = 0;
return;
}
var tick = function(self) {
var now = new Date();
self.value = self.multiplier*self.rate*(now - self.realStart)/1000 + self.startTime;
self.forceToRange();
if (typeof self.Tick !== "undefined") {
self.Tick(self.value);
}
};
this.realStart = new Date() - 1000*(this.value - this.startTime)/this.rate/this.multiplier;
this.timerId = window.setInterval(tick, 1000*this.interval, this);
this.enabled = true;
};
/**
* Force value into legal range
*/
rgltimerClass.prototype.forceToRange = function() {
if (this.value > this.stopTime + this.stepSize/2 || this.value < this.startTime - this.stepSize/2) {
if (!this.loop) {
this.reset();
} else {
var cycle = this.stopTime - this.startTime + this.stepSize,
newval = (this.value - this.startTime) % cycle + this.startTime;
if (newval < this.startTime) {
newval += cycle;
}
this.realStart += (this.value - newval)*1000/this.multiplier/this.rate;
this.value = newval;
}
}
};
/**
* Reset to start values
*/
rgltimerClass.prototype.reset = function() {
this.value = this.startTime;
this.newmultiplier(1);
if (typeof this.Tick !== "undefined") {
this.Tick(this.value);
}
if (this.enabled)
this.play();  /* really pause... */
if (typeof this.PlayButton !== "undefined")
this.PlayButton.value = "Play";
};
/**
* Increase the multiplier to play faster
*/
rgltimerClass.prototype.faster = function() {
this.newmultiplier(Math.SQRT2*this.multiplier);
};
/**
* Decrease the multiplier to play slower
*/
rgltimerClass.prototype.slower = function() {
this.newmultiplier(this.multiplier/Math.SQRT2);
};
/**
* Change sign of multiplier to reverse direction
*/
rgltimerClass.prototype.reverse = function() {
this.newmultiplier(-this.multiplier);
};
/**
* Set multiplier for play speed
* @param { number } newmult - new value
*/
rgltimerClass.prototype.newmultiplier = function(newmult) {
if (newmult != this.multiplier) {
this.realStart += 1000*(this.value - this.startTime)/this.rate*(1/this.multiplier - 1/newmult);
this.multiplier = newmult;
}
};
/**
* Take one step
*/
rgltimerClass.prototype.step = function() {
this.value += this.rate*this.multiplier;
this.forceToRange();
if (typeof this.Tick !== "undefined")
this.Tick(this.value);
};</script>
<div id="togglediv" class="rglWebGL">

</div>
<script type="text/javascript">
var togglediv = document.getElementById("togglediv"),
togglergl = new rglwidgetClass();
togglediv.width = 481;
togglediv.height = 481;
togglergl.initialize(togglediv,
{"material":{"color":"#000000","alpha":1,"lit":true,"ambient":"#000000","specular":"#FFFFFF","emission":"#000000","shininess":50,"smooth":true,"front":"filled","back":"filled","size":3,"lwd":1,"fog":false,"point_antialias":false,"line_antialias":false,"texture":null,"textype":"rgb","texmipmap":false,"texminfilter":"linear","texmagfilter":"linear","texenvmap":false,"depth_mask":true,"depth_test":"less","isTransparent":false},"rootSubscene":175,"objects":{"181":{"id":181,"type":"spheres","material":{},"vertices":[[5.1,3.5,1.4],[4.9,3,1.4],[4.7,3.2,1.3],[4.6,3.1,1.5],[5,3.6,1.4],[5.4,3.9,1.7],[4.6,3.4,1.4],[5,3.4,1.5],[4.4,2.9,1.4],[4.9,3.1,1.5],[5.4,3.7,1.5],[4.8,3.4,1.6],[4.8,3,1.4],[4.3,3,1.1],[5.8,4,1.2],[5.7,4.4,1.5],[5.4,3.9,1.3],[5.1,3.5,1.4],[5.7,3.8,1.7],[5.1,3.8,1.5],[5.4,3.4,1.7],[5.1,3.7,1.5],[4.6,3.6,1],[5.1,3.3,1.7],[4.8,3.4,1.9],[5,3,1.6],[5,3.4,1.6],[5.2,3.5,1.5],[5.2,3.4,1.4],[4.7,3.2,1.6],[4.8,3.1,1.6],[5.4,3.4,1.5],[5.2,4.1,1.5],[5.5,4.2,1.4],[4.9,3.1,1.5],[5,3.2,1.2],[5.5,3.5,1.3],[4.9,3.6,1.4],[4.4,3,1.3],[5.1,3.4,1.5],[5,3.5,1.3],[4.5,2.3,1.3],[4.4,3.2,1.3],[5,3.5,1.6],[5.1,3.8,1.9],[4.8,3,1.4],[5.1,3.8,1.6],[4.6,3.2,1.4],[5.3,3.7,1.5],[5,3.3,1.4]],"colors":[[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1]],"radii":[[0.211]],"centers":[[5.1,3.5,1.4],[4.9,3,1.4],[4.7,3.2,1.3],[4.6,3.1,1.5],[5,3.6,1.4],[5.4,3.9,1.7],[4.6,3.4,1.4],[5,3.4,1.5],[4.4,2.9,1.4],[4.9,3.1,1.5],[5.4,3.7,1.5],[4.8,3.4,1.6],[4.8,3,1.4],[4.3,3,1.1],[5.8,4,1.2],[5.7,4.4,1.5],[5.4,3.9,1.3],[5.1,3.5,1.4],[5.7,3.8,1.7],[5.1,3.8,1.5],[5.4,3.4,1.7],[5.1,3.7,1.5],[4.6,3.6,1],[5.1,3.3,1.7],[4.8,3.4,1.9],[5,3,1.6],[5,3.4,1.6],[5.2,3.5,1.5],[5.2,3.4,1.4],[4.7,3.2,1.6],[4.8,3.1,1.6],[5.4,3.4,1.5],[5.2,4.1,1.5],[5.5,4.2,1.4],[4.9,3.1,1.5],[5,3.2,1.2],[5.5,3.5,1.3],[4.9,3.6,1.4],[4.4,3,1.3],[5.1,3.4,1.5],[5,3.5,1.3],[4.5,2.3,1.3],[4.4,3.2,1.3],[5,3.5,1.6],[5.1,3.8,1.9],[4.8,3,1.4],[5.1,3.8,1.6],[4.6,3.2,1.4],[5.3,3.7,1.5],[5,3.3,1.4]],"ignoreExtent":false,"flags":3},"182":{"id":182,"type":"spheres","material":{},"vertices":[[7,3.2,4.7],[6.4,3.2,4.5],[6.9,3.1,4.9],[5.5,2.3,4],[6.5,2.8,4.6],[5.7,2.8,4.5],[6.3,3.3,4.7],[4.9,2.4,3.3],[6.6,2.9,4.6],[5.2,2.7,3.9],[5,2,3.5],[5.9,3,4.2],[6,2.2,4],[6.1,2.9,4.7],[5.6,2.9,3.6],[6.7,3.1,4.4],[5.6,3,4.5],[5.8,2.7,4.1],[6.2,2.2,4.5],[5.6,2.5,3.9],[5.9,3.2,4.8],[6.1,2.8,4],[6.3,2.5,4.9],[6.1,2.8,4.7],[6.4,2.9,4.3],[6.6,3,4.4],[6.8,2.8,4.8],[6.7,3,5],[6,2.9,4.5],[5.7,2.6,3.5],[5.5,2.4,3.8],[5.5,2.4,3.7],[5.8,2.7,3.9],[6,2.7,5.1],[5.4,3,4.5],[6,3.4,4.5],[6.7,3.1,4.7],[6.3,2.3,4.4],[5.6,3,4.1],[5.5,2.5,4],[5.5,2.6,4.4],[6.1,3,4.6],[5.8,2.6,4],[5,2.3,3.3],[5.6,2.7,4.2],[5.7,3,4.2],[5.7,2.9,4.2],[6.2,2.9,4.3],[5.1,2.5,3],[5.7,2.8,4.1]],"colors":[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1]],"radii":[[0.211]],"centers":[[7,3.2,4.7],[6.4,3.2,4.5],[6.9,3.1,4.9],[5.5,2.3,4],[6.5,2.8,4.6],[5.7,2.8,4.5],[6.3,3.3,4.7],[4.9,2.4,3.3],[6.6,2.9,4.6],[5.2,2.7,3.9],[5,2,3.5],[5.9,3,4.2],[6,2.2,4],[6.1,2.9,4.7],[5.6,2.9,3.6],[6.7,3.1,4.4],[5.6,3,4.5],[5.8,2.7,4.1],[6.2,2.2,4.5],[5.6,2.5,3.9],[5.9,3.2,4.8],[6.1,2.8,4],[6.3,2.5,4.9],[6.1,2.8,4.7],[6.4,2.9,4.3],[6.6,3,4.4],[6.8,2.8,4.8],[6.7,3,5],[6,2.9,4.5],[5.7,2.6,3.5],[5.5,2.4,3.8],[5.5,2.4,3.7],[5.8,2.7,3.9],[6,2.7,5.1],[5.4,3,4.5],[6,3.4,4.5],[6.7,3.1,4.7],[6.3,2.3,4.4],[5.6,3,4.1],[5.5,2.5,4],[5.5,2.6,4.4],[6.1,3,4.6],[5.8,2.6,4],[5,2.3,3.3],[5.6,2.7,4.2],[5.7,3,4.2],[5.7,2.9,4.2],[6.2,2.9,4.3],[5.1,2.5,3],[5.7,2.8,4.1]],"ignoreExtent":false,"flags":3},"183":{"id":183,"type":"spheres","material":{},"vertices":[[6.3,3.3,6],[5.8,2.7,5.1],[7.1,3,5.9],[6.3,2.9,5.6],[6.5,3,5.8],[7.6,3,6.6],[4.9,2.5,4.5],[7.3,2.9,6.3],[6.7,2.5,5.8],[7.2,3.6,6.1],[6.5,3.2,5.1],[6.4,2.7,5.3],[6.8,3,5.5],[5.7,2.5,5],[5.8,2.8,5.1],[6.4,3.2,5.3],[6.5,3,5.5],[7.7,3.8,6.7],[7.7,2.6,6.9],[6,2.2,5],[6.9,3.2,5.7],[5.6,2.8,4.9],[7.7,2.8,6.7],[6.3,2.7,4.9],[6.7,3.3,5.7],[7.2,3.2,6],[6.2,2.8,4.8],[6.1,3,4.9],[6.4,2.8,5.6],[7.2,3,5.8],[7.4,2.8,6.1],[7.9,3.8,6.4],[6.4,2.8,5.6],[6.3,2.8,5.1],[6.1,2.6,5.6],[7.7,3,6.1],[6.3,3.4,5.6],[6.4,3.1,5.5],[6,3,4.8],[6.9,3.1,5.4],[6.7,3.1,5.6],[6.9,3.1,5.1],[5.8,2.7,5.1],[6.8,3.2,5.9],[6.7,3.3,5.7],[6.7,3,5.2],[6.3,2.5,5],[6.5,3,5.2],[6.2,3.4,5.4],[5.9,3,5.1]],"colors":[[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1],[0,0.8039216,0,1]],"radii":[[0.211]],"centers":[[6.3,3.3,6],[5.8,2.7,5.1],[7.1,3,5.9],[6.3,2.9,5.6],[6.5,3,5.8],[7.6,3,6.6],[4.9,2.5,4.5],[7.3,2.9,6.3],[6.7,2.5,5.8],[7.2,3.6,6.1],[6.5,3.2,5.1],[6.4,2.7,5.3],[6.8,3,5.5],[5.7,2.5,5],[5.8,2.8,5.1],[6.4,3.2,5.3],[6.5,3,5.5],[7.7,3.8,6.7],[7.7,2.6,6.9],[6,2.2,5],[6.9,3.2,5.7],[5.6,2.8,4.9],[7.7,2.8,6.7],[6.3,2.7,4.9],[6.7,3.3,5.7],[7.2,3.2,6],[6.2,2.8,4.8],[6.1,3,4.9],[6.4,2.8,5.6],[7.2,3,5.8],[7.4,2.8,6.1],[7.9,3.8,6.4],[6.4,2.8,5.6],[6.3,2.8,5.1],[6.1,2.6,5.6],[7.7,3,6.1],[6.3,3.4,5.6],[6.4,3.1,5.5],[6,3,4.8],[6.9,3.1,5.4],[6.7,3.1,5.6],[6.9,3.1,5.1],[5.8,2.7,5.1],[6.8,3.2,5.9],[6.7,3.3,5.7],[6.7,3,5.2],[6.3,2.5,5],[6.5,3,5.2],[6.2,3.4,5.4],[5.9,3,5.1]],"ignoreExtent":false,"flags":3},"185":{"id":185,"type":"text","material":{"lit":false},"vertices":[[6.1,1.432677,-0.3946676]],"colors":[[0,0,0,1]],"texts":[["x"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[6.1,1.432677,-0.3946676]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":2064},"186":{"id":186,"type":"text","material":{"lit":false},"vertices":[[3.449016,3.2,-0.3946676]],"colors":[[0,0,0,1]],"texts":[["y"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[3.449016,3.2,-0.3946676]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":2064},"187":{"id":187,"type":"text","material":{"lit":false},"vertices":[[3.449016,1.432677,3.95]],"colors":[[0,0,0,1]],"texts":[["z"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[3.449016,1.432677,3.95]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":2064},"179":{"id":179,"type":"light","vertices":[[0,0,1]],"colors":[[1,1,1,1],[1,1,1,1],[1,1,1,1]],"viewpoint":true,"finite":false},"178":{"id":178,"type":"background","material":{"fog":true},"colors":[[0.2980392,0.2980392,0.2980392,1]],"centers":[[0,0,0]],"sphere":false,"fogtype":"none","flags":0},"180":{"id":180,"type":"background","material":{"lit":false,"back":"lines"},"colors":[[1,1,1,1]],"centers":[[0,0,0]],"sphere":false,"fogtype":"none","flags":0},"184":{"id":184,"type":"bboxdeco","material":{"front":"lines","back":"lines"},"vertices":[[5,"NA","NA"],[6,"NA","NA"],[7,"NA","NA"],[8,"NA","NA"],["NA",2,"NA"],["NA",2.5,"NA"],["NA",3,"NA"],["NA",3.5,"NA"],["NA",4,"NA"],["NA",4.5,"NA"],["NA","NA",1],["NA","NA",2],["NA","NA",3],["NA","NA",4],["NA","NA",5],["NA","NA",6],["NA","NA",7]],"colors":[[0,0,0,1]],"draw_front":true,"newIds":[195,196,197,198,199,200,201]},"175":{"id":175,"type":"subscene","par3d":{"antialias":1,"FOV":30,"ignoreExtent":false,"listeners":175,"mouseMode":{"left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,19.69192],"modelMatrix":[[1.17337,0,0,-7.157556],[0,0.6019719,0.6727789,-4.583787],[0,-1.653904,0.2448715,-15.36667],[0,0,0,1]],"projMatrix":[[3.732051,0,0,0],[0,3.732051,0,0],[0,0,-3.863703,-70.98709],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[1,0,0,0],[0,0.3420201,0.9396926,0],[0,-0.9396926,0.3420201,0],[0,0,0,1]],"scale":[1.17337,1.760048,0.7159564],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[4.120176,8.079824,1.880117,4.519883,0.7052893,7.194711],"windowRect":[100,100,580,580],"family":"sans","font":1,"cex":1,"useFreeType":false,"fontname":"NULL","maxClipPlanes":2147483647,"glVersion":"NaN"},"embeddings":{"viewport":"replace","projection":"replace","model":"replace"},"objects":[180,184,181,182,183,185,186,187,179,195,196,197,198,199,200,201],"subscenes":[],"flags":2643},"195":{"id":195,"type":"lines","material":{"lit":false},"vertices":[[5,1.840521,0.607948],[8,1.840521,0.607948],[5,1.840521,0.607948],[5,1.772546,0.4408454],[6,1.840521,0.607948],[6,1.772546,0.4408454],[7,1.840521,0.607948],[7,1.772546,0.4408454],[8,1.840521,0.607948],[8,1.772546,0.4408454]],"colors":[[0,0,0,1]],"centers":[[6.5,1.840521,0.607948],[5,1.806533,0.5243967],[6,1.806533,0.5243967],[7,1.806533,0.5243967],[8,1.806533,0.5243967]],"ignoreExtent":true,"origId":184,"flags":64},"196":{"id":196,"type":"text","material":{"lit":false},"vertices":[[5,1.636598,0.1066402],[6,1.636598,0.1066402],[7,1.636598,0.1066402],[8,1.636598,0.1066402]],"colors":[[0,0,0,1]],"texts":[["5"],["6"],["7"],["8"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[5,1.636598,0.1066402],[6,1.636598,0.1066402],[7,1.636598,0.1066402],[8,1.636598,0.1066402]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"origId":184,"flags":2064},"197":{"id":197,"type":"lines","material":{"lit":false},"vertices":[[4.060781,2,0.607948],[4.060781,4.5,0.607948],[4.060781,2,0.607948],[3.958821,2,0.4408454],[4.060781,2.5,0.607948],[3.958821,2.5,0.4408454],[4.060781,3,0.607948],[3.958821,3,0.4408454],[4.060781,3.5,0.607948],[3.958821,3.5,0.4408454],[4.060781,4,0.607948],[3.958821,4,0.4408454],[4.060781,4.5,0.607948],[3.958821,4.5,0.4408454]],"colors":[[0,0,0,1]],"centers":[[4.060781,3.25,0.607948],[4.009801,2,0.5243967],[4.009801,2.5,0.5243967],[4.009801,3,0.5243967],[4.009801,3.5,0.5243967],[4.009801,4,0.5243967],[4.009801,4.5,0.5243967]],"ignoreExtent":true,"origId":184,"flags":64},"198":{"id":198,"type":"text","material":{"lit":false},"vertices":[[3.754899,2,0.1066402],[3.754899,2.5,0.1066402],[3.754899,3,0.1066402],[3.754899,3.5,0.1066402],[3.754899,4,0.1066402],[3.754899,4.5,0.1066402]],"colors":[[0,0,0,1]],"texts":[["2"],["2.5"],["3"],["3.5"],["4"],["4.5"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[3.754899,2,0.1066402],[3.754899,2.5,0.1066402],[3.754899,3,0.1066402],[3.754899,3.5,0.1066402],[3.754899,4,0.1066402],[3.754899,4.5,0.1066402]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"origId":184,"flags":2064},"199":{"id":199,"type":"lines","material":{"lit":false},"vertices":[[4.060781,1.840521,1],[4.060781,1.840521,7],[4.060781,1.840521,1],[3.958821,1.772546,1],[4.060781,1.840521,2],[3.958821,1.772546,2],[4.060781,1.840521,3],[3.958821,1.772546,3],[4.060781,1.840521,4],[3.958821,1.772546,4],[4.060781,1.840521,5],[3.958821,1.772546,5],[4.060781,1.840521,6],[3.958821,1.772546,6],[4.060781,1.840521,7],[3.958821,1.772546,7]],"colors":[[0,0,0,1]],"centers":[[4.060781,1.840521,4],[4.009801,1.806533,1],[4.009801,1.806533,2],[4.009801,1.806533,3],[4.009801,1.806533,4],[4.009801,1.806533,5],[4.009801,1.806533,6],[4.009801,1.806533,7]],"ignoreExtent":true,"origId":184,"flags":64},"200":{"id":200,"type":"text","material":{"lit":false},"vertices":[[3.754899,1.636598,1],[3.754899,1.636598,2],[3.754899,1.636598,3],[3.754899,1.636598,4],[3.754899,1.636598,5],[3.754899,1.636598,6],[3.754899,1.636598,7]],"colors":[[0,0,0,1]],"texts":[["1"],["2"],["3"],["4"],["5"],["6"],["7"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[3.754899,1.636598,1],[3.754899,1.636598,2],[3.754899,1.636598,3],[3.754899,1.636598,4],[3.754899,1.636598,5],[3.754899,1.636598,6],[3.754899,1.636598,7]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"origId":184,"flags":2064},"201":{"id":201,"type":"lines","material":{"lit":false},"vertices":[[4.060781,1.840521,0.607948],[4.060781,4.55948,0.607948],[4.060781,1.840521,7.292052],[4.060781,4.55948,7.292052],[4.060781,1.840521,0.607948],[4.060781,1.840521,7.292052],[4.060781,4.55948,0.607948],[4.060781,4.55948,7.292052],[4.060781,1.840521,0.607948],[8.139219,1.840521,0.607948],[4.060781,1.840521,7.292052],[8.139219,1.840521,7.292052],[4.060781,4.55948,0.607948],[8.139219,4.55948,0.607948],[4.060781,4.55948,7.292052],[8.139219,4.55948,7.292052],[8.139219,1.840521,0.607948],[8.139219,4.55948,0.607948],[8.139219,1.840521,7.292052],[8.139219,4.55948,7.292052],[8.139219,1.840521,0.607948],[8.139219,1.840521,7.292052],[8.139219,4.55948,0.607948],[8.139219,4.55948,7.292052]],"colors":[[0,0,0,1]],"centers":[[4.060781,3.2,0.607948],[4.060781,3.2,7.292052],[4.060781,1.840521,3.95],[4.060781,4.55948,3.95],[6.1,1.840521,0.607948],[6.1,1.840521,7.292052],[6.1,4.55948,0.607948],[6.1,4.55948,7.292052],[8.139219,3.2,0.607948],[8.139219,3.2,7.292052],[8.139219,1.840521,3.95],[8.139219,4.55948,3.95]],"ignoreExtent":true,"origId":184,"flags":64}},"width":481,"height":481,"sphereVerts":{"vb":[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.07465783,0.1464466,0.2126075,0.2705981,0.3181896,0.3535534,0.3753303,0.3826834,0.3753303,0.3535534,0.3181896,0.2705981,0.2126075,0.1464466,0.07465783,0,0,0.1379497,0.2705981,0.3928475,0.5,0.5879378,0.6532815,0.6935199,0.7071068,0.6935199,0.6532815,0.5879378,0.5,0.3928475,0.2705981,0.1379497,0,0,0.18024,0.3535534,0.51328,0.6532815,0.7681778,0.8535534,0.9061274,0.9238795,0.9061274,0.8535534,0.7681778,0.6532815,0.51328,0.3535534,0.18024,0,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,0.9807853,0.9238795,0.8314696,0.7071068,0.5555702,0.3826834,0.1950903,0,0,0.18024,0.3535534,0.51328,0.6532815,0.7681778,0.8535534,0.9061274,0.9238795,0.9061274,0.8535534,0.7681778,0.6532815,0.51328,0.3535534,0.18024,0,0,0.1379497,0.2705981,0.3928475,0.5,0.5879378,0.6532815,0.6935199,0.7071068,0.6935199,0.6532815,0.5879378,0.5,0.3928475,0.2705981,0.1379497,0,0,0.07465783,0.1464466,0.2126075,0.2705981,0.3181896,0.3535534,0.3753303,0.3826834,0.3753303,0.3535534,0.3181896,0.2705981,0.2126075,0.1464466,0.07465783,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-0,-0.07465783,-0.1464466,-0.2126075,-0.2705981,-0.3181896,-0.3535534,-0.3753303,-0.3826834,-0.3753303,-0.3535534,-0.3181896,-0.2705981,-0.2126075,-0.1464466,-0.07465783,-0,-0,-0.1379497,-0.2705981,-0.3928475,-0.5,-0.5879378,-0.6532815,-0.6935199,-0.7071068,-0.6935199,-0.6532815,-0.5879378,-0.5,-0.3928475,-0.2705981,-0.1379497,-0,-0,-0.18024,-0.3535534,-0.51328,-0.6532815,-0.7681778,-0.8535534,-0.9061274,-0.9238795,-0.9061274,-0.8535534,-0.7681778,-0.6532815,-0.51328,-0.3535534,-0.18024,-0,-0,-0.1950903,-0.3826834,-0.5555702,-0.7071068,-0.8314696,-0.9238795,-0.9807853,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,-0,-0,-0.18024,-0.3535534,-0.51328,-0.6532815,-0.7681778,-0.8535534,-0.9061274,-0.9238795,-0.9061274,-0.8535534,-0.7681778,-0.6532815,-0.51328,-0.3535534,-0.18024,-0,-0,-0.1379497,-0.2705981,-0.3928475,-0.5,-0.5879378,-0.6532815,-0.6935199,-0.7071068,-0.6935199,-0.6532815,-0.5879378,-0.5,-0.3928475,-0.2705981,-0.1379497,-0,-0,-0.07465783,-0.1464466,-0.2126075,-0.2705981,-0.3181896,-0.3535534,-0.3753303,-0.3826834,-0.3753303,-0.3535534,-0.3181896,-0.2705981,-0.2126075,-0.1464466,-0.07465783,-0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1],[0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,0.9807853,0.9238795,0.8314696,0.7071068,0.5555702,0.3826834,0.1950903,0,0,0.18024,0.3535534,0.51328,0.6532815,0.7681778,0.8535534,0.9061274,0.9238795,0.9061274,0.8535534,0.7681778,0.6532815,0.51328,0.3535534,0.18024,0,0,0.1379497,0.2705981,0.3928475,0.5,0.5879378,0.6532815,0.6935199,0.7071068,0.6935199,0.6532815,0.5879378,0.5,0.3928475,0.2705981,0.1379497,0,0,0.07465783,0.1464466,0.2126075,0.2705981,0.3181896,0.3535534,0.3753303,0.3826834,0.3753303,0.3535534,0.3181896,0.2705981,0.2126075,0.1464466,0.07465783,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-0,-0.07465783,-0.1464466,-0.2126075,-0.2705981,-0.3181896,-0.3535534,-0.3753303,-0.3826834,-0.3753303,-0.3535534,-0.3181896,-0.2705981,-0.2126075,-0.1464466,-0.07465783,-0,-0,-0.1379497,-0.2705981,-0.3928475,-0.5,-0.5879378,-0.6532815,-0.6935199,-0.7071068,-0.6935199,-0.6532815,-0.5879378,-0.5,-0.3928475,-0.2705981,-0.1379497,-0,-0,-0.18024,-0.3535534,-0.51328,-0.6532815,-0.7681778,-0.8535534,-0.9061274,-0.9238795,-0.9061274,-0.8535534,-0.7681778,-0.6532815,-0.51328,-0.3535534,-0.18024,-0,-0,-0.1950903,-0.3826834,-0.5555702,-0.7071068,-0.8314696,-0.9238795,-0.9807853,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,-0,-0,-0.18024,-0.3535534,-0.51328,-0.6532815,-0.7681778,-0.8535534,-0.9061274,-0.9238795,-0.9061274,-0.8535534,-0.7681778,-0.6532815,-0.51328,-0.3535534,-0.18024,-0,-0,-0.1379497,-0.2705981,-0.3928475,-0.5,-0.5879378,-0.6532815,-0.6935199,-0.7071068,-0.6935199,-0.6532815,-0.5879378,-0.5,-0.3928475,-0.2705981,-0.1379497,-0,-0,-0.07465783,-0.1464466,-0.2126075,-0.2705981,-0.3181896,-0.3535534,-0.3753303,-0.3826834,-0.3753303,-0.3535534,-0.3181896,-0.2705981,-0.2126075,-0.1464466,-0.07465783,-0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.07465783,0.1464466,0.2126075,0.2705981,0.3181896,0.3535534,0.3753303,0.3826834,0.3753303,0.3535534,0.3181896,0.2705981,0.2126075,0.1464466,0.07465783,0,0,0.1379497,0.2705981,0.3928475,0.5,0.5879378,0.6532815,0.6935199,0.7071068,0.6935199,0.6532815,0.5879378,0.5,0.3928475,0.2705981,0.1379497,0,0,0.18024,0.3535534,0.51328,0.6532815,0.7681778,0.8535534,0.9061274,0.9238795,0.9061274,0.8535534,0.7681778,0.6532815,0.51328,0.3535534,0.18024,0,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,0.9807853,0.9238795,0.8314696,0.7071068,0.5555702,0.3826834,0.1950903,0]],"it":[[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270],[17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288],[18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271]],"primitivetype":"triangle","material":null,"normals":null,"texcoords":[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1]]}});
togglergl.prefix = "toggle";
</script>
<p id="toggledebug">
You must enable Javascript to view this page properly.
</p>
<script>togglergl.start();</script>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">toggleButton</span>(sphereid, <span class="dt">label =</span> <span class="st">&quot;setosa&quot;</span>, <span class="dt">prefix =</span> <span class="st">&quot;toggle&quot;</span>, <span class="dt">subscene =</span> subid)</code></pre>
<button type="button" id="inputedc730b8e52b" name="inputedc730b8e52b" onclick="(function(){
  var subset = [181], i;
  if (togglergl.inSubscene(subset[0], 175)) {
    for (i=0; i&lt;subset.length; i++)
      togglergl.delFromSubscene(subset[i], 175);
  } else {
    for (i=0; i&lt;subset.length; i++)
      togglergl.addToSubscene(subset[i], 175);
  }
  togglergl.drawScene();
})()">
setosa
</button>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">toggleButton</span>(sphereid<span class="dv">+1</span>, <span class="dt">label =</span> <span class="st">&quot;versicolor&quot;</span>, <span class="dt">prefix =</span> <span class="st">&quot;toggle&quot;</span>, <span class="dt">subscene =</span> subid)</code></pre>
<button type="button" id="inputedc73acd830a" name="inputedc73acd830a" onclick="(function(){
  var subset = [182], i;
  if (togglergl.inSubscene(subset[0], 175)) {
    for (i=0; i&lt;subset.length; i++)
      togglergl.delFromSubscene(subset[i], 175);
  } else {
    for (i=0; i&lt;subset.length; i++)
      togglergl.addToSubscene(subset[i], 175);
  }
  togglergl.drawScene();
})()">
versicolor
</button>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">toggleButton</span>(sphereid<span class="dv">+2</span>, <span class="dt">label =</span> <span class="st">&quot;virginica&quot;</span>, <span class="dt">prefix =</span> <span class="st">&quot;toggle&quot;</span>, <span class="dt">subscene =</span> subid)</code></pre>
<button type="button" id="inputedc7a5623af" name="inputedc7a5623af" onclick="(function(){
  var subset = [183], i;
  if (togglergl.inSubscene(subset[0], 175)) {
    for (i=0; i&lt;subset.length; i++)
      togglergl.delFromSubscene(subset[i], 175);
  } else {
    for (i=0; i&lt;subset.length; i++)
      togglergl.addToSubscene(subset[i], 175);
  }
  togglergl.drawScene();
})()">
virginica
</button>
<p>Note that we need to use <code>results=&quot;asis&quot;</code> for the button code.<br />Normally we would also use <code>echo=FALSE</code>, though I didnt do so above; then the buttons will end up side-by-side. We also add another button to toggle the axes:</p>
<button type="button" id="inputedc74d34efb" name="inputedc74d34efb" onclick="(function(){
  var subset = [181], i;
  if (togglergl.inSubscene(subset[0], 175)) {
    for (i=0; i&lt;subset.length; i++)
      togglergl.delFromSubscene(subset[i], 175);
  } else {
    for (i=0; i&lt;subset.length; i++)
      togglergl.addToSubscene(subset[i], 175);
  }
  togglergl.drawScene();
})()">
setosa
</button>
<button type="button" id="inputedc74ce64336" name="inputedc74ce64336" onclick="(function(){
  var subset = [182], i;
  if (togglergl.inSubscene(subset[0], 175)) {
    for (i=0; i&lt;subset.length; i++)
      togglergl.delFromSubscene(subset[i], 175);
  } else {
    for (i=0; i&lt;subset.length; i++)
      togglergl.addToSubscene(subset[i], 175);
  }
  togglergl.drawScene();
})()">
versicolor
</button>
<button type="button" id="inputedc72146b5ab" name="inputedc72146b5ab" onclick="(function(){
  var subset = [183], i;
  if (togglergl.inSubscene(subset[0], 175)) {
    for (i=0; i&lt;subset.length; i++)
      togglergl.delFromSubscene(subset[i], 175);
  } else {
    for (i=0; i&lt;subset.length; i++)
      togglergl.addToSubscene(subset[i], 175);
  }
  togglergl.drawScene();
})()">
virginica
</button>
<button type="button" id="inputedc72940fe9e" name="inputedc72940fe9e" onclick="(function(){
  var subset = [184,185,186,187], i;
  if (togglergl.inSubscene(subset[0], 175)) {
    for (i=0; i&lt;subset.length; i++)
      togglergl.delFromSubscene(subset[i], 175);
  } else {
    for (i=0; i&lt;subset.length; i++)
      togglergl.addToSubscene(subset[i], 175);
  }
  togglergl.drawScene();
})()">
axes
</button>
<p>An alternate control to achieve the same thing is <a name="subsetSlider"><a href="../../rgl/help/subsetSlider"><code>subsetSlider</code></a></a>. Here we also illustrate the <a name="elementId2Prefix"><a href="../../rgl/help/elementId2Prefix"><code>elementId2Prefix</code></a></a> bridge to allow an <a name="rglwidget"><a href="../../rgl/help/rglwidget"><code>rglwidget</code></a></a> to be controlled by the old-style slider.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rglwidget</span>(<span class="dt">elementId =</span> <span class="st">&quot;slider&quot;</span>)</code></pre>
<div id="slider" style="width:480px;height:480px;" class="rglWebGL html-widget"></div>
<script type="application/json" data-for="slider">{"x":{"material":{"color":"#000000","alpha":1,"lit":true,"ambient":"#000000","specular":"#FFFFFF","emission":"#000000","shininess":50,"smooth":true,"front":"filled","back":"filled","size":3,"lwd":1,"fog":false,"point_antialias":false,"line_antialias":false,"texture":null,"textype":"rgb","texmipmap":false,"texminfilter":"linear","texmagfilter":"linear","texenvmap":false,"depth_mask":true,"depth_test":"less","isTransparent":false},"rootSubscene":175,"objects":{"181":{"id":181,"type":"spheres","material":{},"vertices":[[5.09999990463257,3.5,1.39999997615814],[4.90000009536743,3,1.39999997615814],[4.69999980926514,3.20000004768372,1.29999995231628],[4.59999990463257,3.09999990463257,1.5],[5,3.59999990463257,1.39999997615814],[5.40000009536743,3.90000009536743,1.70000004768372],[4.59999990463257,3.40000009536743,1.39999997615814],[5,3.40000009536743,1.5],[4.40000009536743,2.90000009536743,1.39999997615814],[4.90000009536743,3.09999990463257,1.5],[5.40000009536743,3.70000004768372,1.5],[4.80000019073486,3.40000009536743,1.60000002384186],[4.80000019073486,3,1.39999997615814],[4.30000019073486,3,1.10000002384186],[5.80000019073486,4,1.20000004768372],[5.69999980926514,4.40000009536743,1.5],[5.40000009536743,3.90000009536743,1.29999995231628],[5.09999990463257,3.5,1.39999997615814],[5.69999980926514,3.79999995231628,1.70000004768372],[5.09999990463257,3.79999995231628,1.5],[5.40000009536743,3.40000009536743,1.70000004768372],[5.09999990463257,3.70000004768372,1.5],[4.59999990463257,3.59999990463257,1],[5.09999990463257,3.29999995231628,1.70000004768372],[4.80000019073486,3.40000009536743,1.89999997615814],[5,3,1.60000002384186],[5,3.40000009536743,1.60000002384186],[5.19999980926514,3.5,1.5],[5.19999980926514,3.40000009536743,1.39999997615814],[4.69999980926514,3.20000004768372,1.60000002384186],[4.80000019073486,3.09999990463257,1.60000002384186],[5.40000009536743,3.40000009536743,1.5],[5.19999980926514,4.09999990463257,1.5],[5.5,4.19999980926514,1.39999997615814],[4.90000009536743,3.09999990463257,1.5],[5,3.20000004768372,1.20000004768372],[5.5,3.5,1.29999995231628],[4.90000009536743,3.59999990463257,1.39999997615814],[4.40000009536743,3,1.29999995231628],[5.09999990463257,3.40000009536743,1.5],[5,3.5,1.29999995231628],[4.5,2.29999995231628,1.29999995231628],[4.40000009536743,3.20000004768372,1.29999995231628],[5,3.5,1.60000002384186],[5.09999990463257,3.79999995231628,1.89999997615814],[4.80000019073486,3,1.39999997615814],[5.09999990463257,3.79999995231628,1.60000002384186],[4.59999990463257,3.20000004768372,1.39999997615814],[5.30000019073486,3.70000004768372,1.5],[5,3.29999995231628,1.39999997615814]],"colors":[[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1]],"radii":[[0.210999995470047]],"centers":[[5.09999990463257,3.5,1.39999997615814],[4.90000009536743,3,1.39999997615814],[4.69999980926514,3.20000004768372,1.29999995231628],[4.59999990463257,3.09999990463257,1.5],[5,3.59999990463257,1.39999997615814],[5.40000009536743,3.90000009536743,1.70000004768372],[4.59999990463257,3.40000009536743,1.39999997615814],[5,3.40000009536743,1.5],[4.40000009536743,2.90000009536743,1.39999997615814],[4.90000009536743,3.09999990463257,1.5],[5.40000009536743,3.70000004768372,1.5],[4.80000019073486,3.40000009536743,1.60000002384186],[4.80000019073486,3,1.39999997615814],[4.30000019073486,3,1.10000002384186],[5.80000019073486,4,1.20000004768372],[5.69999980926514,4.40000009536743,1.5],[5.40000009536743,3.90000009536743,1.29999995231628],[5.09999990463257,3.5,1.39999997615814],[5.69999980926514,3.79999995231628,1.70000004768372],[5.09999990463257,3.79999995231628,1.5],[5.40000009536743,3.40000009536743,1.70000004768372],[5.09999990463257,3.70000004768372,1.5],[4.59999990463257,3.59999990463257,1],[5.09999990463257,3.29999995231628,1.70000004768372],[4.80000019073486,3.40000009536743,1.89999997615814],[5,3,1.60000002384186],[5,3.40000009536743,1.60000002384186],[5.19999980926514,3.5,1.5],[5.19999980926514,3.40000009536743,1.39999997615814],[4.69999980926514,3.20000004768372,1.60000002384186],[4.80000019073486,3.09999990463257,1.60000002384186],[5.40000009536743,3.40000009536743,1.5],[5.19999980926514,4.09999990463257,1.5],[5.5,4.19999980926514,1.39999997615814],[4.90000009536743,3.09999990463257,1.5],[5,3.20000004768372,1.20000004768372],[5.5,3.5,1.29999995231628],[4.90000009536743,3.59999990463257,1.39999997615814],[4.40000009536743,3,1.29999995231628],[5.09999990463257,3.40000009536743,1.5],[5,3.5,1.29999995231628],[4.5,2.29999995231628,1.29999995231628],[4.40000009536743,3.20000004768372,1.29999995231628],[5,3.5,1.60000002384186],[5.09999990463257,3.79999995231628,1.89999997615814],[4.80000019073486,3,1.39999997615814],[5.09999990463257,3.79999995231628,1.60000002384186],[4.59999990463257,3.20000004768372,1.39999997615814],[5.30000019073486,3.70000004768372,1.5],[5,3.29999995231628,1.39999997615814]],"ignoreExtent":false,"flags":3},"182":{"id":182,"type":"spheres","material":{},"vertices":[[7,3.20000004768372,4.69999980926514],[6.40000009536743,3.20000004768372,4.5],[6.90000009536743,3.09999990463257,4.90000009536743],[5.5,2.29999995231628,4],[6.5,2.79999995231628,4.59999990463257],[5.69999980926514,2.79999995231628,4.5],[6.30000019073486,3.29999995231628,4.69999980926514],[4.90000009536743,2.40000009536743,3.29999995231628],[6.59999990463257,2.90000009536743,4.59999990463257],[5.19999980926514,2.70000004768372,3.90000009536743],[5,2,3.5],[5.90000009536743,3,4.19999980926514],[6,2.20000004768372,4],[6.09999990463257,2.90000009536743,4.69999980926514],[5.59999990463257,2.90000009536743,3.59999990463257],[6.69999980926514,3.09999990463257,4.40000009536743],[5.59999990463257,3,4.5],[5.80000019073486,2.70000004768372,4.09999990463257],[6.19999980926514,2.20000004768372,4.5],[5.59999990463257,2.5,3.90000009536743],[5.90000009536743,3.20000004768372,4.80000019073486],[6.09999990463257,2.79999995231628,4],[6.30000019073486,2.5,4.90000009536743],[6.09999990463257,2.79999995231628,4.69999980926514],[6.40000009536743,2.90000009536743,4.30000019073486],[6.59999990463257,3,4.40000009536743],[6.80000019073486,2.79999995231628,4.80000019073486],[6.69999980926514,3,5],[6,2.90000009536743,4.5],[5.69999980926514,2.59999990463257,3.5],[5.5,2.40000009536743,3.79999995231628],[5.5,2.40000009536743,3.70000004768372],[5.80000019073486,2.70000004768372,3.90000009536743],[6,2.70000004768372,5.09999990463257],[5.40000009536743,3,4.5],[6,3.40000009536743,4.5],[6.69999980926514,3.09999990463257,4.69999980926514],[6.30000019073486,2.29999995231628,4.40000009536743],[5.59999990463257,3,4.09999990463257],[5.5,2.5,4],[5.5,2.59999990463257,4.40000009536743],[6.09999990463257,3,4.59999990463257],[5.80000019073486,2.59999990463257,4],[5,2.29999995231628,3.29999995231628],[5.59999990463257,2.70000004768372,4.19999980926514],[5.69999980926514,3,4.19999980926514],[5.69999980926514,2.90000009536743,4.19999980926514],[6.19999980926514,2.90000009536743,4.30000019073486],[5.09999990463257,2.5,3],[5.69999980926514,2.79999995231628,4.09999990463257]],"colors":[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1]],"radii":[[0.210999995470047]],"centers":[[7,3.20000004768372,4.69999980926514],[6.40000009536743,3.20000004768372,4.5],[6.90000009536743,3.09999990463257,4.90000009536743],[5.5,2.29999995231628,4],[6.5,2.79999995231628,4.59999990463257],[5.69999980926514,2.79999995231628,4.5],[6.30000019073486,3.29999995231628,4.69999980926514],[4.90000009536743,2.40000009536743,3.29999995231628],[6.59999990463257,2.90000009536743,4.59999990463257],[5.19999980926514,2.70000004768372,3.90000009536743],[5,2,3.5],[5.90000009536743,3,4.19999980926514],[6,2.20000004768372,4],[6.09999990463257,2.90000009536743,4.69999980926514],[5.59999990463257,2.90000009536743,3.59999990463257],[6.69999980926514,3.09999990463257,4.40000009536743],[5.59999990463257,3,4.5],[5.80000019073486,2.70000004768372,4.09999990463257],[6.19999980926514,2.20000004768372,4.5],[5.59999990463257,2.5,3.90000009536743],[5.90000009536743,3.20000004768372,4.80000019073486],[6.09999990463257,2.79999995231628,4],[6.30000019073486,2.5,4.90000009536743],[6.09999990463257,2.79999995231628,4.69999980926514],[6.40000009536743,2.90000009536743,4.30000019073486],[6.59999990463257,3,4.40000009536743],[6.80000019073486,2.79999995231628,4.80000019073486],[6.69999980926514,3,5],[6,2.90000009536743,4.5],[5.69999980926514,2.59999990463257,3.5],[5.5,2.40000009536743,3.79999995231628],[5.5,2.40000009536743,3.70000004768372],[5.80000019073486,2.70000004768372,3.90000009536743],[6,2.70000004768372,5.09999990463257],[5.40000009536743,3,4.5],[6,3.40000009536743,4.5],[6.69999980926514,3.09999990463257,4.69999980926514],[6.30000019073486,2.29999995231628,4.40000009536743],[5.59999990463257,3,4.09999990463257],[5.5,2.5,4],[5.5,2.59999990463257,4.40000009536743],[6.09999990463257,3,4.59999990463257],[5.80000019073486,2.59999990463257,4],[5,2.29999995231628,3.29999995231628],[5.59999990463257,2.70000004768372,4.19999980926514],[5.69999980926514,3,4.19999980926514],[5.69999980926514,2.90000009536743,4.19999980926514],[6.19999980926514,2.90000009536743,4.30000019073486],[5.09999990463257,2.5,3],[5.69999980926514,2.79999995231628,4.09999990463257]],"ignoreExtent":false,"flags":3},"183":{"id":183,"type":"spheres","material":{},"vertices":[[6.30000019073486,3.29999995231628,6],[5.80000019073486,2.70000004768372,5.09999990463257],[7.09999990463257,3,5.90000009536743],[6.30000019073486,2.90000009536743,5.59999990463257],[6.5,3,5.80000019073486],[7.59999990463257,3,6.59999990463257],[4.90000009536743,2.5,4.5],[7.30000019073486,2.90000009536743,6.30000019073486],[6.69999980926514,2.5,5.80000019073486],[7.19999980926514,3.59999990463257,6.09999990463257],[6.5,3.20000004768372,5.09999990463257],[6.40000009536743,2.70000004768372,5.30000019073486],[6.80000019073486,3,5.5],[5.69999980926514,2.5,5],[5.80000019073486,2.79999995231628,5.09999990463257],[6.40000009536743,3.20000004768372,5.30000019073486],[6.5,3,5.5],[7.69999980926514,3.79999995231628,6.69999980926514],[7.69999980926514,2.59999990463257,6.90000009536743],[6,2.20000004768372,5],[6.90000009536743,3.20000004768372,5.69999980926514],[5.59999990463257,2.79999995231628,4.90000009536743],[7.69999980926514,2.79999995231628,6.69999980926514],[6.30000019073486,2.70000004768372,4.90000009536743],[6.69999980926514,3.29999995231628,5.69999980926514],[7.19999980926514,3.20000004768372,6],[6.19999980926514,2.79999995231628,4.80000019073486],[6.09999990463257,3,4.90000009536743],[6.40000009536743,2.79999995231628,5.59999990463257],[7.19999980926514,3,5.80000019073486],[7.40000009536743,2.79999995231628,6.09999990463257],[7.90000009536743,3.79999995231628,6.40000009536743],[6.40000009536743,2.79999995231628,5.59999990463257],[6.30000019073486,2.79999995231628,5.09999990463257],[6.09999990463257,2.59999990463257,5.59999990463257],[7.69999980926514,3,6.09999990463257],[6.30000019073486,3.40000009536743,5.59999990463257],[6.40000009536743,3.09999990463257,5.5],[6,3,4.80000019073486],[6.90000009536743,3.09999990463257,5.40000009536743],[6.69999980926514,3.09999990463257,5.59999990463257],[6.90000009536743,3.09999990463257,5.09999990463257],[5.80000019073486,2.70000004768372,5.09999990463257],[6.80000019073486,3.20000004768372,5.90000009536743],[6.69999980926514,3.29999995231628,5.69999980926514],[6.69999980926514,3,5.19999980926514],[6.30000019073486,2.5,5],[6.5,3,5.19999980926514],[6.19999980926514,3.40000009536743,5.40000009536743],[5.90000009536743,3,5.09999990463257]],"colors":[[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1],[0,0.803921580314636,0,1]],"radii":[[0.210999995470047]],"centers":[[6.30000019073486,3.29999995231628,6],[5.80000019073486,2.70000004768372,5.09999990463257],[7.09999990463257,3,5.90000009536743],[6.30000019073486,2.90000009536743,5.59999990463257],[6.5,3,5.80000019073486],[7.59999990463257,3,6.59999990463257],[4.90000009536743,2.5,4.5],[7.30000019073486,2.90000009536743,6.30000019073486],[6.69999980926514,2.5,5.80000019073486],[7.19999980926514,3.59999990463257,6.09999990463257],[6.5,3.20000004768372,5.09999990463257],[6.40000009536743,2.70000004768372,5.30000019073486],[6.80000019073486,3,5.5],[5.69999980926514,2.5,5],[5.80000019073486,2.79999995231628,5.09999990463257],[6.40000009536743,3.20000004768372,5.30000019073486],[6.5,3,5.5],[7.69999980926514,3.79999995231628,6.69999980926514],[7.69999980926514,2.59999990463257,6.90000009536743],[6,2.20000004768372,5],[6.90000009536743,3.20000004768372,5.69999980926514],[5.59999990463257,2.79999995231628,4.90000009536743],[7.69999980926514,2.79999995231628,6.69999980926514],[6.30000019073486,2.70000004768372,4.90000009536743],[6.69999980926514,3.29999995231628,5.69999980926514],[7.19999980926514,3.20000004768372,6],[6.19999980926514,2.79999995231628,4.80000019073486],[6.09999990463257,3,4.90000009536743],[6.40000009536743,2.79999995231628,5.59999990463257],[7.19999980926514,3,5.80000019073486],[7.40000009536743,2.79999995231628,6.09999990463257],[7.90000009536743,3.79999995231628,6.40000009536743],[6.40000009536743,2.79999995231628,5.59999990463257],[6.30000019073486,2.79999995231628,5.09999990463257],[6.09999990463257,2.59999990463257,5.59999990463257],[7.69999980926514,3,6.09999990463257],[6.30000019073486,3.40000009536743,5.59999990463257],[6.40000009536743,3.09999990463257,5.5],[6,3,4.80000019073486],[6.90000009536743,3.09999990463257,5.40000009536743],[6.69999980926514,3.09999990463257,5.59999990463257],[6.90000009536743,3.09999990463257,5.09999990463257],[5.80000019073486,2.70000004768372,5.09999990463257],[6.80000019073486,3.20000004768372,5.90000009536743],[6.69999980926514,3.29999995231628,5.69999980926514],[6.69999980926514,3,5.19999980926514],[6.30000019073486,2.5,5],[6.5,3,5.19999980926514],[6.19999980926514,3.40000009536743,5.40000009536743],[5.90000009536743,3,5.09999990463257]],"ignoreExtent":false,"flags":3},"185":{"id":185,"type":"text","material":{"lit":false},"vertices":[[6.10000038146973,1.4326765537262,-0.394667625427246]],"colors":[[0,0,0,1]],"texts":[["x"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[6.10000038146973,1.4326765537262,-0.394667625427246]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":2064},"186":{"id":186,"type":"text","material":{"lit":false},"vertices":[[3.44901585578918,3.20000004768372,-0.394667625427246]],"colors":[[0,0,0,1]],"texts":[["y"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[3.44901585578918,3.20000004768372,-0.394667625427246]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":2064},"187":{"id":187,"type":"text","material":{"lit":false},"vertices":[[3.44901585578918,1.4326765537262,3.95000004768372]],"colors":[[0,0,0,1]],"texts":[["z"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[3.44901585578918,1.4326765537262,3.95000004768372]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":2064},"179":{"id":179,"type":"light","vertices":[[0,0,1]],"colors":[[1,1,1,1],[1,1,1,1],[1,1,1,1]],"viewpoint":true,"finite":false},"178":{"id":178,"type":"background","material":{"fog":true},"colors":[[0.298039227724075,0.298039227724075,0.298039227724075,1]],"centers":[[0,0,0]],"sphere":false,"fogtype":"none","flags":0},"180":{"id":180,"type":"background","material":{"lit":false,"back":"lines"},"colors":[[1,1,1,1]],"centers":[[0,0,0]],"sphere":false,"fogtype":"none","flags":0},"184":{"id":184,"type":"bboxdeco","material":{"front":"lines","back":"lines"},"vertices":[[5,"NA","NA"],[6,"NA","NA"],[7,"NA","NA"],[8,"NA","NA"],["NA",2,"NA"],["NA",2.5,"NA"],["NA",3,"NA"],["NA",3.5,"NA"],["NA",4,"NA"],["NA",4.5,"NA"],["NA","NA",1],["NA","NA",2],["NA","NA",3],["NA","NA",4],["NA","NA",5],["NA","NA",6],["NA","NA",7]],"colors":[[0,0,0,1]],"draw_front":true,"newIds":[209,210,211,212,213,214,215]},"175":{"id":175,"type":"subscene","par3d":{"antialias":1,"FOV":30,"ignoreExtent":false,"listeners":175,"mouseMode":{"left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,19.6919212341309],"modelMatrix":[[1.17336976528168,0,0,-7.15755605697632],[0,0.601971924304962,0.672778904438019,-4.5837869644165],[0,-1.65390419960022,0.244871512055397,-15.3666706085205],[0,0,0,1]],"projMatrix":[[3.73205089569092,0,0,0],[0,3.73205089569092,0,0],[0,0,-3.86370277404785,-70.9870910644531],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[1,0,0,0],[0,0.342020143325668,0.939692620785909,0],[0,-0.939692620785909,0.342020143325668,0],[0,0,0,1]],"scale":[1.17336976528168,1.76004803180695,0.715956389904022],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[4.12017631530762,8.07982444763184,1.88011693954468,4.51988315582275,0.705289304256439,7.19471073150635],"windowRect":[100,100,580,580],"family":"sans","font":1,"cex":1,"useFreeType":false,"fontname":"NULL","maxClipPlanes":2147483647,"glVersion":"NaN"},"embeddings":{"viewport":"replace","projection":"replace","model":"replace"},"objects":[180,184,181,182,183,185,186,187,179,209,210,211,212,213,214,215],"subscenes":[],"flags":2643},"209":{"id":209,"type":"lines","material":{"lit":false},"vertices":[[5,1.84052050113678,0.607948005199432],[8,1.84052050113678,0.607948005199432],[5,1.84052050113678,0.607948005199432],[5,1.77254641056061,0.440845370292664],[6,1.84052050113678,0.607948005199432],[6,1.77254641056061,0.440845370292664],[7,1.84052050113678,0.607948005199432],[7,1.77254641056061,0.440845370292664],[8,1.84052050113678,0.607948005199432],[8,1.77254641056061,0.440845370292664]],"colors":[[0,0,0,1]],"centers":[[6.5,1.84052050113678,0.607948005199432],[5,1.80653345584869,0.524396657943726],[6,1.80653345584869,0.524396657943726],[7,1.80653345584869,0.524396657943726],[8,1.80653345584869,0.524396657943726]],"ignoreExtent":true,"origId":184,"flags":64},"210":{"id":210,"type":"text","material":{"lit":false},"vertices":[[5,1.63659846782684,0.106640174984932],[6,1.63659846782684,0.106640174984932],[7,1.63659846782684,0.106640174984932],[8,1.63659846782684,0.106640174984932]],"colors":[[0,0,0,1]],"texts":[["5"],["6"],["7"],["8"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[5,1.63659846782684,0.106640174984932],[6,1.63659846782684,0.106640174984932],[7,1.63659846782684,0.106640174984932],[8,1.63659846782684,0.106640174984932]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"origId":184,"flags":2064},"211":{"id":211,"type":"lines","material":{"lit":false},"vertices":[[4.06078147888184,2,0.607948005199432],[4.06078147888184,4.5,0.607948005199432],[4.06078147888184,2,0.607948005199432],[3.95882058143616,2,0.440845370292664],[4.06078147888184,2.5,0.607948005199432],[3.95882058143616,2.5,0.440845370292664],[4.06078147888184,3,0.607948005199432],[3.95882058143616,3,0.440845370292664],[4.06078147888184,3.5,0.607948005199432],[3.95882058143616,3.5,0.440845370292664],[4.06078147888184,4,0.607948005199432],[3.95882058143616,4,0.440845370292664],[4.06078147888184,4.5,0.607948005199432],[3.95882058143616,4.5,0.440845370292664]],"colors":[[0,0,0,1]],"centers":[[4.06078147888184,3.25,0.607948005199432],[4.00980091094971,2,0.524396657943726],[4.00980091094971,2.5,0.524396657943726],[4.00980091094971,3,0.524396657943726],[4.00980091094971,3.5,0.524396657943726],[4.00980091094971,4,0.524396657943726],[4.00980091094971,4.5,0.524396657943726]],"ignoreExtent":true,"origId":184,"flags":64},"212":{"id":212,"type":"text","material":{"lit":false},"vertices":[[3.7548987865448,2,0.106640174984932],[3.7548987865448,2.5,0.106640174984932],[3.7548987865448,3,0.106640174984932],[3.7548987865448,3.5,0.106640174984932],[3.7548987865448,4,0.106640174984932],[3.7548987865448,4.5,0.106640174984932]],"colors":[[0,0,0,1]],"texts":[["2"],["2.5"],["3"],["3.5"],["4"],["4.5"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[3.7548987865448,2,0.106640174984932],[3.7548987865448,2.5,0.106640174984932],[3.7548987865448,3,0.106640174984932],[3.7548987865448,3.5,0.106640174984932],[3.7548987865448,4,0.106640174984932],[3.7548987865448,4.5,0.106640174984932]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"origId":184,"flags":2064},"213":{"id":213,"type":"lines","material":{"lit":false},"vertices":[[4.06078147888184,1.84052050113678,1],[4.06078147888184,1.84052050113678,7],[4.06078147888184,1.84052050113678,1],[3.95882058143616,1.77254641056061,1],[4.06078147888184,1.84052050113678,2],[3.95882058143616,1.77254641056061,2],[4.06078147888184,1.84052050113678,3],[3.95882058143616,1.77254641056061,3],[4.06078147888184,1.84052050113678,4],[3.95882058143616,1.77254641056061,4],[4.06078147888184,1.84052050113678,5],[3.95882058143616,1.77254641056061,5],[4.06078147888184,1.84052050113678,6],[3.95882058143616,1.77254641056061,6],[4.06078147888184,1.84052050113678,7],[3.95882058143616,1.77254641056061,7]],"colors":[[0,0,0,1]],"centers":[[4.06078147888184,1.84052050113678,4],[4.00980091094971,1.80653345584869,1],[4.00980091094971,1.80653345584869,2],[4.00980091094971,1.80653345584869,3],[4.00980091094971,1.80653345584869,4],[4.00980091094971,1.80653345584869,5],[4.00980091094971,1.80653345584869,6],[4.00980091094971,1.80653345584869,7]],"ignoreExtent":true,"origId":184,"flags":64},"214":{"id":214,"type":"text","material":{"lit":false},"vertices":[[3.7548987865448,1.63659846782684,1],[3.7548987865448,1.63659846782684,2],[3.7548987865448,1.63659846782684,3],[3.7548987865448,1.63659846782684,4],[3.7548987865448,1.63659846782684,5],[3.7548987865448,1.63659846782684,6],[3.7548987865448,1.63659846782684,7]],"colors":[[0,0,0,1]],"texts":[["1"],["2"],["3"],["4"],["5"],["6"],["7"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[3.7548987865448,1.63659846782684,1],[3.7548987865448,1.63659846782684,2],[3.7548987865448,1.63659846782684,3],[3.7548987865448,1.63659846782684,4],[3.7548987865448,1.63659846782684,5],[3.7548987865448,1.63659846782684,6],[3.7548987865448,1.63659846782684,7]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"origId":184,"flags":2064},"215":{"id":215,"type":"lines","material":{"lit":false},"vertices":[[4.06078147888184,1.84052050113678,0.607948005199432],[4.06078147888184,4.55947971343994,0.607948005199432],[4.06078147888184,1.84052050113678,7.29205226898193],[4.06078147888184,4.55947971343994,7.29205226898193],[4.06078147888184,1.84052050113678,0.607948005199432],[4.06078147888184,1.84052050113678,7.29205226898193],[4.06078147888184,4.55947971343994,0.607948005199432],[4.06078147888184,4.55947971343994,7.29205226898193],[4.06078147888184,1.84052050113678,0.607948005199432],[8.13921928405762,1.84052050113678,0.607948005199432],[4.06078147888184,1.84052050113678,7.29205226898193],[8.13921928405762,1.84052050113678,7.29205226898193],[4.06078147888184,4.55947971343994,0.607948005199432],[8.13921928405762,4.55947971343994,0.607948005199432],[4.06078147888184,4.55947971343994,7.29205226898193],[8.13921928405762,4.55947971343994,7.29205226898193],[8.13921928405762,1.84052050113678,0.607948005199432],[8.13921928405762,4.55947971343994,0.607948005199432],[8.13921928405762,1.84052050113678,7.29205226898193],[8.13921928405762,4.55947971343994,7.29205226898193],[8.13921928405762,1.84052050113678,0.607948005199432],[8.13921928405762,1.84052050113678,7.29205226898193],[8.13921928405762,4.55947971343994,0.607948005199432],[8.13921928405762,4.55947971343994,7.29205226898193]],"colors":[[0,0,0,1]],"centers":[[4.06078147888184,3.20000004768372,0.607948005199432],[4.06078147888184,3.20000004768372,7.29205226898193],[4.06078147888184,1.84052050113678,3.95000004768372],[4.06078147888184,4.55947971343994,3.95000004768372],[6.10000038146973,1.84052050113678,0.607948005199432],[6.10000038146973,1.84052050113678,7.29205226898193],[6.10000038146973,4.55947971343994,0.607948005199432],[6.10000038146973,4.55947971343994,7.29205226898193],[8.13921928405762,3.20000004768372,0.607948005199432],[8.13921928405762,3.20000004768372,7.29205226898193],[8.13921928405762,1.84052050113678,3.95000004768372],[8.13921928405762,4.55947971343994,3.95000004768372]],"ignoreExtent":true,"origId":184,"flags":64}},"width":480,"height":480,"sphereVerts":{"reuse":"plot3drgl"},"webGLoptions":{"preserveDrawingBuffer":true},"context":{"shiny":false,"rmarkdown":"rmarkdown::html_vignette"}},"evals":[],"jsHooks":[]}</script>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">elementId2Prefix</span>(<span class="st">&quot;slider&quot;</span>)</code></pre>
<script>var sliderrgl = {};</script>
<span id="rgl-play28758" class="rglPlayer html-widget"></span>
<script type="application/json" data-for="rgl-play28758">{"x":{"actions":[{"type":"oldBridge","prefix":"slider"}],"start":0,"stop":null,"value":0,"interval":0.05,"rate":1,"components":[],"buttonLabels":[],"pause":"Pause","loop":true,"step":1,"labels":null,"precision":3,"reinit":null,"sceneId":"slider","respondTo":null},"evals":[],"jsHooks":[]}</script>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">subsetSlider</span>(<span class="dt">subsets =</span> <span class="kw">list</span>(<span class="dt">setosa =</span> sphereid, 
                  <span class="dt">versicolor =</span> sphereid +<span class="st"> </span><span class="dv">1</span>, 
                  <span class="dt">virginica =</span> sphereid +<span class="st"> </span><span class="dv">2</span>, 
                  <span class="dt">all =</span> sphereid +<span class="st"> </span><span class="dv">0</span>:<span class="dv">2</span>),
             <span class="dt">prefixes =</span> <span class="st">&quot;slider&quot;</span>, <span class="dt">subscenes =</span> subid,
             <span class="dt">init =</span> <span class="dv">3</span>)</code></pre>
<script>sliderrgl.inputedc71ac1b10b = function(value){
  if (typeof sliderrgl.drawScene === "undefined")
    return;
  var busy = (typeof sliderrgl.inputedc71ac1b10b.busy !== "undefined"),
      lvalue, labels;
  try {
    sliderrgl.inputedc71ac1b10b.busy = value;
    if (busy) return;
    do {
       (function(value) {
  var i, ids = [[181],[182],[183],[181,182,183]],
      fullset = [181,182,183], entries,
      f = function(x) { return fullset.indexOf(x) < 0; };
  value = Math.round(value);
  if (typeof sliderrgl.getObj === "undefined") return;
  entries = sliderrgl.getObj(175).objects;
  entries = entries.filter(f);
  entries = entries.concat(ids[value]);

  sliderrgl.setSubsceneEntries(entries, 175);
})(value);
       sliderrgl.drawScene();
       lvalue = Math.round((value - 0)/1);
       labels = ['setosa','versicolor','virginica','all']; 
  label = document.getElementById('inputedc71ac1b10btext');
  if (label !== null) label.value = labels[lvalue];
     } while (sliderrgl.inputedc71ac1b10b.busy !== value);
  }
  finally {
    if (!busy)
      sliderrgl.inputedc71ac1b10b.busy = undefined;
  }
};
sliderrgl.inputedc71ac1b10b(3);</script>
<input type="range" min="0" max="3" step="1" value="3" id="inputedc71ac1b10b" name="inputedc71ac1b10b" oninput="sliderrgl.inputedc71ac1b10b(this.valueAsNumber)">
<output id="inputedc71ac1b10btext" for="inputedc71ac1b10b">
all
</output>
<p>There are several other functions to generate the Javascript code for controls. <a name="par3dinterpSetter"><a href="../../rgl/help/par3dinterpSetter"><code>par3dinterpSetter</code></a></a> generates a function that approximates the result of <a href="#par3dinterp"><code>par3dinterp</code></a>. <a name="propertySetter"><a href="../../rgl/help/propertySetter"><code>propertySetter</code></a></a> is a more general function to set the value of properties of the scene. Both generate Javascript functions, but not the controls to use them; for that, use <a name="propertySlider"><a href="../../rgl/help/propertySlider"><code>propertySlider</code></a></a> or your own custom code.</p>
For example, the following code (similar to the <a href="#play3d"><code>play3d</code></a> example) rotates the scene in a complex way.
<div id="userMatrixdiv" class="rglWebGL">

</div>
<script type="text/javascript">
var userMatrixdiv = document.getElementById("userMatrixdiv"),
userMatrixrgl = new rglwidgetClass();
userMatrixdiv.width = 481;
userMatrixdiv.height = 481;
userMatrixrgl.initialize(userMatrixdiv,
{"material":{"color":"#000000","alpha":1,"lit":true,"ambient":"#000000","specular":"#FFFFFF","emission":"#000000","shininess":50,"smooth":true,"front":"filled","back":"filled","size":3,"lwd":1,"fog":false,"point_antialias":false,"line_antialias":false,"texture":null,"textype":"rgb","texmipmap":false,"texminfilter":"linear","texmagfilter":"linear","texenvmap":false,"depth_mask":true,"depth_test":"less","isTransparent":false},"rootSubscene":175,"objects":{"181":{"id":181,"reuse":"togglediv"},"182":{"id":182,"reuse":"togglediv"},"183":{"id":183,"reuse":"togglediv"},"185":{"id":185,"reuse":"togglediv"},"186":{"id":186,"reuse":"togglediv"},"187":{"id":187,"reuse":"togglediv"},"179":{"id":179,"reuse":"togglediv"},"178":{"id":178,"reuse":"togglediv"},"180":{"id":180,"reuse":"togglediv"},"184":{"id":184,"type":"bboxdeco","material":{"front":"lines","back":"lines"},"vertices":[[5,"NA","NA"],[6,"NA","NA"],[7,"NA","NA"],[8,"NA","NA"],["NA",2,"NA"],["NA",2.5,"NA"],["NA",3,"NA"],["NA",3.5,"NA"],["NA",4,"NA"],["NA",4.5,"NA"],["NA","NA",1],["NA","NA",2],["NA","NA",3],["NA","NA",4],["NA","NA",5],["NA","NA",6],["NA","NA",7]],"colors":[[0,0,0,1]],"draw_front":true,"newIds":[223,224,225,226,227,228,229]},"175":{"id":175,"type":"subscene","par3d":{"antialias":1,"FOV":30,"ignoreExtent":false,"listeners":175,"mouseMode":{"left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,19.69192],"modelMatrix":[[1.17337,0,0,-7.157556],[0,0.6019719,0.6727789,-4.583787],[0,-1.653904,0.2448715,-15.36667],[0,0,0,1]],"projMatrix":[[3.732051,0,0,0],[0,3.732051,0,0],[0,0,-3.863703,-70.98709],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[1,0,0,0],[0,0.3420201,0.9396926,0],[0,-0.9396926,0.3420201,0],[0,0,0,1]],"scale":[1.17337,1.760048,0.7159564],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[4.120176,8.079824,1.880117,4.519883,0.7052893,7.194711],"windowRect":[100,100,580,580],"family":"sans","font":1,"cex":1,"useFreeType":false,"fontname":"NULL","maxClipPlanes":2147483647,"glVersion":"NaN"},"embeddings":{"viewport":"replace","projection":"replace","model":"replace"},"objects":[180,184,181,182,183,185,186,187,179,223,224,225,226,227,228,229],"subscenes":[],"flags":2643},"223":{"id":223,"type":"lines","material":{"lit":false},"vertices":[[5,1.840521,0.607948],[8,1.840521,0.607948],[5,1.840521,0.607948],[5,1.772546,0.4408454],[6,1.840521,0.607948],[6,1.772546,0.4408454],[7,1.840521,0.607948],[7,1.772546,0.4408454],[8,1.840521,0.607948],[8,1.772546,0.4408454]],"colors":[[0,0,0,1]],"centers":[[6.5,1.840521,0.607948],[5,1.806533,0.5243967],[6,1.806533,0.5243967],[7,1.806533,0.5243967],[8,1.806533,0.5243967]],"ignoreExtent":true,"origId":184,"flags":64},"224":{"id":224,"type":"text","material":{"lit":false},"vertices":[[5,1.636598,0.1066402],[6,1.636598,0.1066402],[7,1.636598,0.1066402],[8,1.636598,0.1066402]],"colors":[[0,0,0,1]],"texts":[["5"],["6"],["7"],["8"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[5,1.636598,0.1066402],[6,1.636598,0.1066402],[7,1.636598,0.1066402],[8,1.636598,0.1066402]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"origId":184,"flags":2064},"225":{"id":225,"type":"lines","material":{"lit":false},"vertices":[[4.060781,2,0.607948],[4.060781,4.5,0.607948],[4.060781,2,0.607948],[3.958821,2,0.4408454],[4.060781,2.5,0.607948],[3.958821,2.5,0.4408454],[4.060781,3,0.607948],[3.958821,3,0.4408454],[4.060781,3.5,0.607948],[3.958821,3.5,0.4408454],[4.060781,4,0.607948],[3.958821,4,0.4408454],[4.060781,4.5,0.607948],[3.958821,4.5,0.4408454]],"colors":[[0,0,0,1]],"centers":[[4.060781,3.25,0.607948],[4.009801,2,0.5243967],[4.009801,2.5,0.5243967],[4.009801,3,0.5243967],[4.009801,3.5,0.5243967],[4.009801,4,0.5243967],[4.009801,4.5,0.5243967]],"ignoreExtent":true,"origId":184,"flags":64},"226":{"id":226,"type":"text","material":{"lit":false},"vertices":[[3.754899,2,0.1066402],[3.754899,2.5,0.1066402],[3.754899,3,0.1066402],[3.754899,3.5,0.1066402],[3.754899,4,0.1066402],[3.754899,4.5,0.1066402]],"colors":[[0,0,0,1]],"texts":[["2"],["2.5"],["3"],["3.5"],["4"],["4.5"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[3.754899,2,0.1066402],[3.754899,2.5,0.1066402],[3.754899,3,0.1066402],[3.754899,3.5,0.1066402],[3.754899,4,0.1066402],[3.754899,4.5,0.1066402]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"origId":184,"flags":2064},"227":{"id":227,"type":"lines","material":{"lit":false},"vertices":[[4.060781,1.840521,1],[4.060781,1.840521,7],[4.060781,1.840521,1],[3.958821,1.772546,1],[4.060781,1.840521,2],[3.958821,1.772546,2],[4.060781,1.840521,3],[3.958821,1.772546,3],[4.060781,1.840521,4],[3.958821,1.772546,4],[4.060781,1.840521,5],[3.958821,1.772546,5],[4.060781,1.840521,6],[3.958821,1.772546,6],[4.060781,1.840521,7],[3.958821,1.772546,7]],"colors":[[0,0,0,1]],"centers":[[4.060781,1.840521,4],[4.009801,1.806533,1],[4.009801,1.806533,2],[4.009801,1.806533,3],[4.009801,1.806533,4],[4.009801,1.806533,5],[4.009801,1.806533,6],[4.009801,1.806533,7]],"ignoreExtent":true,"origId":184,"flags":64},"228":{"id":228,"type":"text","material":{"lit":false},"vertices":[[3.754899,1.636598,1],[3.754899,1.636598,2],[3.754899,1.636598,3],[3.754899,1.636598,4],[3.754899,1.636598,5],[3.754899,1.636598,6],[3.754899,1.636598,7]],"colors":[[0,0,0,1]],"texts":[["1"],["2"],["3"],["4"],["5"],["6"],["7"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[3.754899,1.636598,1],[3.754899,1.636598,2],[3.754899,1.636598,3],[3.754899,1.636598,4],[3.754899,1.636598,5],[3.754899,1.636598,6],[3.754899,1.636598,7]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"origId":184,"flags":2064},"229":{"id":229,"type":"lines","material":{"lit":false},"vertices":[[4.060781,1.840521,0.607948],[4.060781,4.55948,0.607948],[4.060781,1.840521,7.292052],[4.060781,4.55948,7.292052],[4.060781,1.840521,0.607948],[4.060781,1.840521,7.292052],[4.060781,4.55948,0.607948],[4.060781,4.55948,7.292052],[4.060781,1.840521,0.607948],[8.139219,1.840521,0.607948],[4.060781,1.840521,7.292052],[8.139219,1.840521,7.292052],[4.060781,4.55948,0.607948],[8.139219,4.55948,0.607948],[4.060781,4.55948,7.292052],[8.139219,4.55948,7.292052],[8.139219,1.840521,0.607948],[8.139219,4.55948,0.607948],[8.139219,1.840521,7.292052],[8.139219,4.55948,7.292052],[8.139219,1.840521,0.607948],[8.139219,1.840521,7.292052],[8.139219,4.55948,0.607948],[8.139219,4.55948,7.292052]],"colors":[[0,0,0,1]],"centers":[[4.060781,3.2,0.607948],[4.060781,3.2,7.292052],[4.060781,1.840521,3.95],[4.060781,4.55948,3.95],[6.1,1.840521,0.607948],[6.1,1.840521,7.292052],[6.1,4.55948,0.607948],[6.1,4.55948,7.292052],[8.139219,3.2,0.607948],[8.139219,3.2,7.292052],[8.139219,1.840521,3.95],[8.139219,4.55948,3.95]],"ignoreExtent":true,"origId":184,"flags":64}},"width":481,"height":481,"sphereVerts":{"reuse":"togglediv"}});
userMatrixrgl.prefix = "userMatrix";
</script>
<p id="userMatrixdebug">
You must enable Javascript to view this page properly.
</p>
<script>userMatrixrgl.start();</script>
<pre class="sourceCode r"><code class="sourceCode r">M &lt;-<span class="st"> </span>r3dDefaults$userMatrix
fn &lt;-<span class="st"> </span><span class="kw">par3dinterp</span>(<span class="dt">time =</span> (<span class="dv">0</span>:<span class="dv">2</span>)*<span class="fl">0.75</span>, <span class="dt">userMatrix =</span> <span class="kw">list</span>(M,
                                     <span class="kw">rotate3d</span>(M, pi/<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>),
                                     <span class="kw">rotate3d</span>(M, pi/<span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>) ) )
<span class="kw">propertySlider</span>(<span class="dt">setter =</span> <span class="kw">par3dinterpSetter</span>(fn, <span class="dv">0</span>, <span class="fl">1.5</span>, <span class="dt">steps=</span><span class="dv">15</span>, 
                       <span class="dt">prefix =</span> <span class="st">&quot;userMatrix&quot;</span>, 
                       <span class="dt">subscene =</span> subid),
           <span class="dt">step =</span> <span class="fl">0.01</span>)</code></pre>
<script>userMatrixrgl.inputedc72f202c76 = function(value){
  if (typeof userMatrixrgl.drawScene === "undefined")
    return;
  var busy = (typeof userMatrixrgl.inputedc72f202c76.busy !== "undefined"),
      lvalue, labels;
  try {
    userMatrixrgl.inputedc72f202c76.busy = value;
    if (busy) return;
    do {
       (function(value){
   var values = [1,0,0,0,0.3420201,-0.9396926,0,0.9396926,0.3420201,1,0,0,0,0.3420201,-0.9396926,0,0.9396926,0.3420201,0.9998637,0.01530909,0.006182005,-0.0005731673,0.4063968,-0.9136965,-0.01650021,0.9135684,0.4063502,0.998369,0.05070307,0.02623844,-0.007314602,0.5694157,-0.8220172,-0.05661938,0.8204846,0.5688579,0.994286,0.08726108,0.06148823,-0.02793499,0.7686299,-0.6390835,-0.1030288,0.6337141,0.7666756,0.9891054,0.1056615,0.1024996,-0.06017974,0.9256743,-0.3735044,-0.1343463,0.3632668,0.9219481,0.9869455,0.0975766,0.1281305,-0.08703014,0.9925308,-0.08548915,-0.1355152,0.07322191,0.9880659,0.9907124,0.06879497,0.1172868,-0.08668432,0.9841065,0.1549846,-0.1047606,-0.1637121,0.9809299,0.9981252,0.02685711,0.05499827,-0.0424958,0.9507813,0.3069348,-0.04404794,-0.3086966,0.9501401,0.9967362,-0.03391975,-0.0732553,0.05723623,0.9368655,0.3449741,0.05692893,-0.348041,0.9357492,0.9546708,-0.1350528,-0.2652627,0.2030747,0.9470569,0.2486845,0.2176334,-0.29128,0.9315534,0.8280962,-0.2984868,-0.4745127,0.3438076,0.9389938,0.009332723,0.4427787,-0.1708694,0.8801992,0.6034845,-0.5142712,-0.6093699,0.3967293,0.8565686,-0.3299942,0.6916736,-0.04260846,0.7209523,0.3452672,-0.7195484,-0.6025286,0.3200916,0.6937994,-0.6451231,0.8822312,0.02987549,0.4698675,0.1448145,-0.8559505,-0.4963642,0.1736775,0.515853,-0.8388873,0.974097,0.0352758,0.2233623,0.0341197,-0.921358,-0.3872147,0.04873981,0.3885133,-0.9201532,0.9982286,0.01252258,0.05816277,5.551115e-17,-0.9396926,-0.3420201,-5.551115e-17,0.3420201,-0.9396926,1,5.551115e-17,0,5.551115e-17,-0.9396926,-0.3420201,-5.551115e-17,0.3420201,-0.9396926,1,5.551115e-17,0],
   propvals = userMatrixrgl.getObj(175).par3d.userMatrix.getAsArray();
   var svals = [-Infinity, 0,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1,1.1,1.2,1.3,1.4,1.5, Infinity],
        v1, v2;
   for (var i = 1; i < svals.length; i++)
     if (value <= svals[i]) {
       var p = (svals[i] - value)/(svals[i] - svals[i-1]);
       v1 = values[9*(i-1)];
       v2 = values[9*i];
       propvals[0] = p*v1 + (1-p)*v2;
       v1 = values[9*(i-1)+1];
       v2 = values[9*i+1];
       propvals[1] = p*v1 + (1-p)*v2;
       v1 = values[9*(i-1)+2];
       v2 = values[9*i+2];
       propvals[2] = p*v1 + (1-p)*v2;
       v1 = values[9*(i-1)+3];
       v2 = values[9*i+3];
       propvals[4] = p*v1 + (1-p)*v2;
       v1 = values[9*(i-1)+4];
       v2 = values[9*i+4];
       propvals[5] = p*v1 + (1-p)*v2;
       v1 = values[9*(i-1)+5];
       v2 = values[9*i+5];
       propvals[6] = p*v1 + (1-p)*v2;
       v1 = values[9*(i-1)+6];
       v2 = values[9*i+6];
       propvals[8] = p*v1 + (1-p)*v2;
       v1 = values[9*(i-1)+7];
       v2 = values[9*i+7];
       propvals[9] = p*v1 + (1-p)*v2;
       v1 = values[9*(i-1)+8];
       v2 = values[9*i+8];
       propvals[10] = p*v1 + (1-p)*v2;
       break;
     }
   userMatrixrgl.getObj(175).par3d.userMatrix.load(propvals);
})(value);
       userMatrixrgl.drawScene();
       lvalue = Math.round((value - 0)/0.01);
       labels = ['0','0.01','0.02','0.03','0.04','0.05','0.0600000000000001','0.07','0.08','0.09','0.1','0.11','0.12','0.13','0.14','0.15','0.16','0.17','0.18','0.19','0.2','0.21','0.22','0.23','0.24','0.25','0.26','0.27','0.28','0.29','0.3','0.31','0.32','0.33','0.34','0.35','0.36','0.37','0.38','0.39','0.4','0.41','0.42','0.43','0.44','0.45','0.46','0.47','0.48','0.49','0.5','0.51','0.52','0.53','0.54','0.55','0.56','0.57','0.58','0.59','0.6','0.61','0.62','0.63','0.64','0.65','0.66','0.67','0.68','0.69','0.7','0.71','0.72','0.73','0.74','0.75','0.76','0.77','0.78','0.79','0.8','0.81','0.82','0.83','0.84','0.85','0.86','0.87','0.88','0.89','0.9','0.91','0.92','0.93','0.94','0.95','0.96','0.97','0.98','0.99','1','1.01','1.02','1.03','1.04','1.05','1.06','1.07','1.08','1.09','1.1','1.11','1.12','1.13','1.14','1.15','1.16','1.17','1.18','1.19','1.2','1.21','1.22','1.23','1.24','1.25','1.26','1.27','1.28','1.29','1.3','1.31','1.32','1.33','1.34','1.35','1.36','1.37','1.38','1.39','1.4','1.41','1.42','1.43','1.44','1.45','1.46','1.47','1.48','1.49','1.5']; 
  label = document.getElementById('inputedc72f202c76text');
  if (label !== null) label.value = labels[lvalue];
     } while (userMatrixrgl.inputedc72f202c76.busy !== value);
  }
  finally {
    if (!busy)
      userMatrixrgl.inputedc72f202c76.busy = undefined;
  }
};
userMatrixrgl.inputedc72f202c76(0);</script>
<input type="range" min="0" max="1.5" step="0.01" value="0" id="inputedc72f202c76" name="inputedc72f202c76" oninput="userMatrixrgl.inputedc72f202c76(this.valueAsNumber)">
<output id="inputedc72f202c76text" for="inputedc72f202c76">
0
</output>
<p>Some things to note: The generated Javascript slider has 150 increments, so that motion appears smooth. However, storing 150 <code>userMatrix</code> values would take up a lot of space, so we use interpolation in the Javascript code. However, the Javascript code can only do linear interpolation, not the more complex spline-based SO(3) interpolation done by <a href="#par3dinterp"><code>par3dinterp</code></a>. Because of this, we need to output 15 steps from <a href="#par3dinterpSetter"><code>par3dinterpSetter</code></a> so that the distortions of linear interpolation are not visible.</p>
<p>Another function that auto-generates Javascript code is <a name="clipplaneSlider"><a href="../../rgl/help/clipplaneSlider"><code>clipplaneSlider</code></a></a>. This function allows the user to control the location of a clipping plane by moving a slider. Both it and <a href="#par3dinterpSetter"><code>par3dinterpSetter</code></a> are implemented using the more general <a name="propertySlider"><a href="../../rgl/help/propertySlider"><code>propertySlider</code></a></a>, which allows control of multiple objects in multiple scenes, but which does require knowledge of the internal representation of the scene in its Javascript implementation.</p>
<p>Less general than <a href="#propertySetter"><code>propertySetter</code></a> is <a name="vertexSetter"><a href="../../rgl/help/vertexSetter"><code>vertexSetter</code></a></a>. This function sets attributes of individual vertices in a scene. For example, to set the x-coordinate of the closest point in the setosa group, and modify its colour from black to white,</p>
<div id="vertexdiv" class="rglWebGL">

</div>
<script type="text/javascript">
var vertexdiv = document.getElementById("vertexdiv"),
vertexrgl = new rglwidgetClass();
vertexdiv.width = 481;
vertexdiv.height = 481;
vertexrgl.initialize(vertexdiv,
{"material":{"color":"#000000","alpha":1,"lit":true,"ambient":"#000000","specular":"#FFFFFF","emission":"#000000","shininess":50,"smooth":true,"front":"filled","back":"filled","size":3,"lwd":1,"fog":false,"point_antialias":false,"line_antialias":false,"texture":null,"textype":"rgb","texmipmap":false,"texminfilter":"linear","texmagfilter":"linear","texenvmap":false,"depth_mask":true,"depth_test":"less","isTransparent":false},"rootSubscene":175,"objects":{"181":{"id":181,"reuse":"togglediv"},"182":{"id":182,"reuse":"togglediv"},"183":{"id":183,"reuse":"togglediv"},"185":{"id":185,"reuse":"togglediv"},"186":{"id":186,"reuse":"togglediv"},"187":{"id":187,"reuse":"togglediv"},"179":{"id":179,"reuse":"togglediv"},"178":{"id":178,"reuse":"togglediv"},"180":{"id":180,"reuse":"togglediv"},"184":{"id":184,"type":"bboxdeco","material":{"front":"lines","back":"lines"},"vertices":[[5,"NA","NA"],[6,"NA","NA"],[7,"NA","NA"],[8,"NA","NA"],["NA",2,"NA"],["NA",2.5,"NA"],["NA",3,"NA"],["NA",3.5,"NA"],["NA",4,"NA"],["NA",4.5,"NA"],["NA","NA",1],["NA","NA",2],["NA","NA",3],["NA","NA",4],["NA","NA",5],["NA","NA",6],["NA","NA",7]],"colors":[[0,0,0,1]],"draw_front":true,"newIds":[237,238,239,240,241,242,243]},"175":{"id":175,"type":"subscene","par3d":{"antialias":1,"FOV":30,"ignoreExtent":false,"listeners":175,"mouseMode":{"left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,19.69192],"modelMatrix":[[1.17337,0,0,-7.157556],[0,0.6019719,0.6727789,-4.583787],[0,-1.653904,0.2448715,-15.36667],[0,0,0,1]],"projMatrix":[[3.732051,0,0,0],[0,3.732051,0,0],[0,0,-3.863703,-70.98709],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[1,0,0,0],[0,0.3420201,0.9396926,0],[0,-0.9396926,0.3420201,0],[0,0,0,1]],"scale":[1.17337,1.760048,0.7159564],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[4.120176,8.079824,1.880117,4.519883,0.7052893,7.194711],"windowRect":[100,100,580,580],"family":"sans","font":1,"cex":1,"useFreeType":false,"fontname":"NULL","maxClipPlanes":2147483647,"glVersion":"NaN"},"embeddings":{"viewport":"replace","projection":"replace","model":"replace"},"objects":[180,184,181,182,183,185,186,187,179,237,238,239,240,241,242,243],"subscenes":[],"flags":2643},"237":{"id":237,"type":"lines","material":{"lit":false},"vertices":[[5,1.840521,0.607948],[8,1.840521,0.607948],[5,1.840521,0.607948],[5,1.772546,0.4408454],[6,1.840521,0.607948],[6,1.772546,0.4408454],[7,1.840521,0.607948],[7,1.772546,0.4408454],[8,1.840521,0.607948],[8,1.772546,0.4408454]],"colors":[[0,0,0,1]],"centers":[[6.5,1.840521,0.607948],[5,1.806533,0.5243967],[6,1.806533,0.5243967],[7,1.806533,0.5243967],[8,1.806533,0.5243967]],"ignoreExtent":true,"origId":184,"flags":64},"238":{"id":238,"type":"text","material":{"lit":false},"vertices":[[5,1.636598,0.1066402],[6,1.636598,0.1066402],[7,1.636598,0.1066402],[8,1.636598,0.1066402]],"colors":[[0,0,0,1]],"texts":[["5"],["6"],["7"],["8"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[5,1.636598,0.1066402],[6,1.636598,0.1066402],[7,1.636598,0.1066402],[8,1.636598,0.1066402]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"origId":184,"flags":2064},"239":{"id":239,"type":"lines","material":{"lit":false},"vertices":[[4.060781,2,0.607948],[4.060781,4.5,0.607948],[4.060781,2,0.607948],[3.958821,2,0.4408454],[4.060781,2.5,0.607948],[3.958821,2.5,0.4408454],[4.060781,3,0.607948],[3.958821,3,0.4408454],[4.060781,3.5,0.607948],[3.958821,3.5,0.4408454],[4.060781,4,0.607948],[3.958821,4,0.4408454],[4.060781,4.5,0.607948],[3.958821,4.5,0.4408454]],"colors":[[0,0,0,1]],"centers":[[4.060781,3.25,0.607948],[4.009801,2,0.5243967],[4.009801,2.5,0.5243967],[4.009801,3,0.5243967],[4.009801,3.5,0.5243967],[4.009801,4,0.5243967],[4.009801,4.5,0.5243967]],"ignoreExtent":true,"origId":184,"flags":64},"240":{"id":240,"type":"text","material":{"lit":false},"vertices":[[3.754899,2,0.1066402],[3.754899,2.5,0.1066402],[3.754899,3,0.1066402],[3.754899,3.5,0.1066402],[3.754899,4,0.1066402],[3.754899,4.5,0.1066402]],"colors":[[0,0,0,1]],"texts":[["2"],["2.5"],["3"],["3.5"],["4"],["4.5"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[3.754899,2,0.1066402],[3.754899,2.5,0.1066402],[3.754899,3,0.1066402],[3.754899,3.5,0.1066402],[3.754899,4,0.1066402],[3.754899,4.5,0.1066402]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"origId":184,"flags":2064},"241":{"id":241,"type":"lines","material":{"lit":false},"vertices":[[4.060781,1.840521,1],[4.060781,1.840521,7],[4.060781,1.840521,1],[3.958821,1.772546,1],[4.060781,1.840521,2],[3.958821,1.772546,2],[4.060781,1.840521,3],[3.958821,1.772546,3],[4.060781,1.840521,4],[3.958821,1.772546,4],[4.060781,1.840521,5],[3.958821,1.772546,5],[4.060781,1.840521,6],[3.958821,1.772546,6],[4.060781,1.840521,7],[3.958821,1.772546,7]],"colors":[[0,0,0,1]],"centers":[[4.060781,1.840521,4],[4.009801,1.806533,1],[4.009801,1.806533,2],[4.009801,1.806533,3],[4.009801,1.806533,4],[4.009801,1.806533,5],[4.009801,1.806533,6],[4.009801,1.806533,7]],"ignoreExtent":true,"origId":184,"flags":64},"242":{"id":242,"type":"text","material":{"lit":false},"vertices":[[3.754899,1.636598,1],[3.754899,1.636598,2],[3.754899,1.636598,3],[3.754899,1.636598,4],[3.754899,1.636598,5],[3.754899,1.636598,6],[3.754899,1.636598,7]],"colors":[[0,0,0,1]],"texts":[["1"],["2"],["3"],["4"],["5"],["6"],["7"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[3.754899,1.636598,1],[3.754899,1.636598,2],[3.754899,1.636598,3],[3.754899,1.636598,4],[3.754899,1.636598,5],[3.754899,1.636598,6],[3.754899,1.636598,7]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"origId":184,"flags":2064},"243":{"id":243,"type":"lines","material":{"lit":false},"vertices":[[4.060781,1.840521,0.607948],[4.060781,4.55948,0.607948],[4.060781,1.840521,7.292052],[4.060781,4.55948,7.292052],[4.060781,1.840521,0.607948],[4.060781,1.840521,7.292052],[4.060781,4.55948,0.607948],[4.060781,4.55948,7.292052],[4.060781,1.840521,0.607948],[8.139219,1.840521,0.607948],[4.060781,1.840521,7.292052],[8.139219,1.840521,7.292052],[4.060781,4.55948,0.607948],[8.139219,4.55948,0.607948],[4.060781,4.55948,7.292052],[8.139219,4.55948,7.292052],[8.139219,1.840521,0.607948],[8.139219,4.55948,0.607948],[8.139219,1.840521,7.292052],[8.139219,4.55948,7.292052],[8.139219,1.840521,0.607948],[8.139219,1.840521,7.292052],[8.139219,4.55948,0.607948],[8.139219,4.55948,7.292052]],"colors":[[0,0,0,1]],"centers":[[4.060781,3.2,0.607948],[4.060781,3.2,7.292052],[4.060781,1.840521,3.95],[4.060781,4.55948,3.95],[6.1,1.840521,0.607948],[6.1,1.840521,7.292052],[6.1,4.55948,0.607948],[6.1,4.55948,7.292052],[8.139219,3.2,0.607948],[8.139219,3.2,7.292052],[8.139219,1.840521,3.95],[8.139219,4.55948,3.95]],"ignoreExtent":true,"origId":184,"flags":64}},"width":481,"height":481,"sphereVerts":{"reuse":"togglediv"}});
vertexrgl.prefix = "vertex";
</script>
<p id="vertexdebug">
You must enable Javascript to view this page properly.
</p>
<script>vertexrgl.start();</script>
<pre class="sourceCode r"><code class="sourceCode r">setosa &lt;-<span class="st"> </span><span class="kw">subset</span>(iris, Species ==<span class="st"> &quot;setosa&quot;</span>)
which &lt;-<span class="st"> </span><span class="kw">which.min</span>(setosa$Sepal.Width)
init &lt;-<span class="st"> </span>setosa$Sepal.Length[which]
<span class="kw">propertySlider</span>(
    <span class="kw">vertexSetter</span>(<span class="dt">values =</span> <span class="kw">matrix</span>(<span class="kw">c</span>(init,<span class="dv">8</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">nrow=</span><span class="dv">2</span>),
                 <span class="dt">attributes=</span><span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;r&quot;</span>, <span class="st">&quot;g&quot;</span>, <span class="st">&quot;b&quot;</span>), 
             <span class="dt">vertices =</span> which, <span class="dt">objid =</span> sphereid, 
             <span class="dt">prefix =</span> <span class="st">&quot;vertex&quot;</span>), 
    <span class="dt">step=</span><span class="fl">0.01</span>)</code></pre>
<script>vertexrgl.inputedc77e680f7a = function(value){
  if (typeof vertexrgl.drawScene === "undefined")
    return;
  var busy = (typeof vertexrgl.inputedc77e680f7a.busy !== "undefined"),
      lvalue, labels;
  try {
    vertexrgl.inputedc77e680f7a.busy = value;
    if (busy) return;
    do {
       (function(value){
  var ofs, values = [4.5,0,0,0,4.5,0,0,0,8,1,1,1,8,1,1,1],
  propvals = vertexrgl.getObj(181).values,
  stride = vertexrgl.getObj(181).vOffsets.stride;
  var p, v1, v2, svals = [-Infinity, 1,2, Infinity];
  for (var i = 1; i < svals.length; i++)
    if (value <= svals[i]) {
      p = (svals[i] - value)/(svals[i] - svals[i-1]);
  ofs = vertexrgl.getObj(181).vOffsets.vofs;
  if (ofs < 0)
    alert("Attribute x not found in object 181");
  v1 = values[4*(i-1)];
  v2 = values[4*i];
  propvals[41*stride + ofs] = p*v1 + (1-p)*v2;
  ofs = vertexrgl.getObj(181).vOffsets.cofs;
  if (ofs < 0)
    alert("Attribute r not found in object 181");
  v1 = values[4*(i-1)+1];
  v2 = values[4*i+1];
  propvals[41*stride + ofs] = p*v1 + (1-p)*v2;
  ofs = vertexrgl.getObj(181).vOffsets.cofs;
  if (ofs < 0)
    alert("Attribute g not found in object 181");
  ofs = ofs + 1;
  v1 = values[4*(i-1)+2];
  v2 = values[4*i+2];
  propvals[41*stride + ofs] = p*v1 + (1-p)*v2;
  ofs = vertexrgl.getObj(181).vOffsets.cofs;
  if (ofs < 0)
    alert("Attribute b not found in object 181");
  ofs = ofs + 2;
  v1 = values[4*(i-1)+3];
  v2 = values[4*i+3];
  propvals[41*stride + ofs] = p*v1 + (1-p)*v2;
       break;
  }
  vertexrgl.getObj(181).values = propvals;
  if (typeof vertexrgl.getObj(181).buf !== "undefined") {
    var gl = vertexrgl.gl;
    gl.bindBuffer(gl.ARRAY_BUFFER, vertexrgl.getObj(181).buf);
    gl.bufferData(gl.ARRAY_BUFFER, vertexrgl.getObj(181).values, gl.STATIC_DRAW);
  }
})(value);
       vertexrgl.drawScene();
       lvalue = Math.round((value - 1)/0.01);
       labels = ['1','1.01','1.02','1.03','1.04','1.05','1.06','1.07','1.08','1.09','1.1','1.11','1.12','1.13','1.14','1.15','1.16','1.17','1.18','1.19','1.2','1.21','1.22','1.23','1.24','1.25','1.26','1.27','1.28','1.29','1.3','1.31','1.32','1.33','1.34','1.35','1.36','1.37','1.38','1.39','1.4','1.41','1.42','1.43','1.44','1.45','1.46','1.47','1.48','1.49','1.5','1.51','1.52','1.53','1.54','1.55','1.56','1.57','1.58','1.59','1.6','1.61','1.62','1.63','1.64','1.65','1.66','1.67','1.68','1.69','1.7','1.71','1.72','1.73','1.74','1.75','1.76','1.77','1.78','1.79','1.8','1.81','1.82','1.83','1.84','1.85','1.86','1.87','1.88','1.89','1.9','1.91','1.92','1.93','1.94','1.95','1.96','1.97','1.98','1.99','2']; 
  label = document.getElementById('inputedc77e680f7atext');
  if (label !== null) label.value = labels[lvalue];
     } while (vertexrgl.inputedc77e680f7a.busy !== value);
  }
  finally {
    if (!busy)
      vertexrgl.inputedc77e680f7a.busy = undefined;
  }
};
vertexrgl.inputedc77e680f7a(1);</script>
<input type="range" min="1" max="2" step="0.01" value="1" id="inputedc77e680f7a" name="inputedc77e680f7a" oninput="vertexrgl.inputedc77e680f7a(this.valueAsNumber)">
<output id="inputedc77e680f7atext" for="inputedc77e680f7a">
1
</output>
<p>A related function is <a name="ageSetter"><a href="../../rgl/help/ageSetter"><code>ageSetter</code></a></a>, though it uses a very different specification of the attributes. It is used when the slider controls the age of the scene, and attributes of vertices change with their age.</p>
<p>Rather than giving an example, we will illustrate the very similar function <a name="ageControl"><a href="../../rgl/help/ageControl"><code>ageControl</code></a></a>, embedded in a <a name="playwidget"><a href="../../rgl/help/playwidget"><code>playwidget</code></a></a>. We will show a point moving along a curve. In the original scene we need to specify multiple colours so that the colour is not fixed, and can be controlled by the slider. We also give two <code>ageControl</code> calls in a list;</p>
<pre class="sourceCode r"><code class="sourceCode r">time &lt;-<span class="st"> </span><span class="dv">0</span>:<span class="dv">500</span>
xyz &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">cos</span>(time/<span class="dv">20</span>), <span class="kw">sin</span>(time/<span class="dv">10</span>), time)
lineid &lt;-<span class="st"> </span><span class="kw">plot3d</span>(xyz, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;black&quot;</span>))[<span class="st">&quot;data&quot;</span>]
sphereid &lt;-<span class="st"> </span><span class="kw">spheres3d</span>(xyz[<span class="dv">1</span>, , <span class="dt">drop=</span><span class="ot">FALSE</span>], <span class="dt">radius =</span> <span class="dv">8</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)
<span class="kw">rglwidget</span>(<span class="dt">elementId =</span> <span class="st">&quot;ageExample&quot;</span>)</code></pre>
<div id="ageExample" style="width:480px;height:480px;" class="rglWebGL html-widget"></div>
<script type="application/json" data-for="ageExample">{"x":{"material":{"color":"#000000","alpha":1,"lit":true,"ambient":"#000000","specular":"#FFFFFF","emission":"#000000","shininess":50,"smooth":true,"front":"filled","back":"filled","size":3,"lwd":1,"fog":false,"point_antialias":false,"line_antialias":false,"texture":null,"textype":"rgb","texmipmap":false,"texminfilter":"linear","texmagfilter":"linear","texenvmap":false,"depth_mask":true,"depth_test":"less","isTransparent":false},"rootSubscene":175,"objects":{"244":{"id":244,"type":"linestrip","material":{"lit":false},"vertices":[[1,0,0],[0.998750269412994,0.0998334139585495,1],[0.995004177093506,0.198669329285622,2],[0.988771080970764,0.295520216226578,3],[0.9800665974617,0.389418333768845,4],[0.968912422657013,0.479425549507141,5],[0.955336511135101,0.564642488956451,6],[0.939372718334198,0.644217669963837,7],[0.921060979366302,0.717356085777283,8],[0.900447130203247,0.783326923847198,9],[0.877582550048828,0.841470956802368,10],[0.852524518966675,0.891207337379456,11],[0.825335621833801,0.932039082050323,12],[0.796083807945251,0.963558197021484,13],[0.764842212200165,0.985449731349945,14],[0.731688857078552,0.997494995594025,15],[0.696706712245941,0.999573588371277,16],[0.659983158111572,0.991664826869965,17],[0.6216099858284,0.973847627639771,18],[0.581683099269867,0.946300089359283,19],[0.540302276611328,0.909297406673431,20],[0.497571051120758,0.863209366798401,21],[0.453596115112305,0.808496415615082,22],[0.408487439155579,0.745705187320709,23],[0.362357765436172,0.675463199615479,24],[0.315322369337082,0.598472118377686,25],[0.267498821020126,0.515501379966736,26],[0.219006687402725,0.427379876375198,27],[0.169967144727707,0.33498814702034,28],[0.120502769947052,0.239249333739281,29],[0.0707371979951859,0.141120001673698,30],[0.020794827491045,0.0415806621313095,31],[-0.0291995219886303,-0.0583741441369057,32],[-0.0791208893060684,-0.157745689153671,33],[-0.128844499588013,-0.255541115999222,34],[-0.178246051073074,-0.350783228874207,35],[-0.227202087640762,-0.442520439624786,36],[-0.275590240955353,-0.529836118221283,37],[-0.323289573192596,-0.611857891082764,38],[-0.37018084526062,-0.687766134738922,39],[-0.416146844625473,-0.756802499294281,40],[-0.461072683334351,-0.81827712059021,41],[-0.504846096038818,-0.871575772762299,42],[-0.547357678413391,-0.916165947914124,43],[-0.58850109577179,-0.951602101325989,44],[-0.628173649311066,-0.977530121803284,45],[-0.666276037693024,-0.993691027164459,46],[-0.702713072299957,-0.999923229217529,47],[-0.737393736839294,-0.996164619922638,48],[-0.770231246948242,-0.982452630996704,49],[-0.80114358663559,-0.958924293518066,50],[-0.830053508281708,-0.925814688205719,51],[-0.856888771057129,-0.88345468044281,52],[-0.881582200527191,-0.832267463207245,53],[-0.904072165489197,-0.772764503955841,54],[-0.924302399158478,-0.705540299415588,55],[-0.942222356796265,-0.63126665353775,56],[-0.957787215709686,-0.550685524940491,57],[-0.970958173274994,-0.464602172374725,58],[-0.981702208518982,-0.373876661062241,59],[-0.989992499351501,-0.279415488243103,60],[-0.995808303356171,-0.182162508368492,61],[-0.999135136604309,-0.0830894038081169,62],[-0.999964654445648,0.016813900321722,63],[-0.998294770717621,0.116549201309681,64],[-0.994129657745361,0.215119987726212,65],[-0.987479746341705,0.311541348695755,66],[-0.978361666202545,0.404849916696548,67],[-0.966798186302185,0.494113355875015,68],[-0.952818214893341,0.578439772129059,69],[-0.936456680297852,0.656986594200134,70],[-0.917754530906677,0.728969037532806,71],[-0.896758437156677,0.793667852878571,72],[-0.873520910739899,0.850436627864838,73],[-0.848100006580353,0.89870810508728,74],[-0.82055938243866,0.937999963760376,75],[-0.790967702865601,0.967919647693634,76],[-0.759399056434631,0.988168239593506,77],[-0.72593230009079,0.998543322086334,78],[-0.690651118755341,0.998941361904144,79],[-0.653643608093262,0.989358246326447,80],[-0.615002393722534,0.96988981962204,81],[-0.574823975563049,0.940730571746826,82],[-0.533208727836609,0.902171850204468,83],[-0.490260809659958,0.854598879814148,84],[-0.44608747959137,0.79848712682724,85],[-0.400799185037613,0.734397113323212,86],[-0.354509055614471,0.66296923160553,87],[-0.307332873344421,0.584917187690735,88],[-0.259388506412506,0.501020848751068,89],[-0.210795804858208,0.412118494510651,90],[-0.161676213145256,0.319098353385925,91],[-0.112152524292469,0.222889915108681,92],[-0.0623485147953033,0.12445442378521,93],[-0.012388663366437,0.0247754249721766,94],[0.0376021526753902,-0.0751511231064796,95],[0.0874989852309227,-0.174326777458191,96],[0.137177109718323,-0.271760612726212,97],[0.186512365937233,-0.366479128599167,98],[0.235381439328194,-0.457535892724991,99],[0.28366219997406,-0.544021129608154,100],[0.33123391866684,-0.625070631504059,101],[0.377977728843689,-0.699874699115753,102],[0.423776805400848,-0.767685830593109,103],[0.468516677618027,-0.82782644033432,104],[0.512085497379303,-0.879695773124695,105],[0.55437433719635,-0.922775447368622,106],[0.595277547836304,-0.956634998321533,107],[0.634692847728729,-0.980936229228973,108],[0.672521829605103,-0.995436251163483,109],[0.708669781684875,-0.999990224838257,110],[0.743046462535858,-0.994552612304688,111],[0.77556586265564,-0.979177713394165,112],[0.806146800518036,-0.954019248485565,113],[0.8347128033638,-0.919328510761261,114],[0.861192405223846,-0.875452160835266,115],[0.885519504547119,-0.822828590869904,116],[0.907633304595947,-0.761983573436737,117],[0.927478432655334,-0.693525075912476,118],[0.945005357265472,-0.618137121200562,119],[0.960170269012451,-0.536572933197021,120],[0.972935259342194,-0.449647456407547,121],[0.983268439769745,-0.358229279518127,122],[0.991143941879272,-0.263231784105301,123],[0.996542096138,-0.165604174137115,124],[0.99944943189621,-0.0663218945264816,125],[0.999858617782593,0.0336230471730232,126],[0.997768700122833,0.133232042193413,127],[0.993184924125671,0.231509819626808,128],[0.986118674278259,0.327474445104599,129],[0.976587653160095,0.420167028903961,130],[0.964615643024445,0.508661448955536,131],[0.950232565402985,0.592073500156403,132],[0.933474481105804,0.669569790363312,133],[0.914383172988892,0.740375876426697,134],[0.893006324768066,0.803784430027008,135],[0.869397461414337,0.859161794185638,136],[0.843615591526031,0.905954718589783,137],[0.815725088119507,0.943695664405823,138],[0.78579568862915,0.972007513046265,139],[0.7539022564888,0.990607380867004,140],[0.720124423503876,0.999309360980988,141],[0.684546649456024,0.998026669025421,142],[0.647257924079895,0.986771941184998,143],[0.608351290225983,0.965657770633698,144],[0.567924201488495,0.934895038604736,145],[0.526077508926392,0.894791185855865,146],[0.482915937900543,0.84574681520462,147],[0.438547313213348,0.788252055644989,148],[0.393082559108734,0.722881376743317,149],[0.346635311841965,0.650287866592407,150],[0.29932165145874,0.571196854114532,151],[0.251259833574295,0.486398696899414,152],[0.202570006251335,0.396740585565567,153],[0.153373867273331,0.303118348121643,154],[0.103794358670712,0.206467479467392,155],[0.0539554208517075,0.107753649353981,156],[0.00398162333294749,0.00796318333595991,157],[-0.0460021272301674,-0.0919068530201912,158],[-0.0958708897233009,-0.190858587622643,159],[-0.145500034093857,-0.287903308868408,160],[-0.194765493273735,-0.382071405649185,161],[-0.243544146418571,-0.47242197394371,162],[-0.291714072227478,-0.558052241802216,163],[-0.339154869318008,-0.63810670375824,164],[-0.385747939348221,-0.711785316467285,165],[-0.431376844644547,-0.778352081775665,166],[-0.475927531719208,-0.837141752243042,167],[-0.519288659095764,-0.887567043304443,168],[-0.561351835727692,-0.929123997688293,169],[-0.602011919021606,-0.961397469043732,170],[-0.641167283058167,-0.984064996242523,171],[-0.678720057010651,-0.996900081634521,172],[-0.714576363563538,-0.99977445602417,173],[-0.74864661693573,-0.992659389972687,174],[-0.780845701694489,-0.975625991821289,175],[-0.811093032360077,-0.948844492435455,176],[-0.83931303024292,-0.912582457065582,177],[-0.865435183048248,-0.867202162742615,178],[-0.889394223690033,-0.813157141208649,179],[-0.911130249500275,-0.750987231731415,180],[-0.930588901042938,-0.681313753128052,181],[-0.947721600532532,-0.604832828044891,182],[-0.962485492229462,-0.522308588027954,183],[-0.974843621253967,-0.434565633535385,184],[-0.9847651720047,-0.342480629682541,185],[-0.992225348949432,-0.246973663568497,186],[-0.997205436229706,-0.148999020457268,187],[-0.999693036079407,-0.0495356395840645,188],[-0.999681949615479,0.0504226870834827,189],[-0.997172176837921,0.149877205491066,190],[-0.992169976234436,0.247834205627441,191],[-0.984687864780426,0.343314915895462,192],[-0.974744558334351,0.435365349054337,193],[-0.962364852428436,0.523065745830536,194],[-0.947579801082611,0.605539858341217,195],[-0.930426299571991,0.681963622570038,196],[-0.910947144031525,0.751573443412781,197],[-0.889191150665283,0.813673734664917,198],[-0.865212619304657,0.867644071578979,199],[-0.83907151222229,0.91294527053833,200],[-0.810833156108856,0.949124574661255,201],[-0.780568182468414,0.975820541381836,202],[-0.74835216999054,0.992766380310059,203],[-0.714265644550323,0.999792873859406,204],[-0.678393840789795,0.996829807758331,205],[-0.640826404094696,0.983906686306,206],[-0.601657271385193,0.961152732372284,207],[-0.560984253883362,0.928795218467712,208],[-0.518909096717834,0.887157499790192,209],[-0.475536942481995,0.836655616760254,210],[-0.430976182222366,0.777794182300568,211],[-0.385338187217712,0.711161196231842,212],[-0.338737070560455,0.637422621250153,213],[-0.291289269924164,0.557315051555634,214],[-0.243113428354263,0.471639007329941,215],[-0.194329902529716,0.381250500679016,216],[-0.145060673356056,0.287052661180496,217],[-0.095428854227066,0.189986675977707,218],[-0.0455585122108459,0.0910224169492722,219],[0.00442569795995951,-0.00885130930691957,220],[0.0543988458812237,-0.108636595308781,221],[0.104236029088497,-0.20733642578125,222],[0.153812676668167,-0.303964614868164,223],[0.203004866838455,-0.39755567908287,224],[0.25168964266777,-0.487174510955811,225],[0.299745351076126,-0.571925640106201,226],[0.347051829099655,-0.650962293148041,227],[0.393490880727768,-0.7234947681427,228],[0.438946396112442,-0.788798272609711,229],[0.483304768800735,-0.846220433712006,230],[0.526455104351044,-0.895187377929688,231],[0.568289637565613,-0.935209929943085,232],[0.60870373249054,-0.965888142585754,233],[0.64759635925293,-0.986915528774261,234],[0.684870302677155,-0.998082041740417,235],[0.720432460308075,-0.999275982379913,236],[0.754193961620331,-0.990485548973083,237],[0.786070287227631,-0.971798419952393,238],[0.815981864929199,-0.943401455879211,239],[0.843853950500488,-0.905578374862671,240],[0.869616806507111,-0.858707010746002,241],[0.893206119537354,-0.80325573682785,242],[0.914562821388245,-0.739778578281403,243],[0.933633625507355,-0.668909847736359,244],[0.950370848178864,-0.591357529163361,245],[0.964732646942139,-0.507896602153778,246],[0.976683080196381,-0.419360905885696,247],[0.986192286014557,-0.326635122299194,248],[0.993236601352692,-0.230645701289177,249],[0.997798264026642,-0.132351756095886,250],[0.999866008758545,-0.0327353775501251,251],[0.999434590339661,0.0672080740332603,252],[0.996505081653595,0.166480004787445,253],[0.9910848736763,0.26408851146698,254],[0.983187437057495,0.359058350324631,255],[0.972832560539246,0.450440585613251,256],[0.960046112537384,0.537322163581848,257],[0.94486004114151,0.618835031986237,258],[0.927312314510345,0.69416469335556,259],[0.907446801662445,0.762558460235596,260],[0.885313093662262,0.823333024978638,261],[0.860966622829437,0.87588107585907,262],[0.834468126296997,0.91967761516571,263],[0.805883944034576,0.954285085201263,264],[0.775285482406616,0.979357659816742,265],[0.742749154567719,0.99464476108551,266],[0.708356380462646,0.999993741512299,267],[0.672193109989166,0.995351076126099,268],[0.634349644184113,0.980763256549835,269],[0.594920635223389,0.956375956535339,270],[0.554004669189453,0.922432839870453,271],[0.511703968048096,0.879273056983948,272],[0.46812430024147,0.827327907085419,273],[0.423374533653259,0.767116367816925,274],[0.377566576004028,0.699240028858185,275],[0.330814868211746,0.624377131462097,276],[0.28323632478714,0.543275654315948,277],[0.234949812293053,0.456745982170105,278],[0.186076059937477,0.365652620792389,279],[0.136737212538719,0.270905792713165,280],[0.0870565995573997,0.173452153801918,281],[0.0371583849191666,0.0742654427886009,282],[-0.0128327067941427,-0.0256632994860411,283],[-0.062791720032692,-0.125335618853569,284],[-0.112593792378902,-0.223755642771721,285],[-0.162114441394806,-0.319939970970154,286],[-0.211229875683784,-0.412927538156509,287],[-0.259817361831665,-0.501789271831512,288],[-0.307755440473557,-0.585637331008911,289],[-0.354924261569977,-0.66363388299942,290],[-0.401205986738205,-0.734999597072601,291],[-0.44648489356041,-0.799021482467651,292],[-0.490647822618484,-0.855059802532196,293],[-0.533584415912628,-0.902554631233215,294],[-0.575187265872955,-0.941031396389008,295],[-0.615352511405945,-0.970105707645416,296],[-0.653979659080505,-0.989487111568451,297],[-0.690972208976746,-0.998981833457947,298],[-0.726237654685974,-0.998495042324066,299],[-0.759687900543213,-0.988031625747681,300],[-0.791239321231842,-0.967696130275726,301],[-0.820813119411469,-0.937691748142242,302],[-0.848335266113281,-0.898318231105804,303],[-0.873736977577209,-0.849969029426575,304],[-0.896954834461212,-0.793127238750458,305],[-0.917930781841278,-0.728360772132874,306],[-0.936612367630005,-0.656316757202148,307],[-0.952952921390533,-0.577715039253235,308],[-0.966911554336548,-0.493340998888016,309],[-0.978453457355499,-0.404037654399872,310],[-0.987549722194672,-0.310697287321091,311],[-0.994177639484406,-0.214252546429634,312],[-0.998320579528809,-0.115667052567005,313],[-0.999968290328979,-0.0159258618950844,314],[-0.999116599559784,0.0839744582772255,315],[-0.995767593383789,0.183035731315613,316],[-0.989929735660553,0.280268162488937,317],[-0.981617569923401,0.374700278043747,318],[-0.970851838588715,0.465388476848602,319],[-0.957659482955933,0.551426708698273,320],[-0.942073464393616,0.631955206394196,321],[-0.924132823944092,0.706169486045837,322],[-0.903882265090942,0.773327887058258,323],[-0.881372511386871,0.832759499549866,324],[-0.856659770011902,0.883870422840118,325],[-0.829805791378021,0.926150023937225,326],[-0.800877749919891,0.959175825119019,327],[-0.769947946071625,0.982617855072021,328],[-0.737093687057495,0.996241927146912,329],[-0.702397048473358,0.999911844730377,330],[-0.665944814682007,0.993591010570526,331],[-0.627828061580658,0.977342486381531,332],[-0.588142037391663,0.951328754425049,333],[-0.546985983848572,0.915809631347656,334],[-0.504462718963623,0.871140003204346,335],[-0.460678577423096,0.81776624917984,336],[-0.415742993354797,0.756221652030945,337],[-0.369768261909485,0.687121152877808,338],[-0.322869300842285,0.611155152320862,339],[-0.275163352489471,0.529082715511322,340],[-0.226769611239433,0.441723793745041,341],[-0.177809074521065,0.349951356649399,342],[-0.12840411067009,0.254682332277298,343],[-0.078678198158741,0.15686859190464,344],[-0.0287556294351816,0.0574874766170979,345],[0.0212388075888157,-0.0424680337309837,346],[0.0711801573634148,-0.141999214887619,347],[0.12094359844923,-0.240111604332924,348],[0.170404747128487,-0.335824847221375,349],[0.219439968466759,-0.428182661533356,350],[0.267926692962646,-0.516262233257294,351],[0.315743744373322,-0.599183440208435,352],[0.36277163028717,-0.676117837429047,353],[0.408892750740051,-0.74629670381546,354],[0.453991830348969,-0.809018790721893,355],[0.497956216335297,-0.863657414913177,356],[0.540675938129425,-0.909666657447815,357],[0.582044243812561,-0.946586847305298,358],[0.621957778930664,-0.974049031734467,359],[0.660316705703735,-0.99177885055542,360],[0.697025179862976,-0.999599158763885,361],[0.731991469860077,-0.997431755065918,362],[0.765128195285797,-0.98529839515686,363],[0.796352446079254,-0.963320195674896,364],[0.825586259365082,-0.931716859340668,365],[0.852756559848785,-0.890804171562195,366],[0.877795398235321,-0.840990781784058,367],[0.900640189647675,-0.78277450799942,368],[0.921233832836151,-0.716737031936646,369],[0.93952488899231,-0.643538117408752,370],[0.955467641353607,-0.563909232616425,371],[0.969022214412689,-0.478645920753479,372],[0.980154693126678,-0.388600140810013,373],[0.988837361335754,-0.294671595096588,374],[0.995048403739929,-0.197798803448677,375],[0.998772382736206,-0.0989496558904648,376],[0.99999988079071,0.000888156821019948,377],[0.998727977275848,0.100717097520828,378],[0.994959712028503,0.199539706110954,379],[0.98870462179184,0.296368569135666,380],[0.979978263378143,0.390236228704453,381],[0.968802452087402,0.480204790830612,382],[0.955205142498016,0.56537526845932,383],[0.939220368862152,0.644896745681763,384],[0.92088794708252,0.717974603176117,385],[0.90025383234024,0.783878684043884,386],[0.877369582653046,0.841950535774231,387],[0.85229229927063,0.891609847545624,388],[0.825084805488586,0.932360529899597,389],[0.795814990997314,0.963795363903046,390],[0.764556050300598,0.985600292682648,391],[0.731386125087738,0.997557401657104,392],[0.696388065814972,0.999547302722931,393],[0.659649431705475,0.991549968719482,394],[0.621262073516846,0.973645448684692,395],[0.581321835517883,0.946012556552887,396],[0.539928555488586,0.908927440643311,397],[0.497185796499252,0.862760663032532,398],[0.453200310468674,0.807973384857178,399],[0.408082067966461,0.745113134384155,400],[0.361943811178207,0.674807965755463,401],[0.314900904893875,0.597760379314423,402],[0.267070919275284,0.514740109443665,403],[0.218573361635208,0.426576763391495,404],[0.169529512524605,0.334151178598404,405],[0.120061911642551,0.238386869430542,406],[0.0702942311763763,0.140240684151649,407],[0.020350843667984,0.0406932570040226,408],[-0.0296434089541435,-0.0592607632279396,409],[-0.0795635655522346,-0.158622667193413,410],[-0.129284858703613,-0.256399661302567,411],[-0.178682997822762,-0.35161480307579,412],[-0.227634534239769,-0.443316727876663,413],[-0.276017099618912,-0.530589163303375,414],[-0.323709756135941,-0.612560153007507,415],[-0.370593339204788,-0.688410639762878,416],[-0.416550606489182,-0.757382750511169,417],[-0.461466699838638,-0.818787336349487,418],[-0.505229413509369,-0.872010886669159,419],[-0.547729253768921,-0.916521549224854,420],[-0.588860094547272,-0.951874673366547,421],[-0.628519058227539,-0.97771692276001,422],[-0.666607081890106,-0.993790209293365,423],[-0.703028976917267,-0.999933838844299,424],[-0.737693607807159,-0.996086478233337,425],[-0.770514369010925,-0.98228657245636,426],[-0.801409304141998,-0.958671987056732,427],[-0.830301105976105,-0.925478637218475,428],[-0.857117593288422,-0.88303816318512,429],[-0.881791710853577,-0.831774771213531,430],[-0.904261827468872,-0.772200465202332,431],[-0.924471795558929,-0.704910635948181,432],[-0.942371010780334,-0.630577564239502,433],[-0.95791482925415,-0.54994398355484,434],[-0.971064329147339,-0.46381551027298,435],[-0.981786668300629,-0.373052775859833,436],[-0.990055084228516,-0.278562605381012,437],[-0.995848834514618,-0.18128913640976,438],[-0.9991534948349,-0.082204282283783,439],[-0.999960839748383,0.0177019257098436,440],[-0.998268783092499,0.11743126064539,441],[-0.994081556797028,0.215987265110016,442],[-0.987409591674805,0.312385201454163,443],[-0.978269696235657,0.405661880970001,444],[-0.966684639453888,0.494885325431824,445],[-0.952683329582214,0.579164028167725,446],[-0.936300814151764,0.657655894756317,447],[-0.917578041553497,0.729576766490936,448],[-0.896561801433563,0.794207870960236,449],[-0.873304665088654,0.850903511047363,450],[-0.84786468744278,0.899097263813019,451],[-0.820305466651917,0.938307464122772,452],[-0.790695905685425,0.968142449855804,453],[-0.759110033512115,0.988304078578949,454],[-0.725626826286316,0.998590886592865,455],[-0.690329849720001,0.99890011548996,456],[-0.653307497501373,0.98922860622406,457],[-0.614652156829834,0.969673097133636,458],[-0.574460506439209,0.940428972244263,459],[-0.53283303976059,0.901788353919983,460],[-0.489873737096786,0.854137361049652,461],[-0.445690006017685,0.797952115535736,462],[-0.400392293930054,0.733793973922729,463],[-0.354093790054321,0.662304043769836,464],[-0.306910246610641,0.5841965675354,465],[-0.258959591388702,0.50025200843811,466],[-0.210361674427986,0.411309093236923,467],[-0.161237969994545,0.318256497383118,468],[-0.111711241304874,0.222024008631706,469],[-0.0619052946567535,0.123573124408722,470],[-0.011944618076086,0.0238875318318605,471],[0.0380459129810333,-0.076036736369133,472],[0.0879413485527039,-0.175201267004013,473],[0.137616977095604,-0.272615253925323,474],[0.186948642134666,-0.367305338382721,475],[0.235813021659851,-0.458325445652008,476],[0.284087985754013,-0.544766128063202,477],[0.331652909517288,-0.625763654708862,478],[0.378388851881027,-0.700508773326874,479],[0.424179017543793,-0.768254637718201,480],[0.468908935785294,-0.828324377536774,481],[0.512466847896576,-0.880117774009705,482],[0.554743885993958,-0.923117280006409,483],[0.595634341239929,-0.95689332485199,484],[0.635035991668701,-0.981108427047729,485],[0.672850370407104,-0.99552059173584,486],[0.70898300409317,-0.999985873699188,487],[0.743343591690063,-0.994459629058838,488],[0.775846123695374,-0.978997051715851,489],[0.806409478187561,-0.953752636909485,490],[0.834957242012024,-0.918978691101074,491],[0.861418068408966,-0.87502259016037,492],[0.885725736618042,-0.822323560714722,493],[0.90781956911087,-0.761408090591431,494],[0.927644371986389,-0.692884981632233,495],[0.9451504945755,-0.617438733577728,496],[0.960294246673584,-0.535823225975037,497],[0.973037779331207,-0.448853969573975,498],[0.98334926366806,-0.357399940490723,499],[0.991202831268311,-0.262374848127365,500]],"colors":[[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1]],"centers":[[1,0,0],[0.998750269412994,0.0998334139585495,1],[0.995004177093506,0.198669329285622,2],[0.988771080970764,0.295520216226578,3],[0.9800665974617,0.389418333768845,4],[0.968912422657013,0.479425549507141,5],[0.955336511135101,0.564642488956451,6],[0.939372718334198,0.644217669963837,7],[0.921060979366302,0.717356085777283,8],[0.900447130203247,0.783326923847198,9],[0.877582550048828,0.841470956802368,10],[0.852524518966675,0.891207337379456,11],[0.825335621833801,0.932039082050323,12],[0.796083807945251,0.963558197021484,13],[0.764842212200165,0.985449731349945,14],[0.731688857078552,0.997494995594025,15],[0.696706712245941,0.999573588371277,16],[0.659983158111572,0.991664826869965,17],[0.6216099858284,0.973847627639771,18],[0.581683099269867,0.946300089359283,19],[0.540302276611328,0.909297406673431,20],[0.497571051120758,0.863209366798401,21],[0.453596115112305,0.808496415615082,22],[0.408487439155579,0.745705187320709,23],[0.362357765436172,0.675463199615479,24],[0.315322369337082,0.598472118377686,25],[0.267498821020126,0.515501379966736,26],[0.219006687402725,0.427379876375198,27],[0.169967144727707,0.33498814702034,28],[0.120502769947052,0.239249333739281,29],[0.0707371979951859,0.141120001673698,30],[0.020794827491045,0.0415806621313095,31],[-0.0291995219886303,-0.0583741441369057,32],[-0.0791208893060684,-0.157745689153671,33],[-0.128844499588013,-0.255541115999222,34],[-0.178246051073074,-0.350783228874207,35],[-0.227202087640762,-0.442520439624786,36],[-0.275590240955353,-0.529836118221283,37],[-0.323289573192596,-0.611857891082764,38],[-0.37018084526062,-0.687766134738922,39],[-0.416146844625473,-0.756802499294281,40],[-0.461072683334351,-0.81827712059021,41],[-0.504846096038818,-0.871575772762299,42],[-0.547357678413391,-0.916165947914124,43],[-0.58850109577179,-0.951602101325989,44],[-0.628173649311066,-0.977530121803284,45],[-0.666276037693024,-0.993691027164459,46],[-0.702713072299957,-0.999923229217529,47],[-0.737393736839294,-0.996164619922638,48],[-0.770231246948242,-0.982452630996704,49],[-0.80114358663559,-0.958924293518066,50],[-0.830053508281708,-0.925814688205719,51],[-0.856888771057129,-0.88345468044281,52],[-0.881582200527191,-0.832267463207245,53],[-0.904072165489197,-0.772764503955841,54],[-0.924302399158478,-0.705540299415588,55],[-0.942222356796265,-0.63126665353775,56],[-0.957787215709686,-0.550685524940491,57],[-0.970958173274994,-0.464602172374725,58],[-0.981702208518982,-0.373876661062241,59],[-0.989992499351501,-0.279415488243103,60],[-0.995808303356171,-0.182162508368492,61],[-0.999135136604309,-0.0830894038081169,62],[-0.999964654445648,0.016813900321722,63],[-0.998294770717621,0.116549201309681,64],[-0.994129657745361,0.215119987726212,65],[-0.987479746341705,0.311541348695755,66],[-0.978361666202545,0.404849916696548,67],[-0.966798186302185,0.494113355875015,68],[-0.952818214893341,0.578439772129059,69],[-0.936456680297852,0.656986594200134,70],[-0.917754530906677,0.728969037532806,71],[-0.896758437156677,0.793667852878571,72],[-0.873520910739899,0.850436627864838,73],[-0.848100006580353,0.89870810508728,74],[-0.82055938243866,0.937999963760376,75],[-0.790967702865601,0.967919647693634,76],[-0.759399056434631,0.988168239593506,77],[-0.72593230009079,0.998543322086334,78],[-0.690651118755341,0.998941361904144,79],[-0.653643608093262,0.989358246326447,80],[-0.615002393722534,0.96988981962204,81],[-0.574823975563049,0.940730571746826,82],[-0.533208727836609,0.902171850204468,83],[-0.490260809659958,0.854598879814148,84],[-0.44608747959137,0.79848712682724,85],[-0.400799185037613,0.734397113323212,86],[-0.354509055614471,0.66296923160553,87],[-0.307332873344421,0.584917187690735,88],[-0.259388506412506,0.501020848751068,89],[-0.210795804858208,0.412118494510651,90],[-0.161676213145256,0.319098353385925,91],[-0.112152524292469,0.222889915108681,92],[-0.0623485147953033,0.12445442378521,93],[-0.012388663366437,0.0247754249721766,94],[0.0376021526753902,-0.0751511231064796,95],[0.0874989852309227,-0.174326777458191,96],[0.137177109718323,-0.271760612726212,97],[0.186512365937233,-0.366479128599167,98],[0.235381439328194,-0.457535892724991,99],[0.28366219997406,-0.544021129608154,100],[0.33123391866684,-0.625070631504059,101],[0.377977728843689,-0.699874699115753,102],[0.423776805400848,-0.767685830593109,103],[0.468516677618027,-0.82782644033432,104],[0.512085497379303,-0.879695773124695,105],[0.55437433719635,-0.922775447368622,106],[0.595277547836304,-0.956634998321533,107],[0.634692847728729,-0.980936229228973,108],[0.672521829605103,-0.995436251163483,109],[0.708669781684875,-0.999990224838257,110],[0.743046462535858,-0.994552612304688,111],[0.77556586265564,-0.979177713394165,112],[0.806146800518036,-0.954019248485565,113],[0.8347128033638,-0.919328510761261,114],[0.861192405223846,-0.875452160835266,115],[0.885519504547119,-0.822828590869904,116],[0.907633304595947,-0.761983573436737,117],[0.927478432655334,-0.693525075912476,118],[0.945005357265472,-0.618137121200562,119],[0.960170269012451,-0.536572933197021,120],[0.972935259342194,-0.449647456407547,121],[0.983268439769745,-0.358229279518127,122],[0.991143941879272,-0.263231784105301,123],[0.996542096138,-0.165604174137115,124],[0.99944943189621,-0.0663218945264816,125],[0.999858617782593,0.0336230471730232,126],[0.997768700122833,0.133232042193413,127],[0.993184924125671,0.231509819626808,128],[0.986118674278259,0.327474445104599,129],[0.976587653160095,0.420167028903961,130],[0.964615643024445,0.508661448955536,131],[0.950232565402985,0.592073500156403,132],[0.933474481105804,0.669569790363312,133],[0.914383172988892,0.740375876426697,134],[0.893006324768066,0.803784430027008,135],[0.869397461414337,0.859161794185638,136],[0.843615591526031,0.905954718589783,137],[0.815725088119507,0.943695664405823,138],[0.78579568862915,0.972007513046265,139],[0.7539022564888,0.990607380867004,140],[0.720124423503876,0.999309360980988,141],[0.684546649456024,0.998026669025421,142],[0.647257924079895,0.986771941184998,143],[0.608351290225983,0.965657770633698,144],[0.567924201488495,0.934895038604736,145],[0.526077508926392,0.894791185855865,146],[0.482915937900543,0.84574681520462,147],[0.438547313213348,0.788252055644989,148],[0.393082559108734,0.722881376743317,149],[0.346635311841965,0.650287866592407,150],[0.29932165145874,0.571196854114532,151],[0.251259833574295,0.486398696899414,152],[0.202570006251335,0.396740585565567,153],[0.153373867273331,0.303118348121643,154],[0.103794358670712,0.206467479467392,155],[0.0539554208517075,0.107753649353981,156],[0.00398162333294749,0.00796318333595991,157],[-0.0460021272301674,-0.0919068530201912,158],[-0.0958708897233009,-0.190858587622643,159],[-0.145500034093857,-0.287903308868408,160],[-0.194765493273735,-0.382071405649185,161],[-0.243544146418571,-0.47242197394371,162],[-0.291714072227478,-0.558052241802216,163],[-0.339154869318008,-0.63810670375824,164],[-0.385747939348221,-0.711785316467285,165],[-0.431376844644547,-0.778352081775665,166],[-0.475927531719208,-0.837141752243042,167],[-0.519288659095764,-0.887567043304443,168],[-0.561351835727692,-0.929123997688293,169],[-0.602011919021606,-0.961397469043732,170],[-0.641167283058167,-0.984064996242523,171],[-0.678720057010651,-0.996900081634521,172],[-0.714576363563538,-0.99977445602417,173],[-0.74864661693573,-0.992659389972687,174],[-0.780845701694489,-0.975625991821289,175],[-0.811093032360077,-0.948844492435455,176],[-0.83931303024292,-0.912582457065582,177],[-0.865435183048248,-0.867202162742615,178],[-0.889394223690033,-0.813157141208649,179],[-0.911130249500275,-0.750987231731415,180],[-0.930588901042938,-0.681313753128052,181],[-0.947721600532532,-0.604832828044891,182],[-0.962485492229462,-0.522308588027954,183],[-0.974843621253967,-0.434565633535385,184],[-0.9847651720047,-0.342480629682541,185],[-0.992225348949432,-0.246973663568497,186],[-0.997205436229706,-0.148999020457268,187],[-0.999693036079407,-0.0495356395840645,188],[-0.999681949615479,0.0504226870834827,189],[-0.997172176837921,0.149877205491066,190],[-0.992169976234436,0.247834205627441,191],[-0.984687864780426,0.343314915895462,192],[-0.974744558334351,0.435365349054337,193],[-0.962364852428436,0.523065745830536,194],[-0.947579801082611,0.605539858341217,195],[-0.930426299571991,0.681963622570038,196],[-0.910947144031525,0.751573443412781,197],[-0.889191150665283,0.813673734664917,198],[-0.865212619304657,0.867644071578979,199],[-0.83907151222229,0.91294527053833,200],[-0.810833156108856,0.949124574661255,201],[-0.780568182468414,0.975820541381836,202],[-0.74835216999054,0.992766380310059,203],[-0.714265644550323,0.999792873859406,204],[-0.678393840789795,0.996829807758331,205],[-0.640826404094696,0.983906686306,206],[-0.601657271385193,0.961152732372284,207],[-0.560984253883362,0.928795218467712,208],[-0.518909096717834,0.887157499790192,209],[-0.475536942481995,0.836655616760254,210],[-0.430976182222366,0.777794182300568,211],[-0.385338187217712,0.711161196231842,212],[-0.338737070560455,0.637422621250153,213],[-0.291289269924164,0.557315051555634,214],[-0.243113428354263,0.471639007329941,215],[-0.194329902529716,0.381250500679016,216],[-0.145060673356056,0.287052661180496,217],[-0.095428854227066,0.189986675977707,218],[-0.0455585122108459,0.0910224169492722,219],[0.00442569795995951,-0.00885130930691957,220],[0.0543988458812237,-0.108636595308781,221],[0.104236029088497,-0.20733642578125,222],[0.153812676668167,-0.303964614868164,223],[0.203004866838455,-0.39755567908287,224],[0.25168964266777,-0.487174510955811,225],[0.299745351076126,-0.571925640106201,226],[0.347051829099655,-0.650962293148041,227],[0.393490880727768,-0.7234947681427,228],[0.438946396112442,-0.788798272609711,229],[0.483304768800735,-0.846220433712006,230],[0.526455104351044,-0.895187377929688,231],[0.568289637565613,-0.935209929943085,232],[0.60870373249054,-0.965888142585754,233],[0.64759635925293,-0.986915528774261,234],[0.684870302677155,-0.998082041740417,235],[0.720432460308075,-0.999275982379913,236],[0.754193961620331,-0.990485548973083,237],[0.786070287227631,-0.971798419952393,238],[0.815981864929199,-0.943401455879211,239],[0.843853950500488,-0.905578374862671,240],[0.869616806507111,-0.858707010746002,241],[0.893206119537354,-0.80325573682785,242],[0.914562821388245,-0.739778578281403,243],[0.933633625507355,-0.668909847736359,244],[0.950370848178864,-0.591357529163361,245],[0.964732646942139,-0.507896602153778,246],[0.976683080196381,-0.419360905885696,247],[0.986192286014557,-0.326635122299194,248],[0.993236601352692,-0.230645701289177,249],[0.997798264026642,-0.132351756095886,250],[0.999866008758545,-0.0327353775501251,251],[0.999434590339661,0.0672080740332603,252],[0.996505081653595,0.166480004787445,253],[0.9910848736763,0.26408851146698,254],[0.983187437057495,0.359058350324631,255],[0.972832560539246,0.450440585613251,256],[0.960046112537384,0.537322163581848,257],[0.94486004114151,0.618835031986237,258],[0.927312314510345,0.69416469335556,259],[0.907446801662445,0.762558460235596,260],[0.885313093662262,0.823333024978638,261],[0.860966622829437,0.87588107585907,262],[0.834468126296997,0.91967761516571,263],[0.805883944034576,0.954285085201263,264],[0.775285482406616,0.979357659816742,265],[0.742749154567719,0.99464476108551,266],[0.708356380462646,0.999993741512299,267],[0.672193109989166,0.995351076126099,268],[0.634349644184113,0.980763256549835,269],[0.594920635223389,0.956375956535339,270],[0.554004669189453,0.922432839870453,271],[0.511703968048096,0.879273056983948,272],[0.46812430024147,0.827327907085419,273],[0.423374533653259,0.767116367816925,274],[0.377566576004028,0.699240028858185,275],[0.330814868211746,0.624377131462097,276],[0.28323632478714,0.543275654315948,277],[0.234949812293053,0.456745982170105,278],[0.186076059937477,0.365652620792389,279],[0.136737212538719,0.270905792713165,280],[0.0870565995573997,0.173452153801918,281],[0.0371583849191666,0.0742654427886009,282],[-0.0128327067941427,-0.0256632994860411,283],[-0.062791720032692,-0.125335618853569,284],[-0.112593792378902,-0.223755642771721,285],[-0.162114441394806,-0.319939970970154,286],[-0.211229875683784,-0.412927538156509,287],[-0.259817361831665,-0.501789271831512,288],[-0.307755440473557,-0.585637331008911,289],[-0.354924261569977,-0.66363388299942,290],[-0.401205986738205,-0.734999597072601,291],[-0.44648489356041,-0.799021482467651,292],[-0.490647822618484,-0.855059802532196,293],[-0.533584415912628,-0.902554631233215,294],[-0.575187265872955,-0.941031396389008,295],[-0.615352511405945,-0.970105707645416,296],[-0.653979659080505,-0.989487111568451,297],[-0.690972208976746,-0.998981833457947,298],[-0.726237654685974,-0.998495042324066,299],[-0.759687900543213,-0.988031625747681,300],[-0.791239321231842,-0.967696130275726,301],[-0.820813119411469,-0.937691748142242,302],[-0.848335266113281,-0.898318231105804,303],[-0.873736977577209,-0.849969029426575,304],[-0.896954834461212,-0.793127238750458,305],[-0.917930781841278,-0.728360772132874,306],[-0.936612367630005,-0.656316757202148,307],[-0.952952921390533,-0.577715039253235,308],[-0.966911554336548,-0.493340998888016,309],[-0.978453457355499,-0.404037654399872,310],[-0.987549722194672,-0.310697287321091,311],[-0.994177639484406,-0.214252546429634,312],[-0.998320579528809,-0.115667052567005,313],[-0.999968290328979,-0.0159258618950844,314],[-0.999116599559784,0.0839744582772255,315],[-0.995767593383789,0.183035731315613,316],[-0.989929735660553,0.280268162488937,317],[-0.981617569923401,0.374700278043747,318],[-0.970851838588715,0.465388476848602,319],[-0.957659482955933,0.551426708698273,320],[-0.942073464393616,0.631955206394196,321],[-0.924132823944092,0.706169486045837,322],[-0.903882265090942,0.773327887058258,323],[-0.881372511386871,0.832759499549866,324],[-0.856659770011902,0.883870422840118,325],[-0.829805791378021,0.926150023937225,326],[-0.800877749919891,0.959175825119019,327],[-0.769947946071625,0.982617855072021,328],[-0.737093687057495,0.996241927146912,329],[-0.702397048473358,0.999911844730377,330],[-0.665944814682007,0.993591010570526,331],[-0.627828061580658,0.977342486381531,332],[-0.588142037391663,0.951328754425049,333],[-0.546985983848572,0.915809631347656,334],[-0.504462718963623,0.871140003204346,335],[-0.460678577423096,0.81776624917984,336],[-0.415742993354797,0.756221652030945,337],[-0.369768261909485,0.687121152877808,338],[-0.322869300842285,0.611155152320862,339],[-0.275163352489471,0.529082715511322,340],[-0.226769611239433,0.441723793745041,341],[-0.177809074521065,0.349951356649399,342],[-0.12840411067009,0.254682332277298,343],[-0.078678198158741,0.15686859190464,344],[-0.0287556294351816,0.0574874766170979,345],[0.0212388075888157,-0.0424680337309837,346],[0.0711801573634148,-0.141999214887619,347],[0.12094359844923,-0.240111604332924,348],[0.170404747128487,-0.335824847221375,349],[0.219439968466759,-0.428182661533356,350],[0.267926692962646,-0.516262233257294,351],[0.315743744373322,-0.599183440208435,352],[0.36277163028717,-0.676117837429047,353],[0.408892750740051,-0.74629670381546,354],[0.453991830348969,-0.809018790721893,355],[0.497956216335297,-0.863657414913177,356],[0.540675938129425,-0.909666657447815,357],[0.582044243812561,-0.946586847305298,358],[0.621957778930664,-0.974049031734467,359],[0.660316705703735,-0.99177885055542,360],[0.697025179862976,-0.999599158763885,361],[0.731991469860077,-0.997431755065918,362],[0.765128195285797,-0.98529839515686,363],[0.796352446079254,-0.963320195674896,364],[0.825586259365082,-0.931716859340668,365],[0.852756559848785,-0.890804171562195,366],[0.877795398235321,-0.840990781784058,367],[0.900640189647675,-0.78277450799942,368],[0.921233832836151,-0.716737031936646,369],[0.93952488899231,-0.643538117408752,370],[0.955467641353607,-0.563909232616425,371],[0.969022214412689,-0.478645920753479,372],[0.980154693126678,-0.388600140810013,373],[0.988837361335754,-0.294671595096588,374],[0.995048403739929,-0.197798803448677,375],[0.998772382736206,-0.0989496558904648,376],[0.99999988079071,0.000888156821019948,377],[0.998727977275848,0.100717097520828,378],[0.994959712028503,0.199539706110954,379],[0.98870462179184,0.296368569135666,380],[0.979978263378143,0.390236228704453,381],[0.968802452087402,0.480204790830612,382],[0.955205142498016,0.56537526845932,383],[0.939220368862152,0.644896745681763,384],[0.92088794708252,0.717974603176117,385],[0.90025383234024,0.783878684043884,386],[0.877369582653046,0.841950535774231,387],[0.85229229927063,0.891609847545624,388],[0.825084805488586,0.932360529899597,389],[0.795814990997314,0.963795363903046,390],[0.764556050300598,0.985600292682648,391],[0.731386125087738,0.997557401657104,392],[0.696388065814972,0.999547302722931,393],[0.659649431705475,0.991549968719482,394],[0.621262073516846,0.973645448684692,395],[0.581321835517883,0.946012556552887,396],[0.539928555488586,0.908927440643311,397],[0.497185796499252,0.862760663032532,398],[0.453200310468674,0.807973384857178,399],[0.408082067966461,0.745113134384155,400],[0.361943811178207,0.674807965755463,401],[0.314900904893875,0.597760379314423,402],[0.267070919275284,0.514740109443665,403],[0.218573361635208,0.426576763391495,404],[0.169529512524605,0.334151178598404,405],[0.120061911642551,0.238386869430542,406],[0.0702942311763763,0.140240684151649,407],[0.020350843667984,0.0406932570040226,408],[-0.0296434089541435,-0.0592607632279396,409],[-0.0795635655522346,-0.158622667193413,410],[-0.129284858703613,-0.256399661302567,411],[-0.178682997822762,-0.35161480307579,412],[-0.227634534239769,-0.443316727876663,413],[-0.276017099618912,-0.530589163303375,414],[-0.323709756135941,-0.612560153007507,415],[-0.370593339204788,-0.688410639762878,416],[-0.416550606489182,-0.757382750511169,417],[-0.461466699838638,-0.818787336349487,418],[-0.505229413509369,-0.872010886669159,419],[-0.547729253768921,-0.916521549224854,420],[-0.588860094547272,-0.951874673366547,421],[-0.628519058227539,-0.97771692276001,422],[-0.666607081890106,-0.993790209293365,423],[-0.703028976917267,-0.999933838844299,424],[-0.737693607807159,-0.996086478233337,425],[-0.770514369010925,-0.98228657245636,426],[-0.801409304141998,-0.958671987056732,427],[-0.830301105976105,-0.925478637218475,428],[-0.857117593288422,-0.88303816318512,429],[-0.881791710853577,-0.831774771213531,430],[-0.904261827468872,-0.772200465202332,431],[-0.924471795558929,-0.704910635948181,432],[-0.942371010780334,-0.630577564239502,433],[-0.95791482925415,-0.54994398355484,434],[-0.971064329147339,-0.46381551027298,435],[-0.981786668300629,-0.373052775859833,436],[-0.990055084228516,-0.278562605381012,437],[-0.995848834514618,-0.18128913640976,438],[-0.9991534948349,-0.082204282283783,439],[-0.999960839748383,0.0177019257098436,440],[-0.998268783092499,0.11743126064539,441],[-0.994081556797028,0.215987265110016,442],[-0.987409591674805,0.312385201454163,443],[-0.978269696235657,0.405661880970001,444],[-0.966684639453888,0.494885325431824,445],[-0.952683329582214,0.579164028167725,446],[-0.936300814151764,0.657655894756317,447],[-0.917578041553497,0.729576766490936,448],[-0.896561801433563,0.794207870960236,449],[-0.873304665088654,0.850903511047363,450],[-0.84786468744278,0.899097263813019,451],[-0.820305466651917,0.938307464122772,452],[-0.790695905685425,0.968142449855804,453],[-0.759110033512115,0.988304078578949,454],[-0.725626826286316,0.998590886592865,455],[-0.690329849720001,0.99890011548996,456],[-0.653307497501373,0.98922860622406,457],[-0.614652156829834,0.969673097133636,458],[-0.574460506439209,0.940428972244263,459],[-0.53283303976059,0.901788353919983,460],[-0.489873737096786,0.854137361049652,461],[-0.445690006017685,0.797952115535736,462],[-0.400392293930054,0.733793973922729,463],[-0.354093790054321,0.662304043769836,464],[-0.306910246610641,0.5841965675354,465],[-0.258959591388702,0.50025200843811,466],[-0.210361674427986,0.411309093236923,467],[-0.161237969994545,0.318256497383118,468],[-0.111711241304874,0.222024008631706,469],[-0.0619052946567535,0.123573124408722,470],[-0.011944618076086,0.0238875318318605,471],[0.0380459129810333,-0.076036736369133,472],[0.0879413485527039,-0.175201267004013,473],[0.137616977095604,-0.272615253925323,474],[0.186948642134666,-0.367305338382721,475],[0.235813021659851,-0.458325445652008,476],[0.284087985754013,-0.544766128063202,477],[0.331652909517288,-0.625763654708862,478],[0.378388851881027,-0.700508773326874,479],[0.424179017543793,-0.768254637718201,480],[0.468908935785294,-0.828324377536774,481],[0.512466847896576,-0.880117774009705,482],[0.554743885993958,-0.923117280006409,483],[0.595634341239929,-0.95689332485199,484],[0.635035991668701,-0.981108427047729,485],[0.672850370407104,-0.99552059173584,486],[0.70898300409317,-0.999985873699188,487],[0.743343591690063,-0.994459629058838,488],[0.775846123695374,-0.978997051715851,489],[0.806409478187561,-0.953752636909485,490],[0.834957242012024,-0.918978691101074,491],[0.861418068408966,-0.87502259016037,492],[0.885725736618042,-0.822323560714722,493],[0.90781956911087,-0.761408090591431,494],[0.927644371986389,-0.692884981632233,495],[0.9451504945755,-0.617438733577728,496],[0.960294246673584,-0.535823225975037,497],[0.973037779331207,-0.448853969573975,498],[0.98334926366806,-0.357399940490723,499],[0.991202831268311,-0.262374848127365,500]],"ignoreExtent":false,"flags":64},"246":{"id":246,"type":"text","material":{"lit":false},"vertices":[[1.58548355102539e-05,-1.33898746967316,-84.75]],"colors":[[0,0,0,1]],"texts":[[""]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[1.58548355102539e-05,-1.33898746967316,-84.75]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":2064},"247":{"id":247,"type":"text","material":{"lit":false},"vertices":[[-1.33896291255951,1.75833702087402e-06,-84.75]],"colors":[[0,0,0,1]],"texts":[[""]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[-1.33896291255951,1.75833702087402e-06,-84.75]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":2064},"248":{"id":248,"type":"text","material":{"lit":false},"vertices":[[-1.33896291255951,-1.33898746967316,250]],"colors":[[0,0,0,1]],"texts":[["time"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[-1.33896291255951,-1.33898746967316,250]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":2064},"249":{"id":249,"type":"spheres","material":{},"vertices":[[1,0,0]],"colors":[[1,0,0,1]],"radii":[[8]],"centers":[[1,0,0]],"ignoreExtent":false,"flags":3},"179":{"id":179,"reuse":"slider"},"180":{"id":180,"reuse":"slider"},"245":{"id":245,"type":"bboxdeco","material":{"front":"lines","back":"lines"},"vertices":[[-0.5,"NA","NA"],[0,"NA","NA"],[0.5,"NA","NA"],[1,"NA","NA"],["NA",-0.5,"NA"],["NA",0,"NA"],["NA",0.5,"NA"],["NA","NA",0],["NA","NA",100],["NA","NA",200],["NA","NA",300],["NA","NA",400],["NA","NA",500]],"colors":[[0,0,0,1]],"draw_front":true,"newIds":[257,258,259,260,261,262,263]},"175":{"id":175,"type":"subscene","par3d":{"antialias":1,"FOV":30,"ignoreExtent":false,"listeners":175,"mouseMode":{"left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,1246.23266601562],"modelMatrix":[[144.342163085938,0,0,-4.00227975845337],[0,49.3675422668457,0.542540431022644,-131.876419067383],[0,-135.636199951172,0.19746857881546,-1294.2314453125],[0,0,0,1]],"projMatrix":[[3.7320511341095,0,0,0],[0,3.73205089569092,0,0],[0,0,-3.86370301246643,-4492.5244140625],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[1,0,0,0],[0,0.342020143325668,0.939692620785909,0],[0,-0.939692620785909,0.342020143325668,0],[0,0,0,1]],"scale":[144.342163085938,144.341033935547,0.57735949754715],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[-0.999968290328979,1.05542385578156,-0.999990224838257,0.999993741512299,-13.8561849594116,500],"windowRect":[100,100,580,580],"family":"sans","font":1,"cex":1,"useFreeType":false,"fontname":"NULL","maxClipPlanes":2147483647,"glVersion":"NaN"},"embeddings":{"viewport":"replace","projection":"replace","model":"replace"},"objects":[180,245,244,246,247,248,249,179,257,258,259,260,261,262,263],"subscenes":[],"flags":2643},"257":{"id":257,"type":"lines","material":{"lit":false},"vertices":[[-0.5,-1.02998995780945,-21.5640277862549],[1,-1.02998995780945,-21.5640277862549],[-0.5,-1.02998995780945,-21.5640277862549],[-0.5,-1.08148956298828,-34.795825958252],[0,-1.02998995780945,-21.5640277862549],[0,-1.08148956298828,-34.795825958252],[0.5,-1.02998995780945,-21.5640277862549],[0.5,-1.08148956298828,-34.795825958252],[1,-1.02998995780945,-21.5640277862549],[1,-1.08148956298828,-34.795825958252]],"colors":[[0,0,0,1]],"centers":[[0.25,-1.02998995780945,-21.5640277862549],[-0.5,-1.05573976039886,-28.1799278259277],[0,-1.05573976039886,-28.1799278259277],[0.5,-1.05573976039886,-28.1799278259277],[1,-1.05573976039886,-28.1799278259277]],"ignoreExtent":true,"origId":245,"flags":64},"258":{"id":258,"type":"text","material":{"lit":false},"vertices":[[-0.5,-1.18448877334595,-61.2594184875488],[0,-1.18448877334595,-61.2594184875488],[0.5,-1.18448877334595,-61.2594184875488],[1,-1.18448877334595,-61.2594184875488]],"colors":[[0,0,0,1]],"texts":[["-0.5"],["0"],["0.5"],["1"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[-0.5,-1.18448877334595,-61.2594184875488],[0,-1.18448877334595,-61.2594184875488],[0.5,-1.18448877334595,-61.2594184875488],[1,-1.18448877334595,-61.2594184875488]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"origId":245,"flags":2064},"259":{"id":259,"type":"lines","material":{"lit":false},"vertices":[[-1.03079915046692,-0.5,-21.5640277862549],[-1.03079915046692,0.5,-21.5640277862549],[-1.03079915046692,-0.5,-21.5640277862549],[-1.08372557163239,-0.5,-34.795825958252],[-1.03079915046692,0,-21.5640277862549],[-1.08372557163239,0,-34.795825958252],[-1.03079915046692,0.5,-21.5640277862549],[-1.08372557163239,0.5,-34.795825958252]],"colors":[[0,0,0,1]],"centers":[[-1.03079915046692,0,-21.5640277862549],[-1.0572624206543,-0.5,-28.1799278259277],[-1.0572624206543,0,-28.1799278259277],[-1.0572624206543,0.5,-28.1799278259277]],"ignoreExtent":true,"origId":245,"flags":64},"260":{"id":260,"type":"text","material":{"lit":false},"vertices":[[-1.18957817554474,-0.5,-61.2594184875488],[-1.18957817554474,0,-61.2594184875488],[-1.18957817554474,0.5,-61.2594184875488]],"colors":[[0,0,0,1]],"texts":[["-0.5"],["0"],["0.5"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[-1.18957817554474,-0.5,-61.2594184875488],[-1.18957817554474,0,-61.2594184875488],[-1.18957817554474,0.5,-61.2594184875488]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"origId":245,"flags":2064},"261":{"id":261,"type":"lines","material":{"lit":false},"vertices":[[-1.03079915046692,-1.02998995780945,0],[-1.03079915046692,-1.02998995780945,500],[-1.03079915046692,-1.02998995780945,0],[-1.08372557163239,-1.08148956298828,0],[-1.03079915046692,-1.02998995780945,100],[-1.08372557163239,-1.08148956298828,100],[-1.03079915046692,-1.02998995780945,200],[-1.08372557163239,-1.08148956298828,200],[-1.03079915046692,-1.02998995780945,300],[-1.08372557163239,-1.08148956298828,300],[-1.03079915046692,-1.02998995780945,400],[-1.08372557163239,-1.08148956298828,400],[-1.03079915046692,-1.02998995780945,500],[-1.08372557163239,-1.08148956298828,500]],"colors":[[0,0,0,1]],"centers":[[-1.03079915046692,-1.02998995780945,250],[-1.0572624206543,-1.05573976039886,0],[-1.0572624206543,-1.05573976039886,100],[-1.0572624206543,-1.05573976039886,200],[-1.0572624206543,-1.05573976039886,300],[-1.0572624206543,-1.05573976039886,400],[-1.0572624206543,-1.05573976039886,500]],"ignoreExtent":true,"origId":245,"flags":64},"262":{"id":262,"type":"text","material":{"lit":false},"vertices":[[-1.18957817554474,-1.18448877334595,0],[-1.18957817554474,-1.18448877334595,100],[-1.18957817554474,-1.18448877334595,200],[-1.18957817554474,-1.18448877334595,300],[-1.18957817554474,-1.18448877334595,400],[-1.18957817554474,-1.18448877334595,500]],"colors":[[0,0,0,1]],"texts":[["0"],["100"],["200"],["300"],["400"],["500"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[-1.18957817554474,-1.18448877334595,0],[-1.18957817554474,-1.18448877334595,100],[-1.18957817554474,-1.18448877334595,200],[-1.18957817554474,-1.18448877334595,300],[-1.18957817554474,-1.18448877334595,400],[-1.18957817554474,-1.18448877334595,500]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"origId":245,"flags":2064},"263":{"id":263,"type":"lines","material":{"lit":false},"vertices":[[-1.03079915046692,-1.02998995780945,-21.5640277862549],[-1.03079915046692,1.02999353408813,-21.5640277862549],[-1.03079915046692,-1.02998995780945,507.707855224609],[-1.03079915046692,1.02999353408813,507.707855224609],[-1.03079915046692,-1.02998995780945,-21.5640277862549],[-1.03079915046692,-1.02998995780945,507.707855224609],[-1.03079915046692,1.02999353408813,-21.5640277862549],[-1.03079915046692,1.02999353408813,507.707855224609],[-1.03079915046692,-1.02998995780945,-21.5640277862549],[1.08625471591949,-1.02998995780945,-21.5640277862549],[-1.03079915046692,-1.02998995780945,507.707855224609],[1.08625471591949,-1.02998995780945,507.707855224609],[-1.03079915046692,1.02999353408813,-21.5640277862549],[1.08625471591949,1.02999353408813,-21.5640277862549],[-1.03079915046692,1.02999353408813,507.707855224609],[1.08625471591949,1.02999353408813,507.707855224609],[1.08625471591949,-1.02998995780945,-21.5640277862549],[1.08625471591949,1.02999353408813,-21.5640277862549],[1.08625471591949,-1.02998995780945,507.707855224609],[1.08625471591949,1.02999353408813,507.707855224609],[1.08625471591949,-1.02998995780945,-21.5640277862549],[1.08625471591949,-1.02998995780945,507.707855224609],[1.08625471591949,1.02999353408813,-21.5640277862549],[1.08625471591949,1.02999353408813,507.707855224609]],"colors":[[0,0,0,1]],"centers":[[-1.03079915046692,1.78813934326172e-06,-21.5640277862549],[-1.03079915046692,1.78813934326172e-06,507.707855224609],[-1.03079915046692,-1.02998995780945,243.071914672852],[-1.03079915046692,1.02999353408813,243.071914672852],[0.0277277827262878,-1.02998995780945,-21.5640277862549],[0.0277277827262878,-1.02998995780945,507.707855224609],[0.0277277827262878,1.02999353408813,-21.5640277862549],[0.0277277827262878,1.02999353408813,507.707855224609],[1.08625471591949,1.78813934326172e-06,-21.5640277862549],[1.08625471591949,1.78813934326172e-06,507.707855224609],[1.08625471591949,-1.02998995780945,243.071914672852],[1.08625471591949,1.02999353408813,243.071914672852]],"ignoreExtent":true,"origId":245,"flags":64}},"width":480,"height":480,"sphereVerts":{"reuse":"plot3drgl"},"webGLoptions":{"preserveDrawingBuffer":true},"context":{"shiny":false,"rmarkdown":"rmarkdown::html_vignette"}},"evals":[],"jsHooks":[]}</script>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">playwidget</span>(<span class="st">&quot;ageExample&quot;</span>, <span class="kw">list</span>(
  <span class="kw">ageControl</span>(<span class="dt">births =</span> time, <span class="dt">ages =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">50</span>),
        <span class="dt">colors =</span> <span class="kw">c</span>(<span class="st">&quot;gray&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;gray&quot;</span>), <span class="dt">objids =</span> lineid),
    <span class="kw">ageControl</span>(<span class="dt">births =</span> <span class="dv">0</span>, <span class="dt">ages =</span> time,
        <span class="dt">vertices =</span> xyz, <span class="dt">objids =</span> sphereid)),
  <span class="dt">start =</span> <span class="dv">0</span>, <span class="dt">stop =</span> <span class="kw">max</span>(time) +<span class="st"> </span><span class="dv">20</span>, <span class="dt">rate =</span> <span class="dv">50</span>,
  <span class="dt">components =</span> <span class="kw">c</span>(<span class="st">&quot;Reverse&quot;</span>, <span class="st">&quot;Play&quot;</span>, <span class="st">&quot;Slower&quot;</span>, <span class="st">&quot;Faster&quot;</span>,
                 <span class="st">&quot;Reset&quot;</span>, <span class="st">&quot;Slider&quot;</span>, <span class="st">&quot;Label&quot;</span>),
  <span class="dt">loop =</span> <span class="ot">TRUE</span>)</code></pre>
<span id="rgl-play78831" class="rglPlayer html-widget"></span>
<script type="application/json" data-for="rgl-play78831">{"x":{"actions":[{"type":"ageSetter","objids":244,"value":0,"births":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,432,433,434,435,436,437,438,439,440,441,442,443,444,445,446,447,448,449,450,451,452,453,454,455,456,457,458,459,460,461,462,463,464,465,466,467,468,469,470,471,472,473,474,475,476,477,478,479,480,481,482,483,484,485,486,487,488,489,490,491,492,493,494,495,496,497,498,499,500],"ages":[null,0,0,50,null],"colors":[0.745098039215686,0.745098039215686,0.745098039215686,0.745098039215686,0.745098039215686,0.745098039215686,1,0,0,0.745098039215686,0.745098039215686,0.745098039215686,0.745098039215686,0.745098039215686,0.745098039215686]},{"type":"ageSetter","objids":249,"value":0,"births":0,"ages":[null,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,432,433,434,435,436,437,438,439,440,441,442,443,444,445,446,447,448,449,450,451,452,453,454,455,456,457,458,459,460,461,462,463,464,465,466,467,468,469,470,471,472,473,474,475,476,477,478,479,480,481,482,483,484,485,486,487,488,489,490,491,492,493,494,495,496,497,498,499,500,null],"vertices":[1,0,0,1,0,0,0.998750260394966,0.0998334166468282,1,0.995004165278026,0.198669330795061,2,0.988771077936042,0.29552020666134,3,0.980066577841242,0.389418342308651,4,0.968912421710645,0.479425538604203,5,0.955336489125606,0.564642473395035,6,0.939372712847379,0.644217687237691,7,0.921060994002885,0.717356090899523,8,0.900447102352677,0.783326909627483,9,0.877582561890373,0.841470984807897,10,0.852524522059506,0.891207360061435,11,0.825335614909678,0.932039085967226,12,0.796083798549056,0.963558185417193,13,0.764842187284488,0.98544972998846,14,0.731688868873821,0.997494986604054,15,0.696706709347165,0.999573603041505,16,0.659983145884982,0.991664810452469,17,0.621609968270665,0.973847630878195,18,0.581683089463884,0.946300087687414,19,0.54030230586814,0.909297426825682,20,0.497571047891727,0.863209366648874,21,0.453596121425577,0.80849640381959,22,0.408487440884157,0.74570521217672,23,0.362357754476674,0.675463180551151,24,0.315322362395269,0.598472144103956,25,0.267498828624587,0.515501371821464,26,0.219006687093041,0.42737988023383,27,0.169967142900241,0.334988150155905,28,0.120502769367367,0.239249329213982,29,0.0707372016677029,0.141120008059867,30,0.0207948278030924,0.0415806624332905,31,-0.0291995223012888,-0.0583741434275801,32,-0.0791208888067339,-0.157745694143248,33,-0.128844494295525,-0.255541102026831,34,-0.178246055649492,-0.35078322768962,35,-0.227202094693087,-0.442520443294852,36,-0.275590246824513,-0.529836140908493,37,-0.323289566863503,-0.611857890942719,38,-0.370180831351287,-0.687766159183974,39,-0.416146836547142,-0.756802495307928,40,-0.461072691376713,-0.81827711106441,41,-0.504846104599857,-0.871575772413588,42,-0.547357665480271,-0.916165936749455,43,-0.588501117255346,-0.951602073889516,44,-0.628173622722739,-0.977530117665097,45,-0.666276021279824,-0.993691003633464,46,-0.702713076773554,-0.999923257564101,47,-0.737393715541245,-0.996164608835841,48,-0.770231254047308,-0.982452612624332,49,-0.801143615546934,-0.958924274663138,50,-0.830053535235222,-0.925814682327732,51,-0.856888753368947,-0.883454655720153,52,-0.881582195878286,-0.832267442223901,53,-0.904072142017061,-0.772764487555987,54,-0.924302378632464,-0.705540325570392,55,-0.942222340668658,-0.631266637872322,56,-0.95778723755309,-0.550685542597638,57,-0.970958165149591,-0.464602179413757,58,-0.981702202998454,-0.373876664830236,59,-0.989992496600445,-0.279415498198926,60,-0.995808324539061,-0.182162504272096,61,-0.999135150273279,-0.0830894028174964,62,-0.999964658471342,0.0168139004843497,63,-0.998294775794753,0.116549204850494,64,-0.994129676080546,0.215119988087816,65,-0.987479769908865,0.311541363513378,66,-0.978361678581934,0.404849920616598,67,-0.966798192579461,0.494113351138608,68,-0.952818214594305,0.5784397643882,69,-0.936456687290796,0.656986598718789,70,-0.917754505966276,0.728969040125876,71,-0.896758416334147,0.793667863849153,72,-0.873520897683938,0.850436620628564,73,-0.848100031710408,0.898708095811627,74,-0.820559357339561,0.937999976774739,75,-0.790967711914417,0.967919672031486,76,-0.759399059137508,0.988168233877,77,-0.72593230420014,0.998543345374605,78,-0.690651096560508,0.998941341839772,79,-0.653643620863612,0.989358246623382,80,-0.615002376525574,0.969889810845086,81,-0.574823946533269,0.940730556679773,82,-0.533208756037154,0.902171833756293,83,-0.490260821340699,0.854598908088281,84,-0.446087489913793,0.79848711262349,85,-0.400799172079975,0.734397097874113,86,-0.354509065048132,0.662969230082183,87,-0.307332869978419,0.584917192891762,88,-0.259388502789626,0.501020856457885,89,-0.21079579943078,0.412118485241757,90,-0.161676216353687,0.319098362349352,91,-0.112152526935055,0.222889914100248,92,-0.0623485146069917,0.124454423507062,93,-0.0123886634628906,0.0247754254533578,94,0.0376021528879766,-0.0751511204618093,95,0.0874989834394464,-0.17432678122298,96,0.137177112100907,-0.271760626410942,97,0.186512369422576,-0.366479129251928,98,0.235381442954451,-0.457535893775321,99,0.283662185463226,-0.54402111088937,100,0.331233920236754,-0.625070648892882,101,0.37797774271298,-0.699874687593542,102,0.423776817679428,-0.767685809763582,103,0.468516671300377,-0.827826469085654,104,0.512085477241841,-0.87969575997167,105,0.554374336179161,-0.922775421612807,106,0.595277547988606,-0.956635016270188,107,0.634692875942635,-0.980936230066492,108,0.672521802248466,-0.995436253306377,109,0.70866977429126,-0.999990206550703,110,0.74304644096641,-0.994552588203989,111,0.77556587851025,-0.979177729151317,112,0.806146805264716,-0.954019249902089,113,0.83471278483916,-0.919328525664676,114,0.861192417161521,-0.875452174688429,115,0.885519516941319,-0.822828594968709,116,0.907633279098413,-0.761983583919033,117,0.927478430744036,-0.693525084777122,118,0.945005369334228,-0.618137112237033,119,0.960170286650366,-0.536572918000435,120,0.972935278296897,-0.449647464534601,121,0.983268438442584,-0.358229282236829,122,0.991143939568469,-0.263231791365801,123,0.996542097023217,-0.165604175448309,124,0.999449418224499,-0.0663218973512007,125,0.999858636383415,0.0336230472211367,126,0.997768728667684,0.133232041419942,127,0.993184918758193,0.231509825101539,128,0.986118663792513,0.327474439137693,129,0.976587625728023,0.420167036826641,130,0.964615627196218,0.508661464372374,131,0.95023259195853,0.592073514707223,132,0.933474470112512,0.669569762196602,133,0.914383148235319,0.740375889952449,134,0.893006344689077,0.803784426551621,135,0.869397490349825,0.859161814856496,136,0.84361559505816,0.905954742308462,137,0.815725100125357,0.943695669444105,138,0.785795717263661,0.972007501394976,139,0.753902254343305,0.99060735569487,140,0.720124428411794,0.999309388747918,141,0.684546666442807,0.998026652716362,142,0.647257894312724,0.986771964274613,143,0.608351314532255,0.965657776549278,144,0.567924173288695,0.934895055524683,145,0.526077517381105,0.894791172140504,146,0.482915941655938,0.845746831142934,147,0.43854732757439,0.788252067375316,148,0.393082573564941,0.722881349511976,149,0.346635317835026,0.650287840157117,150,0.299321654334707,0.571196869659989,151,0.251259842582256,0.4863986888538,152,0.202570012076944,0.396740573130612,153,0.153373862037864,0.303118356745702,154,0.103794357219253,0.206467481937797,155,0.0539554205626498,0.107753652299444,156,0.00398162345407974,0.00796318378593734,157,-0.0460021256395369,-0.0919068502276816,158,-0.0958708933764978,-0.190858581374189,159,-0.145500033808614,-0.287903316665065,160,-0.194765499931161,-0.382071417184009,161,-0.243544153735791,-0.472421986398466,162,-0.291714073991426,-0.558052271286779,163,-0.339154860983835,-0.638106682347947,164,-0.385747937452222,-0.711785342369123,165,-0.431376844970621,-0.778352078534299,166,-0.47592753503331,-0.837141778019747,167,-0.519288654116686,-0.887567033581505,168,-0.561351822005071,-0.929124012734368,169,-0.602011902684824,-0.961397491879557,170,-0.641167267129602,-0.984065005081643,171,-0.678720047320012,-0.996900066041596,172,-0.714576380862692,-0.999774431073011,173,-0.748646645597399,-0.992659380470633,174,-0.780845683605749,-0.975626005468158,175,-0.811093014061656,-0.948844497918124,176,-0.839313034391484,-0.912582449791185,177,-0.865435209241112,-0.867202179485581,178,-0.889394246777581,-0.813157111661488,179,-0.911130261884677,-0.750987246771676,180,-0.930588925844528,-0.6813137655555,181,-0.947721602131112,-0.604832822406284,182,-0.962485467976237,-0.522308589626732,183,-0.974843621404164,-0.434565622071897,184,-0.984765173467324,-0.342480618469613,185,-0.992225325452603,-0.246973661736621,186,-0.997205430865212,-0.148999025814199,187,-0.999693042035206,-0.0495356408783674,188,-0.999681941230185,0.0504226878068112,189,-0.997172156196378,0.149877209662952,190,-0.992169960089301,0.24783420798296,191,-0.984687855794127,0.343314928819895,192,-0.974744544674989,0.435365360372893,193,-0.96236487983131,0.523065765157696,194,-0.947579803977993,0.605539869719601,195,-0.930426272104753,0.681963620068135,196,-0.910947159107888,0.751573415352148,197,-0.889191152625361,0.813673737507105,198,-0.865212631343072,0.867644100641667,199,-0.839071529076452,0.912945250727628,200,-0.810833184967147,0.949124553647895,201,-0.780568180169184,0.975820517766976,202,-0.748352161432847,0.992766405835907,203,-0.7142656520272,0.999792900142669,204,-0.678393850473845,0.996829794278799,205,-0.640826417594993,0.983906694618616,206,-0.601657252408102,0.961152724502117,207,-0.560984257427229,0.92879523407724,208,-0.518909093957743,0.887157528692351,209,-0.475536927995993,0.836655638536056,210,-0.430976167369097,0.777794161801093,211,-0.38533819077183,0.711161222905982,212,-0.338737069377881,0.637422596150239,213,-0.291289281721346,0.557315053517661,214,-0.24311342256103,0.471639003094196,215,-0.194329906455335,0.38125049165494,216,-0.145060666788562,0.287052651327728,217,-0.0954288510009507,0.189986675795438,218,-0.0455585127842237,0.0910224161998479,219,0.00442569798805079,-0.00885130929040388,220,0.0543988468202141,-0.10863659542408,221,0.104236026865697,-0.207336420606759,222,0.153812671129091,-0.303964608811047,223,0.20300486381875,-0.397555683121433,224,0.251689650071754,-0.48717451246051,225,0.299745343277015,-0.571925655109564,226,0.347051829228438,-0.650962305666247,227,0.393490866347891,-0.723494756044245,228,0.438946381227554,-0.788798285975416,229,0.483304758753006,-0.846220404175171,230,0.526455126081828,-0.895187367819682,231,0.568289629767974,-0.935209915194539,232,0.608703705339219,-0.96588815423607,233,0.647596338653876,-0.986915558120649,234,0.684870318383553,-0.998082027979396,235,0.720432478990839,-0.999275992136628,236,0.754193933594628,-0.990485520897156,237,0.786070296141039,-0.971798445743863,238,0.815981892324594,-0.943401481754556,239,0.843853958732492,-0.905578362006624,240,0.869616829714206,-0.858707002609929,241,0.893206111509322,-0.803255726693955,242,0.914562843198418,-0.739778585077893,243,0.933633644074637,-0.668909820378024,244,0.950370847067673,-0.591357529865124,245,0.96473261788661,-0.507896590390622,246,0.976683059583864,-0.419360916073231,247,0.986192302278864,-0.326635126104722,248,0.993236577817188,-0.230645705927396,249,0.997798279178581,-0.132351750097773,250,0.999866004485325,-0.0327353793308453,251,0.999434585501005,0.0672080725254749,252,0.996505100548402,0.166480003537159,253,0.991084871814253,0.264088521384469,254,0.983187447047592,0.359058354022168,255,0.972832565697435,0.450440594275389,256,0.960046109574442,0.537322181006472,257,0.944860038159861,0.618835022120039,258,0.927312308723476,0.694164668252242,259,0.907446781450196,0.762558450479603,260,0.885313109812439,0.823333000738082,261,0.860966616462306,0.875881079810889,262,0.834468154953763,0.91967764466202,263,0.805883957640451,0.954285094492697,264,0.775285470129288,0.979357643103917,265,0.742749172703669,0.994644773877838,266,0.708356389162585,0.999993742857021,267,0.672193083553468,0.995351104911559,268,0.63434964530686,0.980763247745153,269,0.594920663309892,0.956375928404503,270,0.554004689483342,0.922432816923086,271,0.511703992453149,0.879273061650724,272,0.46812430193211,0.827327900595379,273,0.423374544450665,0.76711635263553,274,0.377566571097293,0.699240031655098,275,0.330814877949047,0.624377135416391,276,0.283236319890988,0.543275669232248,277,0.234949818539823,0.456745972144193,278,0.186076065001811,0.365652620282621,279,0.136737218207834,0.270905788307869,280,0.0870565995797034,0.173452155245892,281,0.0371583847908264,0.0742654455843613,282,-0.0128327066083168,-0.0256632998605595,283,-0.0627917229240818,-0.125335626096429,284,-0.112593792633835,-0.223755640186796,285,-0.162114436499718,-0.319939961884198,286,-0.211229878701916,-0.41292754924054,287,-0.259817356213756,-0.501789301020574,288,-0.307755425645323,-0.585637339974298,289,-0.354924266788705,-0.663633884212968,290,-0.401205982106101,-0.734999618048778,291,-0.446484891412266,-0.799021478659614,292,-0.490647821014738,-0.85505978077707,293,-0.533584386589118,-0.902554608210185,294,-0.575187269082403,-0.941031408342954,295,-0.615352482954721,-0.970105733707185,296,-0.653979636089029,-0.989487083254535,297,-0.690972180719126,-0.998981804946949,298,-0.726237654748779,-0.998495030663815,299,-0.759687912858821,-0.988031624092862,300,-0.791239346824533,-0.967696132133805,301,-0.820813094492668,-0.937691740300281,302,-0.848335236895769,-0.898318242557355,303,-0.87373698301108,-0.849969045879328,304,-0.896954841702289,-0.793127239457285,305,-0.917930780414293,-0.728360767831593,306,-0.93661237022437,-0.65631675617779,307,-0.95295291688718,-0.577715044445732,308,-0.966911577546057,-0.493340994956778,309,-0.978453462818884,-0.404037645323065,310,-0.987549724003377,-0.310697285094372,311,-0.994177625183815,-0.214252540295888,312,-0.998320600058992,-0.115667054937237,313,-0.99996829334934,-0.0159258626001018,314,-0.999116586679734,0.0839744556917468,315,-0.995767608873289,0.183035728980588,316,-0.989929730630406,0.28026816976902,317,-0.981617543606384,0.374700263649462,318,-0.970851823939882,0.465388476354956,319,-0.957659480323385,0.551426681241691,320,-0.942073486745495,0.631955213006885,321,-0.92413280007313,0.706169457180334,322,-0.903882262679641,0.773327889566221,323,-0.881372490362235,0.83275948530778,324,-0.856659745828842,0.883870423545831,325,-0.829805798070649,0.926150020680529,326,-0.800877767971785,0.95917583295308,327,-0.769947960542072,0.98261787736414,328,-0.737093684192148,0.996241928754864,329,-0.702397057502714,0.999911860107267,330,-0.665944803970839,0.993591002680395,331,-0.627828035246386,0.977342512392259,332,-0.58814202340034,0.951328738786783,333,-0.546985962794236,0.915809602890819,334,-0.504462722145928,0.871140000169176,335,-0.460678587411363,0.817766254526442,336,-0.415742996125039,0.756221658786063,337,-0.369768263863173,0.687121146204744,338,-0.322869303513235,0.611155146262596,339,-0.275163338051597,0.529082686120024,340,-0.226769607547126,0.441723806669224,341,-0.177809071123116,0.349951368956662,342,-0.128404104622475,0.254682332844035,343,-0.0786781947318402,0.15686859504841,344,-0.0287556303291872,0.0574874781049246,345,0.021238808173646,-0.0424680347169515,346,0.0711801607170025,-0.141999220974002,347,0.120943599928474,-0.240111597953774,348,0.170404743126337,-0.335824859217142,349,0.219439963211459,-0.428182669496151,350,0.267926697670676,-0.516262220079927,351,0.315743754919243,-0.599183449214265,352,0.362771617216678,-0.676117835387764,353,0.40889273939888,-0.746296675644916,354,0.453991842679807,-0.809018766211906,355,0.497956202788415,-0.863657408692956,356,0.54067593172063,-0.909666671833528,357,0.582044252402122,-0.94658684628496,358,0.621957765575399,-0.974049037868326,359,0.66031670824408,-0.991778853443116,360,0.697025203028445,-0.999599142552803,361,0.731991497808947,-0.997431767453648,362,0.765128195058727,-0.985298383841204,363,0.796352470291923,-0.963320224473761,364,0.825586279081739,-0.931716887854706,365,0.852756552130873,-0.890804144076861,366,0.877795377906707,-0.840990779752102,367,0.900640172384768,-0.782774513550654,368,0.921233835476204,-0.716737023160658,369,0.939524893748256,-0.643538133356999,370,0.955467629081043,-0.563909223250262,371,0.96902219293905,-0.478645918588415,372,0.980154705971711,-0.388600142127343,373,0.988837342694146,-0.294671601500258,374,0.995048401036379,-0.197798799636462,375,0.99877235658721,-0.0989496575502895,376,0.999999901397162,0.000888156805717592,377,0.998727967243502,0.100717096992501,378,0.994959733299203,0.199539705238787,379,0.988704618186669,0.296368578709385,380,0.97997825643608,0.390236235307946,381,0.96880245940721,0.480204780438259,382,0.955205160772391,0.565375278137023,383,0.939220346696871,0.644896732944867,384,0.92088797089111,0.717974592771644,385,0.900253854747304,0.783878687798293,386,0.877369572809775,0.841950526092305,387,0.852292323865464,0.891609873041441,388,0.82508478797675,0.932360548866189,389,0.795814969813944,0.963795386284088,390,0.764556028679028,0.985600298790633,391,0.731386095645497,0.997557418907805,392,0.69638807827137,0.999547275043892,393,0.659649453373462,0.991549985214141,394,0.621262048380915,0.973645455694978,395,0.581321811814436,0.946012582626908,396,0.539928573464967,0.908927464543414,397,0.497185794871205,0.862760643685679,398,0.453200310719619,0.807973403666985,399,0.408082061813392,0.745113160479349,400,0.361943820277661,0.674807992893867,401,0.314900907687934,0.597760366905255,402,0.267070906826213,0.514740116923838,403,0.218573367785263,0.426576753844573,404,0.169529509155658,0.334151176848421,405,0.120061915042427,0.238386871748892,406,0.0702942286686256,0.140240683827072,407,0.020350843331683,0.0406932573498649,408,-0.029643408515078,-0.0592607627033863,409,-0.0795635672785401,-0.158622668804709,410,-0.129284858559711,-0.256399669633018,411,-0.178683005024735,-0.351614809716816,412,-0.227634537033503,-0.443316730850321,413,-0.276017101249467,-0.530589177750204,414,-0.323709766459235,-0.61256015297547,415,-0.370593325837641,-0.68841062963767,416,-0.416550594902727,-0.757382734846831,417,-0.461466704415909,-0.818787322126844,418,-0.505229387495269,-0.872010857139274,419,-0.547729260224268,-0.916521547915634,420,-0.588860095054592,-0.951874658346965,421,-0.628519086319688,-0.977716951840021,422,-0.666607107195395,-0.993790220740546,423,-0.703028957465386,-0.999933866258804,424,-0.737693601472117,-0.996086503119594,425,-0.770514395658569,-0.982286572903635,426,-0.801409305132014,-0.958671959951993,427,-0.830301108708525,-0.925478613671331,428,-0.857117591925725,-0.883038191005419,429,-0.881791727541324,-0.831774742628598,430,-0.904261843066324,-0.772200475971607,431,-0.924471774914122,-0.704910637414248,432,-0.942371008780226,-0.630577564780328,433,-0.957914805901716,-0.549943969560348,434,-0.971064314880838,-0.463815515983827,435,-0.981786668793277,-0.373052771088622,436,-0.990055067338345,-0.27856260621955,437,-0.995848843825779,-0.181289135869695,438,-0.999153516831702,-0.0822042844004434,439,-0.999960826394637,0.0177019251054136,440,-0.998268754661117,0.117431262827096,441,-0.994081530929262,0.215987266188224,442,-0.987409621077737,0.312385196181491,443,-0.978269701406507,0.405661876555336,444,-0.966684616954773,0.494885317552628,445,-0.952683324400268,0.579164028044271,446,-0.936300819682647,0.657655923013869,447,-0.917578050531861,0.729576737392853,448,-0.896561814120155,0.794207862177819,449,-0.873304640093516,0.850903524534118,450,-0.847864659274907,0.899097240144582,451,-0.820305458367489,0.938307473333554,452,-0.790695921020979,0.968142448412189,453,-0.75911005565839,0.988304064171637,454,-0.725626810493529,0.99859087241177,455,-0.690329876201572,0.998900090745021,456,-0.653307476735961,0.989228629564017,457,-0.61465214881447,0.969673122911921,458,-0.57446051062559,0.940428962947006,459,-0.532833020333398,0.901788347648809,460,-0.489873724984444,0.854137361272501,461,-0.445690000444333,0.797952116722631,462,-0.40039228301398,0.733793998390374,463,-0.354093793396359,0.662304052986243,464,-0.30691025370373,0.584196584413286,465,-0.258959598212611,0.500252016678587,466,-0.210361678589513,0.411309096154567,467,-0.161237964324189,0.318256511102488,468,-0.111711239119159,0.222024012193082,469,-0.0619052939944205,0.123573122745224,470,-0.0119446178743496,0.0238875315027389,471,0.0380459135697705,-0.0760367360583536,472,0.0879413500438914,-0.175201269687147,473,0.137616978941876,-0.272615250143074,474,0.186948637062043,-0.367305349134191,475,0.235813020950523,-0.458325454491766,476,0.284087995095673,-0.544766123410311,477,0.331652897203249,-0.625763669299474,478,0.378388839789311,-0.700508791454969,479,0.424179007336997,-0.768254661323667,480,0.468908948274497,-0.828324384567645,481,0.512466861044371,-0.880117764368662,482,0.554743873549213,-0.923117298396357,483,0.595634315275209,-0.956893349520488,484,0.635035981413371,-0.981108438603097,485,0.672850388318347,-0.995520616478515,486,0.708983019666234,-0.999985881429444,487,0.743343562696173,-0.994459618004515,488,0.775846133945218,-0.97899704280113,489,0.806409493912255,-0.953752652759472,490,0.834957250114457,-0.918978681480152,491,0.861418048028703,-0.875022578989447,492,0.885725749440722,-0.822323540133491,493,0.907819597756195,-0.761408116288541,494,0.927644369860585,-0.692884954233696,495,0.945150514148171,-0.617438714753462,496,0.96029427437526,-0.535823231733515,497,0.973037799027999,-0.448853980101705,498,0.98334923593146,-0.357399927872111,499,0.991202811863474,-0.262374853703929,500,0.991202811863474,-0.262374853703929,500]}],"start":0,"stop":520,"value":0,"interval":0.05,"rate":50,"components":["Reverse","Play","Slower","Faster","Reset","Slider","Label"],"buttonLabels":["Reverse","Play","Slower","Faster","Reset","Slider","Label"],"pause":"Pause","loop":true,"step":1,"labels":null,"precision":3,"reinit":null,"sceneId":"ageExample","respondTo":null},"evals":[],"jsHooks":[]}</script>
<p>The final function of this type is <a name="matrixSetter"><a href="../../rgl/help/matrixSetter"><code>matrixSetter</code></a></a>, for setting up multiple controls to modify a matrix, typically <code>userMatrix</code>. This is used when complex manipulation of a matrix requires several controls.</p>
</div>
<div id="user-defined-mouse-controls" class="section level2">
<h2>User defined mouse controls</h2>
<p><code>rgl</code> allows user defined mouse controls. For these to work within WebGL, you will need to write a Javascript version as well as the R version. This isnt easy: R provides a lot of support functions which are not easily available in Javascript.</p>
<p>TODO: give an example here.</p>
</div>
<div id="reference-for-rglclass" class="section level2">
<h2>Reference for <code>rglClass</code></h2>
<p>NB: This section has not been updated recently, and is not current.</p>
<p>In writing the <code>writeWebGL()</code> function, I havent tried to prevent access to anything. On the other hand, I havent provided access to everything. The parts documented here should remain relatively stable (unless indicated otherwise). Users may also consult the source to <code>writeWebGL</code>, but should be aware that anything that isnt documented here is subject to change without notice.</p>
<p><a name="rglClass"><code>rglClass</code></a></p>
<p>As documented in <a href="#writeWebGL"><code>writeWebGL</code></a>, the call</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">writeWebGL</span>(..., <span class="dt">prefix =</span> <span class="st">&quot;&lt;prefix&gt;&quot;</span>)</code></pre>
<p>will create a global object on the output page with name <code>&lt;prefix&gt;rgl</code> and Javascript class <code>rglClass</code>. This class has a large number of properties and methods, some of which are designed to be available for use by other code on the web page.</p>
<p>Most of the properties are stored as Javascript <code>Array</code> objects, indexed by the <code>rgl</code> id of the subscene to which they apply. There are also Javascript methods attached to the <code>rglClass</code> class.</p>
<div id="methods" class="section level3">
<h3>Methods</h3>
<p><a name="drawScene"><code>drawScene()</code></a></p>
<p>After any change that will affect the display, code should call <code>&lt;prefix&gt;rgl.drawScene()</code> to redraw the scene.</p>
<p><a name="inSubscene"><code>inSubscene()</code></a>, <a name="addToSubscene"><code>addToSubscene()</code></a>, <a name="delFromSubscene"><code>delFromSubscene()</code></a></p>
<p>These methods each take two arguments: <code>id</code> and <code>subscene</code>, which should be the <code>rgl</code> ids of an object and a subscene. <code>inSubscene</code> tests whether <code>id</code> is already included in the subscene, and the others add it or delete it from the subscene.</p>
<p><a name="getSubsceneEntries"><code>getSubsceneEntries()</code></a></p>
<p>This function takes a subscene id as argument, and returns an <code>Array</code> containing all of the ids displayed in that subscene.</p>
<p><a name="setSubsceneEntries"><code>setSubsceneEntries()</code></a></p>
<p>This takes an <code>Array</code> of ids and a subscene id as arguments, and sets the contents of the subscene to the ids.</p>
</div>
<div id="properties" class="section level3">
<h3>Properties</h3>
<p><a name="FOV"><code>FOV</code></a>, <a name="listeners"><code>listeners</code></a>, <a name="userMatrix"><code>userMatrix</code></a>, <a name="zoom"><code>zoom</code></a></p>
<p>These correspond to the <a href="#par3d"><code>par3d</code></a> properties with the same names.</p>
<ul>
<li><code>FOV</code> and <code>zoom</code> are arrays of numbers.</li>
<li><code>userMatrix</code> is an array of <code>CanvasMatrix4</code> objects (documented in the file <code>system.file(&quot;htmlwidgets/lib/CanvasMatrix/CanvasMatrix.src.js&quot;, package = &quot;rgl&quot;)</code>.</li>
<li>Each <code>listeners</code> item is itself an array of subscene ids that listen to mouse actions, i.e. <code>listeners[19]</code> would contain all subscene ids that respond to mouse actions in subscene 19.</li>
</ul>
<p><a name="viewport"><code>viewport</code></a></p>
<p>This property also corresponds to the <a href="#par3d"><code>par3d</code></a> property, but should be considered to be read-only.</p>
<p><a name="drawFns"><code>drawFns</code></a>, <a name="clipFns"><code>clipFns</code></a></p>
<p>These two arrays contain the code to display each object in the scene. The functions in the <code>drawFns</code> array are called for each object each time it is displayed. The <code>clipFns</code> functions are called when objects being clipped are drawn.</p>
<p><a name="values"><code>values</code></a>, <a name="offsets"><code>offsets</code></a></p>
<p>Most of the data about each object in a scene is contained in the <code>values</code> property. This is an array, indexed by object id. The individual entries are numeric arrays. Though they are singly-indexed, the entries are meant to be interpreted as matrices stored by row. The first 3 columns are generally the coordinates of a vertex, and remaining columns correspond to other values from <a href="#rgl.attrib"><code>rgl.attrib</code></a>.</p>
<p>The <code>offsets</code> property gives the (0-based) offset of the first column for a particular attribute in a named object. Not all columns will be present in every object; if not present, the corresponding <code>offsets</code> entry will be <code>-1</code>. The entries are</p>
<table>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="left">Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">vofs</td>
<td align="left">Offset to 3 columns of vertex data in XYZ order</td>
</tr>
<tr class="even">
<td align="left">cofs</td>
<td align="left">Offset to 4 columns of colour data in RGBA order</td>
</tr>
<tr class="odd">
<td align="left">nofs</td>
<td align="left">Offset to 3 columns of normal data</td>
</tr>
<tr class="even">
<td align="left">radofs</td>
<td align="left">Offset to 1 column of sphere radius data</td>
</tr>
<tr class="odd">
<td align="left">oofs</td>
<td align="left">Offset to 2 columns of text or sprite origin data</td>
</tr>
<tr class="even">
<td align="left">tofs</td>
<td align="left">Offset to 2 columns of texture coordinates</td>
</tr>
<tr class="odd">
<td align="left">stride</td>
<td align="left">Total number of columns in <code>values</code></td>
</tr>
</tbody>
</table>
<p>For example, to find the blue colour entry for vertex <code>i</code> in an object, one would first check if <code>offsets[&quot;cofs&quot;]</code> was <code>-1</code>, indicating that no colour information was present. If not, the entry could be found using</p>
<pre><code>values[offsets[&quot;stride&quot;]*(i-1) + offsets[&quot;cofs&quot;] + 2]</code></pre>
<p>This assumes <code>i</code> is specified using 1-based vertex counting as in R, and writes <code>values</code> and <code>offsets</code> instead of the fully specified <code>&lt;prefix&gt;rgl.values</code> and <code>&lt;prefix&gt;rgl.offsets</code> for clarity.</p>
<p>Changes to <code>values</code> need to be pushed to the graphics system to be reflected in the scene; see the calls to <code>gl.bindBuffer</code> and <code>gl.bufferData</code> in the source to <a href="#propertySlider"><code>propertySlider</code></a> for details.</p>
</div>
</div>
<div id="index" class="section level2">
<h2>Index</h2>
<p>The following functions and <code>rglClass</code> properties and methods are described in this document:<br></p>
<div class="nostripes">
<table>
<tbody>
<tr class="odd">
<td align="left"><a href="#FOV">FOV</a></td>
<td align="left"><a href="#drawFns">drawFns</a></td>
<td align="left"><a href="#offsets">offsets</a></td>
<td align="left"><a href="#rglwidget">rglwidget</a></td>
<td align="left"><a href="#vertexSetter">vertexSetter</a></td>
</tr>
<tr class="even">
<td align="left"><a href="#addToSubscene">addToSubscene</a></td>
<td align="left"><a href="#drawScene">drawScene</a></td>
<td align="left"><a href="#par3dinterpSetter">par3dinterpSetter</a></td>
<td align="left"><a href="#setSubsceneEntries">setSubsceneEntries</a></td>
<td align="left"><a href="#viewport">viewport</a></td>
</tr>
<tr class="odd">
<td align="left"><a href="#ageControl">ageControl</a></td>
<td align="left"><a href="#elementId2Prefix">elementId2Prefix</a></td>
<td align="left"><a href="#playwidget">playwidget</a></td>
<td align="left"><a href="#subsetSlider">subsetSlider</a></td>
<td align="left"><a href="#zoom">zoom</a></td>
</tr>
<tr class="even">
<td align="left"><a href="#ageSetter">ageSetter</a></td>
<td align="left"><a href="#getSubsceneEntries">getSubsceneEntries</a></td>
<td align="left"><a href="#propertySetter">propertySetter</a></td>
<td align="left"><a href="#toggleButton">toggleButton</a></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><a href="#clipFns">clipFns</a></td>
<td align="left"><a href="#inSubscene">inSubscene</a></td>
<td align="left"><a href="#propertySlider">propertySlider</a></td>
<td align="left"><a href="#toggleWidget">toggleWidget</a></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><a href="#clipplaneSlider">clipplaneSlider</a></td>
<td align="left"><a href="#listeners">listeners</a></td>
<td align="left"><a href="#propertySlider">propertySlider</a></td>
<td align="left"><a href="#userMatrix">userMatrix</a></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><a href="#delFromSubscene">delFromSubscene</a></td>
<td align="left"><a href="#matrixSetter">matrixSetter</a></td>
<td align="left"><a href="#rglClass">rglClass</a></td>
<td align="left"><a href="#values">values</a></td>
<td align="left"></td>
</tr>
</tbody>
</table>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
